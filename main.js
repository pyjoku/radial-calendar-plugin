/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Gt=Object.defineProperty;var Ue=Object.getOwnPropertyDescriptor;var Xe=Object.getOwnPropertyNames;var qe=Object.prototype.hasOwnProperty;var ut=(l,n)=>()=>(l&&(n=l(l=0)),n);var le=(l,n)=>{for(var t in n)Gt(l,t,{get:n[t],enumerable:!0})},Ke=(l,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of Xe(n))!qe.call(l,r)&&r!==t&&Gt(l,r,{get:()=>n[r],enumerable:!(e=Ue(n,r))||e.enumerable});return l};var Bt=l=>Ke(Gt({},"__esModule",{value:!0}),l);function M(l,n,t){let e={year:l,month:n,day:t};if(!pt(e))throw new Error(`Invalid date: ${l}-${n}-${t}`);return Object.freeze(e)}function W(l){let n=l.month.toString().padStart(2,"0"),t=l.day.toString().padStart(2,"0");return`${l.year}-${n}-${t}`}function de(l){let n=l.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!n)return null;let t=parseInt(n[1],10),e=parseInt(n[2],10),r=parseInt(n[3],10),a={year:t,month:e,day:r};return pt(a)?Object.freeze(a):null}function L(l,n){return l.year!==n.year?l.year-n.year:l.month!==n.month?l.month-n.month:l.day-n.day}function K(l,n){return l.year===n.year&&l.month===n.month&&l.day===n.day}function pt(l){let{year:n,month:t,day:e}=l;if(!Number.isInteger(n)||n<1||!Number.isInteger(t)||t<1||t>12||!Number.isInteger(e)||e<1)return!1;let r=C(n,t);return e<=r}function C(l,n){let t=[31,28,31,30,31,30,31,31,30,31,30,31];return n===2&&yt(l)?29:t[n-1]}function yt(l){return l%4===0&&l%100!==0||l%400===0}function k(l){let n=l.year,t=l.month,e=l.day;t<3&&(t+=12,n-=1);let r=e,a=t,i=n%100,s=Math.floor(n/100),o=(r+Math.floor(13*(a+1)/5)+i+Math.floor(i/4)+Math.floor(s/4)-2*s)%7;return o=(o%7+7)%7,(o+6)%7}function H(l,n){let t=l.year,e=l.month,r=l.day+n;for(;r>C(t,e);)r-=C(t,e),e+=1,e>12&&(e=1,t+=1);for(;r<1;)e-=1,e<1&&(e=12,t-=1),r+=C(t,e);return Object.freeze({year:t,month:e,day:r})}function ue(l,n){return H(l,-n)}function F(){let l=new Date;return Object.freeze({year:l.getFullYear(),month:l.getMonth()+1,day:l.getDate()})}function he(l,n){let t=ce(l);return ce(n)-t}function mt(l,n){return L(l,n)<0}function ft(l,n){return L(l,n)>0}function ge(l,n,t){return L(l,n)>=0&&L(l,t)<=0}function pe(l){return Object.freeze({year:l.year,month:l.month,day:1})}function ye(l){let n=C(l.year,l.month);return Object.freeze({year:l.year,month:l.month,day:n})}function ce(l){let{year:n,month:t,day:e}=l,r=n*365+Math.floor(n/4)-Math.floor(n/100)+Math.floor(n/400);return r+=[0,31,59,90,120,151,181,212,243,273,304,334][t-1],t>2&&yt(n)&&(r+=1),r+=e,r}var $=ut(()=>{"use strict"});function V(l){var e;let n=l.endDate!==null&&(l.startDate.year!==l.endDate.year||l.startDate.month!==l.endDate.month||l.startDate.day!==l.endDate.day),t=(e=l.isAnniversary)!=null?e:l.startDate.year===0;return Object.freeze({id:l.id,filePath:l.filePath,fileName:l.fileName,displayName:l.displayName,startDate:l.startDate,endDate:l.endDate,isMultiDay:n,isAnniversary:t,metadata:Object.freeze({tags:Object.freeze([...l.metadata.tags]),folder:l.metadata.folder,properties:Object.freeze({...l.metadata.properties})})})}function fe(){return Object.freeze({tags:Object.freeze([]),folder:"",properties:Object.freeze({})})}function be(l){if(typeof l!="object"||l===null)return!1;let n=l;return typeof n.id=="string"&&typeof n.filePath=="string"&&typeof n.fileName=="string"&&typeof n.displayName=="string"&&me(n.startDate)&&(n.endDate===null||me(n.endDate))&&typeof n.isMultiDay=="boolean"&&typeof n.isAnniversary=="boolean"&&Qe(n.metadata)}function me(l){if(typeof l!="object"||l===null)return!1;let n=l;return typeof n.year=="number"&&typeof n.month=="number"&&typeof n.day=="number"}function Qe(l){if(typeof l!="object"||l===null)return!1;let n=l;return Array.isArray(n.tags)&&typeof n.folder=="string"&&typeof n.properties=="object"&&n.properties!==null}var _t=ut(()=>{"use strict"});function Se(l,n){if(L(l,n)>0)throw new Error("Start date must be before or equal to end date");return Object.freeze({start:l,end:n})}function De(l){return Object.freeze({start:l,end:l})}function Wt(l,n){return L(l.start,n.end)<=0&&L(n.start,l.end)<=0}function ve(l,n){return L(l,n.start)>=0&&L(l,n.end)<=0}function Ae(l,n){return L(l.start,n.start)<=0&&L(l.end,n.end)>=0}function we(l,n){if(!Wt(l,n))return null;let t=L(l.start,n.start)>=0?l.start:n.start,e=L(l.end,n.end)<=0?l.end:n.end;return Object.freeze({start:t,end:e})}function Ee(l){if(l.start.year===l.end.year&&l.start.month===l.end.month)return l.end.day-l.start.day+1;let n=0,t=l.start;for(;L(t,l.end)<=0;)n++,t=H(t,1);return n}function Ce(l,n){let t=[],e=l.start.year,r=l.start.month,a=l.start.day;for(;e<l.end.year||e===l.end.year&&r<=l.end.month;){let i=C(e,r),s;e===l.end.year&&r===l.end.month?s=l.end.day:s=i,t.push(Object.freeze({year:e,month:r,startDay:a,endDay:s,entryId:n})),r++,r>12&&(r=1,e++),a=1}return Object.freeze(t)}function Me(l,n,t,e){let r={year:n,month:t,day:1},a={year:n,month:t,day:C(n,t)};if(ft(l.start,a)||mt(l.end,r))return null;let i=l.start.year===n&&l.start.month===t?l.start.day:1,s=l.end.year===n&&l.end.month===t?l.end.day:C(n,t);return Object.freeze({year:n,month:t,startDay:i,endDay:s,entryId:e})}function Le(l,n){return Object.freeze({start:{year:l,month:n,day:1},end:{year:l,month:n,day:C(l,n)}})}function Re(l){return K(l.start,l.end)}function xe(l,n,t){return Object.freeze({start:H(l.start,-n),end:H(l.end,t)})}var Te=ut(()=>{"use strict";$()});var Zt={};le(Zt,{DEFAULT_DATE_EXTRACTION_CONFIG:()=>vt,DEFAULT_DISPLAY_CONFIG:()=>wt,DEFAULT_FOLDER_FILTER_CONFIG:()=>At,DEFAULT_PLUGIN_SETTINGS:()=>Ht,DEFAULT_RADIAL_SETTINGS:()=>Et,DEFAULT_SETTINGS:()=>en,PREDEFINED_QUARTERS:()=>Ut,PREDEFINED_SEASONS:()=>jt,PREDEFINED_SEMESTERS:()=>Xt,RING_COLORS:()=>P,RING_SEGMENT_TEMPLATE:()=>Jt,addDays:()=>H,assignTracks:()=>J,compareLocalDates:()=>L,computeSubRingRadii:()=>z,createCalendarEntry:()=>V,createCurrentViewState:()=>nn,createDateRange:()=>Se,createDefaultRing:()=>zt,createEmptyMetadata:()=>fe,createEventsRing:()=>sn,createLifePhasesRing:()=>an,createLocalDate:()=>M,createMonthRange:()=>Le,createPluginSettings:()=>tn,createSingleDayRange:()=>De,createViewState:()=>rn,daysBetween:()=>he,extendRange:()=>xe,generate10DayPhases:()=>qt,generateWeekSegments:()=>Kt,getDaysInMonth:()=>C,getFirstDayOfMonth:()=>pe,getLastDayOfMonth:()=>ye,getMaxTrackCount:()=>Z,getMonthSegment:()=>Me,getRangeDays:()=>Ee,getToday:()=>F,getWeekday:()=>k,intersectRanges:()=>we,isAfter:()=>ft,isBefore:()=>mt,isCalendarEntry:()=>be,isDateInRange:()=>ve,isLeapYear:()=>yt,isSingleDay:()=>Re,isValidLocalDate:()=>pt,isWithinRange:()=>ge,keyToLocalDate:()=>de,localDateToKey:()=>W,localDatesEqual:()=>K,rangeContains:()=>Ae,rangesOverlap:()=>Wt,splitRangeByMonth:()=>Ce,subtractDays:()=>ue});function tn(l){var n,t;return Object.freeze({dateExtraction:l.dateExtraction?Object.freeze({...vt,...l.dateExtraction}):vt,folderFilter:l.folderFilter?Object.freeze({...At,...l.folderFilter}):At,display:l.display?Object.freeze({...wt,...l.display}):wt,locale:(n=l.locale)!=null?n:Ht.locale,debugMode:(t=l.debugMode)!=null?t:Ht.debugMode})}function nn(){let l=new Date;return Object.freeze({year:l.getFullYear(),month:l.getMonth()+1,selectedDate:null,focusedEntryId:null})}function rn(l,n){return Object.freeze({year:l,month:n,selectedDate:null,focusedEntryId:null})}function zt(l){return{id:`ring-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Ring ${l+1}`,folder:"",color:"blue",segmentType:"monthly",enabled:!0,order:l,ringType:"year-days",segmentStyle:"fixed",folderPattern:"fixed",recursive:!1,showGaps:!1,showLabels:!1}}function an(l,n=0){return{id:`life-phases-${Date.now()}`,name:"Life Phases",folder:l,color:"blue",segmentType:"custom",enabled:!0,order:n,ringType:"life-phases",segmentStyle:"from-yaml",folderPattern:"fixed",recursive:!1,startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",showGaps:!0,showLabels:!0}}function sn(l,n=1){return{id:`events-${Date.now()}`,name:"Events",folder:l,color:"teal",segmentType:"custom",enabled:!0,order:n,ringType:"events",segmentStyle:"from-yaml",folderPattern:"year-substitution",recursive:!1,startDateField:"event-start",endDateField:"event-end",colorField:"event-color",labelField:"event-label",showGaps:!0,showLabels:!0}}function J(l){let n=[...l].sort((e,r)=>e.startAngle-r.startAngle),t=[];return n.map(e=>{let r=t.findIndex(a=>a.endAngle<=e.startAngle);return r===-1?(r=t.length,t.push({endAngle:e.endAngle})):t[r].endAngle=e.endAngle,{...e,track:r}})}function z(l,n,t,e){let r=(l-n)/t;return{outer:l-e*r,inner:l-(e+1)*r}}function Z(l){return l.length===0?1:Math.max(...l.map(n=>n.track))+1}function qt(){let l=[],n=1,t=1;for(;n<=365;){let e=Math.min(n+9,365);l.push({id:`10d-${t}`,label:`P${t}`,startDay:n,endDay:e}),n=e+1,t++}return l}function Kt(){let l=[];for(let n=1;n<=52;n++){let t=(n-1)*7+1,e=Math.min(n*7,365);l.push({id:`w-${n}`,label:`W${n}`,startDay:t,endDay:e})}return l}var vt,At,wt,Ht,en,P,jt,Ut,Xt,Et,Jt,j=ut(()=>{"use strict";$();_t();Te();vt=Object.freeze({fromFilename:!0,fromFrontmatter:!0,frontmatterField:"date",endDateField:"endDate",filenamePatterns:Object.freeze(["^(\\d{4}-\\d{2}-\\d{2})","(\\d{4}-\\d{2}-\\d{2})$","^(\\d{4}-\\d{2}-\\d{2})[-_\\s]","[-_\\s](\\d{4}-\\d{2}-\\d{2})\\.md$"]),useCreationDateFallback:!1}),At=Object.freeze({includeFolders:Object.freeze([]),excludeFolders:Object.freeze([])}),wt=Object.freeze({firstDayOfWeek:1,showWeekNumbers:!1,highlightToday:!0,showAdjacentMonths:!0,maxEntriesPerDay:3,showMultiDayBars:!0}),Ht=Object.freeze({dateExtraction:vt,folderFilter:At,display:wt,locale:"en-US",debugMode:!1});en={calendarWidth:"fit",dateProperties:["date","startDate","created"],endDateProperties:["endDate","due","deadline"],datePriority:"property",dailyNoteFolder:"",dailyNoteFormat:"YYYY-MM-DD",showMultiDayBars:!0,showWeekendHighlight:!0,anniversaryDateProperties:[]};P={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",teal:"#14b8a6",cyan:"#06b6d4",magenta:"#d946ef",lime:"#84cc16",amber:"#f59e0b",indigo:"#6366f1",violet:"#8b5cf6",rose:"#f43f5e",gray:"#6b7280",slate:"#64748b",stone:"#78716c"};jt=[{id:"spring",label:"Spring",startDay:60,endDay:152},{id:"summer",label:"Summer",startDay:152,endDay:244},{id:"autumn",label:"Autumn",startDay:244,endDay:335},{id:"winter",label:"Winter",startDay:335,endDay:60}],Ut=[{id:"q1",label:"Q1",startDay:1,endDay:90},{id:"q2",label:"Q2",startDay:91,endDay:181},{id:"q3",label:"Q3",startDay:182,endDay:273},{id:"q4",label:"Q4",startDay:274,endDay:365}],Xt=[{id:"s1",label:"H1",startDay:1,endDay:181},{id:"s2",label:"H2",startDay:182,endDay:365}];Et={currentView:"annual",birthYear:1990,expectedLifespan:85,currentYear:new Date().getFullYear(),rings:[],centerDisplay:"countdown",periodicNotesFormat:{yearly:"YYYY",monthly:"YYYY-MM",daily:"YYYY-MM-DD"},templateFolder:"Templates",dailyNoteFolder:"",calendarFilterFolder:"",annualRecurringFolder:"",lifePhasesFolder:"",annualSegmentType:"none",customSegments:[],lifeActs:[],showSegmentLabels:!0,anniversaryDateProperties:[],calendarSources:[]},Jt=`---
# === RADIAL CALENDAR TEMPLATE ===
# Delete the lines you don't need

# COLORS (choose one):
ring-color: blue
# ring-color: red
# ring-color: orange
# ring-color: yellow
# ring-color: green
# ring-color: teal
# ring-color: purple
# ring-color: magenta
# ring-color: pink
# ring-color: cyan
# ring-color: lime
# ring-color: amber
# ring-color: indigo

# STYLE (choose one):
ring-style: solid
# ring-style: striped
# ring-style: dotted
# ring-style: gradient

# LABEL & ICON:
ring-label: ""
ring-icon: circle

# DATE RANGE:
date: {{date}}
# end-date:

# PROGRESS (0-100):
# ring-progress: 0
---

# {{title}}

`});var yn={};le(yn,{default:()=>Yt});module.exports=Bt(yn);var O=require("obsidian");var ht=class{constructor(n){this.app=n}getAllMarkdownFiles(){return this.app.vault.getMarkdownFiles().map(t=>this.toFileInfo(t))}getMarkdownFilesInFolder(n){return this.getAllMarkdownFiles().filter(t=>t.folderPath?t.folderPath===n||t.folderPath.startsWith(n+"/"):!1)}getFileByPath(n){let t=this.app.vault.getAbstractFileByPath(n);return t instanceof this.getTFileClass()?t:null}async readFile(n){let t=this.getFileByPath(n);if(!t)return null;try{return await this.app.vault.read(t)}catch(e){return null}}async createOrOpenDailyNote(n,t=""){let e=this.getFileByPath(n);if(!e){let r=n.substring(0,n.lastIndexOf("/"));r&&await this.ensureFolderExists(r),e=await this.app.vault.create(n,t)}return e}async ensureFolderExists(n){this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n)}fileExists(n){return this.getFileByPath(n)!==null}getRoot(){return this.app.vault.getRoot()}toFileInfo(n){var t,e;return Object.freeze({path:n.path,basename:n.basename,name:n.name,extension:n.extension,folderPath:(e=(t=n.parent)==null?void 0:t.path)!=null?e:null})}getTFileClass(){let n=this.app.vault.getMarkdownFiles();return n.length>0?n[0].constructor:class{}}};var gt=class{constructor(n){this.app=n}getMetadata(n){let t=this.app.metadataCache.getFileCache(n);return this.extractMetadata(t)}getMetadataByPath(n){let t=this.app.vault.getAbstractFileByPath(n);return!t||!this.isMarkdownFile(t)?null:this.getMetadata(t)}getProperty(n,t){var r;return(r=this.getMetadata(n).frontmatter)==null?void 0:r[t]}getStringProperty(n,t){let e=this.getProperty(n,t);return typeof e=="string"?e:e instanceof Date?this.formatDate(e):typeof e=="number"?String(e):null}getDateProperty(n,t){let e=this.getProperty(n,t);if(!e)return null;if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;let r=e.match(/^(\d{4}-\d{2}-\d{2})/);return r?r[1]:null}return e instanceof Date&&!isNaN(e.getTime())?this.formatDate(e):this.isLocalDateLike(e)?this.formatLocalDate(e):null}getTags(n){return this.getMetadata(n).tags}hasTag(n,t){let e=t.startsWith("#")?t:`#${t}`;return this.getTags(n).some(a=>a.tag.toLowerCase()===e.toLowerCase())}onMetadataChange(n){let t=e=>n(e);return this.app.metadataCache.on("changed",t),()=>this.app.metadataCache.off("changed",t)}extractMetadata(n){var r;let t=(r=n==null?void 0:n.frontmatter)!=null?r:null,e=[];if(t!=null&&t.tags){let a=Array.isArray(t.tags)?t.tags:[t.tags];for(let i of a)if(typeof i=="string"){let s=i.startsWith("#")?i:`#${i}`;e.push({tag:s,name:s.substring(1)})}}if(n!=null&&n.tags)for(let a of n.tags)e.find(s=>s.tag.toLowerCase()===a.tag.toLowerCase())||e.push({tag:a.tag,name:a.tag.substring(1)});return Object.freeze({frontmatter:t,tags:Object.freeze(e)})}formatDate(n){let t=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${t}-${e}-${r}`}formatLocalDate(n){let t=n.year,e=String(n.month).padStart(2,"0"),r=String(n.day).padStart(2,"0");return`${t}-${e}-${r}`}isLocalDateLike(n){return typeof n=="object"&&n!==null&&"year"in n&&"month"in n&&"day"in n&&typeof n.year=="number"&&typeof n.month=="number"&&typeof n.day=="number"}isMarkdownFile(n){return typeof n=="object"&&n!==null&&"extension"in n&&n.extension==="md"}};$();var bt=class{constructor(n={}){var t,e;this.entriesByPath=new Map,this.entriesByDate=new Map,this.multiDayEntriesByDate=new Map,this.anniversaryEntriesByMonthDay=new Map,this.stats={hits:0,misses:0,lastRebuild:0},this.config={maxEntries:(t=n.maxEntries)!=null?t:1e4,debug:(e=n.debug)!=null?e:!1}}addEntry(n){if(this.removeEntry(n.filePath),this.entriesByPath.set(n.filePath,n),n.isAnniversary){let e=this.monthDayKey(n.startDate.month,n.startDate.day);this.addToDateIndex(e,n,this.anniversaryEntriesByMonthDay),this.log(`Added anniversary entry: ${n.filePath}`);return}let t=W(n.startDate);this.addToDateIndex(t,n,this.entriesByDate),n.isMultiDay&&n.endDate&&this.indexMultiDayEntry(n),this.log(`Added entry: ${n.filePath}`)}monthDayKey(n,t){return`${String(n).padStart(2,"0")}-${String(t).padStart(2,"0")}`}removeEntry(n){let t=this.entriesByPath.get(n);if(!t)return;if(this.entriesByPath.delete(n),t.isAnniversary){let r=this.monthDayKey(t.startDate.month,t.startDate.day);this.removeFromDateIndex(r,t.id,this.anniversaryEntriesByMonthDay),this.log(`Removed anniversary entry: ${n}`);return}let e=W(t.startDate);this.removeFromDateIndex(e,t.id,this.entriesByDate),t.isMultiDay&&t.endDate&&this.removeMultiDayEntry(t),this.log(`Removed entry: ${n}`)}getEntriesForDate(n){var o,c,d;let t=W(n),e=this.monthDayKey(n.month,n.day),r=(o=this.entriesByDate.get(t))!=null?o:[],a=(c=this.multiDayEntriesByDate.get(t))!=null?c:[],i=(d=this.anniversaryEntriesByMonthDay.get(e))!=null?d:[];r.length>0||a.length>0||i.length>0?this.stats.hits++:this.stats.misses++;let s=new Map;for(let g of r)s.set(g.id,g);for(let g of a)s.set(g.id,g);for(let g of i)s.set(g.id,g);return Array.from(s.values())}getEntriesInRange(n,t){var r;let e=new Map;for(let a of this.entriesByPath.values()){let i=(r=a.endDate)!=null?r:a.startDate;L(a.startDate,t)<=0&&L(i,n)>=0&&e.set(a.id,a)}return Array.from(e.values())}getMultiDayEntries(){return Array.from(this.entriesByPath.values()).filter(n=>n.isMultiDay)}getAnniversaryEntriesForDate(n){var e;let t=this.monthDayKey(n.month,n.day);return(e=this.anniversaryEntriesByMonthDay.get(t))!=null?e:[]}getAllAnniversaryEntries(){let n=[];for(let t of this.anniversaryEntriesByMonthDay.values())n.push(...t);return n}getEntryByPath(n){return this.entriesByPath.get(n)}hasEntry(n){return this.entriesByPath.has(n)}getAllEntries(){return Array.from(this.entriesByPath.values())}clear(){this.entriesByPath.clear(),this.entriesByDate.clear(),this.multiDayEntriesByDate.clear(),this.stats={hits:0,misses:0,lastRebuild:Date.now()},this.log("Cache cleared")}rebuild(n){this.clear(),this.stats.lastRebuild=Date.now();for(let t of n)this.addEntry(t);this.log(`Cache rebuilt with ${n.length} entries`)}getStats(){return Object.freeze({entryCount:this.entriesByPath.size,dateCount:this.entriesByDate.size+this.multiDayEntriesByDate.size,hits:this.stats.hits,misses:this.stats.misses,lastRebuild:this.stats.lastRebuild})}indexMultiDayEntry(n){if(!n.endDate)return;let t=n.startDate,e=n.endDate;for(;L(t,e)<0;)if(t=this.addOneDay(t),L(t,e)<=0){let r=W(t);this.addToDateIndex(r,n,this.multiDayEntriesByDate)}}removeMultiDayEntry(n){if(!n.endDate)return;let t=n.startDate,e=n.endDate;for(;L(t,e)<0;)if(t=this.addOneDay(t),L(t,e)<=0){let r=W(t);this.removeFromDateIndex(r,n.id,this.multiDayEntriesByDate)}}addToDateIndex(n,t,e){let r=e.get(n);r?r.push(t):e.set(n,[t])}removeFromDateIndex(n,t,e){let r=e.get(n);if(!r)return;let a=r.filter(i=>i.id!==t);a.length===0?e.delete(n):e.set(n,a)}addOneDay(n){let t=n.day+1,e=n.month,r=n.year,a=this.getDaysInMonth(r,e);return t>a&&(t=1,e+=1,e>12&&(e=1,r+=1)),{year:r,month:e,day:t}}getDaysInMonth(n,t){let e=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2?n%4===0&&n%100!==0||n%400===0?29:28:e[t-1]}log(n){this.config.debug&&console.log(`[EntryCache] ${n}`)}};var St=class St{parseDate(n){if(n==null)return null;if(typeof n=="string")return this.parseDateString(n);if(n instanceof Date)return isNaN(n.getTime())?null:{year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate()};if(typeof n=="object"&&n!==null){let t=n;if(typeof t.year=="number"&&typeof t.month=="number"&&typeof t.day=="number"&&this.isValidDate(t.year,t.month,t.day))return{year:t.year,month:t.month,day:t.day}}return null}parseDateString(n){let t=n.trim(),e=t.match(/^XXXX-(\d{2})-(\d{2})$/i);if(e){let o=parseInt(e[1],10),c=parseInt(e[2],10);return this.isValidDate(2e3,o,c)?{year:0,month:o,day:c}:null}let r=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!r)return null;let a=parseInt(r[1],10),i=parseInt(r[2],10),s=parseInt(r[3],10);return this.isValidDate(a,i,s)?{year:a,month:i,day:s}:null}isValidDate(n,t,e){if(n<1900||n>2100||t<1||t>12||e<1||e>31)return!1;let r=this.getDaysInMonth(n,t);return!(e>r)}getDaysInMonth(n,t){let e=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2&&this.isLeapYear(n)?29:e[t-1]}isLeapYear(n){return n%4===0&&n%100!==0||n%400===0}extractFromFilename(n){let t={start:null,end:null};if(!n||typeof n!="string")return t;let e=n.match(St.DATE_PATTERN);return!e||e.length===0||(t.start=this.parseDate(e[0]),e.length>=2&&(t.end=this.parseDate(e[1]))),t}extractFromProperties(n,t){if(!n||typeof n!="object"||!Array.isArray(t))return null;for(let e of t){if(typeof e!="string"||!e)continue;let r=n[e];if(r==null)continue;let a=this.parseDate(r);if(a!==null)return a}return null}extractDates(n,t,e){let r={start:null,end:null},a=this.extractFromFilename(n);for(let i of e.priorities)i==="filename"?(r.start===null&&a.start!==null&&(r.start=a.start),r.end===null&&a.end!==null&&(r.end=a.end)):i==="properties"&&(r.start===null&&(r.start=this.extractFromProperties(t,e.startSources)),r.end===null&&(r.end=this.extractFromProperties(t,e.endSources)));return r}};St.DATE_PATTERN=/(\d{4}-\d{2}-\d{2})/g;var at=St,wn=new at;$();var Je=["January","February","March","April","May","June","July","August","September","October","November","December"],Dt=class{getDaysInMonth(n,t){return C(n,t)}getFirstDayOfWeek(n,t){let e=M(n,t,1);return k(e)}isToday(n){let t=F();return K(n,t)}generateGrid(n){let t=[];for(let e=1;e<=12;e++)t.push(this.generateMonth(n,e));return{year:n,months:t}}generateMonth(n,t){let e=this.getDaysInMonth(n,t),r=this.getFirstDayOfWeek(n,t),a=[];for(let i=0;i<r;i++)a.push({date:M(n,t,1),isToday:!1,isEmpty:!0});for(let i=1;i<=e;i++){let s=M(n,t,i);a.push({date:s,isToday:this.isToday(s),isEmpty:!1})}return{month:t,name:Je[t-1],startDayOfWeek:r,daysInMonth:e,days:a}}};$();var Ze=24,st=class{calculateMonthSegments(n,t,e){let r=[];if(L(n,t)>0)return r;let a=n.year,i=n.month,s=0;for(;s<Ze;){let o=a===n.year&&i===n.month,c=a===t.year&&i===t.month,d=o?n.day:1,g=c?t.day:C(a,i);if(r.push({year:a,month:i,startDay:d,endDay:g,entryId:e}),c)break;i++,i>12&&(i=1,a++),s++}return r}calculateBarPositions(n,t){let e=new Map;if(n.length===0)return e;let r=[...n].sort((i,s)=>i.startDay!==s.startDay?i.startDay-s.startDay:s.endDay-s.startDay-(i.endDay-i.startDay)),a=[];for(let i=0;i<=31;i++)a.push(new Set);for(let i of r){let s=(t.startDayOfWeek+i.startDay-1)%7,o=(t.startDayOfWeek+i.endDay-1)%7,c=i.endDay-i.startDay+1,d=0,g=!1;for(;!g;){let u=!0;for(let h=i.startDay;h<=i.endDay;h++)if(a[h].has(d)){u=!1;break}if(u){g=!0;for(let h=i.startDay;h<=i.endDay;h++)a[h].add(d)}else d++;if(d>100)break}e.set(i.entryId,{rowIndex:d,startColumn:s,endColumn:o,span:c})}return e}},xn=new st;_t();$();$();var Ct=class{constructor(n,t){this.unregisterMetadataListener=null;this.eventListeners=null;this.updateSubscribers=new Set;this.vaultRepository=new ht(n),this.metadataRepository=new gt(n),this.entryCache=new bt({debug:!1}),this.dateEngine=new at,this.calendarEngine=new Dt,this.multiDayEngine=new st,this.settings=t,this.currentYear=F().year}async initialize(){await this.rebuildCache(),this.setupMetadataListener()}destroy(){this.unregisterMetadataListener&&(this.unregisterMetadataListener(),this.unregisterMetadataListener=null),this.eventListeners=null}setEventListeners(n){this.eventListeners=n}subscribeToUpdates(n){return this.updateSubscribers.add(n),()=>{this.updateSubscribers.delete(n)}}notifySubscribers(){for(let n of this.updateSubscribers)try{n()}catch(t){console.error("Radcal subscriber error:",t)}}async updateSettings(n){let t=this.settings.dateProperties.join(",")!==n.dateProperties.join(",")||this.settings.endDateProperties.join(",")!==n.endDateProperties.join(",")||this.settings.datePriority!==n.datePriority;this.settings=n,t&&await this.rebuildCache()}getCurrentYear(){return this.currentYear}setCurrentYear(n){var t;this.currentYear!==n&&(this.currentYear=n,(t=this.eventListeners)==null||t.onYearChanged(n))}setYear(n){this.setCurrentYear(n)}nextYear(){this.setCurrentYear(this.currentYear+1)}previousYear(){this.setCurrentYear(this.currentYear-1)}goToToday(){this.setCurrentYear(F().year)}generateCalendarGrid(){return this.calendarEngine.generateGrid(this.currentYear)}getEntriesForDate(n){return this.entryCache.getEntriesForDate(n)}getMultiDayEntries(){return this.entryCache.getMultiDayEntries().filter(n=>{var a;let t={year:this.currentYear,month:1,day:1},e={year:this.currentYear,month:12,day:31},r=(a=n.endDate)!=null?a:n.startDate;return n.startDate.year===this.currentYear||n.startDate.year<this.currentYear&&r.year>=this.currentYear})}getAnniversaryEntriesForDate(n){return this.entryCache.getAnniversaryEntriesForDate(n)}getAllAnniversaryEntries(){return this.entryCache.getAllAnniversaryEntries()}calculateBarPositions(n,t){return new Map}async openDailyNote(n){let t=this.settings.dailyNoteFormat,e=this.settings.dailyNoteFolder,r=this.formatDailyNoteFilename(n,t),a=e?`${e}/${r}.md`:`${r}.md`,i=await this.vaultRepository.createOrOpenDailyNote(a);console.log(`Opening daily note: ${i.path}`)}getCacheStats(){let n=this.entryCache.getStats();return{entryCount:n.entryCount,dateCount:n.dateCount}}loadLifePhases(n,t={startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",categoryField:"phase-category"}){if(!n)return[];let e=this.vaultRepository.getAllMarkdownFiles(),r=[],a=n.endsWith("/")?n:`${n}/`,i=e.filter(s=>s.path===`${n}.md`||s.path.startsWith(a));for(let s of i){let o=this.metadataRepository.getMetadataByPath(s.path),c=o==null?void 0:o.frontmatter;if(!c)continue;let d=c[t.startDateField];if(!d||typeof d!="string")continue;let g=this.parseYAMLDate(d);if(!g)continue;let u=c[t.endDateField],h=null;u&&typeof u=="string"&&u.trim()!==""&&(h=this.parseYAMLDate(u));let p=c[t.colorField],m=this.isValidColor(p)?p:"blue",y=c[t.labelField]||s.basename,f=c[t.categoryField];r.push({filePath:s.path,label:String(y),startDate:g,endDate:h,color:m,category:f?String(f):void 0})}return r.sort((s,o)=>s.startDate.year!==o.startDate.year?s.startDate.year-o.startDate.year:s.startDate.month!==o.startDate.month?s.startDate.month-o.startDate.month:s.startDate.day-o.startDate.day)}parseYAMLDate(n){let t=n.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return null;let e=parseInt(t[1],10),r=parseInt(t[2],10),a=parseInt(t[3],10);return r<1||r>12||a<1||a>31?null:M(e,r,a)}isValidColor(n){return typeof n=="string"&&["red","orange","yellow","green","blue","purple","pink","teal","cyan","magenta","lime","amber","indigo","violet","rose","gray","slate","stone"].includes(n)}computeLifePhaseSegments(n,t,e,r){let a=r?this.parseYAMLDate(r)||M(t,1,1):M(t,1,1),i=M(a.year+e,a.month,a.day),s=this.daysBetweenDates(a,i),o=F();return n.map(c=>{let g=this.daysBetweenDates(a,c.startDate)/s*2*Math.PI,u,h=!1;c.endDate?u=c.endDate:(h=!0,u=i);let m=this.daysBetweenDates(a,u)/s*2*Math.PI,y;h&&(y=this.daysBetweenDates(a,o)/s*2*Math.PI);let{RING_COLORS:f}=(j(),Bt(Zt)),b=f[c.color]||f.blue;return{id:c.filePath,filePath:c.filePath,label:c.label,startAngle:g,endAngle:m,color:b,entries:[],isOngoing:h,todayAngle:y,category:c.category}})}loadSpanningArcs(n,t,e={startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label"}){if(!n)return[];let r=this.vaultRepository.getAllMarkdownFiles(),a=[],i=n.endsWith("/")?n:`${n}/`,s=r.filter(d=>d.path===`${n}.md`||d.path.startsWith(i)),o=M(t,1,1),c=M(t,12,31);for(let d of s){let g=this.metadataRepository.getMetadataByPath(d.path),u=g==null?void 0:g.frontmatter;if(!u)continue;let h=u[e.startDateField];if(!h||typeof h!="string")continue;let p=this.parseYAMLDate(h);if(!p)continue;let m=u[e.endDateField],y=null;if(m&&typeof m=="string"&&m.trim()!==""&&(y=this.parseYAMLDate(m)),y||(y=p),y.year<t||p.year>t)continue;let f=this.compareDates(p,o)<0?o:p,b=this.compareDates(y,c)>0?c:y,D=u[e.colorField],A=this.isValidColor(D)?D:void 0,w=u[e.labelField]||d.basename,E=this.dateToYearAngle(f,t),T=this.dateToYearAngle(b,t),{RING_COLORS:N}=(j(),Bt(Zt)),q=A?N[A]:void 0;a.push({id:d.path,filePath:d.path,label:String(w),startAngle:E,endAngle:T,color:q,entries:[]})}return a.sort((d,g)=>d.startAngle-g.startAngle)}dateToYearAngle(n,t){let e=this.isLeapYear(t)?366:365;return(this.getDayOfYear(n)-1)/e*2*Math.PI}compareDates(n,t){return n.year!==t.year?n.year-t.year:n.month!==t.month?n.month-t.month:n.day-t.day}daysBetweenDates(n,t){let e=new Date(n.year,n.month-1,n.day).getTime(),r=new Date(t.year,t.month-1,t.day).getTime();return Math.floor((r-e)/(1e3*60*60*24))}dateToYearFraction(n){let t=this.isLeapYear(n.year)?366:365;return(this.getDayOfYear(n)-1)/t}isLeapYear(n){return n%4===0&&n%100!==0||n%400===0}getDayOfYear(n){let t=[31,28,31,30,31,30,31,31,30,31,30,31];this.isLeapYear(n.year)&&(t[1]=29);let e=n.day;for(let r=0;r<n.month-1;r++)e+=t[r];return e}async rebuildCache(){var r;let n=this.vaultRepository.getAllMarkdownFiles(),t=[],e=this.getDateExtractionConfig();for(let a of n){let i=this.createEntriesFromFile(a,e);t.push(...i)}this.entryCache.rebuild(t),(r=this.eventListeners)==null||r.onEntriesUpdated(),this.notifySubscribers()}createEntriesFromFile(n,t){var d,g,u;let e=this.metadataRepository.getMetadataByPath(n.path),r=(d=e==null?void 0:e.frontmatter)!=null?d:null,{start:a,end:i}=this.dateEngine.extractDates(n.name,r,t),s=(r==null?void 0:r["radcal-annual"])===!0,o={};if(r)for(let[h,p]of Object.entries(r))(typeof p=="string"||typeof p=="number"||typeof p=="boolean")&&(o[h]=p);let c={tags:(g=e==null?void 0:e.tags.map(h=>h.name))!=null?g:[],folder:(u=n.folderPath)!=null?u:"",properties:o};if(s&&r){let h=[],p=this.parseFrontmatterDate(r["radcal-annual-fix"]);if(p)return h.push(V({id:`${n.path}#fix`,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:p,endDate:null,metadata:c,isAnniversary:!0})),h;let m=this.parseFrontmatterDate(r["radcal-start"]),y=this.parseFrontmatterDate(r["radcal-end"]);m&&h.push(V({id:`${n.path}#start`,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:m,endDate:null,metadata:c,isAnniversary:!0})),y&&h.push(V({id:`${n.path}#end`,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:y,endDate:null,metadata:c,isAnniversary:!0}));let f=this.settings.anniversaryDateProperties||[];for(let b of f){let D=this.parseFrontmatterDate(r[b]);if(D){let A=b.toLowerCase().replace(/\s+/g,"-");h.push(V({id:`${n.path}#${A}`,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:D,endDate:null,metadata:c,isAnniversary:!0}))}}return h.length===0&&a&&h.push(V({id:`${n.path}#fallback`,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:a,endDate:null,metadata:c,isAnniversary:!0})),h}return a?[V({id:n.path,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:a,endDate:i,metadata:c,isAnniversary:!1})]:[]}parseFrontmatterDate(n){return n?typeof n=="string"?this.parseYAMLDate(n):n instanceof Date?M(n.getFullYear(),n.getMonth()+1,n.getDate()):null:null}getDateExtractionConfig(){return{startSources:this.settings.dateProperties,endSources:this.settings.endDateProperties,priorities:this.settings.datePriority==="property"?["properties","filename"]:["filename","properties"]}}formatDailyNoteFilename(n,t){return t.replace("YYYY",String(n.year)).replace("MM",String(n.month).padStart(2,"0")).replace("DD",String(n.day).padStart(2,"0"))}setupMetadataListener(){this.unregisterMetadataListener=this.metadataRepository.onMetadataChange(n=>{this.handleFileChange(n.path)})}handleFileChange(n){var e;let t=this.vaultRepository.getAllMarkdownFiles().find(r=>r.path===n);if(t){this.entryCache.removeEntry(n),this.entryCache.removeEntry(`${n}#start`),this.entryCache.removeEntry(`${n}#end`),this.entryCache.removeEntry(`${n}#fix`),this.entryCache.removeEntry(`${n}#fallback`);let r=this.settings.anniversaryDateProperties||[];for(let s of r){let o=s.toLowerCase().replace(/\s+/g,"-");this.entryCache.removeEntry(`${n}#${o}`)}let a=this.getDateExtractionConfig(),i=this.createEntriesFromFile(t,a);for(let s of i)this.entryCache.addEntry(s)}else{this.entryCache.removeEntry(n),this.entryCache.removeEntry(`${n}#start`),this.entryCache.removeEntry(`${n}#end`),this.entryCache.removeEntry(`${n}#fix`),this.entryCache.removeEntry(`${n}#fallback`);let r=this.settings.anniversaryDateProperties||[];for(let a of r){let i=a.toLowerCase().replace(/\s+/g,"-");this.entryCache.removeEntry(`${n}#${i}`)}}(e=this.eventListeners)==null||e.onEntriesUpdated(),this.notifySubscribers()}};var it=require("obsidian");$();j();var ot="radial-calendar-plugin",Fe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Qt=["January","February","March","April","May","June","July","August","September","October","November","December"],ee=800,S=ee/2,Q=380,Pe=340,tt=335,Mt=260,Y=255,G=150,on=140,I=380,ne=30,B=145,te=B+ne,Ie=B+ne/2,nr=(I-B)/31,Ne=4,ln=20,ke=I+2,$e=I+8,Oe=I+14,Ve=I+12,cn=4,Lt=class extends it.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.tooltipEl=null}getViewType(){return ot}getDisplayText(){return"Radial Calendar"}getIcon(){return"circle"}initialize(t){this.config=t,this.config.service.setEventListeners({onEntriesUpdated:()=>this.render(),onYearChanged:()=>this.render()})}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("radial-calendar-plugin"),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null,this.tooltipEl=null}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let e=this.config.service.getCurrentYear(),r=this.containerEl_.createDiv({cls:"rc-container"});this.renderHeader(r,e);let a=r.createDiv({cls:"rc-wrapper"});this.renderRadialCalendar(a,e),this.tooltipEl=r.createDiv({cls:"rc-tooltip"}),this.tooltipEl.style.display="none"}renderHeader(t,e){if(!this.config)return;let r=t.createDiv({cls:"rc-header"});r.createEl("button",{text:"\u2190",cls:"rc-nav-btn",attr:{"aria-label":"Previous year"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.previousYear()}),r.createEl("span",{text:String(e),cls:"rc-year-title"}),r.createEl("button",{text:"\u2192",cls:"rc-nav-btn",attr:{"aria-label":"Next year"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.nextYear()}),r.createEl("button",{text:"Today",cls:"rc-nav-btn rc-today-btn",attr:{"aria-label":"Go to today"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.goToToday()}),r.createEl("button",{text:"\u21BB",cls:"rc-nav-btn rc-refresh-btn",attr:{"aria-label":"Refresh view"}}).addEventListener("click",()=>{this.render()}),this.renderViewModeToggle(r)}renderViewModeToggle(t){if(!this.config)return;let e=this.config.settings.currentView,r=t.createDiv({cls:"rc-view-toggle"});r.createEl("button",{text:"Annual",cls:`rc-toggle-btn ${e==="annual"?"rc-toggle-btn--active":""}`,attr:{"aria-label":"Switch to annual view"}}).addEventListener("click",async()=>{if(this.config&&this.config.settings.currentView!=="annual"){let s={...this.config.settings,currentView:"annual"};this.config.settings=s,await this.config.onSettingsChange(s),this.render()}}),r.createEl("button",{text:"Life",cls:`rc-toggle-btn ${e==="life"?"rc-toggle-btn--active":""}`,attr:{"aria-label":"Switch to life view"}}).addEventListener("click",async()=>{if(this.config&&this.config.settings.currentView!=="life"){let s={...this.config.settings,currentView:"life"};this.config.settings=s,await this.config.onSettingsChange(s),this.render()}})}renderRadialCalendar(t,e){if(!this.config)return;let r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox",`0 0 ${ee} ${ee}`),r.setAttribute("class","rc-svg"),this.svgEl=r,this.config.settings.currentView==="life"?this.renderNestedClock(r,e):this.renderAnnualView(r,e),t.appendChild(r)}renderNestedClock(t,e){if(!this.config)return;let{birthYear:r,expectedLifespan:a}=this.config.settings,i=r+a,s=F(),o=s.year-r;this.renderBackgroundCircle(t),this.renderLifeRing(t,r,i,e),this.renderLifePhasesRing(t,r,a),this.renderYearRing(t,e),this.renderLifeActsOnRing(t,r,a),this.renderNestedCenter(t,e,o),this.renderLifePositionMarker(t,r,a,s.year,"today"),e!==s.year&&this.renderLifePositionMarker(t,r,a,e,"viewed"),e===s.year&&this.renderTodayMarkerOnYearRing(t),this.renderBirthdayMarkerOnYearRing(t,e)}renderLifeRing(t,e,r,a){let i=r-e,s=F();for(let o=e;o<r;o++){let c=o-e,d=c/i*2*Math.PI,g=(c+1)/i*2*Math.PI-.01,u=o<s.year,h=o===s.year,p=o===a,m=this.createArcPath(Pe,Q,d,g),y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttribute("d",m);let f="rc-life-year";u&&(f+=" rc-life-year--past"),h&&(f+=" rc-life-year--current"),p&&(f+=" rc-life-year--selected"),y.setAttribute("class",f),y.setAttribute("data-year",String(o)),y.addEventListener("click",()=>{var b;(b=this.config)==null||b.service.setYear(o)}),y.addEventListener("mouseenter",b=>{this.showLifeYearTooltip(b,o,o-e)}),y.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(y)}for(let o=e;o<=r;o+=10){let d=(o-e)/i*2*Math.PI-Math.PI/2,g=Q+12,u=S+g*Math.cos(d),h=S+g*Math.sin(d),p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x",String(u)),p.setAttribute("y",String(h)),p.setAttribute("class","rc-life-year-label"),p.setAttribute("text-anchor","middle"),p.setAttribute("dominant-baseline","central"),p.textContent=String(o),t.appendChild(p)}}renderLifePhasesRing(t,e,r){if(!this.config)return;let a=this.config.settings.lifePhasesFolder;if(!a||a.trim()==="")return;let i=this.config.service.loadLifePhases(a);if(i.length===0)return;let s=this.config.settings.birthDate,o=this.config.service.computeLifePhaseSegments(i,e,r,s),c=new Map,d=[];for(let f of o)if(f.category){let b=c.get(f.category)||[];b.push(f),c.set(f.category,b)}else d.push(f);let g=Array.from(c.keys()).sort(),u=g.length,h=J(d),p=d.length>0?Z(h):0,m=u+p;if(m===0)return;let y=this.getOrCreateDefs(t);g.forEach((f,b)=>{let D=c.get(f)||[],A=J(D),w=Z(A);for(let E of A){let T=tt-b/m*(tt-Mt),N=tt-(b+1)/m*(tt-Mt),q=z(T,N,w,E.track);this.renderLifePhaseArcWithRadii(t,y,E,q)}});for(let f of h){let b=tt-u/m*(tt-Mt),A=z(b,Mt,p,f.track);this.renderLifePhaseArcWithRadii(t,y,f,A)}}getOrCreateDefs(t){let e=t.querySelector("defs");return e||(e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(e,t.firstChild)),e}renderLifePhaseArcWithRadii(t,e,r,a){if(r.isOngoing&&r.todayAngle!==void 0&&r.todayAngle>r.startAngle){let i=this.createArcPath(a.inner,a.outer,r.startAngle,r.todayAngle),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",i),s.setAttribute("class","rc-life-phase"),s.style.fill=r.color,s.style.opacity="1";let o=this.createArcPath(a.inner,a.outer,r.todayAngle,r.endAngle),c=document.createElementNS("http://www.w3.org/2000/svg","path");if(c.setAttribute("d",o),c.setAttribute("class","rc-life-phase rc-life-phase-future"),c.style.fill=r.color,c.style.opacity="0.35",r.filePath){s.style.cursor="pointer",c.style.cursor="pointer";let u=()=>{var h;return(h=this.config)==null?void 0:h.openFile(r.filePath)};s.addEventListener("click",u),c.addEventListener("click",u)}let d=u=>this.showPhaseTooltip(u,r),g=()=>this.hideTooltip();s.addEventListener("mouseenter",d),s.addEventListener("mouseleave",g),c.addEventListener("mouseenter",d),c.addEventListener("mouseleave",g),t.appendChild(s),t.appendChild(c)}else{let i=this.createArcPath(a.inner,a.outer,r.startAngle,r.endAngle),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",i),s.setAttribute("class","rc-life-phase"),s.style.fill=r.color,r.filePath&&(s.style.cursor="pointer",s.addEventListener("click",()=>{var o;(o=this.config)==null||o.openFile(r.filePath)})),s.addEventListener("mouseenter",o=>{this.showPhaseTooltip(o,r)}),s.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(s)}r.label&&r.endAngle-r.startAngle>.15&&this.renderPhaseLabel(t,r,a)}createPhaseGradient(t,e,r){let a=r.endAngle-r.startAngle,i=(r.todayAngle-r.startAngle)/a,s=Math.max(0,Math.min(100,i*100)),o=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");o.setAttribute("id",e);let c=(r.startAngle+r.endAngle)/2-Math.PI/2,d=50+50*Math.cos(r.startAngle-Math.PI/2),g=50+50*Math.sin(r.startAngle-Math.PI/2),u=50+50*Math.cos(r.endAngle-Math.PI/2),h=50+50*Math.sin(r.endAngle-Math.PI/2);o.setAttribute("x1",`${d}%`),o.setAttribute("y1",`${g}%`),o.setAttribute("x2",`${u}%`),o.setAttribute("y2",`${h}%`);let p=document.createElementNS("http://www.w3.org/2000/svg","stop");p.setAttribute("offset","0%"),p.setAttribute("stop-color",r.color),p.setAttribute("stop-opacity","1"),o.appendChild(p);let m=document.createElementNS("http://www.w3.org/2000/svg","stop");m.setAttribute("offset",`${s}%`),m.setAttribute("stop-color",r.color),m.setAttribute("stop-opacity","1"),o.appendChild(m);let y=document.createElementNS("http://www.w3.org/2000/svg","stop");y.setAttribute("offset",`${s+1}%`),y.setAttribute("stop-color",r.color),y.setAttribute("stop-opacity","0.4"),o.appendChild(y);let f=document.createElementNS("http://www.w3.org/2000/svg","stop");f.setAttribute("offset","100%"),f.setAttribute("stop-color",r.color),f.setAttribute("stop-opacity","0.15"),o.appendChild(f),t.appendChild(o)}renderPhaseLabel(t,e,r){let a=(e.startAngle+e.endAngle)/2-Math.PI/2,i=(r.inner+r.outer)/2,s=S+i*Math.cos(a),o=S+i*Math.sin(a),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(s)),c.setAttribute("y",String(o)),c.setAttribute("class","rc-phase-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central");let d=(a+Math.PI/2)*180/Math.PI,g=d>90&&d<270?d+180:d;c.setAttribute("transform",`rotate(${g}, ${s}, ${o})`),c.textContent=e.label,t.appendChild(c)}showPhaseTooltip(t,e){if(!this.tooltipEl)return;let r=`<div class="rc-tooltip-date">${e.label}</div>`;e.isOngoing&&(r+='<div class="rc-tooltip-note" style="color: var(--text-accent);">Active (ongoing)</div>'),this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block",this.centerTooltip()}renderYearRing(t,e){if(!this.config)return;let r=F();for(let s=1;s<=12;s++){let o=C(e,s),c=this.monthToAngle(s),g=Math.PI/6/o,u=r.year===e&&r.month===s;for(let h=1;h<=o;h++){let p=M(e,s,h),m=k(p),y=u&&r.day===h,f=m===0||m===6,b=c+(h-1)*g,D=b+g-.002,A=this.config.service.getEntriesForDate(p),w=this.createArcPath(G,Y,b,D),E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("d",w);let T=["rc-day-arc"];y&&T.push("rc-day-arc--today"),f&&T.push("rc-day-arc--weekend"),A.length>0&&T.push("rc-day-arc--has-notes"),E.setAttribute("class",T.join(" ")),E.addEventListener("click",async()=>{var N;await((N=this.config)==null?void 0:N.service.openDailyNote(p))}),E.addEventListener("mouseenter",N=>{this.showTooltip(N,p,A)}),E.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(E)}}for(let s=1;s<=12;s++){let o=this.monthToAngle(s)-Math.PI/2,c=S+G*Math.cos(o),d=S+G*Math.sin(o),g=S+Y*Math.cos(o),u=S+Y*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(c)),h.setAttribute("y1",String(d)),h.setAttribute("x2",String(g)),h.setAttribute("y2",String(u)),h.setAttribute("class","rc-month-separator"),t.appendChild(h)}let i=(Y-G)*.1;for(let s=0;s<12;s++){let o=this.monthToAngle(s+1)+Math.PI/12-Math.PI/2,c=G-15,d=S+c*Math.cos(o),g=S+c*Math.sin(o),u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",String(d)),u.setAttribute("y",String(g)),u.setAttribute("class","rc-month-label"),u.setAttribute("text-anchor","middle"),u.setAttribute("dominant-baseline","central"),u.style.fontSize=`${i}px`,u.textContent=Fe[s],t.appendChild(u)}}renderLifeActsOnRing(t,e,r){if(!this.config)return;let a=this.config.settings.lifeActs;if(a.length!==0)for(let i of a){let s=i.startAge/r*2*Math.PI,o=i.endAge/r*2*Math.PI-.01,c=this.createArcPath(Q+2,Q+8,s,o),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",c),d.setAttribute("class","rc-life-act"),i.color&&(d.style.fill=P[i.color]),t.appendChild(d);let g=(s+o)/2-Math.PI/2,u=Q+18,h=S+u*Math.cos(g),p=S+u*Math.sin(g),m=document.createElementNS("http://www.w3.org/2000/svg","text");m.setAttribute("x",String(h)),m.setAttribute("y",String(p)),m.setAttribute("class","rc-life-act-label"),m.setAttribute("text-anchor","middle"),m.setAttribute("dominant-baseline","central");let y=(g+Math.PI/2)*180/Math.PI,f=y>90&&y<270?y+180:y;m.setAttribute("transform",`rotate(${f}, ${h}, ${p})`),i.color&&(m.style.fill=P[i.color]),m.textContent=i.label,t.appendChild(m)}}renderLifePositionMarker(t,e,r,a,i){let s=a-e;if(i==="today"){let y=F(),f=y.year%4===0&&y.year%100!==0||y.year%400===0,b=f?366:365,D=[0,31,28,31,30,31,30,31,31,30,31,30,31];f&&(D[2]=29);let A=y.day;for(let w=1;w<y.month;w++)A+=D[w];s+=A/b}let o=s/r*2*Math.PI-Math.PI/2,c=Pe-5,d=Q+5,g=S+c*Math.cos(o),u=S+c*Math.sin(o),h=S+d*Math.cos(o),p=S+d*Math.sin(o),m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",String(g)),m.setAttribute("y1",String(u)),m.setAttribute("x2",String(h)),m.setAttribute("y2",String(p)),m.setAttribute("class",i==="today"?"rc-life-marker--today":"rc-life-marker--viewed"),t.appendChild(m)}renderTodayMarkerOnYearRing(t){let e=F(),r=C(e.year,e.month),a=this.monthToAngle(e.month),s=Math.PI/6/r,o=a+(e.day-.5)*s-Math.PI/2,c=S+(G-5)*Math.cos(o),d=S+(G-5)*Math.sin(o),g=S+(Y+5)*Math.cos(o),u=S+(Y+5)*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(c)),h.setAttribute("y1",String(d)),h.setAttribute("x2",String(g)),h.setAttribute("y2",String(u)),h.setAttribute("class","rc-today-marker"),t.appendChild(h)}renderBirthdayMarkerOnYearRing(t,e){if(!this.config)return;let r=this.config.settings.birthDate;if(!r)return;let a=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!a)return;let i=parseInt(a[2],10),s=parseInt(a[3],10),o=C(e,i),c=this.monthToAngle(i),g=Math.PI/6/o,u=c+(s-.5)*g-Math.PI/2,h=S+(G-3)*Math.cos(u),p=S+(G-3)*Math.sin(u),m=S+(Y+3)*Math.cos(u),y=S+(Y+3)*Math.sin(u),f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",String(h)),f.setAttribute("y1",String(p)),f.setAttribute("x2",String(m)),f.setAttribute("y2",String(y)),f.setAttribute("class","rc-birthday-marker"),t.appendChild(f);let b=Y+12,D=S+b*Math.cos(u),A=S+b*Math.sin(u),w=document.createElementNS("http://www.w3.org/2000/svg","text");w.setAttribute("x",String(D)),w.setAttribute("y",String(A)),w.setAttribute("class","rc-birthday-icon"),w.setAttribute("text-anchor","middle"),w.setAttribute("dominant-baseline","central"),w.textContent="\u{1F382}",t.appendChild(w)}renderNestedCenter(t,e,r){let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",String(S)),a.setAttribute("cy",String(S)),a.setAttribute("r",String(on-10)),a.setAttribute("class","rc-center"),t.appendChild(a);let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",String(S)),i.setAttribute("y",String(S-20)),i.setAttribute("class","rc-center-year"),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","central"),i.textContent=String(e),t.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(S)),s.setAttribute("y",String(S+20)),s.setAttribute("class","rc-center-age"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=`${r} years`,t.appendChild(s)}showLifeYearTooltip(t,e,r){if(!this.tooltipEl)return;let a=`<div class="rc-tooltip-date">${e}</div>
      <div class="rc-tooltip-note">Age: ${r} years</div>`;this.tooltipEl.innerHTML=a,this.tooltipEl.style.display="block",this.centerTooltip()}renderAnnualView(t,e){this.renderBackgroundCircle(t);let r=this.getEnabledRingsSorted(),a=this.calculateRingRadii(r.length);for(let i of r){let s=a.get(i.order);s&&this.renderRing(t,e,i,s)}for(let i=1;i<=12;i++)this.renderMonthSeparator(t,this.monthToAngle(i));this.renderLabelRingSeparator(t),this.renderOuterSegments(t,e),this.renderCenter(t,e),this.renderMonthLabels(t),this.renderTodayMarker(t,e)}renderLabelRingSeparator(t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(S)),e.setAttribute("cy",String(S)),e.setAttribute("r",String(te)),e.setAttribute("class","rc-label-ring-separator"),t.appendChild(e)}renderAnniversaryRing(t,e){var i;if(!this.config)return;let r=this.config.service.getAllAnniversaryEntries();if(r.length===0)return;let a=new Map;for(let s of r){let o=`${String(s.startDate.month).padStart(2,"0")}-${String(s.startDate.day).padStart(2,"0")}`,c=(i=a.get(o))!=null?i:[];c.push(s),a.set(o,c)}for(let[s,o]of a){let[c,d]=s.split("-"),g=parseInt(c,10),u=parseInt(d,10),h=C(e,g),p=this.monthToAngle(g),m=Math.PI/6,y=(u-.5)/h,f=p+y*m,b=S+Ve*Math.cos(f-Math.PI/2),D=S+Ve*Math.sin(f-Math.PI/2),A=document.createElementNS("http://www.w3.org/2000/svg","circle");A.setAttribute("cx",String(b)),A.setAttribute("cy",String(D)),A.setAttribute("r",String(cn)),A.setAttribute("class","rc-anniversary-dot");let w=o[0];A.addEventListener("mouseenter",E=>{this.showAnniversaryTooltip(E,o)}),A.addEventListener("mouseleave",()=>this.hideTooltip()),A.addEventListener("click",()=>{var E,T;o.length===1?(E=this.config)==null||E.openFile(w.filePath):(T=this.config)==null||T.openFile(w.filePath)}),t.appendChild(A)}}showAnniversaryTooltip(t,e){if(!this.tooltipEl||e.length===0)return;let r='<div class="rc-tooltip-date">\u{1F4C5}</div>';r+='<div class="rc-tooltip-notes">';for(let a of e.slice(0,5))r+=`<div class="rc-tooltip-note">${a.displayName}</div>`;e.length>5&&(r+=`<div class="rc-tooltip-more">+${e.length-5} more</div>`),r+="</div>",this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block",this.centerTooltip()}getEnabledRingsSorted(){if(!this.config)return[];let t=[],e=this.config.settings.dailyNoteFolder;t.push({id:"__daily_notes__",name:"Daily Notes",folder:(e==null?void 0:e.trim())||"",color:"blue",segmentType:"daily",enabled:!0,order:0});let r=this.config.settings.rings.filter(s=>s.enabled).sort((s,o)=>s.order-o.order).map((s,o)=>({...s,order:o+1}));t.push(...r);let i=(this.config.settings.calendarSources||[]).filter(s=>s.enabled&&s.showAsRing!==!1&&s.folder).map((s,o)=>({id:`__calendar_${s.id}__`,name:s.name,folder:s.folder,color:s.color,segmentType:"daily",enabled:!0,order:t.length+o,showSpanningArcs:s.showSpanningArcs!==!1,startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label"}));return t.push(...i),t}calculateRingRadii(t){let e=new Map;if(t===0)return e;let r=(t-1)*Ne,a=I-te-r,i=Math.max(ln,a/t);for(let s=0;s<t;s++){let o=I-s*(i+Ne),c=Math.max(te,o-i);e.set(s,{outerRadius:o,innerRadius:c})}return e}renderRing(t,e,r,a){if(!this.config)return;let i=P[r.color]||P.blue,s=a.outerRadius-a.innerRadius;if(r.showSpanningArcs){let o=this.config.service.loadSpanningArcs(r.folder,e,{startDateField:r.startDateField||"radcal-start",endDateField:r.endDateField||"radcal-end",colorField:r.colorField||"radcal-color",labelField:r.labelField||"radcal-label"}),c=o.length>0?J(o):[],d=c.length>0?Z(c):0,g=d>0,u=this.ringHasDailyNotes(r,e);if(u&&!g)for(let h=1;h<=12;h++)this.renderRingMonthSegment(t,e,h,r,a,i);else if(g&&!u)for(let h of c){let p=z(a.outerRadius,a.innerRadius,d,h.track);this.renderSpanningArc(t,h,p,r,i)}else if(g&&u){let y=.5+(d-1)*.05,f=Math.min(.6,y),b=Math.max(.4,1-f),D={innerRadius:a.innerRadius,outerRadius:a.innerRadius+s*b};for(let E=1;E<=12;E++)this.renderRingMonthSegment(t,e,E,r,D,i);let A=a.outerRadius,w=D.outerRadius;for(let E of c){let T=z(A,w,d,E.track);this.renderSpanningArc(t,E,T,r,i)}}else this.renderEmptyRingBackground(t,a)}else for(let o=1;o<=12;o++)this.renderRingMonthSegment(t,e,o,r,a,i)}ringHasDailyNotes(t,e){if(!this.config)return!1;for(let r=1;r<=12;r++){let a=M(e,r,1);if(this.getEntriesForRing(a,t).length>0)return!0;let s=M(e,r,15);if(this.getEntriesForRing(s,t).length>0)return!0}return!1}renderSpanningArcsRing(t,e,r,a,i){if(!this.config)return;let s=this.config.service.loadSpanningArcs(r.folder,e,{startDateField:r.startDateField||"radcal-start",endDateField:r.endDateField||"radcal-end",colorField:r.colorField||"radcal-color",labelField:r.labelField||"radcal-label"});if(s.length===0){this.renderEmptyRingBackground(t,a);return}let o=J(s),c=Z(o);for(let d of o){let g=z(a.outerRadius,a.innerRadius,c,d.track);this.renderSpanningArc(t,d,g,r,i)}}renderEmptyRingBackground(t,e){let r=this.createArcPath(e.innerRadius,e.outerRadius,0,2*Math.PI-.001),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",r),a.setAttribute("class","rc-ring-arc"),a.style.fill="var(--background-secondary)",a.style.fillOpacity="0.3",t.appendChild(a)}renderSpanningArc(t,e,r,a,i){if(!this.config)return;let s=this.createArcPath(r.inner,r.outer,e.startAngle,e.endAngle),o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",s),o.setAttribute("class","rc-ring-arc"),o.style.fill=e.color||i,e.filePath&&(o.style.cursor="pointer",o.addEventListener("click",()=>{var c;(c=this.config)==null||c.openFile(e.filePath)})),o.addEventListener("mouseenter",c=>{this.showSpanningArcTooltip(c,e,a)}),o.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(o),e.label&&e.endAngle-e.startAngle>.26&&this.renderSpanningArcLabel(t,e,r)}renderSpanningArcLabel(t,e,r){let a=(e.startAngle+e.endAngle)/2-Math.PI/2,i=(r.inner+r.outer)/2,s=S+i*Math.cos(a),o=S+i*Math.sin(a),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(s)),c.setAttribute("y",String(o)),c.setAttribute("class","rc-phase-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central");let d=(a+Math.PI/2)*180/Math.PI,g=d>90&&d<270?d+180:d;c.setAttribute("transform",`rotate(${g}, ${s}, ${o})`),c.textContent=e.label,t.appendChild(c)}showSpanningArcTooltip(t,e,r){if(!this.tooltipEl)return;let a=`<div class="rc-tooltip-ring" style="color: ${e.color}">${r.name}</div>`;a+=`<div class="rc-tooltip-date">${e.label}</div>`,this.tooltipEl.innerHTML=a,this.tooltipEl.style.display="block",this.centerTooltip()}renderRingMonthSegment(t,e,r,a,i,s){if(!this.config)return;let o=C(e,r),c=this.monthToAngle(r),g=Math.PI/6/o,u=F(),h=u.year===e&&u.month===r,p=this.config.service.getEntriesForDate(M(e,r,1));for(let m=1;m<=o;m++){let y=M(e,r,m),f=k(y),b=h&&u.day===m,D=f===0||f===6,A=c+(m-1)*g,w=A+g-.002,E=this.getEntriesForRing(y,a);this.renderRingDayArc(t,y,A,w,b,D,E,i,s,a)}}getEntriesForRing(t,e){if(!this.config)return[];let r=this.config.service.getEntriesForDate(t);if(!e.folder||e.folder.trim()==="")return r;let a=e.folder.replace(/^\/+|\/+$/g,"");return r.filter(i=>{let o=(i.metadata.folder||"").replace(/^\/+|\/+$/g,"");return o===a||o.startsWith(a+"/")})}renderRingDayArc(t,e,r,a,i,s,o,c,d,g){if(!this.config)return;let h=(c.outerRadius-c.innerRadius)*.1,p=c.outerRadius-h,m=this.config.service.getAnniversaryEntriesForDate(e),y=m.length>0,f=this.createArcPath(c.innerRadius,p,r,a),b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d",f);let D=["rc-day-arc",`rc-ring-${g.order}`];i&&D.push("rc-day-arc--today"),s&&D.push("rc-day-arc--weekend"),o.length>0&&D.push("rc-day-arc--has-notes"),o.length>3&&D.push("rc-day-arc--many-notes"),b.setAttribute("class",D.join(" ")),b.setAttribute("data-date",`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`),b.setAttribute("data-ring",g.id),o.length>0&&(b.style.fill=d,b.style.fillOpacity="0.6"),b.addEventListener("click",async A=>{var w;A.preventDefault(),o.length>0?this.showDayContextMenu(A,e,o):await((w=this.config)==null?void 0:w.service.openDailyNote(e))}),b.addEventListener("mouseenter",A=>{this.showRingTooltip(A,e,o,g)}),b.addEventListener("mouseleave",()=>{this.hideTooltip()}),b.addEventListener("contextmenu",A=>{A.preventDefault(),this.showDayContextMenu(A,e,o)}),t.appendChild(b),y&&this.renderAnniversaryIndicator(t,r,a,p,c.outerRadius,m,e)}renderAnniversaryIndicator(t,e,r,a,i,s,o){if(!this.config)return;let c=this.createArcPath(a,i,e,r),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",c),d.setAttribute("class","rc-anniversary-indicator"),d.addEventListener("click",g=>{var u;g.stopPropagation(),s.length===1?(u=this.config)==null||u.openFile(s[0].filePath):s.length>1&&this.showAnniversaryMenu(g,s)}),d.addEventListener("mouseenter",g=>{this.showAnniversaryTooltip(g,s)}),d.addEventListener("mouseleave",()=>{this.hideTooltip()}),t.appendChild(d)}showAnniversaryMenu(t,e){if(!this.config)return;let r=new it.Menu;for(let a of e.slice(0,15))r.addItem(i=>{i.setTitle(a.displayName).setIcon("cake").onClick(()=>{var s;(s=this.config)==null||s.openFile(a.filePath)})});e.length>15&&r.addItem(a=>{a.setTitle(`+${e.length-15} more...`).setDisabled(!0)}),r.showAtMouseEvent(t)}showRingTooltip(t,e,r,a){if(!this.tooltipEl)return;let o=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][k(e)]}, ${Qt[e.month-1]} ${e.day}, ${e.year}`}</div>`;if(o+=`<div class="rc-tooltip-ring" style="color: ${P[a.color]}">${a.name}</div>`,r.length>0){o+='<div class="rc-tooltip-notes">';for(let c of r.slice(0,5))o+=`<div class="rc-tooltip-note">${c.displayName}</div>`;r.length>5&&(o+=`<div class="rc-tooltip-more">+${r.length-5} more</div>`),o+="</div>"}this.tooltipEl.innerHTML=o,this.tooltipEl.style.display="block",this.centerTooltip()}renderBackgroundCircle(t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(S)),e.setAttribute("cy",String(S)),e.setAttribute("r",String(I)),e.setAttribute("class","rc-background"),t.appendChild(e)}renderCenter(t,e){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(S)),r.setAttribute("cy",String(S)),r.setAttribute("r",String(B-10)),r.setAttribute("class","rc-center"),t.appendChild(r)}renderMonthLabels(t){let e=ne*.4;for(let r=0;r<12;r++){let a=this.monthToAngle(r+1)+Math.PI/12,i=S+Ie*Math.cos(a-Math.PI/2),s=S+Ie*Math.sin(a-Math.PI/2),o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x",String(i)),o.setAttribute("y",String(s)),o.setAttribute("class","rc-month-label"),o.setAttribute("text-anchor","middle"),o.setAttribute("dominant-baseline","central"),o.style.fontSize=`${e}px`,o.textContent=Fe[r],t.appendChild(o)}}renderMonthSegment(t,e,r){if(!this.config)return;let a=C(e,r),i=this.monthToAngle(r),o=Math.PI/6/a,c=F(),d=c.year===e&&c.month===r;for(let g=1;g<=a;g++){let u=M(e,r,g),h=k(u),p=d&&c.day===g,m=h===0||h===6,y=i+(g-1)*o,f=y+o-.002,b=this.config.service.getEntriesForDate(u);this.renderDayArc(t,u,y,f,p,m,b)}this.renderMonthSeparator(t,i)}renderDayArc(t,e,r,a,i,s,o){if(!this.config)return;let c=B,d=I,g=this.createArcPath(c,d,r,a),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",g);let h=["rc-day-arc"];i&&h.push("rc-day-arc--today"),s&&h.push("rc-day-arc--weekend"),o.length>0&&h.push("rc-day-arc--has-notes"),o.length>3&&h.push("rc-day-arc--many-notes"),u.setAttribute("class",h.join(" ")),u.setAttribute("data-date",`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`),u.addEventListener("click",async p=>{var m;p.preventDefault(),await((m=this.config)==null?void 0:m.service.openDailyNote(e))}),u.addEventListener("mouseenter",p=>{this.showTooltip(p,e,o)}),u.addEventListener("mouseleave",()=>{this.hideTooltip()}),u.addEventListener("contextmenu",p=>{p.preventDefault(),o.length>0&&this.showDayContextMenu(p,e,o)}),t.appendChild(u),o.length>0&&this.renderNoteIndicators(t,r,a,o)}renderNoteIndicators(t,e,r,a){let i=I-15,s=I-5,o=Math.min(a.length,3),c=(r-e)/o;for(let d=0;d<o;d++){let g=e+d*c+.001,u=g+c-.002,h=this.createArcPath(i,s,g,u),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",h),p.setAttribute("class","rc-note-indicator"),t.appendChild(p)}}renderMonthSeparator(t,e){let r=S+B*Math.cos(e-Math.PI/2),a=S+B*Math.sin(e-Math.PI/2),i=S+I*Math.cos(e-Math.PI/2),s=S+I*Math.sin(e-Math.PI/2),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(r)),o.setAttribute("y1",String(a)),o.setAttribute("x2",String(i)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-month-separator"),t.appendChild(o)}renderTodayMarker(t,e){let r=F();if(r.year!==e)return;let a=C(e,r.month),i=this.monthToAngle(r.month),o=Math.PI/6/a,c=i+(r.day-.5)*o,d=S+(B-10)*Math.cos(c-Math.PI/2),g=S+(B-10)*Math.sin(c-Math.PI/2),u=S+(I+5)*Math.cos(c-Math.PI/2),h=S+(I+5)*Math.sin(c-Math.PI/2),p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttribute("x1",String(d)),p.setAttribute("y1",String(g)),p.setAttribute("x2",String(u)),p.setAttribute("y2",String(h)),p.setAttribute("class","rc-today-marker"),t.appendChild(p)}createArcPath(t,e,r,a){let i=r-Math.PI/2,s=a-Math.PI/2,o=S+t*Math.cos(i),c=S+t*Math.sin(i),d=S+t*Math.cos(s),g=S+t*Math.sin(s),u=S+e*Math.cos(i),h=S+e*Math.sin(i),p=S+e*Math.cos(s),m=S+e*Math.sin(s),y=a-r>Math.PI?1:0;return`
      M ${o} ${c}
      L ${u} ${h}
      A ${e} ${e} 0 ${y} 1 ${p} ${m}
      L ${d} ${g}
      A ${t} ${t} 0 ${y} 0 ${o} ${c}
      Z
    `}monthToAngle(t){return(t-1)*Math.PI/6}showTooltip(t,e,r){if(!this.tooltipEl)return;let s=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][k(e)]}, ${Qt[e.month-1]} ${e.day}, ${e.year}`}</div>`;if(r.length>0){s+='<div class="rc-tooltip-notes">';for(let o of r.slice(0,5))s+=`<div class="rc-tooltip-note">${o.displayName}</div>`;r.length>5&&(s+=`<div class="rc-tooltip-more">+${r.length-5} more</div>`),s+="</div>"}this.tooltipEl.innerHTML=s,this.tooltipEl.style.display="block",this.centerTooltip()}hideTooltip(){this.tooltipEl&&(this.tooltipEl.style.display="none")}centerTooltip(){if(!this.tooltipEl||!this.containerEl_)return;let t=this.containerEl_.getBoundingClientRect();this.tooltipEl.style.left="50%",this.tooltipEl.style.top="50%",this.tooltipEl.style.transform="translate(-50%, -50%)"}showDayContextMenu(t,e,r){if(!this.config)return;let a=new it.Menu;a.addItem(i=>{i.setTitle(`Open ${Qt[e.month-1]} ${e.day}`).setIcon("calendar").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(e))})}),a.addSeparator();for(let i of r.slice(0,10))a.addItem(s=>{s.setTitle(i.displayName).setIcon("file").onClick(()=>{var o;(o=this.config)==null||o.openFile(i.filePath)})});r.length>10&&a.addItem(i=>{i.setTitle(`+${r.length-10} more...`).setDisabled(!0)}),a.showAtMouseEvent(t)}renderOuterSegments(t,e){if(!this.config)return;let r=this.getSegmentsForCurrentView();if(r.length!==0)for(let a of r)this.renderSegmentTick(t,a,e)}getSegmentsForCurrentView(){if(!this.config)return[];let t=this.config.settings;if(t.currentView==="life")return this.lifeActsToSegments(t.lifeActs);switch(t.annualSegmentType){case"seasons":return jt;case"quarters":return Ut;case"semester":return Xt;case"ten-days":return qt();case"weeks":return Kt();case"custom":return t.customSegments;case"none":default:return[]}}lifeActsToSegments(t){if(!this.config)return[];let{birthYear:e,expectedLifespan:r}=this.config.settings,a=r;return t.map(i=>{let s=Math.floor(i.startAge/a*365)+1,o=Math.floor(i.endAge/a*365);return{id:i.id,label:i.label,startDay:s,endDay:o,color:i.color}})}renderSegmentTick(t,e,r){if(!this.config)return;let a=this.config.settings.showSegmentLabels,i=this.dayOfYearToAngle(e.startDay),s=e.endDay>e.startDay?this.dayOfYearToAngle(e.endDay):this.dayOfYearToAngle(e.endDay)+2*Math.PI,o=i-Math.PI/2,c=S+ke*Math.cos(o),d=S+ke*Math.sin(o),g=S+$e*Math.cos(o),u=S+$e*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");if(h.setAttribute("x1",String(c)),h.setAttribute("y1",String(d)),h.setAttribute("x2",String(g)),h.setAttribute("y2",String(u)),h.setAttribute("class","rc-segment-tick"),e.color&&(h.style.stroke=P[e.color]),t.appendChild(h),a){let p;e.endDay>e.startDay?p=(i+s)/2:(p=(i+s)/2,p>2*Math.PI&&(p-=2*Math.PI));let m=p-Math.PI/2,y=S+Oe*Math.cos(m),f=S+Oe*Math.sin(m),b=document.createElementNS("http://www.w3.org/2000/svg","text");b.setAttribute("x",String(y)),b.setAttribute("y",String(f)),b.setAttribute("class","rc-segment-label"),b.setAttribute("text-anchor","middle"),b.setAttribute("dominant-baseline","central");let D=p*180/Math.PI,A=D>90&&D<270?D+180:D;b.setAttribute("transform",`rotate(${A}, ${y}, ${f})`),e.color&&(b.style.fill=P[e.color]),b.textContent=e.label,t.appendChild(b)}}dayOfYearToAngle(t){return(t-1)/365*2*Math.PI}};var Tt=require("obsidian");$();var dn=["January","February","March","April","May","June","July","August","September","October","November","December"],dt="local-calendar-view",re=300,R=re/2,lt=140,Rt=115,ct=105,et=40,un=35,xt=class extends Tt.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.activeFileDate=null}getViewType(){return dt}getDisplayText(){return"Local Calendar"}getIcon(){return"clock"}initialize(t){this.config=t,this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updateActiveFileDate(),this.render()})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.updateActiveFileDate(),this.render()}))}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("local-calendar-view"),this.updateActiveFileDate(),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null}updateActiveFileDate(){this.config&&(this.activeFileDate=this.config.getActiveFileDate())}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let t=this.containerEl_.createDiv({cls:"lc-container"}),e=t.createDiv({cls:"lc-title"});this.activeFileDate?e.textContent=`${this.activeFileDate.day}.${this.activeFileDate.month}.${this.activeFileDate.year}`:e.textContent="Keine Datums-Notiz";let r=t.createDiv({cls:"lc-wrapper"});this.renderNestedClock(r)}renderNestedClock(t){if(!this.config)return;let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox",`0 0 ${re} ${re}`),e.setAttribute("class","lc-svg"),this.svgEl=e;let{birthYear:r,expectedLifespan:a}=this.config.settings,i=r+a,s=F(),o=this.activeFileDate||s,c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx",String(R)),c.setAttribute("cy",String(R)),c.setAttribute("r",String(lt)),c.setAttribute("class","lc-background"),e.appendChild(c),this.renderLifeRing(e,r,i,o.year,s.year),this.renderYearRing(e,o,s),this.renderCenter(e,o),this.activeFileDate&&this.renderNoteMarkers(e,r,a,this.activeFileDate),(!this.activeFileDate||this.activeFileDate.year!==s.year||this.activeFileDate.month!==s.month||this.activeFileDate.day!==s.day)&&this.renderTodayMarkers(e,r,a,s),t.appendChild(e)}renderLifeRing(t,e,r,a,i){let s=r-e;for(let o=0;o<s;o+=10){let c=o/s*2*Math.PI,d=Math.min((o+10)/s*2*Math.PI,2*Math.PI)-.02,g=this.createArcPath(Rt,lt,c,d),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",g);let h=e+o,p=h+10<=i,m=h<=i&&i<h+10,y="lc-life-decade";p&&(y+=" lc-life-decade--past"),m&&(y+=" lc-life-decade--current"),u.setAttribute("class",y),t.appendChild(u);let f=(o+5)/s*2*Math.PI-Math.PI/2,b=(Rt+lt)/2,D=R+b*Math.cos(f),A=R+b*Math.sin(f),w=document.createElementNS("http://www.w3.org/2000/svg","text");w.setAttribute("x",String(D)),w.setAttribute("y",String(A)),w.setAttribute("class","lc-decade-label"),w.setAttribute("text-anchor","middle"),w.setAttribute("dominant-baseline","central"),w.textContent=String(e+o),t.appendChild(w)}}renderYearRing(t,e,r){if(!this.config)return;let a=e.year;for(let s=1;s<=12;s++){let o=C(a,s),c=this.monthToAngle(s),g=Math.PI/6/o;for(let u=1;u<=o;u++){let h=M(a,s,u),p=k(h),m=r.year===a&&r.month===s&&r.day===u,y=e.month===s&&e.day===u,f=p===0||p===6,b=c+(u-1)*g,D=b+g-.002,A=this.config.service.getEntriesForDate(h),w=this.createArcPath(et,ct,b,D),E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("d",w);let T=["lc-day"];m&&T.push("lc-day--today"),y&&T.push("lc-day--note"),f&&T.push("lc-day--weekend"),A.length>0&&T.push("lc-day--has-notes"),A.length>2&&T.push("lc-day--many-notes"),E.setAttribute("class",T.join(" ")),E.style.cursor="pointer",E.addEventListener("click",N=>{var q;N.preventDefault(),N.stopPropagation(),A.length>0?this.showDayContextMenu(N,h,A):(q=this.config)==null||q.service.openDailyNote(h)}),t.appendChild(E)}}for(let s=1;s<=12;s++){let o=this.monthToAngle(s)-Math.PI/2,c=R+et*Math.cos(o),d=R+et*Math.sin(o),g=R+ct*Math.cos(o),u=R+ct*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(c)),h.setAttribute("y1",String(d)),h.setAttribute("x2",String(g)),h.setAttribute("y2",String(u)),h.setAttribute("class","lc-month-separator"),t.appendChild(h)}let i=["J","F","M","A","M","J","J","A","S","O","N","D"];for(let s=0;s<12;s++){let o=this.monthToAngle(s+1)+Math.PI/12-Math.PI/2,c=et-8,d=R+c*Math.cos(o),g=R+c*Math.sin(o),u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",String(d)),u.setAttribute("y",String(g)),u.setAttribute("class","lc-month-label"),u.setAttribute("text-anchor","middle"),u.setAttribute("dominant-baseline","central"),u.textContent=i[s],t.appendChild(u)}}monthToAngle(t){return(t-1)*Math.PI/6}renderCenter(t,e){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(R)),r.setAttribute("cy",String(R)),r.setAttribute("r",String(un-5)),r.setAttribute("class","lc-center"),t.appendChild(r);let a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",String(R)),a.setAttribute("y",String(R)),a.setAttribute("class","lc-center-day"),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","central"),a.textContent=String(e.day),t.appendChild(a)}renderNoteMarkers(t,e,r,a){let s=(a.year-e)/r*2*Math.PI-Math.PI/2;this.drawMarker(t,s,Rt-3,lt+3,"lc-marker--note");let o=this.dateToAngle(a);this.drawMarker(t,o,et-3,ct+3,"lc-marker--note")}renderTodayMarkers(t,e,r,a){let s=(a.year-e)/r*2*Math.PI-Math.PI/2;this.drawMarker(t,s,Rt,lt,"lc-marker--today");let o=this.dateToAngle(a);this.drawMarker(t,o,et,ct,"lc-marker--today")}dateToAngle(t){let e=C(t.year,t.month),r=this.monthToAngle(t.month),i=Math.PI/6/e;return r+(t.day-.5)*i-Math.PI/2}drawMarker(t,e,r,a,i){let s=R+r*Math.cos(e),o=R+r*Math.sin(e),c=R+a*Math.cos(e),d=R+a*Math.sin(e),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",String(s)),g.setAttribute("y1",String(o)),g.setAttribute("x2",String(c)),g.setAttribute("y2",String(d)),g.setAttribute("class",i),t.appendChild(g)}showDayContextMenu(t,e,r){if(!this.config)return;let a=new Tt.Menu;if(a.addItem(i=>{i.setTitle(`${e.day}. ${dn[e.month-1]} ${e.year}`).setIcon("calendar").setDisabled(!0)}),a.addSeparator(),a.addItem(i=>{i.setTitle("Neue Notiz erstellen").setIcon("plus").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(e))})}),r.length>0){a.addSeparator();for(let i of r.slice(0,10))a.addItem(s=>{s.setTitle(i.displayName).setIcon("file").onClick(async()=>{var o;await((o=this.config)==null?void 0:o.openFile(i.filePath))})});r.length>10&&a.addItem(i=>{i.setTitle(`+${r.length-10} weitere...`).setDisabled(!0)})}a.showAtMouseEvent(t)}createArcPath(t,e,r,a){let i=r-Math.PI/2,s=a-Math.PI/2,o=R+t*Math.cos(i),c=R+t*Math.sin(i),d=R+t*Math.cos(s),g=R+t*Math.sin(s),u=R+e*Math.cos(i),h=R+e*Math.sin(i),p=R+e*Math.cos(s),m=R+e*Math.sin(s),y=a-r>Math.PI?1:0;return`
      M ${o} ${c}
      L ${u} ${h}
      A ${e} ${e} 0 ${y} 1 ${p} ${m}
      L ${d} ${g}
      A ${t} ${t} 0 ${y} 0 ${o} ${c}
      Z
    `}};var nt=require("obsidian");$();var Ye={style:"annual",showLabels:!0,showToday:!0,showAnniversaries:!1,segments:"none"};function Ge(l){let n={...Ye},t=l.trim().split(`
`),e=!1,r=!1,a=!1,i=0,s=[],o=[],c=[],d=null;for(let g of t){let u=g.trim();if(!u||u.startsWith("#"))continue;if(a)if(g.length-g.trimStart().length>i||u.startsWith("-")){s.push(g);continue}else a=!1,n.filter=Ft(s);if(u.startsWith("- ")){if(e){d&&d.folder&&o.push({folder:d.folder,color:d.color||"blue",label:d.label});let f=u.match(/^-\s*folder:\s*["']?([^"'\n]+)["']?/);f?d={folder:f[1].trim()}:d={};continue}if(r){let f=u.slice(2).trim().replace(/["']/g,"");c.push(f);continue}}if(e&&d&&(g.startsWith("    ")||g.startsWith("	"))){let[f,...b]=u.split(":"),D=b.join(":").trim().replace(/["']/g,"");switch(f.trim()){case"folder":d.folder=D;break;case"color":d.color=D;break;case"label":d.label=D;break}continue}let h=u.indexOf(":");if(h===-1)continue;let p=u.slice(0,h).trim(),m=u.slice(h+1).trim();if(p==="rings"&&(!m||m==="")){d&&d.folder&&o.push({folder:d.folder,color:d.color||"blue",label:d.label}),e=!0,r=!1,d=null;continue}if(p==="folders"&&(!m||m==="")){r=!0,e=!1;continue}!g.startsWith(" ")&&!g.startsWith("	")&&!u.startsWith("-")&&(e&&d&&d.folder&&(o.push({folder:d.folder,color:d.color||"blue",label:d.label}),d=null),e=!1,r=!1);let y=m.replace(/["']/g,"");switch(p){case"year":n.year=parseInt(y,10);break;case"style":(y==="annual"||y==="life")&&(n.style=y);break;case"dateProperty":n.dateProperty=y;break;case"folder":n.folder=y;break;case"filter":y?n.filter=y:(a=!0,i=g.indexOf("filter"));break;case"showLabels":n.showLabels=y==="true";break;case"showToday":n.showToday=y==="true";break;case"showAnniversaries":n.showAnniversaries=y==="true";break;case"segments":["none","seasons","quarters","weeks"].includes(y)&&(n.segments=y);break;case"birthYear":n.birthYear=parseInt(y,10);break;case"lifespan":n.lifespan=parseInt(y,10);break}}return d&&d.folder&&o.push({folder:d.folder,color:d.color||"blue",label:d.label}),a&&s.length>0&&(n.filter=Ft(s)),o.length>0&&(n.rings=o),c.length>0&&(n.folders=c),n}function Ft(l){let n={},t=null,e=[],r=[],a=-1;for(let i of l){let s=i.trim();if(!s)continue;let o=i.length-i.trimStart().length;if(a>=0)if(o>a){r.push(i);continue}else r.length>0&&(e.push(Ft(r)),r=[]),a=-1;if(s==="and:"||s==="or:"||s==="not:"){t&&e.length>0&&(n[t]=[...e],e.length=0),t=s.slice(0,-1);continue}if(s.startsWith("- ")){let c=s.slice(2).trim();c==="and:"||c==="or:"||c==="not:"?(a=o,r=[i]):e.push(c)}}return r.length>0&&e.push(Ft(r)),t&&e.length>0&&(n[t]=e),n}$();j();var ae=800,x=ae/2,U=380,_e=30,X=145,hn=X+_e,Be=4,gn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Pt=class{render(n,t,e,r){var o;let a=this.createSVG();this.renderBackground(a);let i=((o=n.rings)==null?void 0:o.length)||1,s=this.calculateRingRadii(i);if(n.rings&&n.rings.length>0)n.rings.forEach((c,d)=>{let g=s.get(d);if(g){let u=P[c.color]||P.blue;this.renderDataRing(a,e,t,g,u,c.folder,r)}});else{let c=s.get(0);if(c){let d=P.blue;this.renderDataRing(a,e,t,c,d,n.folder,r)}}return this.renderMonthSeparators(a),n.showLabels&&this.renderMonthLabels(a),n.showToday&&this.renderTodayMarker(a,e),this.renderCenter(a,e),a}createSVG(){let n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("viewBox",`0 0 ${ae} ${ae}`),n.setAttribute("class","radcal-svg"),n.style.width="100%",n.style.height="auto",n.style.maxWidth="800px",n}renderBackground(n){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",String(x)),t.setAttribute("cy",String(x)),t.setAttribute("r",String(U)),t.setAttribute("class","rc-background"),n.appendChild(t)}calculateRingRadii(n){let t=new Map,e=U-hn,r=(n-1)*Be,a=(e-r)/n;for(let i=0;i<n;i++){let s=U-i*(a+Be),o=s-a;t.set(i,{innerRadius:o,outerRadius:s})}return t}renderDataRing(n,t,e,r,a,i,s){for(let o=1;o<=12;o++){let c=C(t,o),d=this.monthToAngle(o),u=Math.PI/6/c;for(let h=1;h<=c;h++){let p=M(t,o,h),m=`${t}-${String(o).padStart(2,"0")}-${String(h).padStart(2,"0")}`,y=e.get(m)||[];i&&(y=y.filter(w=>w.metadata.folder.startsWith(i)));let f=d+(h-1)*u,b=f+u,D=document.createElementNS("http://www.w3.org/2000/svg","path"),A=this.createArcPath(r.innerRadius,r.outerRadius,f,b);if(D.setAttribute("d",A),D.setAttribute("class","rc-day-arc"),y.length>0&&(D.style.fill=a,D.style.opacity=String(Math.min(.3+y.length*.15,1)),D.style.cursor="pointer",D.setAttribute("data-date",m),D.setAttribute("data-count",String(y.length)),D.setAttribute("data-names",y.map(w=>w.displayName).join("|")),s)){let w=p,E=y;D.addEventListener("click",T=>s(T,w,E))}n.appendChild(D)}}}renderMonthSeparators(n){for(let t=1;t<=12;t++){let e=this.monthToAngle(t)-Math.PI/2,r=x+X*Math.cos(e),a=x+X*Math.sin(e),i=x+U*Math.cos(e),s=x+U*Math.sin(e),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(r)),o.setAttribute("y1",String(a)),o.setAttribute("x2",String(i)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-month-separator"),n.appendChild(o)}}renderMonthLabels(n){let t=X+_e/2;for(let e=1;e<=12;e++){let r=this.monthToAngle(e)+Math.PI/12-Math.PI/2,a=x+t*Math.cos(r),i=x+t*Math.sin(r),s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(a)),s.setAttribute("y",String(i)),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.setAttribute("class","rc-month-label"),s.textContent=gn[e-1],n.appendChild(s)}}renderTodayMarker(n,t){let e=F();if(e.year!==t)return;let r=C(t,e.month),a=this.monthToAngle(e.month),i=Math.PI/6/r,o=a+(e.day-.5)*i-Math.PI/2,c=x+X*Math.cos(o),d=x+X*Math.sin(o),g=x+U*Math.cos(o),u=x+U*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(c)),h.setAttribute("y1",String(d)),h.setAttribute("x2",String(g)),h.setAttribute("y2",String(u)),h.setAttribute("class","rc-today-marker"),n.appendChild(h)}renderCenter(n,t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(x)),e.setAttribute("cy",String(x)),e.setAttribute("r",String(X-5)),e.setAttribute("class","rc-center"),n.appendChild(e);let r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",String(x)),r.setAttribute("y",String(x)),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.setAttribute("class","rc-center-text"),r.textContent=String(t),n.appendChild(r)}createArcPath(n,t,e,r){let a=e-Math.PI/2,i=r-Math.PI/2,s=x+n*Math.cos(a),o=x+n*Math.sin(a),c=x+n*Math.cos(i),d=x+n*Math.sin(i),g=x+t*Math.cos(a),u=x+t*Math.sin(a),h=x+t*Math.cos(i),p=x+t*Math.sin(i),m=r-e>Math.PI?1:0;return`
      M ${s} ${o}
      L ${g} ${u}
      A ${t} ${t} 0 ${m} 1 ${h} ${p}
      L ${c} ${d}
      A ${n} ${n} 0 ${m} 0 ${s} ${o}
      Z
    `}monthToAngle(n){return(n-1)*Math.PI/6}};var It=class{constructor(n){this.app=n}createContext(n){var a,i,s;let t=this.app.metadataCache.getFileCache(n),e=[];if((a=t==null?void 0:t.frontmatter)!=null&&a.tags){let o=t.frontmatter.tags;Array.isArray(o)?e.push(...o.map(c=>this.normalizeTag(c))):typeof o=="string"&&e.push(this.normalizeTag(o))}if(t!=null&&t.tags)for(let o of t.tags)e.push(this.normalizeTag(o.tag));let r=[];if(t!=null&&t.links)for(let o of t.links)r.push(o.link);if(t!=null&&t.frontmatterLinks)for(let o of t.frontmatterLinks)r.push(o.link);return{file:n,metadata:t,tags:[...new Set(e)],folder:(s=(i=n.parent)==null?void 0:i.path)!=null?s:"",links:[...new Set(r)]}}normalizeTag(n){return n.replace(/^#/,"").toLowerCase()}evaluate(n,t){return typeof n=="string"?this.evaluateString(n,t):this.evaluateYaml(n,t)}evaluateYaml(n,t){return n.and?n.and.every(e=>this.evaluate(e,t)):n.or?n.or.some(e=>this.evaluate(e,t)):n.not?n.not.every(e=>!this.evaluate(e,t)):!0}evaluateString(n,t){let e=n.trim();if(!e)return!0;if(e.startsWith("(")&&e.endsWith(")"))return this.evaluateString(e.slice(1,-1),t);let r=this.splitByOperator(e,"||");if(r.length>1)return r.some(i=>this.evaluateString(i,t));let a=this.splitByOperator(e,"&&");return a.length>1?a.every(i=>this.evaluateString(i,t)):e.startsWith("!")?!this.evaluateString(e.slice(1),t):this.evaluateFunction(e,t)}splitByOperator(n,t){let e=[],r="",a=0,i=0;for(;i<n.length;){let s=n[i];if(s==="(")a++,r+=s;else if(s===")")a--,r+=s;else if(a===0&&n.slice(i,i+t.length)===t){e.push(r.trim()),r="",i+=t.length;continue}else r+=s;i++}return r.trim()&&e.push(r.trim()),e}evaluateFunction(n,t){let e=n.match(/^file\.hasTag\s*\(\s*["']([^"']+)["']\s*\)$/);if(e){let i=this.normalizeTag(e[1]);return t.tags.some(s=>s===i||s.startsWith(i+"/"))}let r=n.match(/^file\.inFolder\s*\(\s*["']([^"']+)["']\s*\)$/);if(r){let i=r[1].replace(/^\/|\/$/g,""),s=t.folder.replace(/^\/|\/$/g,"");return s===i||s.startsWith(i+"/")}let a=n.match(/^file\.hasLink\s*\(\s*["']([^"']+)["']\s*\)$/);if(a){let i=a[1].toLowerCase();return t.links.some(s=>s.toLowerCase()===i||s.toLowerCase().endsWith("/"+i))}return console.warn(`Radcal: Unknown filter function: ${n}`),!0}};var se=class extends nt.MarkdownRenderChild{constructor(t,e,r,a,i){super(t);this.app=e;this.service=r;this.config=a;this.openFile=i;this.unsubscribe=null;this.filterEngine=new It(e)}onload(){this.render(),this.unsubscribe=this.service.subscribeToUpdates(()=>{this.render()})}onunload(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}render(){var o;this.containerEl.empty();let t=(o=this.config.year)!=null?o:this.service.getCurrentYear(),e=this.loadFilteredEntries(t),a=new Pt().render(this.config,e,t,(c,d,g)=>this.handleDayClick(c,d,g)),i=this.containerEl.createDiv({cls:"radcal-tooltip"});this.containerEl.createDiv({cls:"radcal-block-content"}).appendChild(a),this.setupTooltips(a,i,t)}loadFilteredEntries(t){let e=new Map;if(this.config.dateProperty)return this.loadEntriesByProperty(t);for(let r=1;r<=12;r++){let a=C(t,r);for(let i=1;i<=a;i++){let s=M(t,r,i),o=`${t}-${String(r).padStart(2,"0")}-${String(i).padStart(2,"0")}`,c=[...this.service.getEntriesForDate(s)];if(this.config.filter&&(c=c.filter(d=>{let g=this.app.vault.getAbstractFileByPath(d.filePath);if(!(g instanceof nt.TFile))return!1;let u=this.filterEngine.createContext(g);return this.filterEngine.evaluate(this.config.filter,u)})),!this.config.filter&&this.config.folder){let d=this.config.folder;c=c.filter(g=>g.metadata.folder===d||g.metadata.folder.startsWith(d+"/"))}if(!this.config.filter&&this.config.folders&&this.config.folders.length>0){let d=this.config.folders;c=c.filter(g=>d.some(u=>g.metadata.folder===u||g.metadata.folder.startsWith(u+"/")))}c.length>0&&e.set(o,c)}}return e}loadEntriesByProperty(t){var i,s;let e=new Map,r=this.config.dateProperty,a=this.app.vault.getMarkdownFiles();for(let o of a){if(this.config.filter){let m=this.filterEngine.createContext(o);if(!this.filterEngine.evaluate(this.config.filter,m))continue}let c=this.app.metadataCache.getFileCache(o),d=c==null?void 0:c.frontmatter;if(!d)continue;let g=d[r];if(!g)continue;let u=this.parseDate(g);if(!u||u.year!==t)continue;let h=`${u.year}-${String(u.month).padStart(2,"0")}-${String(u.day).padStart(2,"0")}`,p={id:o.path,filePath:o.path,fileName:o.name,displayName:o.basename,startDate:u,endDate:null,isMultiDay:!1,isAnniversary:!1,metadata:{tags:[],folder:(s=(i=o.parent)==null?void 0:i.path)!=null?s:"",properties:{}}};e.has(h)||e.set(h,[]),e.get(h).push(p)}return e}parseDate(t){if(!t)return null;if(t instanceof Date)return M(t.getFullYear(),t.getMonth()+1,t.getDate());if(typeof t=="string"){let e=t.match(/(\d{4})-(\d{2})-(\d{2})/);if(e)return M(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10))}return null}handleDayClick(t,e,r){r.length===1?this.openFile(r[0].filePath):r.length>1&&this.showEntryMenu(t,e,r)}showEntryMenu(t,e,r){let a=new nt.Menu,i=`${e.day}.${e.month}.${e.year}`;a.addItem(s=>{s.setTitle(i).setIcon("calendar").setDisabled(!0)}),a.addSeparator();for(let s of r.slice(0,15))a.addItem(o=>{o.setTitle(s.displayName).setIcon("file-text").onClick(()=>{this.openFile(s.filePath)})});r.length>15&&a.addItem(s=>{s.setTitle(`+${r.length-15} more...`).setDisabled(!0)}),a.showAtMouseEvent(t)}setupTooltips(t,e,r){t.querySelectorAll(".rc-day-arc[data-date]").forEach(i=>{i.addEventListener("mouseenter",s=>{var D;let o=s,c=s.target,d=c.getAttribute("data-date")||"",g=c.getAttribute("data-count")||"0",u=((D=c.getAttribute("data-names"))==null?void 0:D.split("|"))||[],[h,p,m]=d.split("-").map(Number),f=`<div class="radcal-tooltip-date">${`${m}.${p}.${h}`}</div>`;if(u.length>0){f+='<div class="radcal-tooltip-entries">';for(let A of u.slice(0,5))f+=`<div class="radcal-tooltip-entry">${A}</div>`;u.length>5&&(f+=`<div class="radcal-tooltip-more">+${u.length-5} more</div>`),f+="</div>"}e.innerHTML=f,e.style.display="block";let b=this.containerEl.getBoundingClientRect();e.style.left=`${o.clientX-b.left+15}px`,e.style.top=`${o.clientY-b.top+15}px`}),i.addEventListener("mouseleave",()=>{e.style.display="none"})})}},Nt=class{constructor(n,t,e){this.app=n;this.service=t;this.openFile=e}process(n,t,e){try{let r=Ge(n),a=t.createDiv({cls:"radcal-block"}),i=new se(a,this.app,this.service,r,this.openFile);e.addChild(i)}catch(r){t.createDiv({cls:"radcal-error",text:`Radcal Error: ${r instanceof Error?r.message:String(r)}`})}}};var v=require("obsidian");j();var kt=require("obsidian"),_=class extends kt.AbstractInputSuggest{constructor(n,t){super(n,t),this.textInputEl=t}getSuggestions(n){let t=this.getAllFolders(),e=n.toLowerCase().trim();return e===""?t:t.filter(r=>r.path.toLowerCase().includes(e))}renderSuggestion(n,t){t.addClass("folder-suggest-item");let e=t.createSpan({cls:"folder-suggest-icon"});e.innerHTML=this.getFolderIcon(),t.createSpan({cls:"folder-suggest-text"}).setText(n.path||"/")}selectSuggestion(n,t){this.textInputEl.value=n.path,this.textInputEl.trigger("input"),this.close()}getAllFolders(){let n=[],t=r=>{n.push(r);for(let a of r.children)a instanceof kt.TFolder&&t(a)},e=this.app.vault.getRoot();return t(e),n.sort((r,a)=>r.isRoot()?-1:a.isRoot()?1:r.path.localeCompare(a.path))}getFolderIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>'}};var $t=class extends v.PluginSettingTab{constructor(n,t){super(n,t),this.plugin=t}display(){let{containerEl:n}=this;n.empty(),this.createViewModeSection(n),this.plugin.settings.currentView==="life"&&this.createLifeViewSection(n),this.createDailyNotesSection(n),this.createCalendarSyncSection(n),this.createRingConfigSection(n),this.createOuterSegmentsSection(n),this.createTemplateSection(n),this.createCenterDisplaySection(n)}createViewModeSection(n){new v.Setting(n).setName("View Mode").setDesc("Switch between Annual and Life view").addDropdown(t=>{t.addOption("annual","Annual View").addOption("life","Life View").setValue(this.plugin.settings.currentView).onChange(async e=>{this.plugin.settings.currentView=e,await this.plugin.saveSettings(),this.display()})})}createLifeViewSection(n){n.createEl("h3",{text:"Life View Settings"}),new v.Setting(n).setName("Birth Date").setDesc("Your birth date (YYYY-MM-DD) for precise calculation").addText(e=>{e.setPlaceholder("e.g. 1977-03-27").setValue(this.plugin.settings.birthDate||"").onChange(async r=>{let a=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(a){let i=parseInt(a[1],10),s=parseInt(a[2],10),o=parseInt(a[3],10);i>1900&&i<=new Date().getFullYear()&&s>=1&&s<=12&&o>=1&&o<=31&&(this.plugin.settings.birthDate=r,this.plugin.settings.birthYear=i,await this.plugin.saveSettings())}else r===""&&(this.plugin.settings.birthDate=void 0,await this.plugin.saveSettings())})}),new v.Setting(n).setName("Birth Year (Fallback)").setDesc("Used when no full date is provided").addText(e=>{e.setPlaceholder("e.g. 1990").setValue(String(this.plugin.settings.birthYear)).onChange(async r=>{let a=parseInt(r,10);!isNaN(a)&&a>1900&&a<=new Date().getFullYear()&&(this.plugin.settings.birthYear=a,await this.plugin.saveSettings())})}),new v.Setting(n).setName("Expected Lifespan").setDesc("Expected lifespan in years").addText(e=>{e.setPlaceholder("e.g. 85").setValue(String(this.plugin.settings.expectedLifespan)).onChange(async r=>{let a=parseInt(r,10);!isNaN(a)&&a>0&&a<=150&&(this.plugin.settings.expectedLifespan=a,await this.plugin.saveSettings())})}),n.createEl("h4",{text:"Life Phases"}),new v.Setting(n).setName("Life Phases Folder").setDesc("Folder with life phase notes (YAML: phase-start, phase-end, phase-color, phase-label)").addText(e=>{e.setPlaceholder("e.g. Life/Phases").setValue(this.plugin.settings.lifePhasesFolder).onChange(async r=>{this.plugin.settings.lifePhasesFolder=r,await this.plugin.saveSettings()}),new _(this.app,e.inputEl)});let t=n.createDiv({cls:"setting-item-description"});t.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Example YAML for a life phase:</strong><br>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
phase-start: 1983-09-01<br>
phase-end: 1987-07-15<br>
phase-color: blue<br>
phase-label: Elementary School<br>
---
        </code>
        <br>
        <em>Leave end empty for "ongoing" phases (shows faded arc until life expectancy)</em>
      </p>
    `}createDailyNotesSection(n){n.createEl("h3",{text:"Daily Notes"}),new v.Setting(n).setName("Notes Folder").setDesc("Folder where new notes are created (empty = vault root)").addText(e=>{e.setPlaceholder("e.g. Daily Notes").setValue(this.plugin.settings.dailyNoteFolder).onChange(async r=>{this.plugin.settings.dailyNoteFolder=r,await this.plugin.saveSettings()}),new _(this.app,e.inputEl)}),new v.Setting(n).setName("Filter Folder").setDesc("Only show notes from this folder (empty = all)").addText(e=>{e.setPlaceholder("e.g. Journal").setValue(this.plugin.settings.calendarFilterFolder).onChange(async r=>{this.plugin.settings.calendarFilterFolder=r,await this.plugin.saveSettings()}),new _(this.app,e.inputEl)}),new v.Setting(n).setName("Filename Format").setDesc("Format for new notes (YYYY-MM-DD)").addText(e=>{e.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.periodicNotesFormat.daily).onChange(async r=>{this.plugin.settings.periodicNotesFormat={...this.plugin.settings.periodicNotesFormat,daily:r||"YYYY-MM-DD"},await this.plugin.saveSettings()})}),new v.Setting(n).setName("Annual Recurring").setDesc("Folder for birthdays, anniversaries (use XXXX-MM-DD format, shown every year on that date)").addText(e=>{e.setPlaceholder("e.g. Birthdays").setValue(this.plugin.settings.annualRecurringFolder).onChange(async r=>{this.plugin.settings.annualRecurringFolder=r,await this.plugin.saveSettings()}),new _(this.app,e.inputEl)}),n.createEl("h4",{text:"Anniversary Properties"}),new v.Setting(n).setName("Additional Date Properties").setDesc("Comma-separated list of YAML properties to use for anniversary dates (in addition to radcal-start/radcal-end)").addText(e=>{var r;e.setPlaceholder("e.g. Birthday, Todestag, Hochzeitstag").setValue(((r=this.plugin.settings.anniversaryDateProperties)==null?void 0:r.join(", "))||"").onChange(async a=>{let i=a.split(",").map(s=>s.trim()).filter(s=>s.length>0);this.plugin.settings.anniversaryDateProperties=i,await this.plugin.saveSettings()})});let t=n.createDiv({cls:"setting-item-description"});t.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Anniversary Properties:</strong><br>
        Use <code>radcal-annual: true</code> to mark a note as anniversary.<br><br>
        <strong>Date sources (checked in order):</strong><br>
        1. <code>radcal-annual-fix</code> - Single fixed date (overrides all)<br>
        2. <code>radcal-start</code> / <code>radcal-end</code> - Birth + death dates<br>
        3. Properties from list above (e.g., <code>Birthday</code>)<br><br>
        <strong>Example:</strong>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
radcal-annual: true<br>
Birthday: 1982-09-24<br>
---
        </code>
      </p>
    `}createCalendarSyncSection(n){n.createEl("h3",{text:"Calendar Sync (Google Calendar)"}),(this.plugin.settings.calendarSources||[]).forEach((r,a)=>{this.createCalendarSourceSettings(n,r,a)}),new v.Setting(n).setName("Add Calendar Source").setDesc("Add a new Google Calendar or iCal source").addButton(r=>{r.setButtonText("+ Add Calendar").setCta().onClick(async()=>{let a={id:`gcal_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:"New Calendar",url:"",folder:"Calendar/Google",color:"blue",syncOnStart:!0,syncIntervalMinutes:0,enabled:!0,showAsRing:!0,showSpanningArcs:!0};this.plugin.settings.calendarSources||(this.plugin.settings.calendarSources=[]),this.plugin.settings.calendarSources.push(a),await this.plugin.saveSettings(),this.display()})});let e=n.createDiv({cls:"setting-item-description"});e.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>How to get your Google Calendar URL:</strong><br>
        1. Open Google Calendar \u2192 Settings \u2192 Calendar Settings<br>
        2. Select your calendar \u2192 Integrate calendar<br>
        3. Copy "Secret address in iCal format"<br><br>
        <em>Note: This URL is private and contains a secret key. Never share it publicly.</em>
      </p>
    `}createCalendarSourceSettings(n,t,e){let r=n.createDiv({cls:"radial-calendar-source-config"});if(new v.Setting(r).setName(`Calendar ${e+1}: ${t.name}`).setHeading().addButton(a=>{a.setIcon("trash").setWarning().setTooltip("Delete this calendar source").onClick(async()=>{this.plugin.settings.calendarSources.splice(e,1),await this.plugin.saveSettings(),this.display()})}),new v.Setting(r).setName("Name").setDesc("Display name for this calendar").addText(a=>{a.setPlaceholder("e.g. Work Calendar").setValue(t.name).onChange(async i=>{t.name=i,await this.plugin.saveSettings()})}),new v.Setting(r).setName("iCal URL").setDesc("Private iCal/ICS URL (from Google Calendar settings)").addText(a=>{a.setPlaceholder("https://calendar.google.com/calendar/ical/...").setValue(t.url).onChange(async i=>{t.url=i,await this.plugin.saveSettings()}),a.inputEl.style.width="100%",a.inputEl.type="password"}),new v.Setting(r).setName("Target Folder").setDesc("Where synced events will be saved").addText(a=>{a.setPlaceholder("e.g. Calendar/Google/Work").setValue(t.folder).onChange(async i=>{t.folder=i,await this.plugin.saveSettings()}),new _(this.app,a.inputEl)}),new v.Setting(r).setName("Color").setDesc("Color for this calendar in the radial view").addDropdown(a=>{Object.keys(P).forEach(i=>{a.addOption(i,i.charAt(0).toUpperCase()+i.slice(1))}),a.setValue(t.color).onChange(async i=>{t.color=i,await this.plugin.saveSettings()})}),new v.Setting(r).setName("Sync on Start").setDesc("Automatically sync when Obsidian starts").addToggle(a=>{a.setValue(t.syncOnStart).onChange(async i=>{t.syncOnStart=i,await this.plugin.saveSettings()})}),new v.Setting(r).setName("Auto-sync Interval").setDesc("How often to sync (0 = manual only)").addDropdown(a=>{a.addOption("0","Manual only").addOption("15","Every 15 minutes").addOption("30","Every 30 minutes").addOption("60","Every hour").addOption("360","Every 6 hours").addOption("1440","Daily").setValue(String(t.syncIntervalMinutes)).onChange(async i=>{t.syncIntervalMinutes=parseInt(i,10),await this.plugin.saveSettings()})}),new v.Setting(r).setName("Enabled").setDesc("Enable or disable this calendar source").addToggle(a=>{a.setValue(t.enabled).onChange(async i=>{t.enabled=i,await this.plugin.saveSettings()})}),new v.Setting(r).setName("Show as Ring").setDesc("Display this calendar as a ring in the annual view").addToggle(a=>{var i;a.setValue((i=t.showAsRing)!=null?i:!0).onChange(async s=>{t.showAsRing=s,await this.plugin.saveSettings()})}),new v.Setting(r).setName("Spanning Arcs").setDesc("Show multi-day events as continuous arcs").addToggle(a=>{var i;a.setValue((i=t.showSpanningArcs)!=null?i:!0).onChange(async s=>{t.showSpanningArcs=s,await this.plugin.saveSettings()})}),t.lastSync){let i=new Date(t.lastSync).toLocaleString();r.createDiv({cls:"setting-item-description",text:`Last synced: ${i}`})}r.createEl("hr")}createRingConfigSection(n){n.createEl("h3",{text:"Configure Rings"});let t=this.plugin.settings.rings;t.forEach((e,r)=>{this.createRingSettings(n,e,r)}),new v.Setting(n).addButton(e=>{e.setButtonText("Add Ring").setCta().onClick(async()=>{let r=zt(t.length);this.plugin.settings.rings=[...t,r],await this.plugin.saveSettings(),this.display()})})}createRingSettings(n,t,e){let r=n.createDiv({cls:"radial-calendar-ring-config"}),a=new v.Setting(r).setName(`Ring ${e+1}`).setClass("radial-calendar-ring-header");new v.Setting(r).setName("Name").addText(i=>{i.setPlaceholder("Ring Name").setValue(t.name).onChange(async s=>{this.updateRing(e,{name:s})})}),new v.Setting(r).setName("Folder").setDesc("Folder path in vault").addText(i=>{i.setPlaceholder("e.g. Projects/2024").setValue(t.folder).onChange(async s=>{this.updateRing(e,{folder:s})}),new _(this.app,i.inputEl)}),new v.Setting(r).setName("Color").addDropdown(i=>{Object.keys(P).forEach(s=>{i.addOption(s,this.formatColorName(s))}),i.setValue(t.color).onChange(async s=>{this.updateRing(e,{color:s})})}),new v.Setting(r).setName("Spanning Arcs").setDesc("Show multi-day events as continuous arcs").addToggle(i=>{var s;i.setValue((s=t.showSpanningArcs)!=null?s:!1).onChange(async o=>{await this.updateRing(e,{showSpanningArcs:o}),this.display()})}),t.showSpanningArcs&&this.createSpanningArcsPropertySettings(r,t,e),new v.Setting(r).addButton(i=>{i.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.rings=this.plugin.settings.rings.filter((s,o)=>o!==e),this.plugin.settings.rings=this.plugin.settings.rings.map((s,o)=>({...s,order:o})),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateRing(n,t){let e=[...this.plugin.settings.rings];e[n]={...e[n],...t},this.plugin.settings.rings=e,await this.plugin.saveSettings()}createSpanningArcsPropertySettings(n,t,e){let r=n.createDiv({cls:"radial-calendar-segment-config"});new v.Setting(r).setName("Start Date Property").setDesc("YAML frontmatter field for start date").addText(a=>{a.setPlaceholder("radcal-start").setValue(t.startDateField||"radcal-start").onChange(async i=>{this.updateRing(e,{startDateField:i||"radcal-start"})})}),new v.Setting(r).setName("End Date Property").setDesc("YAML frontmatter field for end date").addText(a=>{a.setPlaceholder("radcal-end").setValue(t.endDateField||"radcal-end").onChange(async i=>{this.updateRing(e,{endDateField:i||"radcal-end"})})}),new v.Setting(r).setName("Color Property").setDesc("YAML frontmatter field for color").addText(a=>{a.setPlaceholder("radcal-color").setValue(t.colorField||"radcal-color").onChange(async i=>{this.updateRing(e,{colorField:i||"radcal-color"})})}),new v.Setting(r).setName("Label Property").setDesc("YAML frontmatter field for label").addText(a=>{a.setPlaceholder("radcal-label").setValue(t.labelField||"radcal-label").onChange(async i=>{this.updateRing(e,{labelField:i||"radcal-label"})})})}formatColorName(n){return n.charAt(0).toUpperCase()+n.slice(1)}createOuterSegmentsSection(n){n.createEl("h3",{text:"Outer Segments"}),new v.Setting(n).setName("Segment Type").setDesc("Markers on the outer edge of the calendar").addDropdown(t=>{t.addOption("none","None").addOption("seasons","Seasons (4)").addOption("quarters","Quarters (4)").addOption("semester","Semesters (2)").addOption("ten-days","10-Day Phases (36)").addOption("weeks","Weeks (52)").addOption("custom","Custom").setValue(this.plugin.settings.annualSegmentType).onChange(async e=>{this.plugin.settings.annualSegmentType=e,await this.plugin.saveSettings(),this.display()})}),new v.Setting(n).setName("Show Labels").setDesc("Display segment labels").addToggle(t=>{t.setValue(this.plugin.settings.showSegmentLabels).onChange(async e=>{this.plugin.settings.showSegmentLabels=e,await this.plugin.saveSettings()})}),this.plugin.settings.annualSegmentType==="custom"&&this.createCustomSegmentsEditor(n),this.plugin.settings.currentView==="life"&&this.createLifeActsEditor(n)}createCustomSegmentsEditor(n){n.createEl("h4",{text:"Custom Segments"});let t=this.plugin.settings.customSegments;t.forEach((e,r)=>{this.createSegmentSettings(n,e,r)}),new v.Setting(n).addButton(e=>{e.setButtonText("Add Segment").onClick(async()=>{let r={id:`seg-${Date.now()}`,label:`Segment ${t.length+1}`,startDay:1,endDay:30};this.plugin.settings.customSegments=[...t,r],await this.plugin.saveSettings(),this.display()})})}createSegmentSettings(n,t,e){let r=n.createDiv({cls:"radial-calendar-segment-config"});new v.Setting(r).setName("Label").addText(a=>{a.setValue(t.label).onChange(async i=>{this.updateSegment(e,{label:i})})}),new v.Setting(r).setName("Start Day").setDesc("Day of year (1-365)").addText(a=>{a.setValue(String(t.startDay)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=1&&s<=365&&this.updateSegment(e,{startDay:s})})}),new v.Setting(r).setName("End Day").setDesc("Day of year (1-365)").addText(a=>{a.setValue(String(t.endDay)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=1&&s<=365&&this.updateSegment(e,{endDay:s})})}),new v.Setting(r).addButton(a=>{a.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.customSegments=this.plugin.settings.customSegments.filter((i,s)=>s!==e),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateSegment(n,t){let e=[...this.plugin.settings.customSegments];e[n]={...e[n],...t},this.plugin.settings.customSegments=e,await this.plugin.saveSettings()}createLifeActsEditor(n){n.createEl("h4",{text:"Life Acts"});let t=this.plugin.settings.lifeActs;t.forEach((e,r)=>{this.createLifeActSettings(n,e,r)}),new v.Setting(n).addButton(e=>{e.setButtonText("Add Life Act").onClick(async()=>{let r={id:`act-${Date.now()}`,label:`Act ${t.length+1}`,startAge:0,endAge:10};this.plugin.settings.lifeActs=[...t,r],await this.plugin.saveSettings(),this.display()})})}createLifeActSettings(n,t,e){let r=n.createDiv({cls:"radial-calendar-life-act-config"});new v.Setting(r).setName("Label").addText(a=>{a.setPlaceholder("e.g. Childhood").setValue(t.label).onChange(async i=>{this.updateLifeAct(e,{label:i})})}),new v.Setting(r).setName("Start Age").addText(a=>{a.setValue(String(t.startAge)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=0&&this.updateLifeAct(e,{startAge:s})})}),new v.Setting(r).setName("End Age").addText(a=>{a.setValue(String(t.endAge)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=0&&this.updateLifeAct(e,{endAge:s})})}),new v.Setting(r).setName("Color").addDropdown(a=>{a.addOption("","(Default)"),Object.keys(P).forEach(i=>{a.addOption(i,this.formatColorName(i))}),a.setValue(t.color||"").onChange(async i=>{this.updateLifeAct(e,{color:i||void 0})})}),new v.Setting(r).addButton(a=>{a.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.lifeActs=this.plugin.settings.lifeActs.filter((i,s)=>s!==e),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateLifeAct(n,t){let e=[...this.plugin.settings.lifeActs];e[n]={...e[n],...t},this.plugin.settings.lifeActs=e,await this.plugin.saveSettings()}createTemplateSection(n){n.createEl("h3",{text:"Template"}),new v.Setting(n).setName("Create Template").setDesc("Creates a template file for ring segments in your vault").addButton(t=>{t.setButtonText("Create Template").onClick(async()=>{await this.createTemplateFile()})})}async createTemplateFile(){let n=this.plugin.settings.templateFolder||"Templates",t=`${n}/Radial Calendar Segment.md`;try{if(this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n),this.app.vault.getAbstractFileByPath(t)){new v.Notice(`Template already exists: ${t}`);return}await this.app.vault.create(t,Jt),new v.Notice(`Template created: ${t}`)}catch(e){console.error("Failed to create template file:",e),new v.Notice("Error creating template")}}createCenterDisplaySection(n){n.createEl("h3",{text:"Center Display"}),new v.Setting(n).setName("Display Mode").setDesc("What is shown in the center of the calendar").addDropdown(t=>{t.addOption("countdown","Countdown").addOption("stats","Statistics").addOption("navigation","Navigation").setValue(this.plugin.settings.centerDisplay).onChange(async e=>{this.plugin.settings.centerDisplay=e,await this.plugin.saveSettings()})})}};var rt=require("obsidian");function He(l){let n=[],e=pn(l).split(`
`),r=null;for(let a of e){let i=a.trim();if(i==="BEGIN:VEVENT"){r={};continue}if(i==="END:VEVENT"){r&&r.uid&&r.summary&&r.startDate&&n.push(r),r=null;continue}if(!r)continue;let s=i.indexOf(":");if(s===-1)continue;let o=i.substring(0,s),c=i.substring(s+1),d=o.indexOf(";"),g=d===-1?o:o.substring(0,d),u=d===-1?"":o.substring(d+1);switch(g){case"UID":r.uid=c;break;case"SUMMARY":r.summary=ie(c);break;case"DESCRIPTION":r.description=ie(c);break;case"LOCATION":r.location=ie(c);break;case"DTSTART":let h=We(c,u);r.startDate=h.date,r.isAllDay=h.isAllDay;break;case"DTEND":let p=We(c,u);r.endDate=p.date;break;case"RRULE":r.isRecurring=!0,r.recurrenceRule=c;break}}return n}function pn(l){return l.replace(/\r\n[ \t]/g,"").replace(/\n[ \t]/g,"")}function ie(l){return l.replace(/\\n/g,`
`).replace(/\\,/g,",").replace(/\\;/g,";").replace(/\\\\/g,"\\")}function We(l,n){if(n.includes("VALUE=DATE")&&!n.includes("VALUE=DATE-TIME")){let i=parseInt(l.substring(0,4),10),s=parseInt(l.substring(4,6),10)-1,o=parseInt(l.substring(6,8),10);return{date:new Date(i,s,o),isAllDay:!0}}let e=parseInt(l.substring(0,4),10),r=parseInt(l.substring(4,6),10)-1,a=parseInt(l.substring(6,8),10);if(l.length>=15){let i=parseInt(l.substring(9,11),10),s=parseInt(l.substring(11,13),10),o=parseInt(l.substring(13,15),10);return l.endsWith("Z")?{date:new Date(Date.UTC(e,r,a,i,s,o)),isAllDay:!1}:{date:new Date(e,r,a,i,s,o),isAllDay:!1}}return{date:new Date(e,r,a),isAllDay:!0}}function ze(l){return l.isRecurring&&l.recurrenceRule!==void 0&&l.recurrenceRule.includes("FREQ=YEARLY")}function Ot(l){let n=l.getFullYear(),t=String(l.getMonth()+1).padStart(2,"0"),e=String(l.getDate()).padStart(2,"0");return`${n}-${t}-${e}`}function oe(l){let n=String(l.getHours()).padStart(2,"0"),t=String(l.getMinutes()).padStart(2,"0");return`${n}:${t}`}function je(l){return l.replace(/[<>:"/\\|?*]/g,"-").replace(/\s+/g," ").trim().substring(0,100)}var Vt=class{constructor(n){this.app=n;this.syncIntervals=new Map}async syncCalendar(n){let t={success:!1,calendarId:n.id,calendarName:n.name,eventsCreated:0,eventsUpdated:0,eventsSkipped:0,errors:[]};try{let e=await this.fetchICS(n.url);if(!e)return t.errors.push("Failed to fetch calendar data"),t;let r=He(e);await this.ensureFolder(n.folder);for(let a of r)try{let i=await this.processEvent(a,n);i==="created"?t.eventsCreated++:i==="updated"?t.eventsUpdated++:t.eventsSkipped++}catch(i){t.errors.push(`Event "${a.summary}": ${i instanceof Error?i.message:String(i)}`)}t.success=!0}catch(e){t.errors.push(e instanceof Error?e.message:String(e))}return t}async syncAllCalendars(n){let t=[];for(let e of n)if(e.enabled){let r=await this.syncCalendar(e);t.push(r)}return t}startAutoSync(n,t){this.stopAutoSync();for(let e of n)if(e.enabled&&e.syncIntervalMinutes>0){let r=e.syncIntervalMinutes*60*1e3,a=window.setInterval(async()=>{let i=await this.syncCalendar(e);t(i)},r);this.syncIntervals.set(e.id,a)}}stopAutoSync(){for(let n of this.syncIntervals.values())window.clearInterval(n);this.syncIntervals.clear()}async fetchICS(n){try{let t=await(0,rt.requestUrl)({url:n,method:"GET"});return t.status===200?t.text:null}catch(t){return console.error("Failed to fetch ICS:",t),null}}async ensureFolder(n){if(this.app.vault.getAbstractFileByPath(n)instanceof rt.TFolder)return;let e=n.split("/"),r="";for(let a of e)r=r?`${r}/${a}`:a,this.app.vault.getAbstractFileByPath(r)||await this.app.vault.createFolder(r)}async processEvent(n,t){let e=this.generateFilename(n),r=`${t.folder}/${e}.md`,a=this.app.vault.getAbstractFileByPath(r),i=this.generateFileContent(n,t);if(a instanceof rt.TFile){if((await this.app.vault.read(a)).includes(`gcal-uid: "${n.uid}"`)){let o=a.stat.mtime;if(Date.now()-o<60*60*1e3)return"skipped"}return await this.app.vault.modify(a,i),"updated"}return await this.app.vault.create(r,i),"created"}generateFilename(n){let t=Ot(n.startDate),e=je(n.summary);return`${t} ${e}`}generateFileContent(n,t){let e=["---"];if(e.push(`radcal-start: ${Ot(n.startDate)}`),n.endDate&&e.push(`radcal-end: ${Ot(n.endDate)}`),e.push(`radcal-color: ${t.color}`),e.push(`radcal-label: "${n.summary.replace(/"/g,'\\"')}"`),e.push(`gcal-uid: "${n.uid}"`),e.push(`gcal-source: "${t.name}"`),n.isRecurring&&(e.push("gcal-recurring: true"),ze(n)&&e.push("anniversary: true")),n.location&&e.push(`location: "${n.location.replace(/"/g,'\\"')}"`),e.push("---"),e.push(""),e.push(`# ${n.summary}`),e.push(""),!n.isAllDay){let r=oe(n.startDate);if(n.endDate){let a=oe(n.endDate);e.push(`**Zeit:** ${r} - ${a}`)}else e.push(`**Zeit:** ${r}`);e.push("")}return n.location&&(e.push(`**Ort:** ${n.location}`),e.push("")),n.description&&(e.push("## Beschreibung"),e.push(""),e.push(n.description),e.push("")),e.join(`
`)}};j();var Yt=class extends O.Plugin{constructor(){super(...arguments);this.service=null;this.calendarSync=null;this.settings={...Et}}async onload(){await this.loadSettings();let t={calendarWidth:"fit",dateProperties:["date","created","due"],endDateProperties:["endDate","end","until"],datePriority:"filename",dailyNoteFormat:this.settings.periodicNotesFormat.daily,dailyNoteFolder:this.settings.dailyNoteFolder,showMultiDayBars:!0,showWeekendHighlight:!0,anniversaryDateProperties:this.settings.anniversaryDateProperties||[]};this.service=new Ct(this.app,t),await this.service.initialize(),this.registerView(ot,r=>{let a=new Lt(r);return a.initialize({service:this.service,openFile:async i=>{let s=this.app.vault.getAbstractFileByPath(i);s instanceof O.TFile&&await this.app.workspace.getLeaf().openFile(s)},settings:this.settings,onSettingsChange:async i=>{this.settings=i,await this.saveSettings()}}),a}),this.registerView(dt,r=>{let a=new xt(r);return a.initialize({service:this.service,settings:this.settings,getActiveFileDate:()=>this.getActiveFileDate(),openFile:async i=>{let s=this.app.vault.getAbstractFileByPath(i);s instanceof O.TFile&&await this.app.workspace.getLeaf().openFile(s)}}),a});let e=new Nt(this.app,this.service,async r=>{let a=this.app.vault.getAbstractFileByPath(r);a instanceof O.TFile&&await this.app.workspace.getLeaf().openFile(a)});this.registerMarkdownCodeBlockProcessor("radcal",(r,a,i)=>e.process(r,a,i)),this.addSettingTab(new $t(this.app,this)),this.addRibbonIcon("circle","Open Radial Calendar",()=>{this.activateView()}),this.addRibbonIcon("clock","Open Local Calendar",()=>{this.activateLocalCalendarView()}),this.addCommand({id:"open-radial-calendar",name:"Open Radial Calendar",callback:()=>{this.activateView()}}),this.addCommand({id:"open-local-calendar",name:"Open Local Calendar (Sidebar)",callback:()=>{this.activateLocalCalendarView()}}),this.calendarSync=new Vt(this.app),this.addCommand({id:"sync-google-calendars",name:"Sync Google Calendars",callback:()=>{this.syncAllCalendars()}}),this.syncOnStart(),this.startAutoSync()}async onunload(){var t,e;(t=this.calendarSync)==null||t.stopAutoSync(),this.calendarSync=null,(e=this.service)==null||e.destroy(),this.service=null}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},Et,t)}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:t}=this.app,e=null,r=t.getLeavesOfType(ot);r.length>0?e=r[0]:(e=t.getLeaf("tab"),e&&await e.setViewState({type:ot,active:!0})),e&&t.revealLeaf(e)}getActiveFileDate(){let t=this.app.workspace.getActiveFile();if(!t)return null;let e=t.basename.match(/(\d{4})-(\d{2})-(\d{2})/);return e?M(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10)):null}async activateLocalCalendarView(){var r;let{workspace:t}=this.app,e=(r=t.getLeavesOfType(dt)[0])!=null?r:null;e||(e=t.getRightLeaf(!1),e&&await e.setViewState({type:dt,active:!0})),e&&t.revealLeaf(e)}async syncAllCalendars(){var r;if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(a=>a.enabled&&a.url);if(t.length===0){new O.Notice("No calendar sources configured");return}new O.Notice(`Syncing ${t.length} calendar(s)...`);let e=await this.calendarSync.syncAllCalendars(t);this.showSyncResults(e);for(let a of e)if(a.success){let i=this.settings.calendarSources.find(s=>s.id===a.calendarId);i&&(i.lastSync=Date.now())}await this.saveSettings(),await((r=this.service)==null?void 0:r.initialize())}async syncOnStart(){if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(e=>e.enabled&&e.url&&e.syncOnStart);t.length!==0&&setTimeout(async()=>{var i;let e=await this.calendarSync.syncAllCalendars(t);for(let s of e)if(s.success){let o=this.settings.calendarSources.find(c=>c.id===s.calendarId);o&&(o.lastSync=Date.now())}await this.saveSettings();let r=e.filter(s=>s.success).length,a=e.reduce((s,o)=>s+o.eventsCreated+o.eventsUpdated,0);a>0&&new O.Notice(`Calendar sync: ${a} events updated from ${r} calendar(s)`),await((i=this.service)==null?void 0:i.initialize())},2e3)}startAutoSync(){if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(e=>e.enabled&&e.url&&e.syncIntervalMinutes>0);t.length!==0&&this.calendarSync.startAutoSync(t,async e=>{var a;if(e.success){let i=this.settings.calendarSources.find(s=>s.id===e.calendarId);i&&(i.lastSync=Date.now(),await this.saveSettings())}let r=e.eventsCreated+e.eventsUpdated;r>0&&new O.Notice(`${e.calendarName}: ${r} events synced`),await((a=this.service)==null?void 0:a.initialize())})}showSyncResults(t){let e=t.filter(o=>o.success).length,r=t.reduce((o,c)=>o+c.eventsCreated,0),a=t.reduce((o,c)=>o+c.eventsUpdated,0),i=t.reduce((o,c)=>o+c.errors.length,0),s=`Sync complete: ${e}/${t.length} calendars`;r>0&&(s+=`, ${r} created`),a>0&&(s+=`, ${a} updated`),i>0&&(s+=`, ${i} errors`),new O.Notice(s);for(let o of t)o.errors.length>0&&console.warn(`Calendar sync errors (${o.calendarName}):`,o.errors)}};
