/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Rt=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var Ae=Object.getOwnPropertyNames;var Ee=Object.prototype.hasOwnProperty;var rt=(l,n)=>()=>(l&&(n=l(l=0)),n);var jt=(l,n)=>{for(var t in n)Rt(l,t,{get:n[t],enumerable:!0})},we=(l,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of Ae(n))!Ee.call(l,a)&&a!==t&&Rt(l,a,{get:()=>n[a],enumerable:!(e=ve(n,a))||e.enumerable});return l};var Tt=l=>we(Rt({},"__esModule",{value:!0}),l);function L(l,n,t){let e={year:l,month:n,day:t};if(!ot(e))throw new Error(`Invalid date: ${l}-${n}-${t}`);return Object.freeze(e)}function O(l){let n=l.month.toString().padStart(2,"0"),t=l.day.toString().padStart(2,"0");return`${l.year}-${n}-${t}`}function Ut(l){let n=l.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!n)return null;let t=parseInt(n[1],10),e=parseInt(n[2],10),a=parseInt(n[3],10),r={year:t,month:e,day:a};return ot(r)?Object.freeze(r):null}function w(l,n){return l.year!==n.year?l.year-n.year:l.month!==n.month?l.month-n.month:l.day-n.day}function z(l,n){return l.year===n.year&&l.month===n.month&&l.day===n.day}function ot(l){let{year:n,month:t,day:e}=l;if(!Number.isInteger(n)||n<1||!Number.isInteger(t)||t<1||t>12||!Number.isInteger(e)||e<1)return!1;let a=E(n,t);return e<=a}function E(l,n){let t=[31,28,31,30,31,30,31,31,30,31,30,31];return n===2&&lt(l)?29:t[n-1]}function lt(l){return l%4===0&&l%100!==0||l%400===0}function F(l){let n=l.year,t=l.month,e=l.day;t<3&&(t+=12,n-=1);let a=e,r=t,i=n%100,s=Math.floor(n/100),o=(a+Math.floor(13*(r+1)/5)+i+Math.floor(i/4)+Math.floor(s/4)-2*s)%7;return o=(o%7+7)%7,(o+6)%7}function G(l,n){let t=l.year,e=l.month,a=l.day+n;for(;a>E(t,e);)a-=E(t,e),e+=1,e>12&&(e=1,t+=1);for(;a<1;)e-=1,e<1&&(e=12,t-=1),a+=E(t,e);return Object.freeze({year:t,month:e,day:a})}function Jt(l,n){return G(l,-n)}function x(){let l=new Date;return Object.freeze({year:l.getFullYear(),month:l.getMonth()+1,day:l.getDate()})}function Kt(l,n){let t=Ht(l);return Ht(n)-t}function ct(l,n){return w(l,n)<0}function dt(l,n){return w(l,n)>0}function Xt(l,n,t){return w(l,n)>=0&&w(l,t)<=0}function qt(l){return Object.freeze({year:l.year,month:l.month,day:1})}function Zt(l){let n=E(l.year,l.month);return Object.freeze({year:l.year,month:l.month,day:n})}function Ht(l){let{year:n,month:t,day:e}=l,a=n*365+Math.floor(n/4)-Math.floor(n/100)+Math.floor(n/400);return a+=[0,31,59,90,120,151,181,212,243,273,304,334][t-1],t>2&&lt(n)&&(a+=1),a+=e,a}var N=rt(()=>{"use strict"});function pt(l){let n=l.endDate!==null&&(l.startDate.year!==l.endDate.year||l.startDate.month!==l.endDate.month||l.startDate.day!==l.endDate.day),t=l.startDate.year===0;return Object.freeze({id:l.id,filePath:l.filePath,fileName:l.fileName,displayName:l.displayName,startDate:l.startDate,endDate:l.endDate,isMultiDay:n,isAnniversary:t,metadata:Object.freeze({tags:Object.freeze([...l.metadata.tags]),folder:l.metadata.folder,properties:Object.freeze({...l.metadata.properties})})})}function te(){return Object.freeze({tags:Object.freeze([]),folder:"",properties:Object.freeze({})})}function ee(l){if(typeof l!="object"||l===null)return!1;let n=l;return typeof n.id=="string"&&typeof n.filePath=="string"&&typeof n.fileName=="string"&&typeof n.displayName=="string"&&Qt(n.startDate)&&(n.endDate===null||Qt(n.endDate))&&typeof n.isMultiDay=="boolean"&&typeof n.isAnniversary=="boolean"&&Le(n.metadata)}function Qt(l){if(typeof l!="object"||l===null)return!1;let n=l;return typeof n.year=="number"&&typeof n.month=="number"&&typeof n.day=="number"}function Le(l){if(typeof l!="object"||l===null)return!1;let n=l;return Array.isArray(n.tags)&&typeof n.folder=="string"&&typeof n.properties=="object"&&n.properties!==null}var Ft=rt(()=>{"use strict"});function ne(l,n){if(w(l,n)>0)throw new Error("Start date must be before or equal to end date");return Object.freeze({start:l,end:n})}function ae(l){return Object.freeze({start:l,end:l})}function Pt(l,n){return w(l.start,n.end)<=0&&w(n.start,l.end)<=0}function re(l,n){return w(l,n.start)>=0&&w(l,n.end)<=0}function ie(l,n){return w(l.start,n.start)<=0&&w(l.end,n.end)>=0}function se(l,n){if(!Pt(l,n))return null;let t=w(l.start,n.start)>=0?l.start:n.start,e=w(l.end,n.end)<=0?l.end:n.end;return Object.freeze({start:t,end:e})}function oe(l){if(l.start.year===l.end.year&&l.start.month===l.end.month)return l.end.day-l.start.day+1;let n=0,t=l.start;for(;w(t,l.end)<=0;)n++,t=G(t,1);return n}function le(l,n){let t=[],e=l.start.year,a=l.start.month,r=l.start.day;for(;e<l.end.year||e===l.end.year&&a<=l.end.month;){let i=E(e,a),s;e===l.end.year&&a===l.end.month?s=l.end.day:s=i,t.push(Object.freeze({year:e,month:a,startDay:r,endDay:s,entryId:n})),a++,a>12&&(a=1,e++),r=1}return Object.freeze(t)}function ce(l,n,t,e){let a={year:n,month:t,day:1},r={year:n,month:t,day:E(n,t)};if(dt(l.start,r)||ct(l.end,a))return null;let i=l.start.year===n&&l.start.month===t?l.start.day:1,s=l.end.year===n&&l.end.month===t?l.end.day:E(n,t);return Object.freeze({year:n,month:t,startDay:i,endDay:s,entryId:e})}function de(l,n){return Object.freeze({start:{year:l,month:n,day:1},end:{year:l,month:n,day:E(l,n)}})}function ge(l){return z(l.start,l.end)}function ue(l,n,t){return Object.freeze({start:G(l.start,-n),end:G(l.end,t)})}var he=rt(()=>{"use strict";N()});var Gt={};jt(Gt,{DEFAULT_DATE_EXTRACTION_CONFIG:()=>yt,DEFAULT_DISPLAY_CONFIG:()=>ft,DEFAULT_FOLDER_FILTER_CONFIG:()=>mt,DEFAULT_PLUGIN_SETTINGS:()=>It,DEFAULT_RADIAL_SETTINGS:()=>bt,DEFAULT_SETTINGS:()=>Re,PREDEFINED_QUARTERS:()=>Ot,PREDEFINED_SEASONS:()=>kt,PREDEFINED_SEMESTERS:()=>Vt,RING_COLORS:()=>P,RING_SEGMENT_TEMPLATE:()=>Bt,addDays:()=>G,assignTracks:()=>X,compareLocalDates:()=>w,computeSubRingRadii:()=>q,createCalendarEntry:()=>pt,createCurrentViewState:()=>Te,createDateRange:()=>ne,createDefaultRing:()=>Nt,createEmptyMetadata:()=>te,createEventsRing:()=>Ie,createLifePhasesRing:()=>Pe,createLocalDate:()=>L,createMonthRange:()=>de,createPluginSettings:()=>xe,createSingleDayRange:()=>ae,createViewState:()=>Fe,daysBetween:()=>Kt,extendRange:()=>ue,generate10DayPhases:()=>$t,generateWeekSegments:()=>Yt,getDaysInMonth:()=>E,getFirstDayOfMonth:()=>qt,getLastDayOfMonth:()=>Zt,getMaxTrackCount:()=>Z,getMonthSegment:()=>ce,getRangeDays:()=>oe,getToday:()=>x,getWeekday:()=>F,intersectRanges:()=>se,isAfter:()=>dt,isBefore:()=>ct,isCalendarEntry:()=>ee,isDateInRange:()=>re,isLeapYear:()=>lt,isSingleDay:()=>ge,isValidLocalDate:()=>ot,isWithinRange:()=>Xt,keyToLocalDate:()=>Ut,localDateToKey:()=>O,localDatesEqual:()=>z,rangeContains:()=>ie,rangesOverlap:()=>Pt,splitRangeByMonth:()=>le,subtractDays:()=>Jt});function xe(l){var n,t;return Object.freeze({dateExtraction:l.dateExtraction?Object.freeze({...yt,...l.dateExtraction}):yt,folderFilter:l.folderFilter?Object.freeze({...mt,...l.folderFilter}):mt,display:l.display?Object.freeze({...ft,...l.display}):ft,locale:(n=l.locale)!=null?n:It.locale,debugMode:(t=l.debugMode)!=null?t:It.debugMode})}function Te(){let l=new Date;return Object.freeze({year:l.getFullYear(),month:l.getMonth()+1,selectedDate:null,focusedEntryId:null})}function Fe(l,n){return Object.freeze({year:l,month:n,selectedDate:null,focusedEntryId:null})}function Nt(l){return{id:`ring-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Ring ${l+1}`,folder:"",color:"blue",segmentType:"monthly",enabled:!0,order:l,ringType:"year-days",segmentStyle:"fixed",folderPattern:"fixed",recursive:!1,showGaps:!1,showLabels:!1}}function Pe(l,n=0){return{id:`life-phases-${Date.now()}`,name:"Lebensphasen",folder:l,color:"blue",segmentType:"custom",enabled:!0,order:n,ringType:"life-phases",segmentStyle:"from-yaml",folderPattern:"fixed",recursive:!1,startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",showGaps:!0,showLabels:!0}}function Ie(l,n=1){return{id:`events-${Date.now()}`,name:"Events",folder:l,color:"teal",segmentType:"custom",enabled:!0,order:n,ringType:"events",segmentStyle:"from-yaml",folderPattern:"year-substitution",recursive:!1,startDateField:"event-start",endDateField:"event-end",colorField:"event-color",labelField:"event-label",showGaps:!0,showLabels:!0}}function X(l){let n=[...l].sort((e,a)=>e.startAngle-a.startAngle),t=[];return n.map(e=>{let a=t.findIndex(r=>r.endAngle<=e.startAngle);return a===-1?(a=t.length,t.push({endAngle:e.endAngle})):t[a].endAngle=e.endAngle,{...e,track:a}})}function q(l,n,t,e){let a=(l-n)/t;return{outer:l-e*a,inner:l-(e+1)*a}}function Z(l){return l.length===0?1:Math.max(...l.map(n=>n.track))+1}function $t(){let l=[],n=1,t=1;for(;n<=365;){let e=Math.min(n+9,365);l.push({id:`10d-${t}`,label:`P${t}`,startDay:n,endDay:e}),n=e+1,t++}return l}function Yt(){let l=[];for(let n=1;n<=52;n++){let t=(n-1)*7+1,e=Math.min(n*7,365);l.push({id:`kw-${n}`,label:`KW${n}`,startDay:t,endDay:e})}return l}var yt,mt,ft,It,Re,P,kt,Ot,Vt,bt,Bt,W=rt(()=>{"use strict";N();Ft();he();yt=Object.freeze({fromFilename:!0,fromFrontmatter:!0,frontmatterField:"date",endDateField:"endDate",filenamePatterns:Object.freeze(["^(\\d{4}-\\d{2}-\\d{2})","(\\d{4}-\\d{2}-\\d{2})$","^(\\d{4}-\\d{2}-\\d{2})[-_\\s]","[-_\\s](\\d{4}-\\d{2}-\\d{2})\\.md$"]),useCreationDateFallback:!1}),mt=Object.freeze({includeFolders:Object.freeze([]),excludeFolders:Object.freeze([])}),ft=Object.freeze({firstDayOfWeek:1,showWeekNumbers:!1,highlightToday:!0,showAdjacentMonths:!0,maxEntriesPerDay:3,showMultiDayBars:!0}),It=Object.freeze({dateExtraction:yt,folderFilter:mt,display:ft,locale:"en-US",debugMode:!1});Re={calendarWidth:"fit",dateProperties:["date","startDate","created"],endDateProperties:["endDate","due","deadline"],datePriority:"property",dailyNoteFolder:"",dailyNoteFormat:"YYYY-MM-DD",showMultiDayBars:!0,showWeekendHighlight:!0};P={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",teal:"#14b8a6",cyan:"#06b6d4",magenta:"#d946ef",lime:"#84cc16",amber:"#f59e0b",indigo:"#6366f1",violet:"#8b5cf6",rose:"#f43f5e",gray:"#6b7280",slate:"#64748b",stone:"#78716c"};kt=[{id:"spring",label:"Fr\xFChling",startDay:60,endDay:152},{id:"summer",label:"Sommer",startDay:152,endDay:244},{id:"autumn",label:"Herbst",startDay:244,endDay:335},{id:"winter",label:"Winter",startDay:335,endDay:60}],Ot=[{id:"q1",label:"Q1",startDay:1,endDay:90},{id:"q2",label:"Q2",startDay:91,endDay:181},{id:"q3",label:"Q3",startDay:182,endDay:273},{id:"q4",label:"Q4",startDay:274,endDay:365}],Vt=[{id:"s1",label:"H1",startDay:1,endDay:181},{id:"s2",label:"H2",startDay:182,endDay:365}];bt={currentView:"annual",birthYear:1990,expectedLifespan:85,currentYear:new Date().getFullYear(),rings:[],centerDisplay:"countdown",periodicNotesFormat:{yearly:"YYYY",monthly:"YYYY-MM",daily:"YYYY-MM-DD"},templateFolder:"Templates",dailyNoteFolder:"",calendarFilterFolder:"",annualRecurringFolder:"",lifePhasesFolder:"",annualSegmentType:"none",customSegments:[],lifeActs:[],showSegmentLabels:!0},Bt=`---
# === RADIAL CALENDAR TEMPLATE ===
# L\xF6sche die Zeilen, die du nicht brauchst

# FARBEN (w\xE4hle eine):
ring-color: blue
# ring-color: red
# ring-color: orange
# ring-color: yellow
# ring-color: green
# ring-color: teal
# ring-color: purple
# ring-color: magenta
# ring-color: pink
# ring-color: cyan
# ring-color: lime
# ring-color: amber
# ring-color: indigo

# STIL (w\xE4hle einen):
ring-style: solid
# ring-style: striped
# ring-style: dotted
# ring-style: gradient

# LABEL & ICON:
ring-label: ""
ring-icon: circle

# ZEITRAUM:
date: {{date}}
# end-date:

# FORTSCHRITT (0-100):
# ring-progress: 0
---

# {{title}}

`});var $e={};jt($e,{default:()=>xt});module.exports=Tt($e);var at=require("obsidian");var it=class{constructor(n){this.app=n}getAllMarkdownFiles(){return this.app.vault.getMarkdownFiles().map(t=>this.toFileInfo(t))}getMarkdownFilesInFolder(n){return this.getAllMarkdownFiles().filter(t=>t.folderPath?t.folderPath===n||t.folderPath.startsWith(n+"/"):!1)}getFileByPath(n){let t=this.app.vault.getAbstractFileByPath(n);return t instanceof this.getTFileClass()?t:null}async readFile(n){let t=this.getFileByPath(n);if(!t)return null;try{return await this.app.vault.read(t)}catch(e){return null}}async createOrOpenDailyNote(n,t=""){let e=this.getFileByPath(n);if(!e){let a=n.substring(0,n.lastIndexOf("/"));a&&await this.ensureFolderExists(a),e=await this.app.vault.create(n,t)}return e}async ensureFolderExists(n){this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n)}fileExists(n){return this.getFileByPath(n)!==null}getRoot(){return this.app.vault.getRoot()}toFileInfo(n){var t,e;return Object.freeze({path:n.path,basename:n.basename,name:n.name,extension:n.extension,folderPath:(e=(t=n.parent)==null?void 0:t.path)!=null?e:null})}getTFileClass(){let n=this.app.vault.getMarkdownFiles();return n.length>0?n[0].constructor:class{}}};var st=class{constructor(n){this.app=n}getMetadata(n){let t=this.app.metadataCache.getFileCache(n);return this.extractMetadata(t)}getMetadataByPath(n){let t=this.app.vault.getAbstractFileByPath(n);return!t||!this.isMarkdownFile(t)?null:this.getMetadata(t)}getProperty(n,t){var a;return(a=this.getMetadata(n).frontmatter)==null?void 0:a[t]}getStringProperty(n,t){let e=this.getProperty(n,t);return typeof e=="string"?e:e instanceof Date?this.formatDate(e):typeof e=="number"?String(e):null}getDateProperty(n,t){let e=this.getProperty(n,t);if(!e)return null;if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;let a=e.match(/^(\d{4}-\d{2}-\d{2})/);return a?a[1]:null}return e instanceof Date&&!isNaN(e.getTime())?this.formatDate(e):this.isLocalDateLike(e)?this.formatLocalDate(e):null}getTags(n){return this.getMetadata(n).tags}hasTag(n,t){let e=t.startsWith("#")?t:`#${t}`;return this.getTags(n).some(r=>r.tag.toLowerCase()===e.toLowerCase())}onMetadataChange(n){let t=e=>n(e);return this.app.metadataCache.on("changed",t),()=>this.app.metadataCache.off("changed",t)}extractMetadata(n){var a;let t=(a=n==null?void 0:n.frontmatter)!=null?a:null,e=[];if(t!=null&&t.tags){let r=Array.isArray(t.tags)?t.tags:[t.tags];for(let i of r)if(typeof i=="string"){let s=i.startsWith("#")?i:`#${i}`;e.push({tag:s,name:s.substring(1)})}}if(n!=null&&n.tags)for(let r of n.tags)e.find(s=>s.tag.toLowerCase()===r.tag.toLowerCase())||e.push({tag:r.tag,name:r.tag.substring(1)});return Object.freeze({frontmatter:t,tags:Object.freeze(e)})}formatDate(n){let t=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),a=String(n.getDate()).padStart(2,"0");return`${t}-${e}-${a}`}formatLocalDate(n){let t=n.year,e=String(n.month).padStart(2,"0"),a=String(n.day).padStart(2,"0");return`${t}-${e}-${a}`}isLocalDateLike(n){return typeof n=="object"&&n!==null&&"year"in n&&"month"in n&&"day"in n&&typeof n.year=="number"&&typeof n.month=="number"&&typeof n.day=="number"}isMarkdownFile(n){return typeof n=="object"&&n!==null&&"extension"in n&&n.extension==="md"}};N();var gt=class{constructor(n={}){var t,e;this.entriesByPath=new Map,this.entriesByDate=new Map,this.multiDayEntriesByDate=new Map,this.anniversaryEntriesByMonthDay=new Map,this.stats={hits:0,misses:0,lastRebuild:0},this.config={maxEntries:(t=n.maxEntries)!=null?t:1e4,debug:(e=n.debug)!=null?e:!1}}addEntry(n){if(this.removeEntry(n.filePath),this.entriesByPath.set(n.filePath,n),n.isAnniversary){let e=this.monthDayKey(n.startDate.month,n.startDate.day);this.addToDateIndex(e,n,this.anniversaryEntriesByMonthDay),this.log(`Added anniversary entry: ${n.filePath}`);return}let t=O(n.startDate);this.addToDateIndex(t,n,this.entriesByDate),n.isMultiDay&&n.endDate&&this.indexMultiDayEntry(n),this.log(`Added entry: ${n.filePath}`)}monthDayKey(n,t){return`${String(n).padStart(2,"0")}-${String(t).padStart(2,"0")}`}removeEntry(n){let t=this.entriesByPath.get(n);if(!t)return;if(this.entriesByPath.delete(n),t.isAnniversary){let a=this.monthDayKey(t.startDate.month,t.startDate.day);this.removeFromDateIndex(a,t.id,this.anniversaryEntriesByMonthDay),this.log(`Removed anniversary entry: ${n}`);return}let e=O(t.startDate);this.removeFromDateIndex(e,t.id,this.entriesByDate),t.isMultiDay&&t.endDate&&this.removeMultiDayEntry(t),this.log(`Removed entry: ${n}`)}getEntriesForDate(n){var o,c,g;let t=O(n),e=this.monthDayKey(n.month,n.day),a=(o=this.entriesByDate.get(t))!=null?o:[],r=(c=this.multiDayEntriesByDate.get(t))!=null?c:[],i=(g=this.anniversaryEntriesByMonthDay.get(e))!=null?g:[];a.length>0||r.length>0||i.length>0?this.stats.hits++:this.stats.misses++;let s=new Map;for(let d of a)s.set(d.id,d);for(let d of r)s.set(d.id,d);for(let d of i)s.set(d.id,d);return Array.from(s.values())}getEntriesInRange(n,t){var a;let e=new Map;for(let r of this.entriesByPath.values()){let i=(a=r.endDate)!=null?a:r.startDate;w(r.startDate,t)<=0&&w(i,n)>=0&&e.set(r.id,r)}return Array.from(e.values())}getMultiDayEntries(){return Array.from(this.entriesByPath.values()).filter(n=>n.isMultiDay)}getEntryByPath(n){return this.entriesByPath.get(n)}hasEntry(n){return this.entriesByPath.has(n)}getAllEntries(){return Array.from(this.entriesByPath.values())}clear(){this.entriesByPath.clear(),this.entriesByDate.clear(),this.multiDayEntriesByDate.clear(),this.stats={hits:0,misses:0,lastRebuild:Date.now()},this.log("Cache cleared")}rebuild(n){this.clear(),this.stats.lastRebuild=Date.now();for(let t of n)this.addEntry(t);this.log(`Cache rebuilt with ${n.length} entries`)}getStats(){return Object.freeze({entryCount:this.entriesByPath.size,dateCount:this.entriesByDate.size+this.multiDayEntriesByDate.size,hits:this.stats.hits,misses:this.stats.misses,lastRebuild:this.stats.lastRebuild})}indexMultiDayEntry(n){if(!n.endDate)return;let t=n.startDate,e=n.endDate;for(;w(t,e)<0;)if(t=this.addOneDay(t),w(t,e)<=0){let a=O(t);this.addToDateIndex(a,n,this.multiDayEntriesByDate)}}removeMultiDayEntry(n){if(!n.endDate)return;let t=n.startDate,e=n.endDate;for(;w(t,e)<0;)if(t=this.addOneDay(t),w(t,e)<=0){let a=O(t);this.removeFromDateIndex(a,n.id,this.multiDayEntriesByDate)}}addToDateIndex(n,t,e){let a=e.get(n);a?a.push(t):e.set(n,[t])}removeFromDateIndex(n,t,e){let a=e.get(n);if(!a)return;let r=a.filter(i=>i.id!==t);r.length===0?e.delete(n):e.set(n,r)}addOneDay(n){let t=n.day+1,e=n.month,a=n.year,r=this.getDaysInMonth(a,e);return t>r&&(t=1,e+=1,e>12&&(e=1,a+=1)),{year:a,month:e,day:t}}getDaysInMonth(n,t){let e=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2?n%4===0&&n%100!==0||n%400===0?29:28:e[t-1]}log(n){this.config.debug&&console.log(`[EntryCache] ${n}`)}};var ut=class ut{parseDate(n){if(n==null)return null;if(typeof n=="string")return this.parseDateString(n);if(n instanceof Date)return isNaN(n.getTime())?null:{year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate()};if(typeof n=="object"&&n!==null){let t=n;if(typeof t.year=="number"&&typeof t.month=="number"&&typeof t.day=="number"&&this.isValidDate(t.year,t.month,t.day))return{year:t.year,month:t.month,day:t.day}}return null}parseDateString(n){let t=n.trim(),e=t.match(/^[X\d]{3,4}-(\d{2})-(\d{2})$/i);if(e&&t.match(/X/i)){let o=parseInt(e[1],10),c=parseInt(e[2],10);return this.isValidDate(2e3,o,c)?{year:0,month:o,day:c}:null}let a=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!a)return null;let r=parseInt(a[1],10),i=parseInt(a[2],10),s=parseInt(a[3],10);return this.isValidDate(r,i,s)?{year:r,month:i,day:s}:null}isValidDate(n,t,e){if(n<1900||n>2100||t<1||t>12||e<1||e>31)return!1;let a=this.getDaysInMonth(n,t);return!(e>a)}getDaysInMonth(n,t){let e=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2&&this.isLeapYear(n)?29:e[t-1]}isLeapYear(n){return n%4===0&&n%100!==0||n%400===0}extractFromFilename(n){let t={start:null,end:null};if(!n||typeof n!="string")return t;let e=n.match(ut.DATE_PATTERN);return!e||e.length===0||(t.start=this.parseDate(e[0]),e.length>=2&&(t.end=this.parseDate(e[1]))),t}extractFromProperties(n,t){if(!n||typeof n!="object"||!Array.isArray(t))return null;for(let e of t){if(typeof e!="string"||!e)continue;let a=n[e];if(a==null)continue;let r=this.parseDate(a);if(r!==null)return r}return null}extractDates(n,t,e){let a={start:null,end:null},r=this.extractFromFilename(n);for(let i of e.priorities)i==="filename"?(a.start===null&&r.start!==null&&(a.start=r.start),a.end===null&&r.end!==null&&(a.end=r.end)):i==="properties"&&(a.start===null&&(a.start=this.extractFromProperties(t,e.startSources)),a.end===null&&(a.end=this.extractFromProperties(t,e.endSources)));return a}};ut.DATE_PATTERN=/(\d{4}-\d{2}-\d{2})/g;var J=ut,He=new J;N();var Me=["January","February","March","April","May","June","July","August","September","October","November","December"],ht=class{getDaysInMonth(n,t){return E(n,t)}getFirstDayOfWeek(n,t){let e=L(n,t,1);return F(e)}isToday(n){let t=x();return z(n,t)}generateGrid(n){let t=[];for(let e=1;e<=12;e++)t.push(this.generateMonth(n,e));return{year:n,months:t}}generateMonth(n,t){let e=this.getDaysInMonth(n,t),a=this.getFirstDayOfWeek(n,t),r=[];for(let i=0;i<a;i++)r.push({date:L(n,t,1),isToday:!1,isEmpty:!0});for(let i=1;i<=e;i++){let s=L(n,t,i);r.push({date:s,isToday:this.isToday(s),isEmpty:!1})}return{month:t,name:Me[t-1],startDayOfWeek:a,daysInMonth:e,days:r}}};N();var Ce=24,K=class{calculateMonthSegments(n,t,e){let a=[];if(w(n,t)>0)return a;let r=n.year,i=n.month,s=0;for(;s<Ce;){let o=r===n.year&&i===n.month,c=r===t.year&&i===t.month,g=o?n.day:1,d=c?t.day:E(r,i);if(a.push({year:r,month:i,startDay:g,endDay:d,entryId:e}),c)break;i++,i>12&&(i=1,r++),s++}return a}calculateBarPositions(n,t){let e=new Map;if(n.length===0)return e;let a=[...n].sort((i,s)=>i.startDay!==s.startDay?i.startDay-s.startDay:s.endDay-s.startDay-(i.endDay-i.startDay)),r=[];for(let i=0;i<=31;i++)r.push(new Set);for(let i of a){let s=(t.startDayOfWeek+i.startDay-1)%7,o=(t.startDayOfWeek+i.endDay-1)%7,c=i.endDay-i.startDay+1,g=0,d=!1;for(;!d;){let u=!0;for(let h=i.startDay;h<=i.endDay;h++)if(r[h].has(g)){u=!1;break}if(u){d=!0;for(let h=i.startDay;h<=i.endDay;h++)r[h].add(g)}else g++;if(g>100)break}e.set(i.entryId,{rowIndex:g,startColumn:s,endColumn:o,span:c})}return e}},Ze=new K;Ft();N();N();var Dt=class{constructor(n,t){this.unregisterMetadataListener=null;this.eventListeners=null;this.vaultRepository=new it(n),this.metadataRepository=new st(n),this.entryCache=new gt({debug:!1}),this.dateEngine=new J,this.calendarEngine=new ht,this.multiDayEngine=new K,this.settings=t,this.currentYear=x().year}async initialize(){await this.rebuildCache(),this.setupMetadataListener()}destroy(){this.unregisterMetadataListener&&(this.unregisterMetadataListener(),this.unregisterMetadataListener=null),this.eventListeners=null}setEventListeners(n){this.eventListeners=n}async updateSettings(n){let t=this.settings.dateProperties.join(",")!==n.dateProperties.join(",")||this.settings.endDateProperties.join(",")!==n.endDateProperties.join(",")||this.settings.datePriority!==n.datePriority;this.settings=n,t&&await this.rebuildCache()}getCurrentYear(){return this.currentYear}setCurrentYear(n){var t;this.currentYear!==n&&(this.currentYear=n,(t=this.eventListeners)==null||t.onYearChanged(n))}setYear(n){this.setCurrentYear(n)}nextYear(){this.setCurrentYear(this.currentYear+1)}previousYear(){this.setCurrentYear(this.currentYear-1)}goToToday(){this.setCurrentYear(x().year)}generateCalendarGrid(){return this.calendarEngine.generateGrid(this.currentYear)}getEntriesForDate(n){return this.entryCache.getEntriesForDate(n)}getMultiDayEntries(){return this.entryCache.getMultiDayEntries().filter(n=>{var r;let t={year:this.currentYear,month:1,day:1},e={year:this.currentYear,month:12,day:31},a=(r=n.endDate)!=null?r:n.startDate;return n.startDate.year===this.currentYear||n.startDate.year<this.currentYear&&a.year>=this.currentYear})}calculateBarPositions(n,t){return new Map}async openDailyNote(n){let t=this.settings.dailyNoteFormat,e=this.settings.dailyNoteFolder,a=this.formatDailyNoteFilename(n,t),r=e?`${e}/${a}.md`:`${a}.md`,i=await this.vaultRepository.createOrOpenDailyNote(r);console.log(`Opening daily note: ${i.path}`)}getCacheStats(){let n=this.entryCache.getStats();return{entryCount:n.entryCount,dateCount:n.dateCount}}loadLifePhases(n,t={startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",categoryField:"phase-category"}){if(!n)return[];let e=this.vaultRepository.getAllMarkdownFiles(),a=[],r=n.endsWith("/")?n:`${n}/`,i=e.filter(s=>s.path===`${n}.md`||s.path.startsWith(r));for(let s of i){let o=this.metadataRepository.getMetadataByPath(s.path),c=o==null?void 0:o.frontmatter;if(!c)continue;let g=c[t.startDateField];if(!g||typeof g!="string")continue;let d=this.parseYAMLDate(g);if(!d)continue;let u=c[t.endDateField],h=null;u&&typeof u=="string"&&u.trim()!==""&&(h=this.parseYAMLDate(u));let p=c[t.colorField],y=this.isValidColor(p)?p:"blue",m=c[t.labelField]||s.basename,b=c[t.categoryField];a.push({filePath:s.path,label:String(m),startDate:d,endDate:h,color:y,category:b?String(b):void 0})}return a.sort((s,o)=>s.startDate.year!==o.startDate.year?s.startDate.year-o.startDate.year:s.startDate.month!==o.startDate.month?s.startDate.month-o.startDate.month:s.startDate.day-o.startDate.day)}parseYAMLDate(n){let t=n.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return null;let e=parseInt(t[1],10),a=parseInt(t[2],10),r=parseInt(t[3],10);return a<1||a>12||r<1||r>31?null:L(e,a,r)}isValidColor(n){return typeof n=="string"&&["red","orange","yellow","green","blue","purple","pink","teal","cyan","magenta","lime","amber","indigo","violet","rose","gray","slate","stone"].includes(n)}computeLifePhaseSegments(n,t,e,a){let r=a?this.parseYAMLDate(a)||L(t,1,1):L(t,1,1),i=L(r.year+e,r.month,r.day),s=this.daysBetweenDates(r,i),o=x();return n.map(c=>{let d=this.daysBetweenDates(r,c.startDate)/s*2*Math.PI,u,h=!1;c.endDate?u=c.endDate:(h=!0,u=i);let y=this.daysBetweenDates(r,u)/s*2*Math.PI,m;h&&(m=this.daysBetweenDates(r,o)/s*2*Math.PI);let{RING_COLORS:b}=(W(),Tt(Gt)),D=b[c.color]||b.blue;return{id:c.filePath,filePath:c.filePath,label:c.label,startAngle:d,endAngle:y,color:D,entries:[],isOngoing:h,todayAngle:m,category:c.category}})}loadSpanningArcs(n,t,e={startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label"}){if(!n)return[];let a=this.vaultRepository.getAllMarkdownFiles(),r=[],i=n.endsWith("/")?n:`${n}/`,s=a.filter(g=>g.path===`${n}.md`||g.path.startsWith(i)),o=L(t,1,1),c=L(t,12,31);for(let g of s){let d=this.metadataRepository.getMetadataByPath(g.path),u=d==null?void 0:d.frontmatter;if(!u)continue;let h=u[e.startDateField];if(!h||typeof h!="string")continue;let p=this.parseYAMLDate(h);if(!p)continue;let y=u[e.endDateField],m=null;if(y&&typeof y=="string"&&y.trim()!==""&&(m=this.parseYAMLDate(y)),m||(m=p),m.year<t||p.year>t)continue;let b=this.compareDates(p,o)<0?o:p,D=this.compareDates(m,c)>0?c:m,C=u[e.colorField],A=this.isValidColor(C)?C:"blue",v=u[e.labelField]||g.basename,R=this.dateToYearAngle(b,t),I=this.dateToYearAngle(D,t),{RING_COLORS:k}=(W(),Tt(Gt)),_=k[A]||k.blue;r.push({id:g.path,filePath:g.path,label:String(v),startAngle:R,endAngle:I,color:_,entries:[]})}return r.sort((g,d)=>g.startAngle-d.startAngle)}dateToYearAngle(n,t){let e=this.isLeapYear(t)?366:365;return(this.getDayOfYear(n)-1)/e*2*Math.PI}compareDates(n,t){return n.year!==t.year?n.year-t.year:n.month!==t.month?n.month-t.month:n.day-t.day}daysBetweenDates(n,t){let e=new Date(n.year,n.month-1,n.day).getTime(),a=new Date(t.year,t.month-1,t.day).getTime();return Math.floor((a-e)/(1e3*60*60*24))}dateToYearFraction(n){let t=this.isLeapYear(n.year)?366:365;return(this.getDayOfYear(n)-1)/t}isLeapYear(n){return n%4===0&&n%100!==0||n%400===0}getDayOfYear(n){let t=[31,28,31,30,31,30,31,31,30,31,30,31];this.isLeapYear(n.year)&&(t[1]=29);let e=n.day;for(let a=0;a<n.month-1;a++)e+=t[a];return e}async rebuildCache(){var a;let n=this.vaultRepository.getAllMarkdownFiles(),t=[],e=this.getDateExtractionConfig();for(let r of n){let i=this.createEntryFromFile(r,e);i&&t.push(i)}this.entryCache.rebuild(t),(a=this.eventListeners)==null||a.onEntriesUpdated()}createEntryFromFile(n,t){var o,c,g;let e=this.metadataRepository.getMetadataByPath(n.path),a=(o=e==null?void 0:e.frontmatter)!=null?o:null,{start:r,end:i}=this.dateEngine.extractDates(n.name,a,t);if(!r)return null;let s={};if(a)for(let[d,u]of Object.entries(a))(typeof u=="string"||typeof u=="number"||typeof u=="boolean")&&(s[d]=u);return pt({id:n.path,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:r,endDate:i,metadata:{tags:(c=e==null?void 0:e.tags.map(d=>d.name))!=null?c:[],folder:(g=n.folderPath)!=null?g:"",properties:s}})}getDateExtractionConfig(){return{startSources:this.settings.dateProperties,endSources:this.settings.endDateProperties,priorities:this.settings.datePriority==="property"?["properties","filename"]:["filename","properties"]}}formatDailyNoteFilename(n,t){return t.replace("YYYY",String(n.year)).replace("MM",String(n.month).padStart(2,"0")).replace("DD",String(n.day).padStart(2,"0"))}setupMetadataListener(){this.unregisterMetadataListener=this.metadataRepository.onMetadataChange(n=>{this.handleFileChange(n.path)})}handleFileChange(n){var e;let t=this.vaultRepository.getAllMarkdownFiles().find(a=>a.path===n);if(!t)this.entryCache.removeEntry(n);else{let a=this.getDateExtractionConfig(),r=this.createEntryFromFile(t,a);r?this.entryCache.addEntry(r):this.entryCache.removeEntry(n)}(e=this.eventListeners)==null||e.onEntriesUpdated()}};var At=require("obsidian");N();W();var Q="radial-calendar-plugin",pe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_t=["January","February","March","April","May","June","July","August","September","October","November","December"],zt=800,f=zt/2,j=380,ye=340,H=335,St=260,V=255,$=150,Ne=140,T=380,Y=145,me=115,Cn=(T-Y)/31,fe=4,ke=20,be=T+2,De=T+8,Se=T+14,vt=class extends At.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.tooltipEl=null}getViewType(){return Q}getDisplayText(){return"Radial Calendar"}getIcon(){return"circle"}initialize(t){this.config=t,this.config.service.setEventListeners({onEntriesUpdated:()=>this.render(),onYearChanged:()=>this.render()})}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("radial-calendar-plugin"),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null,this.tooltipEl=null}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let e=this.config.service.getCurrentYear(),a=this.containerEl_.createDiv({cls:"rc-container"});this.renderHeader(a,e);let r=a.createDiv({cls:"rc-wrapper"});this.renderRadialCalendar(r,e),this.tooltipEl=a.createDiv({cls:"rc-tooltip"}),this.tooltipEl.style.display="none"}renderHeader(t,e){if(!this.config)return;let a=t.createDiv({cls:"rc-header"});a.createEl("button",{text:"\u2190",cls:"rc-nav-btn",attr:{"aria-label":"Previous year"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.previousYear()}),a.createEl("span",{text:String(e),cls:"rc-year-title"}),a.createEl("button",{text:"\u2192",cls:"rc-nav-btn",attr:{"aria-label":"Next year"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.nextYear()}),a.createEl("button",{text:"Today",cls:"rc-nav-btn rc-today-btn",attr:{"aria-label":"Go to today"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.goToToday()}),a.createEl("button",{text:"\u21BB",cls:"rc-nav-btn rc-refresh-btn",attr:{"aria-label":"Refresh view"}}).addEventListener("click",()=>{this.render()}),this.renderViewModeToggle(a)}renderViewModeToggle(t){if(!this.config)return;let e=this.config.settings.currentView,a=t.createDiv({cls:"rc-view-toggle"});a.createEl("button",{text:"Jahresansicht",cls:`rc-toggle-btn ${e==="annual"?"rc-toggle-btn--active":""}`,attr:{"aria-label":"Switch to annual view"}}).addEventListener("click",async()=>{if(this.config&&this.config.settings.currentView!=="annual"){let s={...this.config.settings,currentView:"annual"};this.config.settings=s,await this.config.onSettingsChange(s),this.render()}}),a.createEl("button",{text:"Lebensansicht",cls:`rc-toggle-btn ${e==="life"?"rc-toggle-btn--active":""}`,attr:{"aria-label":"Switch to life view"}}).addEventListener("click",async()=>{if(this.config&&this.config.settings.currentView!=="life"){let s={...this.config.settings,currentView:"life"};this.config.settings=s,await this.config.onSettingsChange(s),this.render()}})}renderRadialCalendar(t,e){if(!this.config)return;let a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("viewBox",`0 0 ${zt} ${zt}`),a.setAttribute("class","rc-svg"),this.svgEl=a,this.config.settings.currentView==="life"?this.renderNestedClock(a,e):this.renderAnnualView(a,e),t.appendChild(a)}renderNestedClock(t,e){if(!this.config)return;let{birthYear:a,expectedLifespan:r}=this.config.settings,i=a+r,s=x(),o=s.year-a;this.renderBackgroundCircle(t),this.renderLifeRing(t,a,i,e),this.renderLifePhasesRing(t,a,r),this.renderYearRing(t,e),this.renderLifeActsOnRing(t,a,r),this.renderNestedCenter(t,e,o),this.renderLifePositionMarker(t,a,r,s.year,"today"),e!==s.year&&this.renderLifePositionMarker(t,a,r,e,"viewed"),e===s.year&&this.renderTodayMarkerOnYearRing(t),this.renderBirthdayMarkerOnYearRing(t,e)}renderLifeRing(t,e,a,r){let i=a-e,s=x();for(let o=e;o<a;o++){let c=o-e,g=c/i*2*Math.PI,d=(c+1)/i*2*Math.PI-.01,u=o<s.year,h=o===s.year,p=o===r,y=this.createArcPath(ye,j,g,d),m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",y);let b="rc-life-year";u&&(b+=" rc-life-year--past"),h&&(b+=" rc-life-year--current"),p&&(b+=" rc-life-year--selected"),m.setAttribute("class",b),m.setAttribute("data-year",String(o)),m.addEventListener("click",()=>{var D;(D=this.config)==null||D.service.setYear(o)}),m.addEventListener("mouseenter",D=>{this.showLifeYearTooltip(D,o,o-e)}),m.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(m)}for(let o=e;o<=a;o+=10){let g=(o-e)/i*2*Math.PI-Math.PI/2,d=j+12,u=f+d*Math.cos(g),h=f+d*Math.sin(g),p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x",String(u)),p.setAttribute("y",String(h)),p.setAttribute("class","rc-life-year-label"),p.setAttribute("text-anchor","middle"),p.setAttribute("dominant-baseline","central"),p.textContent=String(o),t.appendChild(p)}}renderLifePhasesRing(t,e,a){if(!this.config)return;let r=this.config.settings.lifePhasesFolder;if(!r||r.trim()==="")return;let i=this.config.service.loadLifePhases(r);if(i.length===0)return;let s=this.config.settings.birthDate,o=this.config.service.computeLifePhaseSegments(i,e,a,s),c=new Map,g=[];for(let b of o)if(b.category){let D=c.get(b.category)||[];D.push(b),c.set(b.category,D)}else g.push(b);let d=Array.from(c.keys()).sort(),u=d.length,h=X(g),p=g.length>0?Z(h):0,y=u+p;if(y===0)return;let m=this.getOrCreateDefs(t);d.forEach((b,D)=>{let C=c.get(b)||[],A=X(C),v=Z(A);for(let R of A){let I=H-D/y*(H-St),k=H-(D+1)/y*(H-St),_=q(I,k,v,R.track);this.renderLifePhaseArcWithRadii(t,m,R,_)}});for(let b of h){let D=H-u/y*(H-St),A=q(D,St,p,b.track);this.renderLifePhaseArcWithRadii(t,m,b,A)}}getOrCreateDefs(t){let e=t.querySelector("defs");return e||(e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(e,t.firstChild)),e}renderLifePhaseArcWithRadii(t,e,a,r){if(a.isOngoing&&a.todayAngle!==void 0&&a.todayAngle>a.startAngle){let i=this.createArcPath(r.inner,r.outer,a.startAngle,a.todayAngle),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",i),s.setAttribute("class","rc-life-phase"),s.style.fill=a.color,s.style.opacity="1";let o=this.createArcPath(r.inner,r.outer,a.todayAngle,a.endAngle),c=document.createElementNS("http://www.w3.org/2000/svg","path");if(c.setAttribute("d",o),c.setAttribute("class","rc-life-phase rc-life-phase-future"),c.style.fill=a.color,c.style.opacity="0.35",a.filePath){s.style.cursor="pointer",c.style.cursor="pointer";let u=()=>{var h;return(h=this.config)==null?void 0:h.openFile(a.filePath)};s.addEventListener("click",u),c.addEventListener("click",u)}let g=u=>this.showPhaseTooltip(u,a),d=()=>this.hideTooltip();s.addEventListener("mouseenter",g),s.addEventListener("mouseleave",d),c.addEventListener("mouseenter",g),c.addEventListener("mouseleave",d),t.appendChild(s),t.appendChild(c)}else{let i=this.createArcPath(r.inner,r.outer,a.startAngle,a.endAngle),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",i),s.setAttribute("class","rc-life-phase"),s.style.fill=a.color,a.filePath&&(s.style.cursor="pointer",s.addEventListener("click",()=>{var o;(o=this.config)==null||o.openFile(a.filePath)})),s.addEventListener("mouseenter",o=>{this.showPhaseTooltip(o,a)}),s.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(s)}a.label&&a.endAngle-a.startAngle>.15&&this.renderPhaseLabel(t,a,r)}createPhaseGradient(t,e,a){let r=a.endAngle-a.startAngle,i=(a.todayAngle-a.startAngle)/r,s=Math.max(0,Math.min(100,i*100)),o=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");o.setAttribute("id",e);let c=(a.startAngle+a.endAngle)/2-Math.PI/2,g=50+50*Math.cos(a.startAngle-Math.PI/2),d=50+50*Math.sin(a.startAngle-Math.PI/2),u=50+50*Math.cos(a.endAngle-Math.PI/2),h=50+50*Math.sin(a.endAngle-Math.PI/2);o.setAttribute("x1",`${g}%`),o.setAttribute("y1",`${d}%`),o.setAttribute("x2",`${u}%`),o.setAttribute("y2",`${h}%`);let p=document.createElementNS("http://www.w3.org/2000/svg","stop");p.setAttribute("offset","0%"),p.setAttribute("stop-color",a.color),p.setAttribute("stop-opacity","1"),o.appendChild(p);let y=document.createElementNS("http://www.w3.org/2000/svg","stop");y.setAttribute("offset",`${s}%`),y.setAttribute("stop-color",a.color),y.setAttribute("stop-opacity","1"),o.appendChild(y);let m=document.createElementNS("http://www.w3.org/2000/svg","stop");m.setAttribute("offset",`${s+1}%`),m.setAttribute("stop-color",a.color),m.setAttribute("stop-opacity","0.4"),o.appendChild(m);let b=document.createElementNS("http://www.w3.org/2000/svg","stop");b.setAttribute("offset","100%"),b.setAttribute("stop-color",a.color),b.setAttribute("stop-opacity","0.15"),o.appendChild(b),t.appendChild(o)}renderPhaseLabel(t,e,a){let r=(e.startAngle+e.endAngle)/2-Math.PI/2,i=(a.inner+a.outer)/2,s=f+i*Math.cos(r),o=f+i*Math.sin(r),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(s)),c.setAttribute("y",String(o)),c.setAttribute("class","rc-phase-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central");let g=(r+Math.PI/2)*180/Math.PI,d=g>90&&g<270?g+180:g;c.setAttribute("transform",`rotate(${d}, ${s}, ${o})`),c.textContent=e.label,t.appendChild(c)}showPhaseTooltip(t,e){var i;if(!this.tooltipEl)return;let a=`<div class="rc-tooltip-date">${e.label}</div>`;e.isOngoing&&(a+='<div class="rc-tooltip-note" style="color: var(--text-accent);">Aktiv (ongoing)</div>'),this.tooltipEl.innerHTML=a,this.tooltipEl.style.display="block";let r=(i=this.containerEl_)==null?void 0:i.getBoundingClientRect();if(r){let s=t.clientX-r.left+10,o=t.clientY-r.top+10;this.tooltipEl.style.left=`${s}px`,this.tooltipEl.style.top=`${o}px`}}renderYearRing(t,e){if(!this.config)return;let a=x();for(let r=1;r<=12;r++){let i=E(e,r),s=this.monthToAngle(r),c=Math.PI/6/i,g=a.year===e&&a.month===r;for(let d=1;d<=i;d++){let u=L(e,r,d),h=F(u),p=g&&a.day===d,y=h===0||h===6,m=s+(d-1)*c,b=m+c-.002,D=this.config.service.getEntriesForDate(u),C=this.createArcPath($,V,m,b),A=document.createElementNS("http://www.w3.org/2000/svg","path");A.setAttribute("d",C);let v=["rc-day-arc"];p&&v.push("rc-day-arc--today"),y&&v.push("rc-day-arc--weekend"),D.length>0&&v.push("rc-day-arc--has-notes"),A.setAttribute("class",v.join(" ")),A.addEventListener("click",async()=>{var R;await((R=this.config)==null?void 0:R.service.openDailyNote(u))}),A.addEventListener("mouseenter",R=>{this.showTooltip(R,u,D)}),A.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(A)}}for(let r=1;r<=12;r++){let i=this.monthToAngle(r)-Math.PI/2,s=f+$*Math.cos(i),o=f+$*Math.sin(i),c=f+V*Math.cos(i),g=f+V*Math.sin(i),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",String(s)),d.setAttribute("y1",String(o)),d.setAttribute("x2",String(c)),d.setAttribute("y2",String(g)),d.setAttribute("class","rc-month-separator"),t.appendChild(d)}for(let r=0;r<12;r++){let i=this.monthToAngle(r+1)+Math.PI/12-Math.PI/2,s=$-15,o=f+s*Math.cos(i),c=f+s*Math.sin(i),g=document.createElementNS("http://www.w3.org/2000/svg","text");g.setAttribute("x",String(o)),g.setAttribute("y",String(c)),g.setAttribute("class","rc-month-label"),g.setAttribute("text-anchor","middle"),g.setAttribute("dominant-baseline","central"),g.textContent=pe[r],t.appendChild(g)}}renderLifeActsOnRing(t,e,a){if(!this.config)return;let r=this.config.settings.lifeActs;if(r.length!==0)for(let i of r){let s=i.startAge/a*2*Math.PI,o=i.endAge/a*2*Math.PI-.01,c=this.createArcPath(j+2,j+8,s,o),g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d",c),g.setAttribute("class","rc-life-act"),i.color&&(g.style.fill=P[i.color]),t.appendChild(g);let d=(s+o)/2-Math.PI/2,u=j+18,h=f+u*Math.cos(d),p=f+u*Math.sin(d),y=document.createElementNS("http://www.w3.org/2000/svg","text");y.setAttribute("x",String(h)),y.setAttribute("y",String(p)),y.setAttribute("class","rc-life-act-label"),y.setAttribute("text-anchor","middle"),y.setAttribute("dominant-baseline","central");let m=(d+Math.PI/2)*180/Math.PI,b=m>90&&m<270?m+180:m;y.setAttribute("transform",`rotate(${b}, ${h}, ${p})`),i.color&&(y.style.fill=P[i.color]),y.textContent=i.label,t.appendChild(y)}}renderLifePositionMarker(t,e,a,r,i){let s=r-e;if(i==="today"){let m=x(),b=m.year%4===0&&m.year%100!==0||m.year%400===0,D=b?366:365,C=[0,31,28,31,30,31,30,31,31,30,31,30,31];b&&(C[2]=29);let A=m.day;for(let v=1;v<m.month;v++)A+=C[v];s+=A/D}let o=s/a*2*Math.PI-Math.PI/2,c=ye-5,g=j+5,d=f+c*Math.cos(o),u=f+c*Math.sin(o),h=f+g*Math.cos(o),p=f+g*Math.sin(o),y=document.createElementNS("http://www.w3.org/2000/svg","line");y.setAttribute("x1",String(d)),y.setAttribute("y1",String(u)),y.setAttribute("x2",String(h)),y.setAttribute("y2",String(p)),y.setAttribute("class",i==="today"?"rc-life-marker--today":"rc-life-marker--viewed"),t.appendChild(y)}renderTodayMarkerOnYearRing(t){let e=x(),a=E(e.year,e.month),r=this.monthToAngle(e.month),s=Math.PI/6/a,o=r+(e.day-.5)*s-Math.PI/2,c=f+($-5)*Math.cos(o),g=f+($-5)*Math.sin(o),d=f+(V+5)*Math.cos(o),u=f+(V+5)*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(c)),h.setAttribute("y1",String(g)),h.setAttribute("x2",String(d)),h.setAttribute("y2",String(u)),h.setAttribute("class","rc-today-marker"),t.appendChild(h)}renderBirthdayMarkerOnYearRing(t,e){if(!this.config)return;let a=this.config.settings.birthDate;if(!a)return;let r=a.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!r)return;let i=parseInt(r[2],10),s=parseInt(r[3],10),o=E(e,i),c=this.monthToAngle(i),d=Math.PI/6/o,u=c+(s-.5)*d-Math.PI/2,h=f+($-3)*Math.cos(u),p=f+($-3)*Math.sin(u),y=f+(V+3)*Math.cos(u),m=f+(V+3)*Math.sin(u),b=document.createElementNS("http://www.w3.org/2000/svg","line");b.setAttribute("x1",String(h)),b.setAttribute("y1",String(p)),b.setAttribute("x2",String(y)),b.setAttribute("y2",String(m)),b.setAttribute("class","rc-birthday-marker"),t.appendChild(b);let D=V+12,C=f+D*Math.cos(u),A=f+D*Math.sin(u),v=document.createElementNS("http://www.w3.org/2000/svg","text");v.setAttribute("x",String(C)),v.setAttribute("y",String(A)),v.setAttribute("class","rc-birthday-icon"),v.setAttribute("text-anchor","middle"),v.setAttribute("dominant-baseline","central"),v.textContent="\u{1F382}",t.appendChild(v)}renderNestedCenter(t,e,a){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(f)),r.setAttribute("cy",String(f)),r.setAttribute("r",String(Ne-10)),r.setAttribute("class","rc-center"),t.appendChild(r);let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",String(f)),i.setAttribute("y",String(f-20)),i.setAttribute("class","rc-center-year"),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","central"),i.textContent=String(e),t.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(f)),s.setAttribute("y",String(f+20)),s.setAttribute("class","rc-center-age"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=`${a} Jahre`,t.appendChild(s)}showLifeYearTooltip(t,e,a){var s;if(!this.tooltipEl)return;let r=`<div class="rc-tooltip-date">${e}</div>
      <div class="rc-tooltip-note">Alter: ${a} Jahre</div>`;this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block";let i=(s=this.containerEl_)==null?void 0:s.getBoundingClientRect();if(i){let o=t.clientX-i.left+10,c=t.clientY-i.top+10;this.tooltipEl.style.left=`${o}px`,this.tooltipEl.style.top=`${c}px`}}renderAnnualView(t,e){this.renderBackgroundCircle(t);let a=this.getEnabledRingsSorted();if(a.length===0)return;let r=this.calculateRingRadii(a.length);for(let i of a){let s=r.get(i.order);s&&this.renderRing(t,e,i,s)}for(let i=1;i<=12;i++)this.renderMonthSeparator(t,this.monthToAngle(i));this.renderOuterSegments(t,e),this.renderCenter(t,e),this.renderMonthLabels(t),this.renderTodayMarker(t,e)}getEnabledRingsSorted(){if(!this.config)return[];let t=[],e=this.config.settings.dailyNoteFolder;e&&e.trim()!==""&&t.push({id:"__daily_notes__",name:"Daily Notes",folder:e,color:"blue",enabled:!0,order:0});let a=this.config.settings.rings.filter(r=>r.enabled).sort((r,i)=>r.order-i.order).map((r,i)=>({...r,order:t.length>0?i+1:i}));return t.push(...a),t}calculateRingRadii(t){let e=new Map;if(t===0)return e;let a=(t-1)*fe,r=T-Y-a,i=Math.max(ke,r/t);for(let s=0;s<t;s++){let o=T-s*(i+fe),c=o-i;e.set(s,{outerRadius:o,innerRadius:c})}return e}renderRing(t,e,a,r){if(!this.config)return;let i=P[a.color]||P.blue;if(a.showSpanningArcs)this.renderSpanningArcsRing(t,e,a,r,i);else for(let s=1;s<=12;s++)this.renderRingMonthSegment(t,e,s,a,r,i)}renderSpanningArcsRing(t,e,a,r,i){if(!this.config)return;let s=this.config.service.loadSpanningArcs(a.folder,e,{startDateField:a.startDateField||"radcal-start",endDateField:a.endDateField||"radcal-end",colorField:a.colorField||"radcal-color",labelField:a.labelField||"radcal-label"});if(s.length===0){this.renderEmptyRingBackground(t,r);return}let o=X(s),c=Z(o);for(let g of o){let d=q(r.outerRadius,r.innerRadius,c,g.track);this.renderSpanningArc(t,g,d,a,i)}}renderEmptyRingBackground(t,e){let a=this.createArcPath(e.innerRadius,e.outerRadius,0,2*Math.PI-.001),r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",a),r.setAttribute("class","rc-ring-arc"),r.style.fill="var(--background-secondary)",r.style.fillOpacity="0.3",t.appendChild(r)}renderSpanningArc(t,e,a,r,i){if(!this.config)return;let s=this.createArcPath(a.inner,a.outer,e.startAngle,e.endAngle),o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",s),o.setAttribute("class","rc-ring-arc"),o.style.fill=e.color||i,e.filePath&&(o.style.cursor="pointer",o.addEventListener("click",()=>{var c;(c=this.config)==null||c.openFile(e.filePath)})),o.addEventListener("mouseenter",c=>{this.showSpanningArcTooltip(c,e,r)}),o.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(o),e.label&&e.endAngle-e.startAngle>.26&&this.renderSpanningArcLabel(t,e,a)}renderSpanningArcLabel(t,e,a){let r=(e.startAngle+e.endAngle)/2-Math.PI/2,i=(a.inner+a.outer)/2,s=f+i*Math.cos(r),o=f+i*Math.sin(r),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(s)),c.setAttribute("y",String(o)),c.setAttribute("class","rc-phase-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central");let g=(r+Math.PI/2)*180/Math.PI,d=g>90&&g<270?g+180:g;c.setAttribute("transform",`rotate(${d}, ${s}, ${o})`),c.textContent=e.label,t.appendChild(c)}showSpanningArcTooltip(t,e,a){var s;if(!this.tooltipEl)return;let r=`<div class="rc-tooltip-ring" style="color: ${e.color}">${a.name}</div>`;r+=`<div class="rc-tooltip-date">${e.label}</div>`,this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block";let i=(s=this.containerEl_)==null?void 0:s.getBoundingClientRect();if(i){let o=t.clientX-i.left+10,c=t.clientY-i.top+10;this.tooltipEl.style.left=`${o}px`,this.tooltipEl.style.top=`${c}px`}}renderRingMonthSegment(t,e,a,r,i,s){if(!this.config)return;let o=E(e,a),c=this.monthToAngle(a),d=Math.PI/6/o,u=x(),h=u.year===e&&u.month===a,p=this.config.service.getEntriesForDate(L(e,a,1));for(let y=1;y<=o;y++){let m=L(e,a,y),b=F(m),D=h&&u.day===y,C=b===0||b===6,A=c+(y-1)*d,v=A+d-.002,R=this.getEntriesForRing(m,r);this.renderRingDayArc(t,m,A,v,D,C,R,i,s,r)}}getEntriesForRing(t,e){if(!this.config)return[];let a=this.config.service.getEntriesForDate(t);if(!e.folder||e.folder.trim()==="")return a;let r=e.folder.replace(/^\/+|\/+$/g,"");return a.filter(i=>{let o=(i.metadata.folder||"").replace(/^\/+|\/+$/g,"");return o===r||o.startsWith(r+"/")})}renderRingDayArc(t,e,a,r,i,s,o,c,g,d){if(!this.config)return;let u=this.createArcPath(c.innerRadius,c.outerRadius,a,r),h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",u);let p=["rc-day-arc",`rc-ring-${d.order}`];i&&p.push("rc-day-arc--today"),s&&p.push("rc-day-arc--weekend"),o.length>0&&p.push("rc-day-arc--has-notes"),o.length>3&&p.push("rc-day-arc--many-notes"),h.setAttribute("class",p.join(" ")),h.setAttribute("data-date",`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`),h.setAttribute("data-ring",d.id),o.length>0&&(h.style.fill=g,h.style.fillOpacity="0.6"),h.addEventListener("click",async y=>{var m;y.preventDefault(),o.length>0?this.showDayContextMenu(y,e,o):await((m=this.config)==null?void 0:m.service.openDailyNote(e))}),h.addEventListener("mouseenter",y=>{this.showRingTooltip(y,e,o,d)}),h.addEventListener("mouseleave",()=>{this.hideTooltip()}),h.addEventListener("contextmenu",y=>{y.preventDefault(),this.showDayContextMenu(y,e,o)}),t.appendChild(h),o.length>0&&this.renderRingNoteIndicators(t,a,r,o,c,g)}renderRingNoteIndicators(t,e,a,r,i,s){let o=Math.min(10,(i.outerRadius-i.innerRadius)*.3),c=i.outerRadius-o,g=i.outerRadius-2,d=Math.min(r.length,3),u=(a-e)/d;for(let h=0;h<d;h++){let p=e+h*u+.001,y=p+u-.002,m=this.createArcPath(c,g,p,y),b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d",m),b.setAttribute("class","rc-note-indicator"),b.style.fill=s,t.appendChild(b)}}showRingTooltip(t,e,a,r){var g;if(!this.tooltipEl)return;let o=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][F(e)]}, ${_t[e.month-1]} ${e.day}, ${e.year}`}</div>`;if(o+=`<div class="rc-tooltip-ring" style="color: ${P[r.color]}">${r.name}</div>`,a.length>0){o+='<div class="rc-tooltip-notes">';for(let d of a.slice(0,5))o+=`<div class="rc-tooltip-note">${d.displayName}</div>`;a.length>5&&(o+=`<div class="rc-tooltip-more">+${a.length-5} more</div>`),o+="</div>"}this.tooltipEl.innerHTML=o,this.tooltipEl.style.display="block";let c=(g=this.containerEl_)==null?void 0:g.getBoundingClientRect();if(c){let d=t.clientX-c.left+10,u=t.clientY-c.top+10;this.tooltipEl.style.left=`${d}px`,this.tooltipEl.style.top=`${u}px`}}renderBackgroundCircle(t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(f)),e.setAttribute("cy",String(f)),e.setAttribute("r",String(T)),e.setAttribute("class","rc-background"),t.appendChild(e)}renderCenter(t,e){let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",String(f)),a.setAttribute("cy",String(f)),a.setAttribute("r",String(Y-10)),a.setAttribute("class","rc-center"),t.appendChild(a)}renderMonthLabels(t){for(let e=0;e<12;e++){let a=this.monthToAngle(e+1)+Math.PI/12,r=f+me*Math.cos(a-Math.PI/2),i=f+me*Math.sin(a-Math.PI/2),s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(r)),s.setAttribute("y",String(i)),s.setAttribute("class","rc-month-label"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=pe[e],t.appendChild(s)}}renderMonthSegment(t,e,a){if(!this.config)return;let r=E(e,a),i=this.monthToAngle(a),o=Math.PI/6/r,c=x(),g=c.year===e&&c.month===a;for(let d=1;d<=r;d++){let u=L(e,a,d),h=F(u),p=g&&c.day===d,y=h===0||h===6,m=i+(d-1)*o,b=m+o-.002,D=this.config.service.getEntriesForDate(u);this.renderDayArc(t,u,m,b,p,y,D)}this.renderMonthSeparator(t,i)}renderDayArc(t,e,a,r,i,s,o){if(!this.config)return;let c=Y,g=T,d=this.createArcPath(c,g,a,r),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",d);let h=["rc-day-arc"];i&&h.push("rc-day-arc--today"),s&&h.push("rc-day-arc--weekend"),o.length>0&&h.push("rc-day-arc--has-notes"),o.length>3&&h.push("rc-day-arc--many-notes"),u.setAttribute("class",h.join(" ")),u.setAttribute("data-date",`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`),u.addEventListener("click",async p=>{var y;p.preventDefault(),await((y=this.config)==null?void 0:y.service.openDailyNote(e))}),u.addEventListener("mouseenter",p=>{this.showTooltip(p,e,o)}),u.addEventListener("mouseleave",()=>{this.hideTooltip()}),u.addEventListener("contextmenu",p=>{p.preventDefault(),o.length>0&&this.showDayContextMenu(p,e,o)}),t.appendChild(u),o.length>0&&this.renderNoteIndicators(t,a,r,o)}renderNoteIndicators(t,e,a,r){let i=T-15,s=T-5,o=Math.min(r.length,3),c=(a-e)/o;for(let g=0;g<o;g++){let d=e+g*c+.001,u=d+c-.002,h=this.createArcPath(i,s,d,u),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",h),p.setAttribute("class","rc-note-indicator"),t.appendChild(p)}}renderMonthSeparator(t,e){let a=f+Y*Math.cos(e-Math.PI/2),r=f+Y*Math.sin(e-Math.PI/2),i=f+T*Math.cos(e-Math.PI/2),s=f+T*Math.sin(e-Math.PI/2),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(a)),o.setAttribute("y1",String(r)),o.setAttribute("x2",String(i)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-month-separator"),t.appendChild(o)}renderTodayMarker(t,e){let a=x();if(a.year!==e)return;let r=E(e,a.month),i=this.monthToAngle(a.month),o=Math.PI/6/r,c=i+(a.day-.5)*o,g=f+(Y-10)*Math.cos(c-Math.PI/2),d=f+(Y-10)*Math.sin(c-Math.PI/2),u=f+(T+5)*Math.cos(c-Math.PI/2),h=f+(T+5)*Math.sin(c-Math.PI/2),p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttribute("x1",String(g)),p.setAttribute("y1",String(d)),p.setAttribute("x2",String(u)),p.setAttribute("y2",String(h)),p.setAttribute("class","rc-today-marker"),t.appendChild(p)}createArcPath(t,e,a,r){let i=a-Math.PI/2,s=r-Math.PI/2,o=f+t*Math.cos(i),c=f+t*Math.sin(i),g=f+t*Math.cos(s),d=f+t*Math.sin(s),u=f+e*Math.cos(i),h=f+e*Math.sin(i),p=f+e*Math.cos(s),y=f+e*Math.sin(s),m=r-a>Math.PI?1:0;return`
      M ${o} ${c}
      L ${u} ${h}
      A ${e} ${e} 0 ${m} 1 ${p} ${y}
      L ${g} ${d}
      A ${t} ${t} 0 ${m} 0 ${o} ${c}
      Z
    `}monthToAngle(t){return(t-1)*Math.PI/6}showTooltip(t,e,a){var c;if(!this.tooltipEl)return;let s=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][F(e)]}, ${_t[e.month-1]} ${e.day}, ${e.year}`}</div>`;if(a.length>0){s+='<div class="rc-tooltip-notes">';for(let g of a.slice(0,5))s+=`<div class="rc-tooltip-note">${g.displayName}</div>`;a.length>5&&(s+=`<div class="rc-tooltip-more">+${a.length-5} more</div>`),s+="</div>"}this.tooltipEl.innerHTML=s,this.tooltipEl.style.display="block";let o=(c=this.containerEl_)==null?void 0:c.getBoundingClientRect();if(o){let g=t.clientX-o.left+10,d=t.clientY-o.top+10;this.tooltipEl.style.left=`${g}px`,this.tooltipEl.style.top=`${d}px`}}hideTooltip(){this.tooltipEl&&(this.tooltipEl.style.display="none")}showDayContextMenu(t,e,a){if(!this.config)return;let r=new At.Menu;r.addItem(i=>{i.setTitle(`Open ${_t[e.month-1]} ${e.day}`).setIcon("calendar").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(e))})}),r.addSeparator();for(let i of a.slice(0,10))r.addItem(s=>{s.setTitle(i.displayName).setIcon("file").onClick(()=>{var o;(o=this.config)==null||o.openFile(i.filePath)})});a.length>10&&r.addItem(i=>{i.setTitle(`+${a.length-10} more...`).setDisabled(!0)}),r.showAtMouseEvent(t)}renderOuterSegments(t,e){if(!this.config)return;let a=this.getSegmentsForCurrentView();if(a.length!==0)for(let r of a)this.renderSegmentTick(t,r,e)}getSegmentsForCurrentView(){if(!this.config)return[];let t=this.config.settings;if(t.currentView==="life")return this.lifeActsToSegments(t.lifeActs);switch(t.annualSegmentType){case"seasons":return kt;case"quarters":return Ot;case"semester":return Vt;case"ten-days":return $t();case"weeks":return Yt();case"custom":return t.customSegments;case"none":default:return[]}}lifeActsToSegments(t){if(!this.config)return[];let{birthYear:e,expectedLifespan:a}=this.config.settings,r=a;return t.map(i=>{let s=Math.floor(i.startAge/r*365)+1,o=Math.floor(i.endAge/r*365);return{id:i.id,label:i.label,startDay:s,endDay:o,color:i.color}})}renderSegmentTick(t,e,a){if(!this.config)return;let r=this.config.settings.showSegmentLabels,i=this.dayOfYearToAngle(e.startDay),s=e.endDay>e.startDay?this.dayOfYearToAngle(e.endDay):this.dayOfYearToAngle(e.endDay)+2*Math.PI,o=i-Math.PI/2,c=f+be*Math.cos(o),g=f+be*Math.sin(o),d=f+De*Math.cos(o),u=f+De*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");if(h.setAttribute("x1",String(c)),h.setAttribute("y1",String(g)),h.setAttribute("x2",String(d)),h.setAttribute("y2",String(u)),h.setAttribute("class","rc-segment-tick"),e.color&&(h.style.stroke=P[e.color]),t.appendChild(h),r){let p;e.endDay>e.startDay?p=(i+s)/2:(p=(i+s)/2,p>2*Math.PI&&(p-=2*Math.PI));let y=p-Math.PI/2,m=f+Se*Math.cos(y),b=f+Se*Math.sin(y),D=document.createElementNS("http://www.w3.org/2000/svg","text");D.setAttribute("x",String(m)),D.setAttribute("y",String(b)),D.setAttribute("class","rc-segment-label"),D.setAttribute("text-anchor","middle"),D.setAttribute("dominant-baseline","central");let C=p*180/Math.PI,A=C>90&&C<270?C+180:C;D.setAttribute("transform",`rotate(${A}, ${m}, ${b})`),e.color&&(D.style.fill=P[e.color]),D.textContent=e.label,t.appendChild(D)}}dayOfYearToAngle(t){return(t-1)/365*2*Math.PI}};var Mt=require("obsidian");N();var Oe=["Januar","Februar","M\xE4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],nt="local-calendar-view",Wt=300,M=Wt/2,tt=140,Et=115,et=105,U=40,Ve=35,wt=class extends Mt.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.activeFileDate=null}getViewType(){return nt}getDisplayText(){return"Local Calendar"}getIcon(){return"clock"}initialize(t){this.config=t,this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updateActiveFileDate(),this.render()})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.updateActiveFileDate(),this.render()}))}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("local-calendar-view"),this.updateActiveFileDate(),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null}updateActiveFileDate(){this.config&&(this.activeFileDate=this.config.getActiveFileDate())}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let t=this.containerEl_.createDiv({cls:"lc-container"}),e=t.createDiv({cls:"lc-title"});this.activeFileDate?e.textContent=`${this.activeFileDate.day}.${this.activeFileDate.month}.${this.activeFileDate.year}`:e.textContent="Keine Datums-Notiz";let a=t.createDiv({cls:"lc-wrapper"});this.renderNestedClock(a)}renderNestedClock(t){if(!this.config)return;let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox",`0 0 ${Wt} ${Wt}`),e.setAttribute("class","lc-svg"),this.svgEl=e;let{birthYear:a,expectedLifespan:r}=this.config.settings,i=a+r,s=x(),o=this.activeFileDate||s,c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx",String(M)),c.setAttribute("cy",String(M)),c.setAttribute("r",String(tt)),c.setAttribute("class","lc-background"),e.appendChild(c),this.renderLifeRing(e,a,i,o.year,s.year),this.renderYearRing(e,o,s),this.renderCenter(e,o),this.activeFileDate&&this.renderNoteMarkers(e,a,r,this.activeFileDate),(!this.activeFileDate||this.activeFileDate.year!==s.year||this.activeFileDate.month!==s.month||this.activeFileDate.day!==s.day)&&this.renderTodayMarkers(e,a,r,s),t.appendChild(e)}renderLifeRing(t,e,a,r,i){let s=a-e;for(let o=0;o<s;o+=10){let c=o/s*2*Math.PI,g=Math.min((o+10)/s*2*Math.PI,2*Math.PI)-.02,d=this.createArcPath(Et,tt,c,g),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",d);let h=e+o,p=h+10<=i,y=h<=i&&i<h+10,m="lc-life-decade";p&&(m+=" lc-life-decade--past"),y&&(m+=" lc-life-decade--current"),u.setAttribute("class",m),t.appendChild(u);let b=(o+5)/s*2*Math.PI-Math.PI/2,D=(Et+tt)/2,C=M+D*Math.cos(b),A=M+D*Math.sin(b),v=document.createElementNS("http://www.w3.org/2000/svg","text");v.setAttribute("x",String(C)),v.setAttribute("y",String(A)),v.setAttribute("class","lc-decade-label"),v.setAttribute("text-anchor","middle"),v.setAttribute("dominant-baseline","central"),v.textContent=String(e+o),t.appendChild(v)}}renderYearRing(t,e,a){if(!this.config)return;let r=e.year;for(let s=1;s<=12;s++){let o=E(r,s),c=this.monthToAngle(s),d=Math.PI/6/o;for(let u=1;u<=o;u++){let h=L(r,s,u),p=F(h),y=a.year===r&&a.month===s&&a.day===u,m=e.month===s&&e.day===u,b=p===0||p===6,D=c+(u-1)*d,C=D+d-.002,A=this.config.service.getEntriesForDate(h),v=this.createArcPath(U,et,D,C),R=document.createElementNS("http://www.w3.org/2000/svg","path");R.setAttribute("d",v);let I=["lc-day"];y&&I.push("lc-day--today"),m&&I.push("lc-day--note"),b&&I.push("lc-day--weekend"),A.length>0&&I.push("lc-day--has-notes"),A.length>2&&I.push("lc-day--many-notes"),R.setAttribute("class",I.join(" ")),R.style.cursor="pointer",R.addEventListener("click",k=>{var _;k.preventDefault(),k.stopPropagation(),A.length>0?this.showDayContextMenu(k,h,A):(_=this.config)==null||_.service.openDailyNote(h)}),t.appendChild(R)}}for(let s=1;s<=12;s++){let o=this.monthToAngle(s)-Math.PI/2,c=M+U*Math.cos(o),g=M+U*Math.sin(o),d=M+et*Math.cos(o),u=M+et*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(c)),h.setAttribute("y1",String(g)),h.setAttribute("x2",String(d)),h.setAttribute("y2",String(u)),h.setAttribute("class","lc-month-separator"),t.appendChild(h)}let i=["J","F","M","A","M","J","J","A","S","O","N","D"];for(let s=0;s<12;s++){let o=this.monthToAngle(s+1)+Math.PI/12-Math.PI/2,c=U-8,g=M+c*Math.cos(o),d=M+c*Math.sin(o),u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",String(g)),u.setAttribute("y",String(d)),u.setAttribute("class","lc-month-label"),u.setAttribute("text-anchor","middle"),u.setAttribute("dominant-baseline","central"),u.textContent=i[s],t.appendChild(u)}}monthToAngle(t){return(t-1)*Math.PI/6}renderCenter(t,e){let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",String(M)),a.setAttribute("cy",String(M)),a.setAttribute("r",String(Ve-5)),a.setAttribute("class","lc-center"),t.appendChild(a);let r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",String(M)),r.setAttribute("y",String(M)),r.setAttribute("class","lc-center-day"),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.textContent=String(e.day),t.appendChild(r)}renderNoteMarkers(t,e,a,r){let s=(r.year-e)/a*2*Math.PI-Math.PI/2;this.drawMarker(t,s,Et-3,tt+3,"lc-marker--note");let o=this.dateToAngle(r);this.drawMarker(t,o,U-3,et+3,"lc-marker--note")}renderTodayMarkers(t,e,a,r){let s=(r.year-e)/a*2*Math.PI-Math.PI/2;this.drawMarker(t,s,Et,tt,"lc-marker--today");let o=this.dateToAngle(r);this.drawMarker(t,o,U,et,"lc-marker--today")}dateToAngle(t){let e=E(t.year,t.month),a=this.monthToAngle(t.month),i=Math.PI/6/e;return a+(t.day-.5)*i-Math.PI/2}drawMarker(t,e,a,r,i){let s=M+a*Math.cos(e),o=M+a*Math.sin(e),c=M+r*Math.cos(e),g=M+r*Math.sin(e),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",String(s)),d.setAttribute("y1",String(o)),d.setAttribute("x2",String(c)),d.setAttribute("y2",String(g)),d.setAttribute("class",i),t.appendChild(d)}showDayContextMenu(t,e,a){if(!this.config)return;let r=new Mt.Menu;if(r.addItem(i=>{i.setTitle(`${e.day}. ${Oe[e.month-1]} ${e.year}`).setIcon("calendar").setDisabled(!0)}),r.addSeparator(),r.addItem(i=>{i.setTitle("Neue Notiz erstellen").setIcon("plus").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(e))})}),a.length>0){r.addSeparator();for(let i of a.slice(0,10))r.addItem(s=>{s.setTitle(i.displayName).setIcon("file").onClick(async()=>{var o;await((o=this.config)==null?void 0:o.openFile(i.filePath))})});a.length>10&&r.addItem(i=>{i.setTitle(`+${a.length-10} weitere...`).setDisabled(!0)})}r.showAtMouseEvent(t)}createArcPath(t,e,a,r){let i=a-Math.PI/2,s=r-Math.PI/2,o=M+t*Math.cos(i),c=M+t*Math.sin(i),g=M+t*Math.cos(s),d=M+t*Math.sin(s),u=M+e*Math.cos(i),h=M+e*Math.sin(i),p=M+e*Math.cos(s),y=M+e*Math.sin(s),m=r-a>Math.PI?1:0;return`
      M ${o} ${c}
      L ${u} ${h}
      A ${e} ${e} 0 ${m} 1 ${p} ${y}
      L ${g} ${d}
      A ${t} ${t} 0 ${m} 0 ${o} ${c}
      Z
    `}};var S=require("obsidian");W();var Ct=require("obsidian"),B=class extends Ct.AbstractInputSuggest{constructor(n,t){super(n,t),this.textInputEl=t}getSuggestions(n){let t=this.getAllFolders(),e=n.toLowerCase().trim();return e===""?t:t.filter(a=>a.path.toLowerCase().includes(e))}renderSuggestion(n,t){t.addClass("folder-suggest-item");let e=t.createSpan({cls:"folder-suggest-icon"});e.innerHTML=this.getFolderIcon(),t.createSpan({cls:"folder-suggest-text"}).setText(n.path||"/")}selectSuggestion(n,t){this.textInputEl.value=n.path,this.textInputEl.trigger("input"),this.close()}getAllFolders(){let n=[],t=a=>{n.push(a);for(let r of a.children)r instanceof Ct.TFolder&&t(r)},e=this.app.vault.getRoot();return t(e),n.sort((a,r)=>a.isRoot()?-1:r.isRoot()?1:a.path.localeCompare(r.path))}getFolderIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>'}};var Lt=class extends S.PluginSettingTab{constructor(n,t){super(n,t),this.plugin=t}display(){let{containerEl:n}=this;n.empty(),this.createViewModeSection(n),this.plugin.settings.currentView==="life"&&this.createLifeViewSection(n),this.createDailyNotesSection(n),this.createRingConfigSection(n),this.createOuterSegmentsSection(n),this.createTemplateSection(n),this.createCenterDisplaySection(n)}createViewModeSection(n){new S.Setting(n).setName("Ansichtsmodus").setDesc("Wechseln zwischen Jahres- und Lebensansicht").addDropdown(t=>{t.addOption("annual","Jahresansicht").addOption("life","Lebensansicht").setValue(this.plugin.settings.currentView).onChange(async e=>{this.plugin.settings.currentView=e,await this.plugin.saveSettings(),this.display()})})}createLifeViewSection(n){n.createEl("h3",{text:"Lebensansicht Einstellungen"}),new S.Setting(n).setName("Geburtsdatum").setDesc("Dein Geburtsdatum (YYYY-MM-DD) f\xFCr pr\xE4zise Berechnung").addText(e=>{e.setPlaceholder("z.B. 1977-03-27").setValue(this.plugin.settings.birthDate||"").onChange(async a=>{let r=a.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(r){let i=parseInt(r[1],10),s=parseInt(r[2],10),o=parseInt(r[3],10);i>1900&&i<=new Date().getFullYear()&&s>=1&&s<=12&&o>=1&&o<=31&&(this.plugin.settings.birthDate=a,this.plugin.settings.birthYear=i,await this.plugin.saveSettings())}else a===""&&(this.plugin.settings.birthDate=void 0,await this.plugin.saveSettings())})}),new S.Setting(n).setName("Geburtsjahr (Fallback)").setDesc("Wird verwendet wenn kein vollst\xE4ndiges Datum angegeben").addText(e=>{e.setPlaceholder("z.B. 1990").setValue(String(this.plugin.settings.birthYear)).onChange(async a=>{let r=parseInt(a,10);!isNaN(r)&&r>1900&&r<=new Date().getFullYear()&&(this.plugin.settings.birthYear=r,await this.plugin.saveSettings())})}),new S.Setting(n).setName("Erwartete Lebensspanne").setDesc("Erwartete Lebensdauer in Jahren").addText(e=>{e.setPlaceholder("z.B. 85").setValue(String(this.plugin.settings.expectedLifespan)).onChange(async a=>{let r=parseInt(a,10);!isNaN(r)&&r>0&&r<=150&&(this.plugin.settings.expectedLifespan=r,await this.plugin.saveSettings())})}),n.createEl("h4",{text:"Lebensphasen"}),new S.Setting(n).setName("Lebensphasen-Ordner").setDesc("Ordner mit Lebensphasen-Notizen (YAML: phase-start, phase-end, phase-color, phase-label)").addText(e=>{e.setPlaceholder("z.B. Life/Phases").setValue(this.plugin.settings.lifePhasesFolder).onChange(async a=>{this.plugin.settings.lifePhasesFolder=a,await this.plugin.saveSettings()}),new B(this.app,e.inputEl)});let t=n.createDiv({cls:"setting-item-description"});t.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Beispiel YAML f\xFCr eine Lebensphase:</strong><br>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
phase-start: 1983-09-01<br>
phase-end: 1987-07-15<br>
phase-color: blue<br>
phase-label: Grundschule<br>
---
        </code>
        <br>
        <em>Leer lassen f\xFCr "ongoing" (aktuelle Phasen zeigen Gradient bis Lebensende)</em>
      </p>
    `}createDailyNotesSection(n){n.createEl("h3",{text:"T\xE4gliche Notizen"}),new S.Setting(n).setName("Notizen-Ordner").setDesc("Ordner, in dem neue Notizen erstellt werden (leer = Root)").addText(t=>{t.setPlaceholder("z.B. Daily Notes").setValue(this.plugin.settings.dailyNoteFolder).onChange(async e=>{this.plugin.settings.dailyNoteFolder=e,await this.plugin.saveSettings()}),new B(this.app,t.inputEl)}),new S.Setting(n).setName("Filter-Ordner").setDesc("Nur Notizen aus diesem Ordner anzeigen (leer = alle)").addText(t=>{t.setPlaceholder("z.B. Journal").setValue(this.plugin.settings.calendarFilterFolder).onChange(async e=>{this.plugin.settings.calendarFilterFolder=e,await this.plugin.saveSettings()}),new B(this.app,t.inputEl)}),new S.Setting(n).setName("Dateiname-Format").setDesc("Format f\xFCr neue Notizen (YYYY-MM-DD)").addText(t=>{t.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.periodicNotesFormat.daily).onChange(async e=>{this.plugin.settings.periodicNotesFormat={...this.plugin.settings.periodicNotesFormat,daily:e||"YYYY-MM-DD"},await this.plugin.saveSettings()})}),new S.Setting(n).setName("J\xE4hrlich wiederkehrend").setDesc("Ordner f\xFCr Geburtstage, Jahrestage (z.B. 27.03.1977 wird jedes Jahr am 27.03. angezeigt)").addText(t=>{t.setPlaceholder("z.B. Geburtstage").setValue(this.plugin.settings.annualRecurringFolder).onChange(async e=>{this.plugin.settings.annualRecurringFolder=e,await this.plugin.saveSettings()}),new B(this.app,t.inputEl)})}createRingConfigSection(n){n.createEl("h3",{text:"Ringe konfigurieren"});let t=this.plugin.settings.rings;t.forEach((e,a)=>{this.createRingSettings(n,e,a)}),new S.Setting(n).addButton(e=>{e.setButtonText("Ring hinzufugen").setCta().onClick(async()=>{let a=Nt(t.length);this.plugin.settings.rings=[...t,a],await this.plugin.saveSettings(),this.display()})})}createRingSettings(n,t,e){let a=n.createDiv({cls:"radial-calendar-ring-config"}),r=new S.Setting(a).setName(`Ring ${e+1}`).setClass("radial-calendar-ring-header");new S.Setting(a).setName("Name").addText(i=>{i.setPlaceholder("Ring Name").setValue(t.name).onChange(async s=>{this.updateRing(e,{name:s})})}),new S.Setting(a).setName("Ordner").setDesc("Ordnerpfad im Vault").addText(i=>{i.setPlaceholder("z.B. Projects/2024").setValue(t.folder).onChange(async s=>{this.updateRing(e,{folder:s})}),new B(this.app,i.inputEl)}),new S.Setting(a).setName("Farbe").addDropdown(i=>{Object.keys(P).forEach(s=>{i.addOption(s,this.formatColorName(s))}),i.setValue(t.color).onChange(async s=>{this.updateRing(e,{color:s})})}),new S.Setting(a).setName("Spanning Arcs").setDesc("Multi-Day Events als durchgehende B\xF6gen anzeigen").addToggle(i=>{var s;i.setValue((s=t.showSpanningArcs)!=null?s:!1).onChange(async o=>{await this.updateRing(e,{showSpanningArcs:o}),this.display()})}),t.showSpanningArcs&&this.createSpanningArcsPropertySettings(a,t,e),new S.Setting(a).addButton(i=>{i.setButtonText("Loschen").setWarning().onClick(async()=>{this.plugin.settings.rings=this.plugin.settings.rings.filter((s,o)=>o!==e),this.plugin.settings.rings=this.plugin.settings.rings.map((s,o)=>({...s,order:o})),await this.plugin.saveSettings(),this.display()})}),a.createEl("hr")}async updateRing(n,t){let e=[...this.plugin.settings.rings];e[n]={...e[n],...t},this.plugin.settings.rings=e,await this.plugin.saveSettings()}createSpanningArcsPropertySettings(n,t,e){let a=n.createDiv({cls:"radial-calendar-segment-config"});new S.Setting(a).setName("Start-Datum Property").setDesc("YAML-Frontmatter Feld f\xFCr Startdatum").addText(r=>{r.setPlaceholder("radcal-start").setValue(t.startDateField||"radcal-start").onChange(async i=>{this.updateRing(e,{startDateField:i||"radcal-start"})})}),new S.Setting(a).setName("End-Datum Property").setDesc("YAML-Frontmatter Feld f\xFCr Enddatum").addText(r=>{r.setPlaceholder("radcal-end").setValue(t.endDateField||"radcal-end").onChange(async i=>{this.updateRing(e,{endDateField:i||"radcal-end"})})}),new S.Setting(a).setName("Farbe Property").setDesc("YAML-Frontmatter Feld f\xFCr Farbe").addText(r=>{r.setPlaceholder("radcal-color").setValue(t.colorField||"radcal-color").onChange(async i=>{this.updateRing(e,{colorField:i||"radcal-color"})})}),new S.Setting(a).setName("Label Property").setDesc("YAML-Frontmatter Feld f\xFCr Beschriftung").addText(r=>{r.setPlaceholder("radcal-label").setValue(t.labelField||"radcal-label").onChange(async i=>{this.updateRing(e,{labelField:i||"radcal-label"})})})}formatColorName(n){return n.charAt(0).toUpperCase()+n.slice(1)}createOuterSegmentsSection(n){n.createEl("h3",{text:"\xC4u\xDFere Segmente"}),new S.Setting(n).setName("Segment-Typ").setDesc("Markierungen am \xE4u\xDFeren Rand des Kalenders").addDropdown(t=>{t.addOption("none","Keine").addOption("seasons","Jahreszeiten (4)").addOption("quarters","Quartale (4)").addOption("semester","Semester (2)").addOption("ten-days","10-Tages-Phasen (36)").addOption("weeks","Wochen (52)").addOption("custom","Benutzerdefiniert").setValue(this.plugin.settings.annualSegmentType).onChange(async e=>{this.plugin.settings.annualSegmentType=e,await this.plugin.saveSettings(),this.display()})}),new S.Setting(n).setName("Labels anzeigen").setDesc("Segment-Beschriftungen anzeigen").addToggle(t=>{t.setValue(this.plugin.settings.showSegmentLabels).onChange(async e=>{this.plugin.settings.showSegmentLabels=e,await this.plugin.saveSettings()})}),this.plugin.settings.annualSegmentType==="custom"&&this.createCustomSegmentsEditor(n),this.plugin.settings.currentView==="life"&&this.createLifeActsEditor(n)}createCustomSegmentsEditor(n){n.createEl("h4",{text:"Benutzerdefinierte Segmente"});let t=this.plugin.settings.customSegments;t.forEach((e,a)=>{this.createSegmentSettings(n,e,a)}),new S.Setting(n).addButton(e=>{e.setButtonText("Segment hinzuf\xFCgen").onClick(async()=>{let a={id:`seg-${Date.now()}`,label:`Segment ${t.length+1}`,startDay:1,endDay:30};this.plugin.settings.customSegments=[...t,a],await this.plugin.saveSettings(),this.display()})})}createSegmentSettings(n,t,e){let a=n.createDiv({cls:"radial-calendar-segment-config"});new S.Setting(a).setName("Label").addText(r=>{r.setValue(t.label).onChange(async i=>{this.updateSegment(e,{label:i})})}),new S.Setting(a).setName("Start-Tag").setDesc("Tag des Jahres (1-365)").addText(r=>{r.setValue(String(t.startDay)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=1&&s<=365&&this.updateSegment(e,{startDay:s})})}),new S.Setting(a).setName("End-Tag").setDesc("Tag des Jahres (1-365)").addText(r=>{r.setValue(String(t.endDay)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=1&&s<=365&&this.updateSegment(e,{endDay:s})})}),new S.Setting(a).addButton(r=>{r.setButtonText("L\xF6schen").setWarning().onClick(async()=>{this.plugin.settings.customSegments=this.plugin.settings.customSegments.filter((i,s)=>s!==e),await this.plugin.saveSettings(),this.display()})}),a.createEl("hr")}async updateSegment(n,t){let e=[...this.plugin.settings.customSegments];e[n]={...e[n],...t},this.plugin.settings.customSegments=e,await this.plugin.saveSettings()}createLifeActsEditor(n){n.createEl("h4",{text:"Lebensakte"});let t=this.plugin.settings.lifeActs;t.forEach((e,a)=>{this.createLifeActSettings(n,e,a)}),new S.Setting(n).addButton(e=>{e.setButtonText("Lebensakt hinzuf\xFCgen").onClick(async()=>{let a={id:`act-${Date.now()}`,label:`Akt ${t.length+1}`,startAge:0,endAge:10};this.plugin.settings.lifeActs=[...t,a],await this.plugin.saveSettings(),this.display()})})}createLifeActSettings(n,t,e){let a=n.createDiv({cls:"radial-calendar-life-act-config"});new S.Setting(a).setName("Bezeichnung").addText(r=>{r.setPlaceholder("z.B. Kindheit").setValue(t.label).onChange(async i=>{this.updateLifeAct(e,{label:i})})}),new S.Setting(a).setName("Start-Alter").addText(r=>{r.setValue(String(t.startAge)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=0&&this.updateLifeAct(e,{startAge:s})})}),new S.Setting(a).setName("End-Alter").addText(r=>{r.setValue(String(t.endAge)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=0&&this.updateLifeAct(e,{endAge:s})})}),new S.Setting(a).setName("Farbe").addDropdown(r=>{r.addOption("","(Standard)"),Object.keys(P).forEach(i=>{r.addOption(i,this.formatColorName(i))}),r.setValue(t.color||"").onChange(async i=>{this.updateLifeAct(e,{color:i||void 0})})}),new S.Setting(a).addButton(r=>{r.setButtonText("L\xF6schen").setWarning().onClick(async()=>{this.plugin.settings.lifeActs=this.plugin.settings.lifeActs.filter((i,s)=>s!==e),await this.plugin.saveSettings(),this.display()})}),a.createEl("hr")}async updateLifeAct(n,t){let e=[...this.plugin.settings.lifeActs];e[n]={...e[n],...t},this.plugin.settings.lifeActs=e,await this.plugin.saveSettings()}createTemplateSection(n){n.createEl("h3",{text:"Template"}),new S.Setting(n).setName("Template erstellen").setDesc("Erstellt eine Template-Datei fur Ring-Segmente im Vault").addButton(t=>{t.setButtonText("Template erstellen").onClick(async()=>{await this.createTemplateFile()})})}async createTemplateFile(){let n=this.plugin.settings.templateFolder||"Templates",t=`${n}/Radial Calendar Segment.md`;try{if(this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n),this.app.vault.getAbstractFileByPath(t)){new S.Notice(`Template existiert bereits: ${t}`);return}await this.app.vault.create(t,Bt),new S.Notice(`Template erstellt: ${t}`)}catch(e){console.error("Failed to create template file:",e),new S.Notice("Fehler beim Erstellen des Templates")}}createCenterDisplaySection(n){n.createEl("h3",{text:"Zentrum Anzeige"}),new S.Setting(n).setName("Anzeigemodus").setDesc("Was im Zentrum des Kalenders angezeigt wird").addDropdown(t=>{t.addOption("countdown","Countdown").addOption("stats","Statistiken").addOption("navigation","Navigation").setValue(this.plugin.settings.centerDisplay).onChange(async e=>{this.plugin.settings.centerDisplay=e,await this.plugin.saveSettings()})})}};W();var xt=class extends at.Plugin{constructor(){super(...arguments);this.service=null;this.settings={...bt}}async onload(){await this.loadSettings();let t={calendarWidth:"fit",dateProperties:["date","created","due"],endDateProperties:["endDate","end","until"],datePriority:"filename",dailyNoteFormat:this.settings.periodicNotesFormat.daily,dailyNoteFolder:this.settings.dailyNoteFolder,showMultiDayBars:!0,showWeekendHighlight:!0};this.service=new Dt(this.app,t),await this.service.initialize(),this.registerView(Q,e=>{let a=new vt(e);return a.initialize({service:this.service,openFile:async r=>{let i=this.app.vault.getAbstractFileByPath(r);i instanceof at.TFile&&await this.app.workspace.getLeaf().openFile(i)},settings:this.settings,onSettingsChange:async r=>{this.settings=r,await this.saveSettings()}}),a}),this.registerView(nt,e=>{let a=new wt(e);return a.initialize({service:this.service,settings:this.settings,getActiveFileDate:()=>this.getActiveFileDate(),openFile:async r=>{let i=this.app.vault.getAbstractFileByPath(r);i instanceof at.TFile&&await this.app.workspace.getLeaf().openFile(i)}}),a}),this.addSettingTab(new Lt(this.app,this)),this.addRibbonIcon("circle","Open Radial Calendar",()=>{this.activateView()}),this.addRibbonIcon("clock","Open Local Calendar",()=>{this.activateLocalCalendarView()}),this.addCommand({id:"open-radial-calendar",name:"Open Radial Calendar",callback:()=>{this.activateView()}}),this.addCommand({id:"open-local-calendar",name:"Open Local Calendar (Sidebar)",callback:()=>{this.activateLocalCalendarView()}})}async onunload(){var t;(t=this.service)==null||t.destroy(),this.service=null}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},bt,t)}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:t}=this.app,e=null,a=t.getLeavesOfType(Q);a.length>0?e=a[0]:(e=t.getLeaf("tab"),e&&await e.setViewState({type:Q,active:!0})),e&&t.revealLeaf(e)}getActiveFileDate(){let t=this.app.workspace.getActiveFile();if(!t)return null;let e=t.basename.match(/(\d{4})-(\d{2})-(\d{2})/);return e?L(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10)):null}async activateLocalCalendarView(){let{workspace:t}=this.app,e=t.getLeavesOfType(nt)[0];e||(e=t.getRightLeaf(!1),e&&await e.setViewState({type:nt,active:!0})),e&&t.revealLeaf(e)}};
