/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Ke=Object.defineProperty;var Mr=Object.getOwnPropertyDescriptor;var Cr=Object.getOwnPropertyNames;var Er=Object.prototype.hasOwnProperty;var Ut=(g,i)=>()=>(g&&(i=g(g=0)),i);var Ze=(g,i)=>{for(var t in i)Ke(g,t,{get:i[t],enumerable:!0})},xr=(g,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let n of Cr(i))!Er.call(g,n)&&n!==t&&Ke(g,n,{get:()=>i[n],enumerable:!(e=Mr(i,n))||e.enumerable});return g};var re=g=>xr(Ke({},"__esModule",{value:!0}),g);function C(g,i,t){let e={year:g,month:i,day:t};if(!ie(e))throw new Error(`Invalid date: ${g}-${i}-${t}`);return Object.freeze(e)}function yt(g){let i=g.month.toString().padStart(2,"0"),t=g.day.toString().padStart(2,"0");return`${g.year}-${i}-${t}`}function Pn(g){let i=g.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!i)return null;let t=parseInt(i[1],10),e=parseInt(i[2],10),n=parseInt(i[3],10),r={year:t,month:e,day:n};return ie(r)?Object.freeze(r):null}function $(g,i){return g.year!==i.year?g.year-i.year:g.month!==i.month?g.month-i.month:g.day-i.day}function Vt(g,i){return g.year===i.year&&g.month===i.month&&g.day===i.day}function ie(g){let{year:i,month:t,day:e}=g;if(!Number.isInteger(i)||i<1||!Number.isInteger(t)||t<1||t>12||!Number.isInteger(e)||e<1)return!1;let n=x(i,t);return e<=n}function x(g,i){let t=[31,28,31,30,31,30,31,31,30,31,30,31];return i===2&&oe(g)?29:t[i-1]}function oe(g){return g%4===0&&g%100!==0||g%400===0}function W(g){let i=g.year,t=g.month,e=g.day;t<3&&(t+=12,i-=1);let n=e,r=t,a=i%100,s=Math.floor(i/100),o=(n+Math.floor(13*(r+1)/5)+a+Math.floor(a/4)+Math.floor(s/4)-2*s)%7;return o=(o%7+7)%7,(o+6)%7}function Ct(g,i){let t=g.year,e=g.month,n=g.day+i;for(;n>x(t,e);)n-=x(t,e),e+=1,e>12&&(e=1,t+=1);for(;n<1;)e-=1,e<1&&(e=12,t-=1),n+=x(t,e);return Object.freeze({year:t,month:e,day:n})}function kn(g,i){return Ct(g,-i)}function N(){let g=new Date;return Object.freeze({year:g.getFullYear(),month:g.getMonth()+1,day:g.getDate()})}function zt(g,i){let t=Tn(g);return Tn(i)-t}function le(g,i){return $(g,i)<0}function ce(g,i){return $(g,i)>0}function Ln(g,i,t){return $(g,i)>=0&&$(g,t)<=0}function In(g){return Object.freeze({year:g.year,month:g.month,day:1})}function Nn(g){let i=x(g.year,g.month);return Object.freeze({year:g.year,month:g.month,day:i})}function Tn(g){let{year:i,month:t,day:e}=g,n=i*365+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400);return n+=[0,31,59,90,120,151,181,212,243,273,304,334][t-1],t>2&&oe(i)&&(n+=1),n+=e,n}var J=Ut(()=>{"use strict"});function lt(g){var e;let i=g.endDate!==null&&(g.startDate.year!==g.endDate.year||g.startDate.month!==g.endDate.month||g.startDate.day!==g.endDate.day),t=(e=g.isAnniversary)!=null?e:g.startDate.year===0;return Object.freeze({id:g.id,filePath:g.filePath,fileName:g.fileName,displayName:g.displayName,startDate:g.startDate,endDate:g.endDate,isMultiDay:i,isAnniversary:t,metadata:Object.freeze({tags:Object.freeze([...g.metadata.tags]),folder:g.metadata.folder,properties:Object.freeze({...g.metadata.properties})})})}function Fn(){return Object.freeze({tags:Object.freeze([]),folder:"",properties:Object.freeze({})})}function $n(g){if(typeof g!="object"||g===null)return!1;let i=g;return typeof i.id=="string"&&typeof i.filePath=="string"&&typeof i.fileName=="string"&&typeof i.displayName=="string"&&Rn(i.startDate)&&(i.endDate===null||Rn(i.endDate))&&typeof i.isMultiDay=="boolean"&&typeof i.isAnniversary=="boolean"&&kr(i.metadata)}function Rn(g){if(typeof g!="object"||g===null)return!1;let i=g;return typeof i.year=="number"&&typeof i.month=="number"&&typeof i.day=="number"}function kr(g){if(typeof g!="object"||g===null)return!1;let i=g;return Array.isArray(i.tags)&&typeof i.folder=="string"&&typeof i.properties=="object"&&i.properties!==null}var Je=Ut(()=>{"use strict"});function Vn(g,i){if($(g,i)>0)throw new Error("Start date must be before or equal to end date");return Object.freeze({start:g,end:i})}function On(g){return Object.freeze({start:g,end:g})}function tn(g,i){return $(g.start,i.end)<=0&&$(i.start,g.end)<=0}function Bn(g,i){return $(g,i.start)>=0&&$(g,i.end)<=0}function Gn(g,i){return $(g.start,i.start)<=0&&$(g.end,i.end)>=0}function Yn(g,i){if(!tn(g,i))return null;let t=$(g.start,i.start)>=0?g.start:i.start,e=$(g.end,i.end)<=0?g.end:i.end;return Object.freeze({start:t,end:e})}function _n(g){if(g.start.year===g.end.year&&g.start.month===g.end.month)return g.end.day-g.start.day+1;let i=0,t=g.start;for(;$(t,g.end)<=0;)i++,t=Ct(t,1);return i}function Hn(g,i){let t=[],e=g.start.year,n=g.start.month,r=g.start.day;for(;e<g.end.year||e===g.end.year&&n<=g.end.month;){let a=x(e,n),s;e===g.end.year&&n===g.end.month?s=g.end.day:s=a,t.push(Object.freeze({year:e,month:n,startDay:r,endDay:s,entryId:i})),n++,n>12&&(n=1,e++),r=1}return Object.freeze(t)}function Wn(g,i,t,e){let n={year:i,month:t,day:1},r={year:i,month:t,day:x(i,t)};if(ce(g.start,r)||le(g.end,n))return null;let a=g.start.year===i&&g.start.month===t?g.start.day:1,s=g.end.year===i&&g.end.month===t?g.end.day:x(i,t);return Object.freeze({year:i,month:t,startDay:a,endDay:s,entryId:e})}function Un(g,i){return Object.freeze({start:{year:g,month:i,day:1},end:{year:g,month:i,day:x(g,i)}})}function zn(g){return Vt(g.start,g.end)}function jn(g,i,t){return Object.freeze({start:Ct(g.start,-i),end:Ct(g.end,t)})}var qn=Ut(()=>{"use strict";J()});var Ot={};Ze(Ot,{ANNIVERSARY_TEMPLATE:()=>ve,COLOR_LIST_COMMENT:()=>Or,DEFAULT_DATE_EXTRACTION_CONFIG:()=>ge,DEFAULT_DISPLAY_CONFIG:()=>me,DEFAULT_FOLDER_FILTER_CONFIG:()=>pe,DEFAULT_MEMENTO_MORI_SETTINGS:()=>be,DEFAULT_PLUGIN_SETTINGS:()=>en,DEFAULT_PRESETS:()=>ye,DEFAULT_RADIAL_SETTINGS:()=>fe,DEFAULT_SETTINGS:()=>Ir,LIFE_PHASE_TEMPLATE:()=>Se,PATTERN_NAMES:()=>nt,PREDEFINED_QUARTERS:()=>on,PREDEFINED_SEASONS:()=>sn,PREDEFINED_SEMESTERS:()=>ln,RING_COLORS:()=>E,SPANNING_ARC_TEMPLATE:()=>Ae,SVG_PATTERN_BUILDERS:()=>nn,addDays:()=>Ct,assignTracks:()=>Et,compareLocalDates:()=>$,computeSubRingRadii:()=>bt,createCalendarEntry:()=>lt,createCurrentViewState:()=>Nr,createDateRange:()=>Vn,createDefaultRing:()=>rn,createEmptyMetadata:()=>Fn,createEventsRing:()=>Vr,createGlobalRing:()=>an,createLifePhasesRing:()=>$r,createLocalDate:()=>C,createMonthRange:()=>Un,createPluginSettings:()=>Lr,createSingleDayRange:()=>On,createViewState:()=>Rr,daysBetween:()=>zt,extendRange:()=>jn,generate10DayPhases:()=>cn,generateWeekSegments:()=>dn,getCustomPeriodDays:()=>Fr,getDaysInMonth:()=>x,getFirstDayOfMonth:()=>In,getLastDayOfMonth:()=>Nn,getMaxTrackCount:()=>xt,getMonthSegment:()=>Wn,getRangeDays:()=>_n,getToday:()=>N,getWeekday:()=>W,intersectRanges:()=>Yn,isAfter:()=>ce,isBefore:()=>le,isCalendarEntry:()=>$n,isDateInRange:()=>Bn,isLeapYear:()=>oe,isSingleDay:()=>zn,isValidLocalDate:()=>ie,isWithinRange:()=>Ln,keyToLocalDate:()=>Pn,localDateToKey:()=>yt,localDatesEqual:()=>Vt,parseCustomPeriod:()=>ft,rangeContains:()=>Gn,rangesOverlap:()=>tn,splitRangeByMonth:()=>Hn,subtractDays:()=>kn});function Lr(g){var i,t;return Object.freeze({dateExtraction:g.dateExtraction?Object.freeze({...ge,...g.dateExtraction}):ge,folderFilter:g.folderFilter?Object.freeze({...pe,...g.folderFilter}):pe,display:g.display?Object.freeze({...me,...g.display}):me,locale:(i=g.locale)!=null?i:en.locale,debugMode:(t=g.debugMode)!=null?t:en.debugMode})}function Nr(){let g=new Date;return Object.freeze({year:g.getFullYear(),month:g.getMonth()+1,selectedDate:null,focusedEntryId:null})}function Rr(g,i){return Object.freeze({year:g,month:i,selectedDate:null,focusedEntryId:null})}function ft(g){let i=g.trim().toLowerCase().match(/^(\d+)(d|w|m)$/);if(!i)return null;let t=parseInt(i[1],10);switch(i[2]){case"d":return{days:t,label:`${t} Days`};case"w":return{days:t*7,label:`${t} Weeks`};case"m":return{months:t,label:`${t} Months`};default:return null}}function Fr(g){let i=ft(g);return i?i.days?i.days:i.months?i.months*30:30:30}function rn(g){return{id:`ring-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Ring ${g+1}`,folder:"",color:"blue",segmentType:"monthly",enabled:!0,order:g,ringType:"year-days",segmentStyle:"fixed",folderPattern:"fixed",recursive:!1,showGaps:!1,showLabels:!1}}function $r(g,i=0){return{id:`life-phases-${Date.now()}`,name:"Life Phases",folder:g,color:"blue",segmentType:"custom",enabled:!0,order:i,ringType:"life-phases",segmentStyle:"from-yaml",folderPattern:"fixed",recursive:!1,startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",showGaps:!0,showLabels:!0}}function Vr(g,i=1){return{id:`events-${Date.now()}`,name:"Events",folder:g,color:"teal",segmentType:"custom",enabled:!0,order:i,ringType:"events",segmentStyle:"from-yaml",folderPattern:"year-substitution",recursive:!1,startDateField:"event-start",endDateField:"event-end",colorField:"event-color",labelField:"event-label",showGaps:!0,showLabels:!0}}function an(g=0){return{id:"global-ring",name:"Global",folder:"",color:"blue",segmentType:"custom",enabled:!0,order:g,ringType:"global",segmentStyle:"from-yaml",folderPattern:"fixed",recursive:!1,showGaps:!0,showLabels:!0,showSpanningArcs:!0}}function Et(g){let i=[...g].sort((e,n)=>e.startAngle-n.startAngle),t=[];return i.map(e=>{let n=t.findIndex(r=>r.endAngle<=e.startAngle);return n===-1?(n=t.length,t.push({endAngle:e.endAngle})):t[n].endAngle=e.endAngle,{...e,track:n}})}function bt(g,i,t,e){let n=(g-i)/t;return{outer:g-e*n,inner:g-(e+1)*n}}function xt(g){return g.length===0?1:Math.max(...g.map(i=>i.track))+1}function cn(){let g=[],i=1,t=1;for(;i<=365;){let e=Math.min(i+9,365);g.push({id:`10d-${t}`,label:`P${t}`,startDay:i,endDay:e}),i=e+1,t++}return g}function dn(){let g=[];for(let i=1;i<=52;i++){let t=(i-1)*7+1,e=Math.min(i*7,365);g.push({id:`w-${i}`,label:`W${i}`,startDay:t,endDay:e})}return g}var ge,pe,me,en,Ir,ye,E,nn,nt,sn,on,ln,fe,be,Or,Se,Ae,ve,z=Ut(()=>{"use strict";J();Je();qn();ge=Object.freeze({fromFilename:!0,fromFrontmatter:!0,frontmatterField:"date",endDateField:"endDate",filenamePatterns:Object.freeze(["^(\\d{4}-\\d{2}-\\d{2})","(\\d{4}-\\d{2}-\\d{2})$","^(\\d{4}-\\d{2}-\\d{2})[-_\\s]","[-_\\s](\\d{4}-\\d{2}-\\d{2})\\.md$"]),useCreationDateFallback:!1}),pe=Object.freeze({includeFolders:Object.freeze([]),excludeFolders:Object.freeze([])}),me=Object.freeze({firstDayOfWeek:1,showWeekNumbers:!1,highlightToday:!0,showAdjacentMonths:!0,maxEntriesPerDay:3,showMultiDayBars:!0}),en=Object.freeze({dateExtraction:ge,folderFilter:pe,display:me,locale:"en-US",debugMode:!1});Ir={calendarWidth:"fit",dateProperties:["date","startDate","created"],endDateProperties:["endDate","due","deadline"],datePriority:"property",dailyNoteFolder:"",dailyNoteFormat:"YYYY-MM-DD",showMultiDayBars:!0,showWeekendHighlight:!0,anniversaryDateProperties:[]};ye=[{name:"family",label:"Family",color:"pink",icon:"\u2764\uFE0F"},{name:"work",label:"Work",color:"blue",icon:"\u{1F4BC}"},{name:"education",label:"Education",color:"indigo",icon:"\u{1F393}"},{name:"health",label:"Health",color:"green",icon:"\u{1F3E5}"},{name:"travel",label:"Travel",color:"cyan",icon:"\u2708\uFE0F"},{name:"project",label:"Project",color:"amber",icon:"\u{1F4CB}"},{name:"completed",label:"Completed",color:"green",opacity:60,icon:"\u2705"},{name:"cancelled",label:"Cancelled",color:"gray",pattern:"striped",opacity:50,icon:"\u274C"}],E={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",teal:"#14b8a6",cyan:"#06b6d4",magenta:"#d946ef",lime:"#84cc16",amber:"#f59e0b",indigo:"#6366f1",violet:"#8b5cf6",rose:"#f43f5e",gray:"#6b7280",slate:"#64748b",stone:"#78716c"},nn={solid:(g,i)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",i),g.appendChild(t)},striped:(g,i)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",i),t.setAttribute("fill-opacity","0.3"),g.appendChild(t);for(let[e,n,r,a]of[[0,0,10,10],[-10,0,0,10],[10,0,20,10]]){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(e)),s.setAttribute("y1",String(n)),s.setAttribute("x2",String(r)),s.setAttribute("y2",String(a)),s.setAttribute("stroke",i),s.setAttribute("stroke-width","2"),g.appendChild(s)}},horizontal:(g,i)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",i),t.setAttribute("fill-opacity","0.2"),g.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1","0"),e.setAttribute("y1","5"),e.setAttribute("x2","10"),e.setAttribute("y2","5"),e.setAttribute("stroke",i),e.setAttribute("stroke-width","2"),g.appendChild(e)},vertical:(g,i)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",i),t.setAttribute("fill-opacity","0.2"),g.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1","5"),e.setAttribute("y1","0"),e.setAttribute("x2","5"),e.setAttribute("y2","10"),e.setAttribute("stroke",i),e.setAttribute("stroke-width","2"),g.appendChild(e)},dotted:(g,i)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",i),t.setAttribute("fill-opacity","0.2"),g.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx","5"),e.setAttribute("cy","5"),e.setAttribute("r","2"),e.setAttribute("fill",i),g.appendChild(e)},crosshatch:(g,i)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",i),t.setAttribute("fill-opacity","0.2"),g.appendChild(t);for(let[e,n,r,a]of[[0,0,10,10],[10,0,0,10]]){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(e)),s.setAttribute("y1",String(n)),s.setAttribute("x2",String(r)),s.setAttribute("y2",String(a)),s.setAttribute("stroke",i),s.setAttribute("stroke-width","1.5"),g.appendChild(s)}},grid:(g,i)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",i),t.setAttribute("fill-opacity","0.2"),g.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1","5"),e.setAttribute("y1","0"),e.setAttribute("x2","5"),e.setAttribute("y2","10"),e.setAttribute("stroke",i),e.setAttribute("stroke-width","1"),g.appendChild(e);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","0"),n.setAttribute("y1","5"),n.setAttribute("x2","10"),n.setAttribute("y2","5"),n.setAttribute("stroke",i),n.setAttribute("stroke-width","1"),g.appendChild(n)},wavy:(g,i)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",i),t.setAttribute("fill-opacity","0.2"),g.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M0,5 Q2.5,0 5,5 T10,5"),e.setAttribute("fill","none"),e.setAttribute("stroke",i),e.setAttribute("stroke-width","1.5"),g.appendChild(e)}},nt=["solid","striped","horizontal","vertical","dotted","crosshatch","grid","wavy"];sn=[{id:"spring",label:"Spring",startDay:60,endDay:152},{id:"summer",label:"Summer",startDay:152,endDay:244},{id:"autumn",label:"Autumn",startDay:244,endDay:335},{id:"winter",label:"Winter",startDay:335,endDay:60}],on=[{id:"q1",label:"Q1",startDay:1,endDay:90},{id:"q2",label:"Q2",startDay:91,endDay:181},{id:"q3",label:"Q3",startDay:182,endDay:273},{id:"q4",label:"Q4",startDay:274,endDay:365}],ln=[{id:"s1",label:"H1",startDay:1,endDay:181},{id:"s2",label:"H2",startDay:182,endDay:365}];fe={currentView:"annual",birthYear:1990,expectedLifespan:85,currentYear:new Date().getFullYear(),currentMonth:new Date().getMonth()+1,currentQuarter:Math.ceil((new Date().getMonth()+1)/3),periodConfig:{type:"annual"},customPeriodString:"10d",customPeriodStart:new Date().toISOString().split("T")[0],rings:[],centerDisplay:"countdown",periodicNotesFormat:{yearly:"YYYY",monthly:"YYYY-MM",daily:"YYYY-MM-DD"},templateFolder:"Templates",dailyNoteFolder:"",calendarFilterFolder:"",annualRecurringFolder:"",lifePhasesFolder:"",annualSegmentType:"none",customSegments:[],lifeActs:[],showSegmentLabels:!0,anniversaryDateProperties:[],calendarSources:[],presets:[...ye],mementoMori:be},be={enabled:!0,rings:[{id:"hour",enabled:!0,order:0,label:"Stunde"},{id:"day",enabled:!0,order:1,label:"Tag"},{id:"custom-short",enabled:!1,order:2,label:"Dekade",customDays:10},{id:"month",enabled:!0,order:3,label:"Monat"},{id:"season",enabled:!1,order:4,label:"Quartal",customMonths:3},{id:"year",enabled:!0,order:5,label:"Jahr"},{id:"life",enabled:!0,order:6,label:"Leben"}],colorPast:"gray",colorPresent:"red",colorFuture:"blue"},Or=`# Farben: red, orange, yellow, green, blue, purple, pink, teal,
#         cyan, magenta, lime, amber, indigo, violet, rose, gray, slate, stone
# Patterns: solid, striped, horizontal, vertical, dotted, crosshatch, grid, wavy`,Se=`---
# Farben: red, orange, yellow, green, blue, purple, pink, teal,
#         cyan, magenta, lime, amber, indigo, violet, rose, gray, slate, stone
# Patterns: solid, striped, horizontal, vertical, dotted, crosshatch, grid, wavy
radcal-start: {{date}}
radcal-end:
radcal-color: blue
radcal-label:
radcal-showInLife: true
radcal-ring:
radcal-pattern:
radcal-opacity:
radcal-fade:
---

# {{title}}

Beschreibung der Lebensphase...
`,Ae=`---
# Farben: red, orange, yellow, green, blue, purple, pink, teal,
#         cyan, magenta, lime, amber, indigo, violet, rose, gray, slate, stone
# Patterns: solid, striped, horizontal, vertical, dotted, crosshatch, grid, wavy
radcal-start: {{date}}
radcal-end:
radcal-color: blue
radcal-label:
radcal-pattern:
radcal-opacity:
radcal-fade:
---

# {{title}}

Beschreibung des Zeitraums...
`,ve=`---
# Farben: red, orange, yellow, green, blue, purple, pink, teal,
#         cyan, magenta, lime, amber, indigo, violet, rose, gray, slate, stone
# Patterns: solid, striped, horizontal, vertical, dotted, crosshatch, grid, wavy
radcal-annual: true
radcal-start:
radcal-end:
radcal-color: pink
radcal-label:
radcal-showInLife: true
radcal-ring:
radcal-pattern:
radcal-opacity:
radcal-fade:
---

# {{title}}

Person oder j\xE4hrliches Event...
`});var Qn={};Ze(Qn,{AppearanceModal:()=>un});var Tt,un,Xn=Ut(()=>{"use strict";Tt=require("obsidian");z();un=class extends Tt.Modal{constructor(i,t,e){super(i),this.file=t,this.onSave=e;let n=i.metadataCache.getFileCache(t),r=(n==null?void 0:n.frontmatter)||{};this.selectedColor=this.isValidColor(r["radcal-color"])?r["radcal-color"]:void 0,this.selectedPattern=this.isValidPattern(r["radcal-pattern"])?r["radcal-pattern"]:void 0,this.selectedOpacity=typeof r["radcal-opacity"]=="number"?r["radcal-opacity"]:100}onOpen(){let{contentEl:i}=this;i.empty(),i.addClass("radcal-appearance-modal"),i.createEl("h2",{text:"Set Appearance"}),this.renderColorSection(i),this.renderPatternSection(i),this.renderOpacitySection(i),new Tt.Setting(i).addButton(t=>{t.setButtonText("Cancel").onClick(()=>this.close())}).addButton(t=>{t.setButtonText("Apply").setCta().onClick(()=>this.applyChanges())})}onClose(){let{contentEl:i}=this;i.empty()}renderColorSection(i){i.createEl("h3",{text:"Color"});let t=i.createDiv({cls:"radcal-color-grid radcal-color-grid--compact"});for(let[e,n]of Object.entries(E)){let r=t.createDiv({cls:`radcal-color-swatch ${this.selectedColor===e?"is-selected":""}`});r.style.backgroundColor=n,r.setAttribute("title",e),r.addEventListener("click",()=>{t.querySelectorAll(".radcal-color-swatch").forEach(a=>a.removeClass("is-selected")),r.addClass("is-selected"),this.selectedColor=e})}}renderPatternSection(i){i.createEl("h3",{text:"Pattern"});let t=i.createDiv({cls:"radcal-pattern-grid radcal-pattern-grid--compact"});for(let e of nt){let n=t.createDiv({cls:`radcal-pattern-option ${this.selectedPattern===e?"is-selected":""}`}),r=n.createDiv({cls:"radcal-pattern-label"});r.textContent=e,n.addEventListener("click",()=>{t.querySelectorAll(".radcal-pattern-option").forEach(a=>a.removeClass("is-selected")),n.addClass("is-selected"),this.selectedPattern=e})}}renderOpacitySection(i){i.createEl("h3",{text:"Opacity"});let t=i.createDiv({cls:"radcal-opacity-section"}),e=t.createDiv({cls:"radcal-opacity-value"});e.textContent=`${this.selectedOpacity}%`;let n=t.createEl("input",{type:"range",cls:"radcal-opacity-slider"});n.setAttribute("min","0"),n.setAttribute("max","100"),n.setAttribute("step","5"),n.value=String(this.selectedOpacity),n.addEventListener("input",()=>{this.selectedOpacity=parseInt(n.value,10),e.textContent=`${this.selectedOpacity}%`});let r=t.createDiv({cls:"radcal-opacity-presets"});for(let a of[25,50,75,100]){let s=r.createEl("button",{text:`${a}%`,cls:`radcal-opacity-preset ${this.selectedOpacity===a?"is-selected":""}`});s.addEventListener("click",()=>{this.selectedOpacity=a,n.value=String(a),e.textContent=`${a}%`,r.querySelectorAll(".radcal-opacity-preset").forEach(o=>o.removeClass("is-selected")),s.addClass("is-selected")})}}async applyChanges(){try{await this.app.fileManager.processFrontMatter(this.file,i=>{this.selectedColor&&(i["radcal-color"]=this.selectedColor),this.selectedPattern&&(i["radcal-pattern"]=this.selectedPattern),this.selectedOpacity!==100?i["radcal-opacity"]=this.selectedOpacity:delete i["radcal-opacity"]}),new Tt.Notice("Appearance updated"),this.onSave(),this.close()}catch(i){console.error("Failed to update appearance:",i),new Tt.Notice("Failed to update appearance")}}isValidColor(i){return typeof i=="string"&&i in E}isValidPattern(i){return typeof i=="string"&&nt.includes(i)}}});var aa={};Ze(aa,{default:()=>Qe});module.exports=re(aa);var q=require("obsidian");var ae=class{constructor(i){this.app=i}getAllMarkdownFiles(){return this.app.vault.getMarkdownFiles().map(t=>this.toFileInfo(t))}getMarkdownFilesInFolder(i){return this.getAllMarkdownFiles().filter(t=>t.folderPath?t.folderPath===i||t.folderPath.startsWith(i+"/"):!1)}getFileByPath(i){let t=this.app.vault.getAbstractFileByPath(i);return t instanceof this.getTFileClass()?t:null}async readFile(i){let t=this.getFileByPath(i);if(!t)return null;try{return await this.app.vault.read(t)}catch(e){return null}}async createOrOpenDailyNote(i,t=""){let e=this.getFileByPath(i);if(!e){let n=i.substring(0,i.lastIndexOf("/"));n&&await this.ensureFolderExists(n),e=await this.app.vault.create(i,t)}return e}async ensureFolderExists(i){this.app.vault.getAbstractFileByPath(i)||await this.app.vault.createFolder(i)}fileExists(i){return this.getFileByPath(i)!==null}getRoot(){return this.app.vault.getRoot()}toFileInfo(i){var t,e;return Object.freeze({path:i.path,basename:i.basename,name:i.name,extension:i.extension,folderPath:(e=(t=i.parent)==null?void 0:t.path)!=null?e:null})}getTFileClass(){let i=this.app.vault.getMarkdownFiles();return i.length>0?i[0].constructor:class{}}};var se=class{constructor(i){this.app=i}getMetadata(i){let t=this.app.metadataCache.getFileCache(i);return this.extractMetadata(t)}getMetadataByPath(i){let t=this.app.vault.getAbstractFileByPath(i);return!t||!this.isMarkdownFile(t)?null:this.getMetadata(t)}getProperty(i,t){var n;return(n=this.getMetadata(i).frontmatter)==null?void 0:n[t]}getStringProperty(i,t){let e=this.getProperty(i,t);return typeof e=="string"?e:e instanceof Date?this.formatDate(e):typeof e=="number"?String(e):null}getDateProperty(i,t){let e=this.getProperty(i,t);if(!e)return null;if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;let n=e.match(/^(\d{4}-\d{2}-\d{2})/);return n?n[1]:null}return e instanceof Date&&!isNaN(e.getTime())?this.formatDate(e):this.isLocalDateLike(e)?this.formatLocalDate(e):null}getTags(i){return this.getMetadata(i).tags}hasTag(i,t){let e=t.startsWith("#")?t:`#${t}`;return this.getTags(i).some(r=>r.tag.toLowerCase()===e.toLowerCase())}onMetadataChange(i){let t=e=>i(e);return this.app.metadataCache.on("changed",t),()=>this.app.metadataCache.off("changed",t)}extractMetadata(i){var n;let t=(n=i==null?void 0:i.frontmatter)!=null?n:null,e=[];if(t!=null&&t.tags){let r=Array.isArray(t.tags)?t.tags:[t.tags];for(let a of r)if(typeof a=="string"){let s=a.startsWith("#")?a:`#${a}`;e.push({tag:s,name:s.substring(1)})}}if(i!=null&&i.tags)for(let r of i.tags)e.find(s=>s.tag.toLowerCase()===r.tag.toLowerCase())||e.push({tag:r.tag,name:r.tag.substring(1)});return Object.freeze({frontmatter:t,tags:Object.freeze(e)})}formatDate(i){let t=i.getFullYear(),e=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0");return`${t}-${e}-${n}`}formatLocalDate(i){let t=i.year,e=String(i.month).padStart(2,"0"),n=String(i.day).padStart(2,"0");return`${t}-${e}-${n}`}isLocalDateLike(i){return typeof i=="object"&&i!==null&&"year"in i&&"month"in i&&"day"in i&&typeof i.year=="number"&&typeof i.month=="number"&&typeof i.day=="number"}isMarkdownFile(i){return typeof i=="object"&&i!==null&&"extension"in i&&i.extension==="md"}};J();var de=class{constructor(i={}){var t,e;this.entriesByPath=new Map,this.entriesByDate=new Map,this.multiDayEntriesByDate=new Map,this.anniversaryEntriesByMonthDay=new Map,this.stats={hits:0,misses:0,lastRebuild:0},this.config={maxEntries:(t=i.maxEntries)!=null?t:1e4,debug:(e=i.debug)!=null?e:!1}}addEntry(i){if(this.removeEntry(i.id),this.entriesByPath.set(i.id,i),i.isAnniversary){let e=this.monthDayKey(i.startDate.month,i.startDate.day);this.addToDateIndex(e,i,this.anniversaryEntriesByMonthDay),this.log(`Added anniversary entry: ${i.filePath}`);return}let t=yt(i.startDate);this.addToDateIndex(t,i,this.entriesByDate),i.isMultiDay&&i.endDate&&this.indexMultiDayEntry(i),this.log(`Added entry: ${i.filePath}`)}monthDayKey(i,t){return`${String(i).padStart(2,"0")}-${String(t).padStart(2,"0")}`}removeEntry(i){let t=this.entriesByPath.get(i);if(!t)return;if(this.entriesByPath.delete(i),t.isAnniversary){let n=this.monthDayKey(t.startDate.month,t.startDate.day);this.removeFromDateIndex(n,t.id,this.anniversaryEntriesByMonthDay),this.log(`Removed anniversary entry: ${i}`);return}let e=yt(t.startDate);this.removeFromDateIndex(e,t.id,this.entriesByDate),t.isMultiDay&&t.endDate&&this.removeMultiDayEntry(t),this.log(`Removed entry: ${i}`)}getEntriesForDate(i){var o,l,c;let t=yt(i),e=this.monthDayKey(i.month,i.day),n=(o=this.entriesByDate.get(t))!=null?o:[],r=(l=this.multiDayEntriesByDate.get(t))!=null?l:[],a=(c=this.anniversaryEntriesByMonthDay.get(e))!=null?c:[];n.length>0||r.length>0||a.length>0?this.stats.hits++:this.stats.misses++;let s=new Map;for(let d of n)s.set(d.id,d);for(let d of r)s.set(d.id,d);for(let d of a)s.set(d.id,d);return Array.from(s.values())}getEntriesInRange(i,t){var n;let e=new Map;for(let r of this.entriesByPath.values()){let a=(n=r.endDate)!=null?n:r.startDate;$(r.startDate,t)<=0&&$(a,i)>=0&&e.set(r.id,r)}return Array.from(e.values())}getMultiDayEntries(){return Array.from(this.entriesByPath.values()).filter(i=>i.isMultiDay)}getAnniversaryEntriesForDate(i){var e;let t=this.monthDayKey(i.month,i.day);return(e=this.anniversaryEntriesByMonthDay.get(t))!=null?e:[]}getAllAnniversaryEntries(){let i=[];for(let t of this.anniversaryEntriesByMonthDay.values())i.push(...t);return i}getEntryByPath(i){return this.entriesByPath.get(i)}hasEntry(i){return this.entriesByPath.has(i)}getAllEntries(){return Array.from(this.entriesByPath.values())}clear(){this.entriesByPath.clear(),this.entriesByDate.clear(),this.multiDayEntriesByDate.clear(),this.stats={hits:0,misses:0,lastRebuild:Date.now()},this.log("Cache cleared")}rebuild(i){this.clear(),this.stats.lastRebuild=Date.now();for(let t of i)this.addEntry(t);this.log(`Cache rebuilt with ${i.length} entries`)}getStats(){return Object.freeze({entryCount:this.entriesByPath.size,dateCount:this.entriesByDate.size+this.multiDayEntriesByDate.size,hits:this.stats.hits,misses:this.stats.misses,lastRebuild:this.stats.lastRebuild})}indexMultiDayEntry(i){if(!i.endDate)return;let t=i.startDate,e=i.endDate;for(;$(t,e)<0;)if(t=this.addOneDay(t),$(t,e)<=0){let n=yt(t);this.addToDateIndex(n,i,this.multiDayEntriesByDate)}}removeMultiDayEntry(i){if(!i.endDate)return;let t=i.startDate,e=i.endDate;for(;$(t,e)<0;)if(t=this.addOneDay(t),$(t,e)<=0){let n=yt(t);this.removeFromDateIndex(n,i.id,this.multiDayEntriesByDate)}}addToDateIndex(i,t,e){let n=e.get(i);n?n.push(t):e.set(i,[t])}removeFromDateIndex(i,t,e){let n=e.get(i);if(!n)return;let r=n.filter(a=>a.id!==t);r.length===0?e.delete(i):e.set(i,r)}addOneDay(i){let t=i.day+1,e=i.month,n=i.year,r=this.getDaysInMonth(n,e);return t>r&&(t=1,e+=1,e>12&&(e=1,n+=1)),{year:n,month:e,day:t}}getDaysInMonth(i,t){let e=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2?i%4===0&&i%100!==0||i%400===0?29:28:e[t-1]}log(i){this.config.debug&&console.log(`[EntryCache] ${i}`)}};var ue=class ue{parseDate(i){if(i==null)return null;if(typeof i=="string")return this.parseDateString(i);if(i instanceof Date)return isNaN(i.getTime())?null:{year:i.getFullYear(),month:i.getMonth()+1,day:i.getDate()};if(typeof i=="object"&&i!==null){let t=i;if(typeof t.year=="number"&&typeof t.month=="number"&&typeof t.day=="number"&&this.isValidDate(t.year,t.month,t.day))return{year:t.year,month:t.month,day:t.day}}return null}parseDateString(i){let t=i.trim(),e=t.match(/^XXXX-(\d{2})-(\d{2})$/i);if(e){let o=parseInt(e[1],10),l=parseInt(e[2],10);return this.isValidDate(2e3,o,l)?{year:0,month:o,day:l}:null}let n=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!n)return null;let r=parseInt(n[1],10),a=parseInt(n[2],10),s=parseInt(n[3],10);return this.isValidDate(r,a,s)?{year:r,month:a,day:s}:null}isValidDate(i,t,e){if(i<1900||i>2100||t<1||t>12||e<1||e>31)return!1;let n=this.getDaysInMonth(i,t);return!(e>n)}getDaysInMonth(i,t){let e=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2&&this.isLeapYear(i)?29:e[t-1]}isLeapYear(i){return i%4===0&&i%100!==0||i%400===0}extractFromFilename(i){let t={start:null,end:null};if(!i||typeof i!="string")return t;let e=i.match(ue.DATE_PATTERN);return!e||e.length===0||(t.start=this.parseDate(e[0]),e.length>=2&&(t.end=this.parseDate(e[1]))),t}extractFromProperties(i,t){if(!i||typeof i!="object"||!Array.isArray(t))return null;for(let e of t){if(typeof e!="string"||!e)continue;let n=i[e];if(n==null)continue;let r=this.parseDate(n);if(r!==null)return r}return null}extractDates(i,t,e){let n={start:null,end:null},r=this.extractFromFilename(i);for(let a of e.priorities)a==="filename"?(n.start===null&&r.start!==null&&(n.start=r.start),n.end===null&&r.end!==null&&(n.end=r.end)):a==="properties"&&(n.start===null&&(n.start=this.extractFromProperties(t,e.startSources)),n.end===null&&(n.end=this.extractFromProperties(t,e.endSources)));return n}};ue.DATE_PATTERN=/(\d{4}-\d{2}-\d{2})/g;var jt=ue,ha=new jt;J();var Tr=["January","February","March","April","May","June","July","August","September","October","November","December"],he=class{getDaysInMonth(i,t){return x(i,t)}getFirstDayOfWeek(i,t){let e=C(i,t,1);return W(e)}isToday(i){let t=N();return Vt(i,t)}generateGrid(i){let t=[];for(let e=1;e<=12;e++)t.push(this.generateMonth(i,e));return{year:i,months:t}}generateMonth(i,t){let e=this.getDaysInMonth(i,t),n=this.getFirstDayOfWeek(i,t),r=[];for(let a=0;a<n;a++)r.push({date:C(i,t,1),isToday:!1,isEmpty:!0});for(let a=1;a<=e;a++){let s=C(i,t,a);r.push({date:s,isToday:this.isToday(s),isEmpty:!1})}return{month:t,name:Tr[t-1],startDayOfWeek:n,daysInMonth:e,days:r}}};J();var Pr=24,qt=class{calculateMonthSegments(i,t,e){let n=[];if($(i,t)>0)return n;let r=i.year,a=i.month,s=0;for(;s<Pr;){let o=r===i.year&&a===i.month,l=r===t.year&&a===t.month,c=o?i.day:1,d=l?t.day:x(r,a);if(n.push({year:r,month:a,startDay:c,endDay:d,entryId:e}),l)break;a++,a>12&&(a=1,r++),s++}return n}calculateBarPositions(i,t){let e=new Map;if(i.length===0)return e;let n=[...i].sort((a,s)=>a.startDay!==s.startDay?a.startDay-s.startDay:s.endDay-s.startDay-(a.endDay-a.startDay)),r=[];for(let a=0;a<=31;a++)r.push(new Set);for(let a of n){let s=(t.startDayOfWeek+a.startDay-1)%7,o=(t.startDayOfWeek+a.endDay-1)%7,l=a.endDay-a.startDay+1,c=0,d=!1;for(;!d;){let u=!0;for(let h=a.startDay;h<=a.endDay;h++)if(r[h].has(c)){u=!1;break}if(u){d=!0;for(let h=a.startDay;h<=a.endDay;h++)r[h].add(c)}else c++;if(c>100)break}e.set(a.entryId,{rowIndex:c,startColumn:s,endColumn:o,span:l})}return e}},ba=new qt;Je();J();z();J();var we=class{constructor(i,t){this.unregisterMetadataListener=null;this.eventListeners=null;this.updateSubscribers=new Set;this.vaultRepository=new ae(i),this.metadataRepository=new se(i),this.entryCache=new de({debug:!1}),this.dateEngine=new jt,this.calendarEngine=new he,this.multiDayEngine=new qt,this.settings=t,this.currentYear=N().year}async initialize(){await this.rebuildCache(),this.setupMetadataListener()}destroy(){this.unregisterMetadataListener&&(this.unregisterMetadataListener(),this.unregisterMetadataListener=null),this.eventListeners=null}setEventListeners(i){this.eventListeners=i}subscribeToUpdates(i){return this.updateSubscribers.add(i),()=>{this.updateSubscribers.delete(i)}}notifySubscribers(){for(let i of this.updateSubscribers)try{i()}catch(t){console.error("Radcal subscriber error:",t)}}async updateSettings(i){let t=this.settings.dateProperties.join(",")!==i.dateProperties.join(",")||this.settings.endDateProperties.join(",")!==i.endDateProperties.join(",")||this.settings.datePriority!==i.datePriority;this.settings=i,t&&await this.rebuildCache()}getCurrentYear(){return this.currentYear}setCurrentYear(i){var t;this.currentYear!==i&&(this.currentYear=i,(t=this.eventListeners)==null||t.onYearChanged(i))}setYear(i){this.setCurrentYear(i)}nextYear(){this.setCurrentYear(this.currentYear+1)}previousYear(){this.setCurrentYear(this.currentYear-1)}goToToday(){this.setCurrentYear(N().year)}generateCalendarGrid(){return this.calendarEngine.generateGrid(this.currentYear)}getEntriesForDate(i){return this.entryCache.getEntriesForDate(i)}getEntriesForDateInFolder(i,t){let e=this.entryCache.getEntriesForDate(i);if(!t)return e;let n=t.toLowerCase().replace(/\/$/,"");return e.filter(r=>{if(!r.path)return!1;let a=r.path.substring(0,r.path.lastIndexOf("/")).toLowerCase();return a===n||a.startsWith(n+"/")})}getMultiDayEntries(){return this.entryCache.getMultiDayEntries().filter(i=>{var r;let t={year:this.currentYear,month:1,day:1},e={year:this.currentYear,month:12,day:31},n=(r=i.endDate)!=null?r:i.startDate;return i.startDate.year===this.currentYear||i.startDate.year<this.currentYear&&n.year>=this.currentYear})}getAnniversaryEntriesForDate(i){return this.entryCache.getAnniversaryEntriesForDate(i)}getAllAnniversaryEntries(){return this.entryCache.getAllAnniversaryEntries()}calculateBarPositions(i,t){return new Map}async openDailyNote(i){let t=this.settings.dailyNoteFormat,e=this.settings.dailyNoteFolder,n=this.formatDailyNoteFilename(i,t),r=e?`${e}/${n}.md`:`${n}.md`,a=await this.vaultRepository.createOrOpenDailyNote(r);console.log(`Opening daily note: ${a.path}`)}getCacheStats(){let i=this.entryCache.getStats();return{entryCount:i.entryCount,dateCount:i.dateCount}}loadLifePhases(i,t={startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",categoryField:"phase-category"}){let e=this.vaultRepository.getAllMarkdownFiles(),n=[],r=new Set;if(i){let s=i.endsWith("/")?i:`${i}/`,o=e.filter(l=>l.path===`${i}.md`||l.path.startsWith(s));for(let l of o){let c=this.parseLifePhase(l,t);c&&(n.push(c),r.add(l.path))}}let a={startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label",categoryField:"radcal-category"};for(let s of e){if(r.has(s.path))continue;let o=this.metadataRepository.getMetadataByPath(s.path),l=o==null?void 0:o.frontmatter;if((l==null?void 0:l["radcal-showInLife"])===!0){let c=this.parseLifePhase(s,a);c&&n.push(c)}}return n.sort((s,o)=>s.startDate.year!==o.startDate.year?s.startDate.year-o.startDate.year:s.startDate.month!==o.startDate.month?s.startDate.month-o.startDate.month:s.startDate.day-o.startDate.day)}parseLifePhase(i,t){let e=this.metadataRepository.getMetadataByPath(i.path),n=e==null?void 0:e.frontmatter;if(!n)return null;let r=n[t.startDateField];if(!r||typeof r!="string")return null;let a=this.parseYAMLDate(r);if(!a)return null;let s=n[t.endDateField],o=null;s&&typeof s=="string"&&s.trim()!==""&&(o=this.parseYAMLDate(s));let l=n[t.colorField],c=this.isValidColor(l)?l:"blue",d=n[t.labelField]||i.basename,u=n[t.categoryField],h=n["radcal-ring"],p=n["radcal-pattern"],m=this.isValidPattern(p)?p:void 0,y=n["radcal-opacity"],f;if(typeof y=="number"&&y>=0&&y<=100)f=y;else if(typeof y=="string"){let I=parseInt(y,10);!isNaN(I)&&I>=0&&I<=100&&(f=I)}let S=n["radcal-fade"],A=S===!0||S==="true",w=n["radcal-icon"],M=typeof w=="string"&&w.trim()?w.trim():void 0,T=n["radcal-preset"],k=typeof T=="string"&&T.trim()?T.trim():void 0;return{filePath:i.path,label:String(d),startDate:a,endDate:o,color:c,category:u?String(u):void 0,ringName:h?String(h):void 0,pattern:m,opacity:f,fade:A,icon:M,preset:k}}isValidPattern(i){return typeof i=="string"&&nt.includes(i)}loadLifePhasesByRing(i){let t=this.loadLifePhases(i),e=new Map;for(let n of t){let r=n.ringName||"__default__",a=e.get(r)||[];a.push(n),e.set(r,a)}return e}parseYAMLDate(i){let t=i.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return null;let e=parseInt(t[1],10),n=parseInt(t[2],10),r=parseInt(t[3],10);return n<1||n>12||r<1||r>31?null:C(e,n,r)}isValidColor(i){return typeof i=="string"&&["red","orange","yellow","green","blue","purple","pink","teal","cyan","magenta","lime","amber","indigo","violet","rose","gray","slate","stone"].includes(i)}computeLifePhaseSegments(i,t,e,n,r){let a=n?this.parseYAMLDate(n)||C(t,1,1):C(t,1,1),s=C(a.year+e,a.month,a.day),o=this.daysBetweenDates(a,s),l=N(),c=new Map;if(r)for(let d of r)c.set(d.name.toLowerCase(),d);return i.map(d=>{let h=this.daysBetweenDates(a,d.startDate)/o*2*Math.PI,p,m=!1;d.endDate?p=d.endDate:(m=!0,p=s);let f=this.daysBetweenDates(a,p)/o*2*Math.PI,S;m&&(S=this.daysBetweenDates(a,l)/o*2*Math.PI);let A=d.color,w=d.pattern,M=d.opacity,T=d.icon;if(d.preset){let F=c.get(d.preset.toLowerCase());F&&(d.color==="blue"&&F.color!=="blue"&&(A=F.color),w===void 0&&F.pattern!==void 0&&(w=F.pattern),M===void 0&&F.opacity!==void 0&&(M=F.opacity),T===void 0&&F.icon!==void 0&&(T=F.icon))}let{RING_COLORS:k}=(z(),re(Ot)),I=k[A]||k.blue;return{id:d.filePath,filePath:d.filePath,label:d.label,startAngle:h,endAngle:f,color:I,entries:[],isOngoing:m,todayAngle:S,category:d.category,pattern:w,opacity:M,fade:d.fade,icon:T}})}loadSpanningArcs(i,t,e={startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label"},n){if(!i)return[];let r=this.vaultRepository.getAllMarkdownFiles(),a=[],s=new Map;if(n)for(let u of n)s.set(u.name.toLowerCase(),u);let o=i.endsWith("/")?i:`${i}/`,l=r.filter(u=>u.path===`${i}.md`||u.path.startsWith(o)),c=C(t,1,1),d=C(t,12,31);for(let u of l){let h=this.metadataRepository.getMetadataByPath(u.path),p=h==null?void 0:h.frontmatter;if(!p)continue;let m=p[e.startDateField];if(!m||typeof m!="string")continue;let y=this.parseYAMLDate(m);if(!y)continue;let f=p[e.endDateField],S=null;if(f&&typeof f=="string"&&f.trim()!==""&&(S=this.parseYAMLDate(f)),S||(S=y),S.year<t||y.year>t)continue;let A=this.compareDates(y,c)<0,w=this.compareDates(S,d)>0,M=A?c:y,T=w?d:S,k=p[e.colorField],I=this.isValidColor(k)?k:void 0,F=p[e.labelField]||u.basename,K=A?0:this.dateToYearAngle(M,t),Q=w?2*Math.PI:this.dateToYearAngle(T,t),{RING_COLORS:X}=(z(),re(Ot)),j=zt(y,S)+1,it=p["radcal-pattern"],ot=this.isValidPattern(it)?it:void 0,tt=p["radcal-opacity"],et;if(typeof tt=="number"&&tt>=0&&tt<=100)et=tt;else if(typeof tt=="string"){let Z=parseInt(tt,10);!isNaN(Z)&&Z>=0&&Z<=100&&(et=Z)}let Rt=p["radcal-fade"],Dt=Rt===!0||Rt==="true",pt=p["radcal-icon"],Ft=typeof pt=="string"&&pt.trim()?pt.trim():void 0,Mt=p["radcal-preset"],$t=typeof Mt=="string"&&Mt.trim()?Mt.trim().toLowerCase():void 0,mt=I,Wt=ot,H=et,Xe=Ft;if($t){let Z=s.get($t);Z&&(mt===void 0&&(mt=Z.color),Wt===void 0&&Z.pattern!==void 0&&(Wt=Z.pattern),H===void 0&&Z.opacity!==void 0&&(H=Z.opacity),Xe===void 0&&Z.icon!==void 0&&(Xe=Z.icon))}let Dr=mt?X[mt]:void 0;a.push({id:u.path,filePath:u.path,label:String(F),startAngle:K,endAngle:Q,color:Dr,entries:[],continuesFromPreviousYear:A,continuesIntoNextYear:w,startDate:{year:y.year,month:y.month,day:y.day},endDate:{year:S.year,month:S.month,day:S.day},durationDays:j,pattern:Wt,opacity:H,fade:Dt,icon:Xe})}return a.sort((u,h)=>u.startAngle-h.startAngle)}loadShowInAnnualArcs(i,t){let e=this.vaultRepository.getAllMarkdownFiles(),n=[],r=new Map;if(t)for(let l of t)r.set(l.name.toLowerCase(),l);let a=C(i,1,1),s=C(i,12,31),{RING_COLORS:o}=(z(),re(Ot));for(let l of e){let c=this.metadataRepository.getMetadataByPath(l.path),d=c==null?void 0:c.frontmatter;if(!d||d["radcal-showInAnnual"]!==!0)continue;let u=d["radcal-start"];if(!u||typeof u!="string")continue;let h=this.parseYAMLDate(u);if(!h)continue;let p=d["radcal-end"],m,y=!1;if(p===void 0?m=h:p===null||p===""||typeof p=="string"&&p.trim()===""?(m=s,y=!0):typeof p=="string"?m=this.parseYAMLDate(p)||h:m=h,m.year<i||h.year>i)continue;let f=this.compareDates(h,a)<0,S=y||this.compareDates(m,s)>0,A=f?a:h,w=S?s:m,M=d["radcal-color"],T=this.isValidColor(M)?M:void 0,k=d["radcal-label"]||l.basename,I=f?0:this.dateToYearAngle(A,i),F=S?2*Math.PI:this.dateToYearAngle(w,i),K=zt(h,m)+1,Q=d["radcal-pattern"],X=this.isValidPattern(Q)?Q:void 0,j=d["radcal-opacity"],it;if(typeof j=="number"&&j>=0&&j<=100)it=j;else if(typeof j=="string"){let H=parseInt(j,10);!isNaN(H)&&H>=0&&H<=100&&(it=H)}let ot=d["radcal-fade"],tt=ot===!0||ot==="true",et=d["radcal-icon"],Rt=typeof et=="string"&&et.trim()?et.trim():void 0,Dt=d["radcal-preset"],pt=typeof Dt=="string"&&Dt.trim()?Dt.trim().toLowerCase():void 0,Ft=T,Mt=X,$t=it,mt=Rt;if(pt){let H=r.get(pt);H&&(Ft===void 0&&(Ft=H.color),Mt===void 0&&H.pattern!==void 0&&(Mt=H.pattern),$t===void 0&&H.opacity!==void 0&&($t=H.opacity),mt===void 0&&H.icon!==void 0&&(mt=H.icon))}let Wt=Ft?o[Ft]:o.blue;n.push({id:l.path,filePath:l.path,label:String(k),startAngle:I,endAngle:F,color:Wt,entries:[],continuesFromPreviousYear:f,continuesIntoNextYear:S,startDate:{year:h.year,month:h.month,day:h.day},endDate:{year:m.year,month:m.month,day:m.day},durationDays:K,pattern:Mt,opacity:$t,fade:tt||y,icon:mt,isOngoing:y})}return n.sort((l,c)=>l.startAngle-c.startAngle)}dateToYearAngle(i,t){let e=this.isLeapYear(t)?366:365;return(this.getDayOfYear(i)-1)/e*2*Math.PI}compareDates(i,t){return i.year!==t.year?i.year-t.year:i.month!==t.month?i.month-t.month:i.day-t.day}daysBetweenDates(i,t){let e=new Date(i.year,i.month-1,i.day).getTime(),n=new Date(t.year,t.month-1,t.day).getTime();return Math.floor((n-e)/(1e3*60*60*24))}dateToYearFraction(i){let t=this.isLeapYear(i.year)?366:365;return(this.getDayOfYear(i)-1)/t}isLeapYear(i){return i%4===0&&i%100!==0||i%400===0}getDayOfYear(i){let t=[31,28,31,30,31,30,31,31,30,31,30,31];this.isLeapYear(i.year)&&(t[1]=29);let e=i.day;for(let n=0;n<i.month-1;n++)e+=t[n];return e}async rebuildCache(){var n;let i=this.vaultRepository.getAllMarkdownFiles(),t=[],e=this.getDateExtractionConfig();for(let r of i){let a=this.createEntriesFromFile(r,e);t.push(...a)}this.entryCache.rebuild(t),(n=this.eventListeners)==null||n.onEntriesUpdated(),this.notifySubscribers()}createEntriesFromFile(i,t){var c,d,u;let e=this.metadataRepository.getMetadataByPath(i.path),n=(c=e==null?void 0:e.frontmatter)!=null?c:null,{start:r,end:a}=this.dateEngine.extractDates(i.name,n,t),s=(n==null?void 0:n["radcal-annual"])===!0,o={};if(n)for(let[h,p]of Object.entries(n))(typeof p=="string"||typeof p=="number"||typeof p=="boolean")&&(o[h]=p);let l={tags:(d=e==null?void 0:e.tags.map(h=>h.name))!=null?d:[],folder:(u=i.folderPath)!=null?u:"",properties:o};if(s&&n){let h=[],p=this.parseFrontmatterDate(n["radcal-annual-fix"]);if(p)return h.push(lt({id:`${i.path}#fix`,filePath:i.path,fileName:i.name,displayName:i.basename,startDate:p,endDate:null,metadata:l,isAnniversary:!0})),h;let m=this.parseFrontmatterDate(n["radcal-start"]),y=this.parseFrontmatterDate(n["radcal-end"]);m&&h.push(lt({id:`${i.path}#start`,filePath:i.path,fileName:i.name,displayName:i.basename,startDate:m,endDate:null,metadata:l,isAnniversary:!0})),y&&h.push(lt({id:`${i.path}#end`,filePath:i.path,fileName:i.name,displayName:i.basename,startDate:y,endDate:null,metadata:l,isAnniversary:!0}));let f=this.settings.anniversaryDateProperties||[];for(let S of f){let A=this.parseFrontmatterDate(n[S]);if(A){let w=S.toLowerCase().replace(/\s+/g,"-");h.push(lt({id:`${i.path}#${w}`,filePath:i.path,fileName:i.name,displayName:i.basename,startDate:A,endDate:null,metadata:l,isAnniversary:!0}))}}return h.length===0&&r&&h.push(lt({id:`${i.path}#fallback`,filePath:i.path,fileName:i.name,displayName:i.basename,startDate:r,endDate:null,metadata:l,isAnniversary:!0})),h}return r?[lt({id:i.path,filePath:i.path,fileName:i.name,displayName:i.basename,startDate:r,endDate:a,metadata:l,isAnniversary:!1})]:[]}parseFrontmatterDate(i){return i?typeof i=="string"?this.parseYAMLDate(i):i instanceof Date?C(i.getFullYear(),i.getMonth()+1,i.getDate()):null:null}getDateExtractionConfig(){return{startSources:this.settings.dateProperties,endSources:this.settings.endDateProperties,priorities:this.settings.datePriority==="property"?["properties","filename"]:["filename","properties"]}}formatDailyNoteFilename(i,t){return t.replace("YYYY",String(i.year)).replace("MM",String(i.month).padStart(2,"0")).replace("DD",String(i.day).padStart(2,"0"))}setupMetadataListener(){this.unregisterMetadataListener=this.metadataRepository.onMetadataChange(i=>{this.handleFileChange(i.path)})}handleFileChange(i){var e;let t=this.vaultRepository.getAllMarkdownFiles().find(n=>n.path===i);if(t){this.entryCache.removeEntry(i),this.entryCache.removeEntry(`${i}#start`),this.entryCache.removeEntry(`${i}#end`),this.entryCache.removeEntry(`${i}#fix`),this.entryCache.removeEntry(`${i}#fallback`);let n=this.settings.anniversaryDateProperties||[];for(let s of n){let o=s.toLowerCase().replace(/\s+/g,"-");this.entryCache.removeEntry(`${i}#${o}`)}let r=this.getDateExtractionConfig(),a=this.createEntriesFromFile(t,r);for(let s of a)this.entryCache.addEntry(s)}else{this.entryCache.removeEntry(i),this.entryCache.removeEntry(`${i}#start`),this.entryCache.removeEntry(`${i}#end`),this.entryCache.removeEntry(`${i}#fix`),this.entryCache.removeEntry(`${i}#fallback`);let n=this.settings.anniversaryDateProperties||[];for(let r of n){let a=r.toLowerCase().replace(/\s+/g,"-");this.entryCache.removeEntry(`${i}#${a}`)}}(e=this.eventListeners)==null||e.onEntriesUpdated(),this.notifySubscribers()}};var ct=require("obsidian");J();z();var Kt="radial-calendar-plugin",St=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Qt=["January","February","March","April","May","June","July","August","September","October","November","December"],gn=800,b=gn/2,kt=b-20,Lt={center:.35,yearRing:.12,gap1:.01,lifePhases:.38,gap2:.01,lifeRing:.1},De=kt*Lt.center,rt=De+kt*Lt.gap1,at=rt+kt*Lt.yearRing,nr=at+kt*Lt.gap1,Me=nr+kt*Lt.lifePhases,pn=Me+kt*Lt.gap2,Pt=pn+kt*Lt.lifeRing,R=380,mn=30,B=145,hn=B+mn,Xt=B+mn*.65,qa=(R-B)/31,Kn=1,Br=20,Zn=R+2,Jn=R+8,tr=R+14,er=R+12,Gr=4;function Yr(g){if(g>=365){let i=Math.floor(g/365),t=g%365;if(t>=30){let e=Math.floor(t/30);return`${i}y ${e}m`}return`${i}y`}if(g>=30){let i=Math.floor(g/30),t=g%30;return t>0?`${i}m ${t}d`:`${i}m`}return`${g}d`}var Ce=class extends ct.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.tooltipEl=null;this.visibleRings=new Set;this.allRingNames=[]}getViewType(){return Kt}getDisplayText(){return"Radial Calendar"}getIcon(){return"circle"}initialize(t){this.config=t,this.config.service.setEventListeners({onEntriesUpdated:()=>this.render(),onYearChanged:()=>this.render()})}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("radial-calendar-plugin"),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null,this.tooltipEl=null}render(){if(!this.containerEl_||!this.config)return;let e=this.config.service.getCurrentYear(),n=document.createElement("div");n.className="rc-container";let r=document.createElement("div");if(r.className="rc-header",r.style.position="relative",r.style.zIndex="100",this.buildHeader(r,e),n.appendChild(r),this.config.settings.currentView==="life"){let l=this.buildRingFilterBar();l&&n.appendChild(l)}let s=document.createElement("div");s.className="rc-wrapper",s.style.position="relative",s.style.zIndex="1",n.appendChild(s),this.renderRadialCalendar(s,e);let o=document.createElement("div");o.className="rc-tooltip",o.style.display="none",n.appendChild(o),this.tooltipEl=o,this.containerEl_.empty(),this.containerEl_.appendChild(n)}buildHeader(t,e){if(!this.config)return;let n=this.config.settings.currentView,r=document.createElement("button");r.textContent="\u2190",r.className="rc-nav-btn",r.setAttribute("aria-label","Previous period"),r.addEventListener("click",()=>this.navigatePrevious()),t.appendChild(r);let a=document.createElement("span");a.textContent=this.getPeriodTitle(),a.className="rc-year-title",t.appendChild(a);let s=document.createElement("button");s.textContent="\u2192",s.className="rc-nav-btn",s.setAttribute("aria-label","Next period"),s.addEventListener("click",()=>this.navigateNext()),t.appendChild(s);let o=document.createElement("button");o.textContent="Today",o.className="rc-nav-btn rc-today-btn",o.setAttribute("aria-label","Go to today"),o.addEventListener("click",()=>this.navigateToToday()),t.appendChild(o);let l=document.createElement("button");l.textContent="\u21BB",l.className="rc-nav-btn rc-refresh-btn",l.setAttribute("aria-label","Refresh view"),l.addEventListener("click",()=>this.render()),t.appendChild(l);let c=document.createElement("select");c.className="rc-view-select",c.setAttribute("aria-label","Select view mode");let d=ft(this.config.settings.customPeriodString),u=d?`\u2699\uFE0F ${d.label}`:"\u2699\uFE0F Custom",h=[{value:"life",label:"\u23F3 Life"},{value:"annual",label:"\u{1F4C5} Year"},{value:"quarter",label:"\u{1F4CA} Quarter"},{value:"month",label:"\u{1F5D3}\uFE0F Month"},{value:"custom",label:u}];for(let p of h){let m=document.createElement("option");m.value=p.value,m.textContent=p.label,m.selected=n===p.value,c.appendChild(m)}c.addEventListener("change",async p=>{if(!this.config)return;let m=p.target.value,y={...this.config.settings,currentView:m};this.config.settings=y,await this.config.onSettingsChange(y),this.render()}),t.appendChild(c)}getPeriodTitle(){if(!this.config)return"";let{currentView:t,currentYear:e,currentMonth:n,currentQuarter:r,customPeriodString:a,customPeriodStart:s}=this.config.settings;switch(t){case"life":return`Life (${this.config.settings.birthYear} - ${this.config.settings.birthYear+this.config.settings.expectedLifespan})`;case"annual":return String(e);case"quarter":return`Q${r} ${e}`;case"month":return`${Qt[n-1]} ${e}`;case"custom":{let o=ft(a),l=this.parseISODate(s);if(o&&l){let c=this.addDaysToDate(l,o.days||(o.months||1)*30),d=`${St[l.month-1]} ${l.day}`,u=`${St[c.month-1]} ${c.day}`;return`${d} - ${u}`}return a}default:return String(e)}}parseISODate(t){let e=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);return e?C(parseInt(e[1]),parseInt(e[2]),parseInt(e[3])):null}addDaysToDate(t,e){let n=new Date(t.year,t.month-1,t.day);return n.setDate(n.getDate()+e-1),C(n.getFullYear(),n.getMonth()+1,n.getDate())}async navigatePrevious(){if(!this.config)return;let{currentView:t,currentYear:e,currentMonth:n,currentQuarter:r,customPeriodString:a,customPeriodStart:s}=this.config.settings,o={...this.config.settings};switch(t){case"life":return;case"annual":o.currentYear=e-1,this.config.service.setYear(e-1);break;case"quarter":r>1?o.currentQuarter=r-1:(o.currentQuarter=4,o.currentYear=e-1);break;case"month":n>1?o.currentMonth=n-1:(o.currentMonth=12,o.currentYear=e-1);break;case"custom":{let l=ft(a),c=this.parseISODate(s);if(l&&c){let d=l.days||(l.months||1)*30,u=this.subtractDaysFromDate(c,d);o.customPeriodStart=this.toISOString(u),o.currentYear=u.year}break}}this.config.settings=o,await this.config.onSettingsChange(o),this.render()}async navigateNext(){if(!this.config)return;let{currentView:t,currentYear:e,currentMonth:n,currentQuarter:r,customPeriodString:a,customPeriodStart:s}=this.config.settings,o={...this.config.settings};switch(t){case"life":return;case"annual":o.currentYear=e+1,this.config.service.setYear(e+1);break;case"quarter":r<4?o.currentQuarter=r+1:(o.currentQuarter=1,o.currentYear=e+1);break;case"month":n<12?o.currentMonth=n+1:(o.currentMonth=1,o.currentYear=e+1);break;case"custom":{let l=ft(a),c=this.parseISODate(s);if(l&&c){let d=l.days||(l.months||1)*30,u=this.addDaysToDate(c,d+1);o.customPeriodStart=this.toISOString(u),o.currentYear=u.year}break}}this.config.settings=o,await this.config.onSettingsChange(o),this.render()}subtractDaysFromDate(t,e){let n=new Date(t.year,t.month-1,t.day);return n.setDate(n.getDate()-e),C(n.getFullYear(),n.getMonth()+1,n.getDate())}toISOString(t){return`${t.year}-${String(t.month).padStart(2,"0")}-${String(t.day).padStart(2,"0")}`}async navigateToToday(){if(!this.config)return;let t=new Date,e=t.toISOString().split("T")[0],n={...this.config.settings,currentYear:t.getFullYear(),currentMonth:t.getMonth()+1,currentQuarter:Math.ceil((t.getMonth()+1)/3),customPeriodStart:e};this.config.settings=n,this.config.service.goToToday(),await this.config.onSettingsChange(n),this.render()}buildRingFilterBar(){if(!this.config)return null;let t=this.config.settings.lifePhasesFolder,e=this.config.service.loadLifePhasesByRing(t);if(this.allRingNames=Array.from(e.keys()).sort((s,o)=>s==="__default__"?1:o==="__default__"?-1:s.localeCompare(o)),this.allRingNames.length<=1)return null;this.visibleRings.size===0&&this.allRingNames.forEach(s=>this.visibleRings.add(s));let n=document.createElement("div");n.className="rc-ring-filter-bar";let r=document.createElement("button");r.className="rc-ring-chip",r.textContent="Alle",this.visibleRings.size===this.allRingNames.length&&r.classList.add("rc-ring-chip-active"),r.addEventListener("click",()=>{this.visibleRings.size===this.allRingNames.length||(this.visibleRings.clear(),this.allRingNames.forEach(s=>this.visibleRings.add(s)),this.render())}),n.appendChild(r);for(let s of this.allRingNames){let o=s==="__default__"?"Standard":s,l=document.createElement("button");l.className="rc-ring-chip",l.textContent=o,this.visibleRings.has(s)&&l.classList.add("rc-ring-chip-active"),l.addEventListener("click",()=>{this.visibleRings.has(s)?this.visibleRings.size>1&&(this.visibleRings.delete(s),this.render()):(this.visibleRings.add(s),this.render())}),n.appendChild(l)}return n}renderRadialCalendar(t,e){if(!this.config)return;let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("viewBox",`0 0 ${gn} ${gn}`),n.setAttribute("class","rc-svg"),this.svgEl=n;let{currentView:r,currentMonth:a,currentQuarter:s,customPeriodString:o,customPeriodStart:l}=this.config.settings;switch(r){case"life":this.renderNestedClock(n,e);break;case"quarter":this.renderQuarterView(n,e,s);break;case"month":this.renderMonthView(n,e,a);break;case"custom":this.renderCustomView(n,o,l);break;case"annual":default:this.renderAnnualView(n,e);break}t.appendChild(n)}renderNestedClock(t,e){if(!this.config)return;let{birthYear:n,expectedLifespan:r}=this.config.settings,a=n+r,s=N(),o=s.year-n;this.renderBackgroundCircle(t),this.renderLifeRing(t,n,a,e),this.renderLifePhasesRing(t,n,r),this.renderYearRing(t,e),this.renderLifeActsOnRing(t,n,r),this.renderNestedCenter(t,e,o),this.renderLifePositionMarker(t,n,r,s.year,"today"),e!==s.year&&this.renderLifePositionMarker(t,n,r,e,"viewed"),e===s.year&&this.renderTodayMarkerOnYearRing(t),this.renderBirthdayMarkerOnYearRing(t,e)}renderLifeRing(t,e,n,r){let a=n-e,s=N();for(let o=e;o<n;o++){let l=o-e,c=l/a*2*Math.PI,d=(l+1)/a*2*Math.PI-.01,u=o<s.year,h=o===s.year,p=o===r,y=Math.floor(l/10)%2===0,f=this.createArcPath(pn,Pt,c,d),S=document.createElementNS("http://www.w3.org/2000/svg","path");S.setAttribute("d",f);let A="rc-life-year";u&&(A+=" rc-life-year--past"),h&&(A+=" rc-life-year--current"),p&&(A+=" rc-life-year--selected"),A+=y?" rc-life-year--decade-even":" rc-life-year--decade-odd",S.setAttribute("class",A),S.setAttribute("data-year",String(o)),S.addEventListener("click",()=>{var w;(w=this.config)==null||w.service.setYear(o)}),S.addEventListener("mouseenter",w=>{this.showLifeYearTooltip(w,o,o-e)}),S.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(S)}for(let o=e+10;o<n;o+=10){let c=(o-e)/a*2*Math.PI-Math.PI/2,d=Pt-2,u=Pt+4,h=b+d*Math.cos(c),p=b+d*Math.sin(c),m=b+u*Math.cos(c),y=b+u*Math.sin(c),f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",String(h)),f.setAttribute("y1",String(p)),f.setAttribute("x2",String(m)),f.setAttribute("y2",String(y)),f.setAttribute("class","rc-decade-tick"),t.appendChild(f)}}renderLifePhasesRing(t,e,n){if(!this.config)return;let r=this.config.settings.lifePhasesFolder,a=this.config.service.loadLifePhasesByRing(r);if(a.size===0)return;let s=Array.from(a.keys()).sort((p,m)=>p==="__default__"?1:m==="__default__"?-1:p.localeCompare(m));this.visibleRings.size>0&&this.visibleRings.size<s.length&&(s=s.filter(p=>this.visibleRings.has(p)));let o=s.length;if(o===0)return;let c=(Me-nr)/o,d=2,u=this.getOrCreateDefs(t),h=this.config.settings.birthDate;s.forEach((p,m)=>{let y=a.get(p)||[];if(y.length===0)return;let f=Me-m*c-d,S=Me-(m+1)*c+d,A=this.config.settings.presets||[],w=this.config.service.computeLifePhaseSegments(y,e,n,h,A),M=new Map,T=[];for(let X of w)if(X.category){let j=M.get(X.category)||[];j.push(X),M.set(X.category,j)}else T.push(X);let k=Array.from(M.keys()).sort(),I=k.length,F=Et(T),K=T.length>0?xt(F):0,Q=I+K;if(Q!==0){k.forEach((X,j)=>{let it=M.get(X)||[],ot=Et(it),tt=xt(ot);for(let et of ot){let Rt=f-j/Q*(f-S),Dt=f-(j+1)/Q*(f-S),pt=bt(Rt,Dt,tt,et.track);this.renderLifePhaseArcWithRadii(t,u,et,pt)}});for(let X of F){let j=f-I/Q*(f-S),ot=bt(j,S,K,X.track);this.renderLifePhaseArcWithRadii(t,u,X,ot)}p!=="__default__"&&this.renderRingLabel(t,p,f,S)}})}renderRingLabel(t,e,n,r){let a=(n+r)/2,s=Math.PI,o=b+a*Math.cos(s),l=b+a*Math.sin(s),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(o-5)),c.setAttribute("y",String(l)),c.setAttribute("class","rc-ring-label"),c.setAttribute("text-anchor","end"),c.setAttribute("dominant-baseline","middle"),c.style.fontSize="10px",c.style.fill="var(--text-muted)",c.style.fontWeight="500",c.textContent=e,t.appendChild(c)}getOrCreateDefs(t){let e=t.querySelector("defs");return e||(e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(e,t.firstChild)),e}getOrCreatePattern(t,e,n){let r=`pattern-${e}-${n.replace("#","")}`;if(t.querySelector(`#${r}`))return`url(#${r})`;let a=document.createElementNS("http://www.w3.org/2000/svg","pattern");a.setAttribute("id",r),a.setAttribute("patternUnits","userSpaceOnUse"),a.setAttribute("width","10"),a.setAttribute("height","10");let s=nn[e];return s&&s(a,n),t.appendChild(a),`url(#${r})`}getOrCreateFadeGradient(t,e,n,r,a,s){if(t.querySelector(`#${e}`))return`url(#${e})`;let o=r-Math.PI/2,l=a-Math.PI/2,c=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");c.setAttribute("id",e),c.setAttribute("gradientUnits","userSpaceOnUse");let d=300,u=b+d*Math.cos(o),h=b+d*Math.sin(o),p=b+d*Math.cos(l),m=b+d*Math.sin(l);c.setAttribute("x1",String(u)),c.setAttribute("y1",String(h)),c.setAttribute("x2",String(p)),c.setAttribute("y2",String(m));let y;s===void 0||s<=0?y=0:s>=1?y=100:y=Math.round(s*100);let f=document.createElementNS("http://www.w3.org/2000/svg","stop");if(f.setAttribute("offset","0%"),f.setAttribute("stop-color",n),f.setAttribute("stop-opacity","1"),y>0&&y<100){let A=document.createElementNS("http://www.w3.org/2000/svg","stop");A.setAttribute("offset",`${y}%`),A.setAttribute("stop-color",n),A.setAttribute("stop-opacity","1"),c.appendChild(f),c.appendChild(A)}else c.appendChild(f);let S=document.createElementNS("http://www.w3.org/2000/svg","stop");return S.setAttribute("offset","100%"),S.setAttribute("stop-color",n),S.setAttribute("stop-opacity",y>=100?"1":"0.15"),c.appendChild(S),t.appendChild(c),`url(#${e})`}calculateTodayPosition(t,e){let n=new Date,r={year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate()},a=this.localDateToDays(t),s=this.localDateToDays(e),o=this.localDateToDays(r),l=s-a;return l<=0?0:(o-a)/l}localDateToDays(t){return new Date(t.year,t.month-1,t.day).getTime()/(1e3*60*60*24)}applyVisualOptions(t,e,n,r){let{pattern:a,opacity:s,fade:o,startAngle:l,endAngle:c,id:d,startDate:u,endDate:h}=r;if(a&&a!=="solid"){let p=this.getOrCreatePattern(e,a,n);t.style.fill=p}else if(o&&l!==void 0&&c!==void 0&&d){let p;u&&h&&(p=this.calculateTodayPosition(u,h));let m=`fade-${d.replace(/[^a-zA-Z0-9]/g,"-")}`,y=this.getOrCreateFadeGradient(e,m,n,l,c,p);t.style.fill=y}else t.style.fill=n;s!==void 0&&s!==100&&(t.style.fillOpacity=String(s/100))}renderLifePhaseArcWithRadii(t,e,n,r){let a=n.opacity!==void 0?n.opacity/100:1;if(n.isOngoing&&n.todayAngle!==void 0&&n.todayAngle>n.startAngle){let s=this.createArcPath(r.inner,r.outer,n.startAngle,n.todayAngle),o=document.createElementNS("http://www.w3.org/2000/svg","path");if(o.setAttribute("d",s),o.setAttribute("class","rc-life-phase"),n.pattern&&n.pattern!=="solid"){let h=this.getOrCreatePattern(e,n.pattern,n.color);o.style.fill=h}else o.style.fill=n.color;o.style.opacity=String(a);let l=this.createArcPath(r.inner,r.outer,n.todayAngle,n.endAngle),c=document.createElementNS("http://www.w3.org/2000/svg","path");if(c.setAttribute("d",l),c.setAttribute("class","rc-life-phase rc-life-phase-future"),n.pattern&&n.pattern!=="solid"){let h=this.getOrCreatePattern(e,n.pattern,n.color);c.style.fill=h}else c.style.fill=n.color;c.style.opacity=String(a*.35),n.filePath&&(o.style.cursor="pointer",c.style.cursor="pointer",o.addEventListener("click",h=>{var p;h.button===0&&!h.ctrlKey&&!h.metaKey&&((p=this.config)==null||p.openFile(n.filePath))}),c.addEventListener("click",h=>{var p;h.button===0&&!h.ctrlKey&&!h.metaKey&&((p=this.config)==null||p.openFile(n.filePath))}),o.addEventListener("contextmenu",h=>{h.preventDefault(),this.showArcContextMenu(h,n)}),c.addEventListener("contextmenu",h=>{h.preventDefault(),this.showArcContextMenu(h,n)}));let d=h=>this.showPhaseTooltip(h,n),u=()=>this.hideTooltip();o.addEventListener("mouseenter",d),o.addEventListener("mouseleave",u),c.addEventListener("mouseenter",d),c.addEventListener("mouseleave",u),t.appendChild(o),t.appendChild(c)}else{let s=this.createArcPath(r.inner,r.outer,n.startAngle,n.endAngle),o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",s),o.setAttribute("class","rc-life-phase"),this.applyVisualOptions(o,e,n.color,{pattern:n.pattern,opacity:n.opacity,fade:n.fade,startAngle:n.startAngle,endAngle:n.endAngle,id:n.id,startDate:n.startDate,endDate:n.endDate}),n.filePath&&(o.style.cursor="pointer",o.addEventListener("click",l=>{var c;l.button===0&&!l.ctrlKey&&!l.metaKey&&((c=this.config)==null||c.openFile(n.filePath))}),o.addEventListener("contextmenu",l=>{l.preventDefault(),this.showArcContextMenu(l,n)})),o.addEventListener("mouseenter",l=>{this.showPhaseTooltip(l,n)}),o.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(o)}n.label&&n.endAngle-n.startAngle>.15&&this.renderPhaseLabel(t,n,r),n.icon&&this.renderPhaseIcon(t,n,r)}renderPhaseIcon(t,e,n){let r=(n.outer+n.inner)/2,a=e.startAngle+.02,s=b+r*Math.sin(a),o=b-r*Math.cos(a),l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",String(s)),l.setAttribute("y",String(o)),l.setAttribute("class","rc-phase-icon"),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","middle"),l.textContent=e.icon,e.filePath&&(l.style.cursor="pointer",l.addEventListener("click",()=>{var c;(c=this.config)==null||c.openFile(e.filePath)})),t.appendChild(l)}showArcContextMenu(t,e){let n=new ct.Menu;n.addItem(r=>{r.setTitle("Open Note").setIcon("file-text").onClick(()=>{var a;e.filePath&&((a=this.config)==null||a.openFile(e.filePath))})}),n.addSeparator(),n.addItem(r=>{r.setTitle("Create Following Phase").setIcon("plus").onClick(()=>{this.createFollowingPhase(e)})}),n.addSeparator(),n.addItem(r=>{r.setTitle("Set Appearance...").setIcon("palette").onClick(()=>{this.showAppearanceModal(e)})}),n.showAtMouseEvent(t)}async createFollowingPhase(t){if(!this.config||!t.filePath)return;let e=t.endDate;if(e){let n=this.addOneDayToDate(e);await this.createNewPhaseNote(t,n)}else{let n=N();await this.createNewPhaseNote(t,n)}}addOneDayToDate(t){let e=new Date(t.year,t.month-1,t.day+1);return{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()}}async createNewPhaseNote(t,e){var f;if(!this.config)return;let n=this.app,r=n.vault,a=n.workspace,s=r.getAbstractFileByPath(t.filePath);if(!s||!(s instanceof ct.TFile))return;let o=n.metadataCache.getFileCache(s),l=(o==null?void 0:o.frontmatter)||{},c=`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`,d=["---",`radcal-start: ${c}`,"radcal-end: ",`radcal-color: ${l["radcal-color"]||"blue"}`,"radcal-label: ",`radcal-showInLife: ${l["radcal-showInLife"]||"true"}`];l["radcal-ring"]&&d.push(`radcal-ring: ${l["radcal-ring"]}`),l["radcal-category"]&&d.push(`radcal-category: ${l["radcal-category"]}`),l["radcal-pattern"]&&d.push(`radcal-pattern: ${l["radcal-pattern"]}`),d.push("---","","# New Phase","");let u=((f=s.parent)==null?void 0:f.path)||"",h=`Phase ${c}.md`,p=u?`${u}/${h}`:h,m=await r.create(p,d.join(`
`));await a.getLeaf(!1).openFile(m)}showAppearanceModal(t){if(!this.config||!t.filePath)return;let e=this.app,n=e.vault.getAbstractFileByPath(t.filePath);!n||!(n instanceof ct.TFile)||Promise.resolve().then(()=>(Xn(),Qn)).then(({AppearanceModal:r})=>{new r(e,n,()=>{this.render()}).open()}).catch(()=>{let{Notice:r}=require("obsidian");new r("Appearance modal not available")})}createPhaseGradient(t,e,n){let r=n.endAngle-n.startAngle,a=(n.todayAngle-n.startAngle)/r,s=Math.max(0,Math.min(100,a*100)),o=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");o.setAttribute("id",e);let l=(n.startAngle+n.endAngle)/2-Math.PI/2,c=50+50*Math.cos(n.startAngle-Math.PI/2),d=50+50*Math.sin(n.startAngle-Math.PI/2),u=50+50*Math.cos(n.endAngle-Math.PI/2),h=50+50*Math.sin(n.endAngle-Math.PI/2);o.setAttribute("x1",`${c}%`),o.setAttribute("y1",`${d}%`),o.setAttribute("x2",`${u}%`),o.setAttribute("y2",`${h}%`);let p=document.createElementNS("http://www.w3.org/2000/svg","stop");p.setAttribute("offset","0%"),p.setAttribute("stop-color",n.color),p.setAttribute("stop-opacity","1"),o.appendChild(p);let m=document.createElementNS("http://www.w3.org/2000/svg","stop");m.setAttribute("offset",`${s}%`),m.setAttribute("stop-color",n.color),m.setAttribute("stop-opacity","1"),o.appendChild(m);let y=document.createElementNS("http://www.w3.org/2000/svg","stop");y.setAttribute("offset",`${s+1}%`),y.setAttribute("stop-color",n.color),y.setAttribute("stop-opacity","0.4"),o.appendChild(y);let f=document.createElementNS("http://www.w3.org/2000/svg","stop");f.setAttribute("offset","100%"),f.setAttribute("stop-color",n.color),f.setAttribute("stop-opacity","0.15"),o.appendChild(f),t.appendChild(o)}renderPhaseLabel(t,e,n){let r=(e.startAngle+e.endAngle)/2-Math.PI/2,a=(n.inner+n.outer)/2,s=b+a*Math.cos(r),o=b+a*Math.sin(r),l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",String(s)),l.setAttribute("y",String(o)),l.setAttribute("class","rc-phase-label"),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","central");let c=(r+Math.PI/2)*180/Math.PI,d=c>90&&c<270?c+180:c;l.setAttribute("transform",`rotate(${d}, ${s}, ${o})`),l.textContent=e.label,t.appendChild(l)}showPhaseTooltip(t,e){if(!this.tooltipEl)return;let n=`<div class="rc-tooltip-date">${e.label}</div>`;e.isOngoing&&(n+='<div class="rc-tooltip-note" style="color: var(--text-accent);">Active (ongoing)</div>'),this.tooltipEl.innerHTML=n,this.tooltipEl.style.display="block",this.centerTooltip()}renderYearRing(t,e){if(!this.config)return;let n=N();for(let s=1;s<=12;s++){let o=x(e,s),l=this.monthToAngle(s),d=Math.PI/6/o,u=n.year===e&&n.month===s;for(let h=1;h<=o;h++){let p=C(e,s,h),m=W(p),y=u&&n.day===h,f=m===0||m===6,S=l+(h-1)*d,A=S+d-.002,w=this.config.service.getEntriesForDate(p),M=this.createArcPath(rt,at,S,A),T=document.createElementNS("http://www.w3.org/2000/svg","path");T.setAttribute("d",M);let k=["rc-day-arc"];y&&k.push("rc-day-arc--today"),f&&k.push("rc-day-arc--weekend"),w.length>0&&k.push("rc-day-arc--has-notes"),T.setAttribute("class",k.join(" ")),T.addEventListener("click",async()=>{var I;await((I=this.config)==null?void 0:I.service.openDailyNote(p))}),T.addEventListener("mouseenter",I=>{this.showTooltip(I,p,w)}),T.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(T)}}for(let s=1;s<=12;s++){let o=this.monthToAngle(s)-Math.PI/2,l=b+rt*Math.cos(o),c=b+rt*Math.sin(o),d=b+at*Math.cos(o),u=b+at*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(l)),h.setAttribute("y1",String(c)),h.setAttribute("x2",String(d)),h.setAttribute("y2",String(u)),h.setAttribute("class","rc-month-separator"),t.appendChild(h)}let a=(at-rt)*.1;for(let s=0;s<12;s++){let o=this.monthToAngle(s+1)+Math.PI/12,l=o-Math.PI/2,c=De+(rt-De)*.6,d=b+c*Math.cos(l),u=b+c*Math.sin(l),h=o*180/Math.PI;o>Math.PI/2&&o<3*Math.PI/2&&(h+=180);let m=document.createElementNS("http://www.w3.org/2000/svg","text");m.setAttribute("x",String(d)),m.setAttribute("y",String(u)),m.setAttribute("class","rc-month-label"),m.setAttribute("text-anchor","middle"),m.setAttribute("dominant-baseline","central"),m.setAttribute("transform",`rotate(${h}, ${d}, ${u})`),m.style.fontSize=`${a}px`,m.textContent=St[s],t.appendChild(m)}}renderLifeActsOnRing(t,e,n){if(!this.config)return;let r=this.config.settings.lifeActs;if(r.length!==0)for(let a of r){let s=a.startAge/n*2*Math.PI,o=a.endAge/n*2*Math.PI-.01,l=this.createArcPath(Pt+2,Pt+8,s,o),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("class","rc-life-act"),a.color&&(c.style.fill=E[a.color]),t.appendChild(c);let d=(s+o)/2-Math.PI/2,u=Pt+18,h=b+u*Math.cos(d),p=b+u*Math.sin(d),m=document.createElementNS("http://www.w3.org/2000/svg","text");m.setAttribute("x",String(h)),m.setAttribute("y",String(p)),m.setAttribute("class","rc-life-act-label"),m.setAttribute("text-anchor","middle"),m.setAttribute("dominant-baseline","central");let y=(d+Math.PI/2)*180/Math.PI,f=y>90&&y<270?y+180:y;m.setAttribute("transform",`rotate(${f}, ${h}, ${p})`),a.color&&(m.style.fill=E[a.color]),m.textContent=a.label,t.appendChild(m)}}renderLifePositionMarker(t,e,n,r,a){let s=r-e;if(a==="today"){let y=N(),f=y.year%4===0&&y.year%100!==0||y.year%400===0,S=f?366:365,A=[0,31,28,31,30,31,30,31,31,30,31,30,31];f&&(A[2]=29);let w=y.day;for(let M=1;M<y.month;M++)w+=A[M];s+=w/S}let o=s/n*2*Math.PI-Math.PI/2,l=pn-5,c=Pt+5,d=b+l*Math.cos(o),u=b+l*Math.sin(o),h=b+c*Math.cos(o),p=b+c*Math.sin(o),m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",String(d)),m.setAttribute("y1",String(u)),m.setAttribute("x2",String(h)),m.setAttribute("y2",String(p)),m.setAttribute("class",a==="today"?"rc-life-marker--today":"rc-life-marker--viewed"),t.appendChild(m)}renderTodayMarkerOnYearRing(t){let e=N(),n=x(e.year,e.month),r=this.monthToAngle(e.month),s=Math.PI/6/n,o=r+(e.day-.5)*s-Math.PI/2,l=b+(rt-5)*Math.cos(o),c=b+(rt-5)*Math.sin(o),d=b+(at+5)*Math.cos(o),u=b+(at+5)*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(l)),h.setAttribute("y1",String(c)),h.setAttribute("x2",String(d)),h.setAttribute("y2",String(u)),h.setAttribute("class","rc-today-marker"),t.appendChild(h)}renderBirthdayMarkerOnYearRing(t,e){if(!this.config)return;let n=this.config.settings.birthDate;if(!n)return;let r=n.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!r)return;let a=parseInt(r[2],10),s=parseInt(r[3],10),o=x(e,a),l=this.monthToAngle(a),d=Math.PI/6/o,u=l+(s-.5)*d-Math.PI/2,h=b+(rt-3)*Math.cos(u),p=b+(rt-3)*Math.sin(u),m=b+(at+3)*Math.cos(u),y=b+(at+3)*Math.sin(u),f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",String(h)),f.setAttribute("y1",String(p)),f.setAttribute("x2",String(m)),f.setAttribute("y2",String(y)),f.setAttribute("class","rc-birthday-marker"),t.appendChild(f);let S=at+12,A=b+S*Math.cos(u),w=b+S*Math.sin(u),M=document.createElementNS("http://www.w3.org/2000/svg","text");M.setAttribute("x",String(A)),M.setAttribute("y",String(w)),M.setAttribute("class","rc-birthday-icon"),M.setAttribute("text-anchor","middle"),M.setAttribute("dominant-baseline","central"),M.textContent="\u{1F382}",t.appendChild(M)}renderNestedCenter(t,e,n){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(b)),r.setAttribute("cy",String(b)),r.setAttribute("r",String(De-10)),r.setAttribute("class","rc-center"),t.appendChild(r);let a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",String(b)),a.setAttribute("y",String(b-20)),a.setAttribute("class","rc-center-year"),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","central"),a.textContent=String(e),t.appendChild(a);let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(b)),s.setAttribute("y",String(b+20)),s.setAttribute("class","rc-center-age"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=`${n} years`,t.appendChild(s)}showLifeYearTooltip(t,e,n){if(!this.tooltipEl)return;let r=`<div class="rc-tooltip-date">${e}</div>
      <div class="rc-tooltip-note">Age: ${n} years</div>`;this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block",this.centerTooltip()}renderAnnualView(t,e){this.renderBackgroundCircle(t);let n=this.getEnabledRingsSorted(),a=n.find(l=>l.ringType==="global")?this.loadShowInAnnualArcs(e):[],s=n.length,o=this.calculateRingRadii(s);n.forEach((l,c)=>{let d=o.get(c);d&&(l.ringType==="global"?a.length>0&&this.renderShowInAnnualRing(t,a,d):this.renderRing(t,e,l,d),this.renderRingSeparator(t,d.innerRadius))});for(let l=1;l<=12;l++)this.renderMonthSeparator(t,this.monthToAngle(l));this.renderLabelRingSeparator(t),this.renderOuterSegments(t,e),this.renderCenter(t,e),this.renderMonthLabels(t),this.renderTodayMarker(t,e),this.renderYearBoundaryMarker(t)}renderMonthView(t,e,n){this.renderBackgroundCircle(t);let r=x(e,n),a=N(),s=a.year===e&&a.month===n,o=this.getEnabledRingsSorted(),l=this.calculateRingRadii(o.length);o.forEach((c,d)=>{let u=l.get(d);if(u){if(c.ringType==="global"){let h=this.loadShowInAnnualArcs(e),p=this.clipArcsToMonth(h,e,n);p.length>0&&this.renderMonthArcs(t,p,u,e,n)}else this.renderMonthRing(t,e,n,c,u);this.renderRingSeparator(t,u.innerRadius)}});for(let c=1;c<=r;c++){let d=this.dayToAngleInMonth(c,r);this.renderDaySeparator(t,d)}this.renderLabelRingSeparator(t),this.renderDayLabels(t,r),this.renderMonthCenter(t,e,n),s&&this.renderTodayMarkerInMonth(t,a.day,r)}renderMonthRing(t,e,n,r,a){if(!this.config)return;let s=x(e,n),o=N(),l=r.folder;for(let c=1;c<=s;c++){let d=C(e,n,c),u=l?this.config.service.getEntriesForDateInFolder(d,l):this.config.service.getEntriesForDate(d),h=this.dayToAngleInMonth(c,s),p=this.dayToAngleInMonth(c+1,s)-.005,m=u.length>0,y=o.year===e&&o.month===n&&o.day===c,f=W(d)===0||W(d)===6,S=this.createArcPath(a.innerRadius,a.outerRadius,h,p),A=document.createElementNS("http://www.w3.org/2000/svg","path");A.setAttribute("d",S);let w="rc-day-arc";m&&(w+=" rc-day-arc--has-entries"),y&&(w+=" rc-day-arc--today"),f&&(w+=" rc-day-arc--weekend"),A.setAttribute("class",w),m&&A.setAttribute("fill",E[r.color]),A.addEventListener("mouseenter",M=>{this.showTooltip(M,d,u)}),A.addEventListener("mouseleave",()=>this.hideTooltip()),A.addEventListener("click",()=>{var M;u.length>0?(M=this.config)==null||M.openFile(u[0].filePath):this.createDailyNote(d)}),t.appendChild(A)}}dayToAngleInMonth(t,e){return(t-1)/e*2*Math.PI}renderDaySeparator(t,e){let n=e-Math.PI/2,r=b+B*Math.cos(n),a=b+B*Math.sin(n),s=b+R*Math.cos(n),o=b+R*Math.sin(n),l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",String(r)),l.setAttribute("y1",String(a)),l.setAttribute("x2",String(s)),l.setAttribute("y2",String(o)),l.setAttribute("class","rc-month-separator"),t.appendChild(l)}renderDayLabels(t,e){let n=Xt;for(let r=1;r<=e;r++){let s=this.dayToAngleInMonth(r,e)+Math.PI/e-Math.PI/2,o=b+n*Math.cos(s),l=b+n*Math.sin(s),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(o)),c.setAttribute("y",String(l)),c.setAttribute("class","rc-month-day-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central"),c.textContent=String(r),t.appendChild(c)}}renderMonthCenter(t,e,n){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(b)),r.setAttribute("cy",String(b)),r.setAttribute("r",String(B-10)),r.setAttribute("class","rc-center-bg"),t.appendChild(r);let a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",String(b)),a.setAttribute("y",String(b-10)),a.setAttribute("class","rc-center-title"),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","central"),a.textContent=Qt[n-1],t.appendChild(a);let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(b)),s.setAttribute("y",String(b+15)),s.setAttribute("class","rc-center-subtitle"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=String(e),t.appendChild(s)}renderTodayMarkerInMonth(t,e,n){let a=this.dayToAngleInMonth(e,n)+Math.PI/n-Math.PI/2,s=b+(B-5)*Math.cos(a),o=b+(B-5)*Math.sin(a),l=b+(R+5)*Math.cos(a),c=b+(R+5)*Math.sin(a),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",String(s)),d.setAttribute("y1",String(o)),d.setAttribute("x2",String(l)),d.setAttribute("y2",String(c)),d.setAttribute("class","rc-today-marker"),t.appendChild(d)}clipArcsToMonth(t,e,n){let r=C(e,n,1),a=x(e,n),s=C(e,n,a);return t.filter(o=>{if(!o.startDate||!o.endDate)return!1;let l=C(o.startDate.year,o.startDate.month,o.startDate.day),c=C(o.endDate.year,o.endDate.month,o.endDate.day);return!(c.year<e||c.year===e&&c.month<n||l.year>e||l.year===e&&l.month>n)})}renderMonthArcs(t,e,n,r,a){let s=x(r,a);for(let o of e){if(!o.startDate||!o.endDate)continue;let l=1,c=s,d=C(o.startDate.year,o.startDate.month,o.startDate.day),u=C(o.endDate.year,o.endDate.month,o.endDate.day);d.year===r&&d.month===a&&(l=d.day),u.year===r&&u.month===a&&(c=u.day);let h=this.dayToAngleInMonth(l,s),p=this.dayToAngleInMonth(c+1,s)-.005,m=this.createArcPath(n.innerRadius,n.outerRadius,h,p),y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttribute("d",m),y.setAttribute("fill",o.color),y.setAttribute("class","rc-spanning-arc"),o.opacity!==void 0&&y.setAttribute("opacity",String(o.opacity/100)),y.addEventListener("mouseenter",f=>{this.showArcTooltip(f,o)}),y.addEventListener("mouseleave",()=>this.hideTooltip()),y.addEventListener("click",()=>{var f;o.filePath&&((f=this.config)==null||f.openFile(o.filePath))}),t.appendChild(y)}}renderQuarterView(t,e,n){this.renderBackgroundCircle(t);let r=(n-1)*3+1,a=r+2,s=0;for(let u=r;u<=a;u++)s+=x(e,u);let o=N(),l=this.getEnabledRingsSorted(),c=this.calculateRingRadii(l.length);l.forEach((u,h)=>{let p=c.get(h);if(p){if(u.ringType==="global"){let m=this.loadShowInAnnualArcs(e),y=this.clipArcsToQuarter(m,e,n);y.length>0&&this.renderQuarterArcs(t,y,p,e,n,s)}else this.renderQuarterRing(t,e,n,u,p,s);this.renderRingSeparator(t,p.innerRadius)}});let d=0;for(let u=r;u<=a;u++){let h=this.dayToAngleInQuarter(d,s);this.renderMonthSeparatorAtAngle(t,h),d+=x(e,u)}if(this.renderLabelRingSeparator(t),this.renderQuarterMonthLabels(t,e,r,a,s),this.renderQuarterCenter(t,e,n),o.year===e&&o.month>=r&&o.month<=a){let u=0;for(let h=r;h<o.month;h++)u+=x(e,h);u+=o.day,this.renderTodayMarkerInQuarter(t,u,s)}}renderQuarterRing(t,e,n,r,a,s){if(!this.config)return;let o=(n-1)*3+1,l=o+2,c=N(),d=r.folder,u=0;for(let h=o;h<=l;h++){let p=x(e,h);for(let m=1;m<=p;m++){let y=C(e,h,m),f=d?this.config.service.getEntriesForDateInFolder(y,d):this.config.service.getEntriesForDate(y),S=this.dayToAngleInQuarter(u,s),A=this.dayToAngleInQuarter(u+1,s)-.002,w=f.length>0,M=c.year===e&&c.month===h&&c.day===m,T=W(y)===0||W(y)===6,k=this.createArcPath(a.innerRadius,a.outerRadius,S,A),I=document.createElementNS("http://www.w3.org/2000/svg","path");I.setAttribute("d",k);let F="rc-day-arc";w&&(F+=" rc-day-arc--has-entries"),M&&(F+=" rc-day-arc--today"),T&&(F+=" rc-day-arc--weekend"),I.setAttribute("class",F),w&&I.setAttribute("fill",E[r.color]),I.addEventListener("mouseenter",K=>{this.showTooltip(K,y,f)}),I.addEventListener("mouseleave",()=>this.hideTooltip()),I.addEventListener("click",()=>{var K;f.length>0?(K=this.config)==null||K.openFile(f[0].filePath):this.createDailyNote(y)}),t.appendChild(I),u++}}}dayToAngleInQuarter(t,e){return t/e*2*Math.PI}renderMonthSeparatorAtAngle(t,e){let n=e-Math.PI/2,r=b+B*Math.cos(n),a=b+B*Math.sin(n),s=b+R*Math.cos(n),o=b+R*Math.sin(n),l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",String(r)),l.setAttribute("y1",String(a)),l.setAttribute("x2",String(s)),l.setAttribute("y2",String(o)),l.setAttribute("class","rc-month-separator"),t.appendChild(l)}renderQuarterMonthLabels(t,e,n,r,a){let s=Xt,o=0;for(let l=n;l<=r;l++){let c=x(e,l),d=o+c/2,h=this.dayToAngleInQuarter(d,a)-Math.PI/2,p=b+s*Math.cos(h),m=b+s*Math.sin(h),y=document.createElementNS("http://www.w3.org/2000/svg","text");y.setAttribute("x",String(p)),y.setAttribute("y",String(m)),y.setAttribute("class","rc-month-label"),y.setAttribute("text-anchor","middle"),y.setAttribute("dominant-baseline","central"),y.textContent=St[l-1],t.appendChild(y),o+=c}}renderQuarterCenter(t,e,n){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(b)),r.setAttribute("cy",String(b)),r.setAttribute("r",String(B-10)),r.setAttribute("class","rc-center-bg"),t.appendChild(r);let a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",String(b)),a.setAttribute("y",String(b-10)),a.setAttribute("class","rc-center-title"),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","central"),a.textContent=`Q${n}`,t.appendChild(a);let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(b)),s.setAttribute("y",String(b+15)),s.setAttribute("class","rc-center-subtitle"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=String(e),t.appendChild(s)}renderTodayMarkerInQuarter(t,e,n){let a=this.dayToAngleInQuarter(e-.5,n)-Math.PI/2,s=b+(B-5)*Math.cos(a),o=b+(B-5)*Math.sin(a),l=b+(R+5)*Math.cos(a),c=b+(R+5)*Math.sin(a),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",String(s)),d.setAttribute("y1",String(o)),d.setAttribute("x2",String(l)),d.setAttribute("y2",String(c)),d.setAttribute("class","rc-today-marker"),t.appendChild(d)}clipArcsToQuarter(t,e,n){let r=(n-1)*3+1,a=r+2;return t.filter(s=>{if(!s.startDate||!s.endDate)return!1;let o=C(s.startDate.year,s.startDate.month,s.startDate.day),l=C(s.endDate.year,s.endDate.month,s.endDate.day),c=C(e,r,1),d=C(e,a,x(e,a));return!(l.year<e||l.year===e&&l.month<r||o.year>e||o.year===e&&o.month>a)})}renderQuarterArcs(t,e,n,r,a,s){let o=(a-1)*3+1,l=o+2;for(let c of e){if(!c.startDate||!c.endDate)continue;let d=C(c.startDate.year,c.startDate.month,c.startDate.day),u=C(c.endDate.year,c.endDate.month,c.endDate.day),h=0,p=s;if(d.year===r&&d.month>=o&&d.month<=l){for(let A=o;A<d.month;A++)h+=x(r,A);h+=d.day-1}if(u.year===r&&u.month>=o&&u.month<=l){p=0;for(let A=o;A<u.month;A++)p+=x(r,A);p+=u.day}let m=this.dayToAngleInQuarter(h,s),y=this.dayToAngleInQuarter(p,s)-.002,f=this.createArcPath(n.innerRadius,n.outerRadius,m,y),S=document.createElementNS("http://www.w3.org/2000/svg","path");S.setAttribute("d",f),S.setAttribute("fill",c.color),S.setAttribute("class","rc-spanning-arc"),c.opacity!==void 0&&S.setAttribute("opacity",String(c.opacity/100)),S.addEventListener("mouseenter",A=>{this.showArcTooltip(A,c)}),S.addEventListener("mouseleave",()=>this.hideTooltip()),S.addEventListener("click",()=>{var A;c.filePath&&((A=this.config)==null||A.openFile(c.filePath))}),t.appendChild(S)}}renderCustomView(t,e,n){this.renderBackgroundCircle(t);let r=ft(e),a=this.parseISODate(n);if(!r||!a){this.renderCustomCenter(t,"Invalid",e);return}let s=r.days||(r.months||1)*30,o=N(),l=this.getEnabledRingsSorted(),c=this.calculateRingRadii(l.length);if(l.forEach((u,h)=>{let p=c.get(h);if(p){if(u.ringType==="global"){let m=a.year,y=this.loadShowInAnnualArcs(m),f=this.clipArcsToCustomPeriod(y,a,s);f.length>0&&this.renderCustomPeriodArcs(t,f,p,a,s)}else this.renderCustomPeriodRing(t,a,s,u,p);this.renderRingSeparator(t,p.innerRadius)}}),s<=60)for(let u=0;u<s;u++){let h=this.dayToAngleInCustomPeriod(u,s);this.renderDaySeparator(t,h)}this.renderLabelRingSeparator(t),this.renderCustomPeriodLabels(t,a,s),this.renderCustomCenter(t,r.label,this.formatDateRange(a,s));let d=this.getDayOffsetFromStart(o,a);d>=0&&d<s&&this.renderTodayMarkerInCustomPeriod(t,d,s)}renderCustomPeriodRing(t,e,n,r,a){if(!this.config)return;let s=N(),o=r.folder;for(let l=0;l<n;l++){let c=this.addDaysToDate(e,l),d=o?this.config.service.getEntriesForDateInFolder(c,o):this.config.service.getEntriesForDate(c),u=this.dayToAngleInCustomPeriod(l,n),h=this.dayToAngleInCustomPeriod(l+1,n)-.005,p=d.length>0,m=s.year===c.year&&s.month===c.month&&s.day===c.day,y=W(c)===0||W(c)===6,f=this.createArcPath(a.innerRadius,a.outerRadius,u,h),S=document.createElementNS("http://www.w3.org/2000/svg","path");S.setAttribute("d",f);let A="rc-day-arc";p&&(A+=" rc-day-arc--has-entries"),m&&(A+=" rc-day-arc--today"),y&&(A+=" rc-day-arc--weekend"),S.setAttribute("class",A),p&&S.setAttribute("fill",E[r.color]),S.addEventListener("mouseenter",w=>{this.showTooltip(w,c,d)}),S.addEventListener("mouseleave",()=>this.hideTooltip()),S.addEventListener("click",()=>{var w;d.length>0?(w=this.config)==null||w.openFile(d[0].filePath):this.createDailyNote(c)}),t.appendChild(S)}}dayToAngleInCustomPeriod(t,e){return t/e*2*Math.PI}renderCustomPeriodLabels(t,e,n){let r=Xt,a=n<=14?1:n<=31?7:Math.ceil(n/12);for(let s=0;s<n;s+=a){let o=this.addDaysToDate(e,s),c=this.dayToAngleInCustomPeriod(s+.5,n)-Math.PI/2,d=b+r*Math.cos(c),u=b+r*Math.sin(c),h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttribute("x",String(d)),h.setAttribute("y",String(u)),h.setAttribute("class","rc-month-day-label"),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","central"),n<=14?h.textContent=String(o.day):h.textContent=`${St[o.month-1]} ${o.day}`,t.appendChild(h)}}renderCustomCenter(t,e,n){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(b)),r.setAttribute("cy",String(b)),r.setAttribute("r",String(B-10)),r.setAttribute("class","rc-center-bg"),t.appendChild(r);let a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",String(b)),a.setAttribute("y",String(b-10)),a.setAttribute("class","rc-center-title"),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","central"),a.textContent=e,t.appendChild(a);let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(b)),s.setAttribute("y",String(b+15)),s.setAttribute("class","rc-center-subtitle"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=n,t.appendChild(s)}renderTodayMarkerInCustomPeriod(t,e,n){let a=this.dayToAngleInCustomPeriod(e+.5,n)-Math.PI/2,s=b+(B-5)*Math.cos(a),o=b+(B-5)*Math.sin(a),l=b+(R+5)*Math.cos(a),c=b+(R+5)*Math.sin(a),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",String(s)),d.setAttribute("y1",String(o)),d.setAttribute("x2",String(l)),d.setAttribute("y2",String(c)),d.setAttribute("class","rc-today-marker"),t.appendChild(d)}formatDateRange(t,e){let n=this.addDaysToDate(t,e-1),r=`${St[t.month-1]} ${t.day}`,a=`${St[n.month-1]} ${n.day}`;return t.year!==n.year?`${r} ${t.year} - ${a} ${n.year}`:`${r} - ${a}, ${t.year}`}getDayOffsetFromStart(t,e){let n=new Date(t.year,t.month-1,t.day),r=new Date(e.year,e.month-1,e.day);return Math.floor((n.getTime()-r.getTime())/(1e3*60*60*24))}clipArcsToCustomPeriod(t,e,n){let r=this.addDaysToDate(e,n-1);return t.filter(a=>{if(!a.startDate||!a.endDate)return!1;let s=C(a.startDate.year,a.startDate.month,a.startDate.day),o=C(a.endDate.year,a.endDate.month,a.endDate.day),l=new Date(e.year,e.month-1,e.day).getTime(),c=new Date(r.year,r.month-1,r.day).getTime(),d=new Date(s.year,s.month-1,s.day).getTime();return new Date(o.year,o.month-1,o.day).getTime()>=l&&d<=c})}renderCustomPeriodArcs(t,e,n,r,a){for(let s of e){if(!s.startDate||!s.endDate)continue;let o=C(s.startDate.year,s.startDate.month,s.startDate.day),l=C(s.endDate.year,s.endDate.month,s.endDate.day),c=Math.max(0,this.getDayOffsetFromStart(o,r)),d=Math.min(a,this.getDayOffsetFromStart(l,r)+1);if(c>=a||d<=0)continue;let u=this.dayToAngleInCustomPeriod(c,a),h=this.dayToAngleInCustomPeriod(d,a)-.005,p=this.createArcPath(n.innerRadius,n.outerRadius,u,h),m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",p),m.setAttribute("fill",s.color),m.setAttribute("class","rc-spanning-arc"),s.opacity!==void 0&&m.setAttribute("opacity",String(s.opacity/100)),m.addEventListener("mouseenter",y=>{this.showArcTooltip(y,s)}),m.addEventListener("mouseleave",()=>this.hideTooltip()),m.addEventListener("click",()=>{var y;s.filePath&&((y=this.config)==null||y.openFile(s.filePath))}),t.appendChild(m)}}renderYearBoundaryMarker(t){let e=-Math.PI/2,n=b+(B-5)*Math.cos(e),r=b+(B-5)*Math.sin(e),a=b+(R+5)*Math.cos(e),s=b+(R+5)*Math.sin(e),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(n)),o.setAttribute("y1",String(r)),o.setAttribute("x2",String(a)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-year-boundary-marker"),t.appendChild(o);let l=b-R-12,c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(b)),c.setAttribute("y",String(l)),c.setAttribute("class","rc-year-boundary-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central"),c.textContent="\u25BC",t.appendChild(c)}renderLabelRingSeparator(t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(b)),e.setAttribute("cy",String(b)),e.setAttribute("r",String(hn)),e.setAttribute("class","rc-label-ring-separator"),t.appendChild(e)}renderRingSeparator(t,e){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(b)),n.setAttribute("cy",String(b)),n.setAttribute("r",String(e)),n.setAttribute("class","rc-ring-separator"),t.appendChild(n)}renderAnniversaryRing(t,e){var a;if(!this.config)return;let n=this.config.service.getAllAnniversaryEntries();if(n.length===0)return;let r=new Map;for(let s of n){let o=`${String(s.startDate.month).padStart(2,"0")}-${String(s.startDate.day).padStart(2,"0")}`,l=(a=r.get(o))!=null?a:[];l.push(s),r.set(o,l)}for(let[s,o]of r){let[l,c]=s.split("-"),d=parseInt(l,10),u=parseInt(c,10),h=x(e,d),p=this.monthToAngle(d),m=Math.PI/6,y=(u-.5)/h,f=p+y*m,S=b+er*Math.cos(f-Math.PI/2),A=b+er*Math.sin(f-Math.PI/2),w=document.createElementNS("http://www.w3.org/2000/svg","circle");w.setAttribute("cx",String(S)),w.setAttribute("cy",String(A)),w.setAttribute("r",String(Gr)),w.setAttribute("class","rc-anniversary-dot");let M=o[0];w.addEventListener("mouseenter",T=>{this.showAnniversaryTooltip(T,o)}),w.addEventListener("mouseleave",()=>this.hideTooltip()),w.addEventListener("click",()=>{var T,k;o.length===1?(T=this.config)==null||T.openFile(M.filePath):(k=this.config)==null||k.openFile(M.filePath)}),t.appendChild(w)}}showAnniversaryTooltip(t,e){if(!this.tooltipEl||e.length===0)return;let n='<div class="rc-tooltip-date">\u{1F4C5}</div>';n+='<div class="rc-tooltip-notes">';for(let r of e.slice(0,5))n+=`<div class="rc-tooltip-note">${r.displayName}</div>`;e.length>5&&(n+=`<div class="rc-tooltip-more">+${e.length-5} more</div>`),n+="</div>",this.tooltipEl.innerHTML=n,this.tooltipEl.style.display="block",this.centerTooltip()}getEnabledRingsSorted(){if(!this.config)return[];let t=this.config.settings.rings.filter(s=>s.enabled).map(s=>({...s})),e=this.config.settings.dailyNoteFolder,n=t.length>0?Math.max(...t.map(s=>s.order)):-1;t.push({id:"__daily_notes__",name:"Daily Notes",folder:(e==null?void 0:e.trim())||"",color:"blue",segmentType:"daily",enabled:!0,order:n+1});let a=(this.config.settings.calendarSources||[]).filter(s=>s.enabled&&s.showAsRing!==!1&&s.folder).map((s,o)=>({id:`__calendar_${s.id}__`,name:s.name,folder:s.folder,color:s.color,segmentType:"daily",enabled:!0,order:n+2+o,showSpanningArcs:s.showSpanningArcs!==!1,startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label"}));return t.push(...a),t.sort((s,o)=>s.order-o.order),t.forEach((s,o)=>{s.order=o}),t}calculateRingRadii(t){let e=new Map;if(t===0)return e;let n=(t-1)*Kn,r=R-hn-n,a=Math.max(Br,r/t);for(let s=0;s<t;s++){let o=R-s*(a+Kn),l=Math.max(hn,o-a);e.set(s,{outerRadius:o,innerRadius:l})}return e}renderRing(t,e,n,r){if(!this.config)return;let a=E[n.color]||E.blue,s=r.outerRadius-r.innerRadius;if(n.showSpanningArcs){let o=this.config.settings.presets||[],l=this.config.service.loadSpanningArcs(n.folder,e,{startDateField:n.startDateField||"radcal-start",endDateField:n.endDateField||"radcal-end",colorField:n.colorField||"radcal-color",labelField:n.labelField||"radcal-label"},o),c=l.length>0?Et(l):[],d=c.length>0?xt(c):0,u=d>0,h=this.ringHasDailyNotes(n,e);if(h&&!u)for(let p=1;p<=12;p++)this.renderRingMonthSegment(t,e,p,n,r,a);else if(u&&!h)for(let p of c){let m=bt(r.outerRadius,r.innerRadius,d,p.track);this.renderSpanningArc(t,p,m,n,a)}else if(u&&h){let f=d*.15,S=Math.min(.6,f),A=Math.max(.4,1-S),w={innerRadius:r.innerRadius,outerRadius:r.innerRadius+s*A};for(let k=1;k<=12;k++)this.renderRingMonthSegment(t,e,k,n,w,a);let M=r.outerRadius,T=w.outerRadius;for(let k of c){let I=bt(M,T,d,k.track);this.renderSpanningArc(t,k,I,n,a)}}else this.renderEmptyRingBackground(t,r)}else for(let o=1;o<=12;o++)this.renderRingMonthSegment(t,e,o,n,r,a)}loadShowInAnnualArcs(t){if(!this.config)return[];let e=this.config.settings.presets||[];return this.config.service.loadShowInAnnualArcs(t,e)}renderShowInAnnualRing(t,e,n){if(!this.config||e.length===0)return;let r=Et(e),a=xt(r),s=E.gray,o={name:"Global",folder:"",color:"gray",enabled:!0,order:999,showSpanningArcs:!0};for(let l of r){let c=bt(n.outerRadius,n.innerRadius,a,l.track);this.renderSpanningArc(t,l,c,o,s)}this.renderRingLabel(t,"Global",n.outerRadius,n.innerRadius)}ringHasDailyNotes(t,e){if(!this.config)return!1;for(let n=1;n<=12;n++){let r=C(e,n,1);if(this.getEntriesForRing(r,t).length>0)return!0;let s=C(e,n,15);if(this.getEntriesForRing(s,t).length>0)return!0}return!1}renderSpanningArcsRing(t,e,n,r,a){if(!this.config)return;let s=this.config.settings.presets||[],o=this.config.service.loadSpanningArcs(n.folder,e,{startDateField:n.startDateField||"radcal-start",endDateField:n.endDateField||"radcal-end",colorField:n.colorField||"radcal-color",labelField:n.labelField||"radcal-label"},s);if(o.length===0){this.renderEmptyRingBackground(t,r);return}let l=Et(o),c=xt(l);for(let d of l){let u=bt(r.outerRadius,r.innerRadius,c,d.track);this.renderSpanningArc(t,d,u,n,a)}}renderEmptyRingBackground(t,e){let n=this.createArcPath(e.innerRadius,e.outerRadius,0,2*Math.PI-.001),r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",n),r.setAttribute("class","rc-ring-arc"),r.style.fill="var(--background-secondary)",r.style.fillOpacity="0.3",t.appendChild(r)}renderSpanningArc(t,e,n,r,a){if(!this.config)return;let s=this.getOrCreateDefs(t),o=this.createArcPath(n.inner,n.outer,e.startAngle,e.endAngle),l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",o),l.setAttribute("class","rc-ring-arc");let c=e.color||a;this.applyVisualOptions(l,s,c,{pattern:e.pattern,opacity:e.opacity,fade:e.fade,startAngle:e.startAngle,endAngle:e.endAngle,id:e.id,startDate:e.startDate,endDate:e.endDate}),e.filePath&&(l.style.cursor="pointer",l.addEventListener("click",()=>{var d;(d=this.config)==null||d.openFile(e.filePath)})),l.addEventListener("mouseenter",d=>{this.showSpanningArcTooltip(d,e,r)}),l.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(l),e.continuesFromPreviousYear&&this.renderCrossYearIndicator(t,n,0,c,"start"),e.continuesIntoNextYear&&this.renderCrossYearIndicator(t,n,2*Math.PI-.001,c,"end"),e.label&&e.endAngle-e.startAngle>.26&&this.renderSpanningArcLabel(t,e,n)}renderCrossYearIndicator(t,e,n,r,a){let s=n-Math.PI/2,l=(e.outer-e.inner)*.6,c=a==="end"?e.outer:e.inner,d=b+c*Math.cos(s),u=b+c*Math.sin(s),h=s+Math.PI/2,p=a==="end"?1:-1,m=a==="end"?-1:1,y=d+p*l*.6*Math.cos(h),f=u+p*l*.6*Math.sin(h),S=p*l*.3,A=d-S*Math.cos(h),w=u-S*Math.sin(h),M=l*.4,T=A+m*M*Math.cos(s),k=w+m*M*Math.sin(s),I=A-m*M*Math.cos(s),F=w-m*M*Math.sin(s),K=`${y},${f} ${T},${k} ${I},${F}`,Q=document.createElementNS("http://www.w3.org/2000/svg","polygon");Q.setAttribute("points",K),Q.setAttribute("class","rc-cross-year-indicator"),Q.style.fill=r,t.appendChild(Q)}renderSpanningArcLabel(t,e,n){let r=(e.startAngle+e.endAngle)/2-Math.PI/2,a=(n.inner+n.outer)/2,s=b+a*Math.cos(r),o=b+a*Math.sin(r),l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",String(s)),l.setAttribute("y",String(o)),l.setAttribute("class","rc-phase-label"),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","central");let c=(r+Math.PI/2)*180/Math.PI,d=c>90&&c<270?c+180:c;l.setAttribute("transform",`rotate(${d}, ${s}, ${o})`),l.textContent=e.label,t.appendChild(l)}showSpanningArcTooltip(t,e,n){if(!this.tooltipEl)return;let r=`<div class="rc-tooltip-ring" style="color: ${e.color}">${n.name}</div>`;if(r+=`<div class="rc-tooltip-date">${e.label}</div>`,e.startDate&&e.endDate&&e.durationDays){let a=`${e.startDate.day}.${e.startDate.month}.${e.startDate.year}`,s=`${e.endDate.day}.${e.endDate.month}.${e.endDate.year}`,o=Yr(e.durationDays);r+=`<div class="rc-tooltip-duration">${a} \u2013 ${s}</div>`,r+=`<div class="rc-tooltip-duration-value">${o}</div>`}this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block",this.centerTooltip()}renderRingMonthSegment(t,e,n,r,a,s){if(!this.config)return;let o=x(e,n),l=this.monthToAngle(n),d=Math.PI/6/o,u=N(),h=u.year===e&&u.month===n,p=this.config.service.getEntriesForDate(C(e,n,1));for(let m=1;m<=o;m++){let y=C(e,n,m),f=W(y),S=h&&u.day===m,A=f===0||f===6,w=l+(m-1)*d,M=w+d-.002,T=this.getEntriesForRing(y,r);this.renderRingDayArc(t,y,w,M,S,A,T,a,s,r)}}getEntriesForRing(t,e){if(!this.config)return[];let n=this.config.service.getEntriesForDate(t);if(!e.folder||e.folder.trim()==="")return n;let r=e.folder.replace(/^\/+|\/+$/g,"");return n.filter(a=>{let o=(a.metadata.folder||"").replace(/^\/+|\/+$/g,"");return o===r||o.startsWith(r+"/")})}renderRingDayArc(t,e,n,r,a,s,o,l,c,d){if(!this.config)return;let h=(l.outerRadius-l.innerRadius)*.1,p=l.outerRadius-h,m=this.config.service.getAnniversaryEntriesForDate(e),y=m.length>0,f=this.createArcPath(l.innerRadius,p,n,r),S=document.createElementNS("http://www.w3.org/2000/svg","path");S.setAttribute("d",f);let A=["rc-day-arc",`rc-ring-${d.order}`];a&&A.push("rc-day-arc--today"),s&&A.push("rc-day-arc--weekend"),o.length>0&&A.push("rc-day-arc--has-notes"),o.length>3&&A.push("rc-day-arc--many-notes"),S.setAttribute("class",A.join(" ")),S.setAttribute("data-date",`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`),S.setAttribute("data-ring",d.id),o.length>0&&(S.style.fill=c,S.style.fillOpacity="0.6"),S.addEventListener("click",async w=>{var M;w.preventDefault(),o.length>0?this.showDayContextMenu(w,e,o):await((M=this.config)==null?void 0:M.service.openDailyNote(e))}),S.addEventListener("mouseenter",w=>{this.showRingTooltip(w,e,o,d)}),S.addEventListener("mouseleave",()=>{this.hideTooltip()}),S.addEventListener("contextmenu",w=>{w.preventDefault(),this.showDayContextMenu(w,e,o)}),t.appendChild(S),y&&this.renderAnniversaryIndicator(t,n,r,p,l.outerRadius,m,e)}renderAnniversaryIndicator(t,e,n,r,a,s,o){if(!this.config)return;let l=this.createArcPath(r,a,e,n),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("class","rc-anniversary-indicator"),c.addEventListener("click",d=>{var u;d.stopPropagation(),s.length===1?(u=this.config)==null||u.openFile(s[0].filePath):s.length>1&&this.showAnniversaryMenu(d,s)}),c.addEventListener("mouseenter",d=>{this.showAnniversaryTooltip(d,s)}),c.addEventListener("mouseleave",()=>{this.hideTooltip()}),t.appendChild(c)}showAnniversaryMenu(t,e){if(!this.config)return;let n=new ct.Menu;for(let r of e.slice(0,15))n.addItem(a=>{a.setTitle(r.displayName).setIcon("cake").onClick(()=>{var s;(s=this.config)==null||s.openFile(r.filePath)})});e.length>15&&n.addItem(r=>{r.setTitle(`+${e.length-15} more...`).setDisabled(!0)}),n.showAtMouseEvent(t)}showRingTooltip(t,e,n,r){if(!this.tooltipEl)return;let o=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][W(e)]}, ${Qt[e.month-1]} ${e.day}, ${e.year}`}</div>`;if(o+=`<div class="rc-tooltip-ring" style="color: ${E[r.color]}">${r.name}</div>`,n.length>0){o+='<div class="rc-tooltip-notes">';for(let l of n.slice(0,5))o+=`<div class="rc-tooltip-note">${l.displayName}</div>`;n.length>5&&(o+=`<div class="rc-tooltip-more">+${n.length-5} more</div>`),o+="</div>"}this.tooltipEl.innerHTML=o,this.tooltipEl.style.display="block",this.centerTooltip()}renderBackgroundCircle(t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(b)),e.setAttribute("cy",String(b)),e.setAttribute("r",String(R)),e.setAttribute("class","rc-background"),t.appendChild(e)}renderCenter(t,e){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(b)),n.setAttribute("cy",String(b)),n.setAttribute("r",String(B-10)),n.setAttribute("class","rc-center"),t.appendChild(n)}renderMonthLabels(t){let e=mn*.4;for(let n=0;n<12;n++){let r=this.monthToAngle(n+1)+Math.PI/12,a=b+Xt*Math.cos(r-Math.PI/2),s=b+Xt*Math.sin(r-Math.PI/2),o=r*180/Math.PI;r>Math.PI/2&&r<3*Math.PI/2&&(o+=180);let c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(a)),c.setAttribute("y",String(s)),c.setAttribute("class","rc-month-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central"),c.setAttribute("transform",`rotate(${o}, ${a}, ${s})`),c.style.fontSize=`${e}px`,c.textContent=St[n],t.appendChild(c)}}renderMonthSegment(t,e,n){if(!this.config)return;let r=x(e,n),a=this.monthToAngle(n),o=Math.PI/6/r,l=N(),c=l.year===e&&l.month===n;for(let d=1;d<=r;d++){let u=C(e,n,d),h=W(u),p=c&&l.day===d,m=h===0||h===6,y=a+(d-1)*o,f=y+o-.002,S=this.config.service.getEntriesForDate(u);this.renderDayArc(t,u,y,f,p,m,S)}this.renderMonthSeparator(t,a)}renderDayArc(t,e,n,r,a,s,o){if(!this.config)return;let l=B,c=R,d=this.createArcPath(l,c,n,r),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",d);let h=["rc-day-arc"];a&&h.push("rc-day-arc--today"),s&&h.push("rc-day-arc--weekend"),o.length>0&&h.push("rc-day-arc--has-notes"),o.length>3&&h.push("rc-day-arc--many-notes"),u.setAttribute("class",h.join(" ")),u.setAttribute("data-date",`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`),u.addEventListener("click",async p=>{var m;p.preventDefault(),await((m=this.config)==null?void 0:m.service.openDailyNote(e))}),u.addEventListener("mouseenter",p=>{this.showTooltip(p,e,o)}),u.addEventListener("mouseleave",()=>{this.hideTooltip()}),u.addEventListener("contextmenu",p=>{p.preventDefault(),o.length>0&&this.showDayContextMenu(p,e,o)}),t.appendChild(u),o.length>0&&this.renderNoteIndicators(t,n,r,o)}renderNoteIndicators(t,e,n,r){let a=R-15,s=R-5,o=Math.min(r.length,3),l=(n-e)/o;for(let c=0;c<o;c++){let d=e+c*l+.001,u=d+l-.002,h=this.createArcPath(a,s,d,u),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",h),p.setAttribute("class","rc-note-indicator"),t.appendChild(p)}}renderMonthSeparator(t,e){let n=b+B*Math.cos(e-Math.PI/2),r=b+B*Math.sin(e-Math.PI/2),a=b+R*Math.cos(e-Math.PI/2),s=b+R*Math.sin(e-Math.PI/2),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(n)),o.setAttribute("y1",String(r)),o.setAttribute("x2",String(a)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-month-separator"),t.appendChild(o)}renderTodayMarker(t,e){let n=N();if(n.year!==e)return;let r=x(e,n.month),a=this.monthToAngle(n.month),o=Math.PI/6/r,l=a+(n.day-.5)*o,c=b+(B-10)*Math.cos(l-Math.PI/2),d=b+(B-10)*Math.sin(l-Math.PI/2),u=b+(R+5)*Math.cos(l-Math.PI/2),h=b+(R+5)*Math.sin(l-Math.PI/2),p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttribute("x1",String(c)),p.setAttribute("y1",String(d)),p.setAttribute("x2",String(u)),p.setAttribute("y2",String(h)),p.setAttribute("class","rc-today-marker"),t.appendChild(p)}createArcPath(t,e,n,r){let a=n-Math.PI/2,s=r-Math.PI/2,o=b+t*Math.cos(a),l=b+t*Math.sin(a),c=b+t*Math.cos(s),d=b+t*Math.sin(s),u=b+e*Math.cos(a),h=b+e*Math.sin(a),p=b+e*Math.cos(s),m=b+e*Math.sin(s),y=r-n>Math.PI?1:0;return`
      M ${o} ${l}
      L ${u} ${h}
      A ${e} ${e} 0 ${y} 1 ${p} ${m}
      L ${c} ${d}
      A ${t} ${t} 0 ${y} 0 ${o} ${l}
      Z
    `}monthToAngle(t){return(t-1)*Math.PI/6}showTooltip(t,e,n){if(!this.tooltipEl)return;let s=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][W(e)]}, ${Qt[e.month-1]} ${e.day}, ${e.year}`}</div>`;if(n.length>0){s+='<div class="rc-tooltip-notes">';for(let o of n.slice(0,5))s+=`<div class="rc-tooltip-note">${o.displayName}</div>`;n.length>5&&(s+=`<div class="rc-tooltip-more">+${n.length-5} more</div>`),s+="</div>"}this.tooltipEl.innerHTML=s,this.tooltipEl.style.display="block",this.centerTooltip()}hideTooltip(){this.tooltipEl&&(this.tooltipEl.style.display="none")}centerTooltip(){if(!this.tooltipEl||!this.containerEl_)return;let t=this.containerEl_.getBoundingClientRect();this.tooltipEl.style.left="50%",this.tooltipEl.style.top="50%",this.tooltipEl.style.transform="translate(-50%, -50%)"}showDayContextMenu(t,e,n){if(!this.config)return;let r=new ct.Menu;r.addItem(a=>{a.setTitle(`Open ${Qt[e.month-1]} ${e.day}`).setIcon("calendar").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(e))})}),r.addSeparator();for(let a of n.slice(0,10))r.addItem(s=>{s.setTitle(a.displayName).setIcon("file").onClick(()=>{var o;(o=this.config)==null||o.openFile(a.filePath)})});n.length>10&&r.addItem(a=>{a.setTitle(`+${n.length-10} more...`).setDisabled(!0)}),r.showAtMouseEvent(t)}renderOuterSegments(t,e){if(!this.config)return;let n=this.getSegmentsForCurrentView();if(n.length!==0)for(let r of n)this.renderSegmentTick(t,r,e)}getSegmentsForCurrentView(){if(!this.config)return[];let t=this.config.settings;if(t.currentView==="life")return this.lifeActsToSegments(t.lifeActs);switch(t.annualSegmentType){case"seasons":return sn;case"quarters":return on;case"semester":return ln;case"ten-days":return cn();case"weeks":return dn();case"custom":return t.customSegments;case"none":default:return[]}}lifeActsToSegments(t){if(!this.config)return[];let{birthYear:e,expectedLifespan:n}=this.config.settings,r=n;return t.map(a=>{let s=Math.floor(a.startAge/r*365)+1,o=Math.floor(a.endAge/r*365);return{id:a.id,label:a.label,startDay:s,endDay:o,color:a.color}})}renderSegmentTick(t,e,n){if(!this.config)return;let r=this.config.settings.showSegmentLabels,a=this.dayOfYearToAngle(e.startDay),s=e.endDay>e.startDay?this.dayOfYearToAngle(e.endDay):this.dayOfYearToAngle(e.endDay)+2*Math.PI,o=a-Math.PI/2,l=b+Zn*Math.cos(o),c=b+Zn*Math.sin(o),d=b+Jn*Math.cos(o),u=b+Jn*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");if(h.setAttribute("x1",String(l)),h.setAttribute("y1",String(c)),h.setAttribute("x2",String(d)),h.setAttribute("y2",String(u)),h.setAttribute("class","rc-segment-tick"),e.color&&(h.style.stroke=E[e.color]),t.appendChild(h),r){let p;e.endDay>e.startDay?p=(a+s)/2:(p=(a+s)/2,p>2*Math.PI&&(p-=2*Math.PI));let m=p-Math.PI/2,y=b+tr*Math.cos(m),f=b+tr*Math.sin(m),S=document.createElementNS("http://www.w3.org/2000/svg","text");S.setAttribute("x",String(y)),S.setAttribute("y",String(f)),S.setAttribute("class","rc-segment-label"),S.setAttribute("text-anchor","middle"),S.setAttribute("dominant-baseline","central");let A=p*180/Math.PI,w=A>90&&A<270?A+180:A;S.setAttribute("transform",`rotate(${w}, ${y}, ${f})`),e.color&&(S.style.fill=E[e.color]),S.textContent=e.label,t.appendChild(S)}}dayOfYearToAngle(t){return(t-1)/365*2*Math.PI}};var Te=require("obsidian");J();var _r=["January","February","March","April","May","June","July","August","September","October","November","December"],te="local-calendar-view",yn=300,V=yn/2,Zt=140,Ee=115,Jt=105,Bt=40,Hr=35,xe=class extends Te.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.activeFileDate=null}getViewType(){return te}getDisplayText(){return"Local Calendar"}getIcon(){return"clock"}initialize(t){this.config=t,this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updateActiveFileDate(),this.render()})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.updateActiveFileDate(),this.render()}))}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("local-calendar-view"),this.updateActiveFileDate(),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null}updateActiveFileDate(){this.config&&(this.activeFileDate=this.config.getActiveFileDate())}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let t=this.containerEl_.createDiv({cls:"lc-container"}),e=t.createDiv({cls:"lc-title"});this.activeFileDate?e.textContent=`${this.activeFileDate.day}.${this.activeFileDate.month}.${this.activeFileDate.year}`:e.textContent="Keine Datums-Notiz";let n=t.createDiv({cls:"lc-wrapper"});this.renderNestedClock(n)}renderNestedClock(t){if(!this.config)return;let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox",`0 0 ${yn} ${yn}`),e.setAttribute("class","lc-svg"),this.svgEl=e;let{birthYear:n,expectedLifespan:r}=this.config.settings,a=n+r,s=N(),o=this.activeFileDate||s,l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttribute("cx",String(V)),l.setAttribute("cy",String(V)),l.setAttribute("r",String(Zt)),l.setAttribute("class","lc-background"),e.appendChild(l),this.renderLifeRing(e,n,a,o.year,s.year),this.renderYearRing(e,o,s),this.renderCenter(e,o),this.activeFileDate&&this.renderNoteMarkers(e,n,r,this.activeFileDate),(!this.activeFileDate||this.activeFileDate.year!==s.year||this.activeFileDate.month!==s.month||this.activeFileDate.day!==s.day)&&this.renderTodayMarkers(e,n,r,s),t.appendChild(e)}renderLifeRing(t,e,n,r,a){let s=n-e;for(let o=0;o<s;o+=10){let l=o/s*2*Math.PI,c=Math.min((o+10)/s*2*Math.PI,2*Math.PI)-.02,d=this.createArcPath(Ee,Zt,l,c),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",d);let h=e+o,p=h+10<=a,m=h<=a&&a<h+10,y="lc-life-decade";p&&(y+=" lc-life-decade--past"),m&&(y+=" lc-life-decade--current"),u.setAttribute("class",y),t.appendChild(u);let f=(o+5)/s*2*Math.PI-Math.PI/2,S=(Ee+Zt)/2,A=V+S*Math.cos(f),w=V+S*Math.sin(f),M=document.createElementNS("http://www.w3.org/2000/svg","text");M.setAttribute("x",String(A)),M.setAttribute("y",String(w)),M.setAttribute("class","lc-decade-label"),M.setAttribute("text-anchor","middle"),M.setAttribute("dominant-baseline","central"),M.textContent=String(e+o),t.appendChild(M)}}renderYearRing(t,e,n){if(!this.config)return;let r=e.year;for(let s=1;s<=12;s++){let o=x(r,s),l=this.monthToAngle(s),d=Math.PI/6/o;for(let u=1;u<=o;u++){let h=C(r,s,u),p=W(h),m=n.year===r&&n.month===s&&n.day===u,y=e.month===s&&e.day===u,f=p===0||p===6,S=l+(u-1)*d,A=S+d-.002,w=this.config.service.getEntriesForDate(h),M=this.createArcPath(Bt,Jt,S,A),T=document.createElementNS("http://www.w3.org/2000/svg","path");T.setAttribute("d",M);let k=["lc-day"];m&&k.push("lc-day--today"),y&&k.push("lc-day--note"),f&&k.push("lc-day--weekend"),w.length>0&&k.push("lc-day--has-notes"),w.length>2&&k.push("lc-day--many-notes"),T.setAttribute("class",k.join(" ")),T.style.cursor="pointer",T.addEventListener("click",I=>{var F;I.preventDefault(),I.stopPropagation(),w.length>0?this.showDayContextMenu(I,h,w):(F=this.config)==null||F.service.openDailyNote(h)}),t.appendChild(T)}}for(let s=1;s<=12;s++){let o=this.monthToAngle(s)-Math.PI/2,l=V+Bt*Math.cos(o),c=V+Bt*Math.sin(o),d=V+Jt*Math.cos(o),u=V+Jt*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(l)),h.setAttribute("y1",String(c)),h.setAttribute("x2",String(d)),h.setAttribute("y2",String(u)),h.setAttribute("class","lc-month-separator"),t.appendChild(h)}let a=["J","F","M","A","M","J","J","A","S","O","N","D"];for(let s=0;s<12;s++){let o=this.monthToAngle(s+1)+Math.PI/12-Math.PI/2,l=Bt-8,c=V+l*Math.cos(o),d=V+l*Math.sin(o),u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",String(c)),u.setAttribute("y",String(d)),u.setAttribute("class","lc-month-label"),u.setAttribute("text-anchor","middle"),u.setAttribute("dominant-baseline","central"),u.textContent=a[s],t.appendChild(u)}}monthToAngle(t){return(t-1)*Math.PI/6}renderCenter(t,e){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(V)),n.setAttribute("cy",String(V)),n.setAttribute("r",String(Hr-5)),n.setAttribute("class","lc-center"),t.appendChild(n);let r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",String(V)),r.setAttribute("y",String(V)),r.setAttribute("class","lc-center-day"),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.textContent=String(e.day),t.appendChild(r)}renderNoteMarkers(t,e,n,r){let s=(r.year-e)/n*2*Math.PI-Math.PI/2;this.drawMarker(t,s,Ee-3,Zt+3,"lc-marker--note");let o=this.dateToAngle(r);this.drawMarker(t,o,Bt-3,Jt+3,"lc-marker--note")}renderTodayMarkers(t,e,n,r){let s=(r.year-e)/n*2*Math.PI-Math.PI/2;this.drawMarker(t,s,Ee,Zt,"lc-marker--today");let o=this.dateToAngle(r);this.drawMarker(t,o,Bt,Jt,"lc-marker--today")}dateToAngle(t){let e=x(t.year,t.month),n=this.monthToAngle(t.month),a=Math.PI/6/e;return n+(t.day-.5)*a-Math.PI/2}drawMarker(t,e,n,r,a){let s=V+n*Math.cos(e),o=V+n*Math.sin(e),l=V+r*Math.cos(e),c=V+r*Math.sin(e),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",String(s)),d.setAttribute("y1",String(o)),d.setAttribute("x2",String(l)),d.setAttribute("y2",String(c)),d.setAttribute("class",a),t.appendChild(d)}showDayContextMenu(t,e,n){if(!this.config)return;let r=new Te.Menu;if(r.addItem(a=>{a.setTitle(`${e.day}. ${_r[e.month-1]} ${e.year}`).setIcon("calendar").setDisabled(!0)}),r.addSeparator(),r.addItem(a=>{a.setTitle("Neue Notiz erstellen").setIcon("plus").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(e))})}),n.length>0){r.addSeparator();for(let a of n.slice(0,10))r.addItem(s=>{s.setTitle(a.displayName).setIcon("file").onClick(async()=>{var o;await((o=this.config)==null?void 0:o.openFile(a.filePath))})});n.length>10&&r.addItem(a=>{a.setTitle(`+${n.length-10} weitere...`).setDisabled(!0)})}r.showAtMouseEvent(t)}createArcPath(t,e,n,r){let a=n-Math.PI/2,s=r-Math.PI/2,o=V+t*Math.cos(a),l=V+t*Math.sin(a),c=V+t*Math.cos(s),d=V+t*Math.sin(s),u=V+e*Math.cos(a),h=V+e*Math.sin(a),p=V+e*Math.cos(s),m=V+e*Math.sin(s),y=r-n>Math.PI?1:0;return`
      M ${o} ${l}
      L ${u} ${h}
      A ${e} ${e} 0 ${y} 1 ${p} ${m}
      L ${c} ${d}
      A ${t} ${t} 0 ${y} 0 ${o} ${l}
      Z
    `}};var At=require("obsidian");z();var ee="memento-mori-view",bn=600,L=bn/2,rr=280,fn=40,ar=3,U="http://www.w3.org/2000/svg",Wr={hour:null,day:"periodic-notes:open-daily-note","custom-short":null,month:"periodic-notes:open-monthly-note",season:"periodic-notes:open-quarterly-note",year:"periodic-notes:open-yearly-note",life:null},Pe=class extends At.ItemView{constructor(t,e,n,r,a="",s="YYYY-MM-DD"){super(t);this.updateInterval=null;this.todayTimeBlocks=[];this.weeklyTimeBlocks=[];this.monthlyTimeBlocks=[];this.settings=e||be,this.birthDate=new Date(n||"1990-01-01"),this.lifeExpectancy=r||85,this.dailyNoteFolder=a,this.dailyNoteFormat=s}getViewType(){return ee}getDisplayText(){return"Memento Mori"}getIcon(){return"clock"}async onOpen(){await this.loadAllTimeBlocks(),this.render(),this.startUpdates()}async loadAllTimeBlocks(){await Promise.all([this.loadTodayTimeBlocks(),this.loadWeeklyTimeBlocks(),this.loadMonthlyTimeBlocks()])}async onClose(){this.stopUpdates()}updateSettings(t,e,n){this.settings=t,this.birthDate=new Date(e||"1990-01-01"),this.lifeExpectancy=n||85,this.render()}async loadTodayTimeBlocks(){this.todayTimeBlocks=[];try{let t=new Date,e=this.formatDate(t,this.dailyNoteFormat),r=`${this.dailyNoteFolder?`${this.dailyNoteFolder}/`:""}${e}.md`,a=this.app.vault.getAbstractFileByPath(r);if(!(a instanceof At.TFile))return;let s=await this.app.vault.read(a),o=/```radcal-day\n([\s\S]*?)```/g,l;for(;(l=o.exec(s))!==null;){let c=l[1],d=this.parseTimeBlocks(c);this.todayTimeBlocks.push(...d)}}catch(t){}}formatDate(t,e){let n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return e.replace("YYYY",String(n)).replace("MM",r).replace("DD",a)}parseTimeBlocks(t){let e=[],n=t.trim().split(`
`),r=!1;for(let a of n){let s=a.trim();if(s==="---"){r=!r;continue}if(r||!s)continue;let o=s.match(/^(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})\s+(.+?)(?:\s*\|\s*(\w+))?$/);o&&e.push({startHour:parseInt(o[1],10),startMinute:parseInt(o[2],10),endHour:parseInt(o[3],10),endMinute:parseInt(o[4],10),label:o[5].trim(),color:o[6]||"blue"})}return e}getPeriodicNotesSettings(){var e,n;let t=(n=(e=this.app.plugins)==null?void 0:e.plugins)==null?void 0:n["periodic-notes"];return t!=null&&t.settings?t.settings:null}async loadWeeklyTimeBlocks(){var t;this.weeklyTimeBlocks=[];try{let e=this.getPeriodicNotesSettings();if(!((t=e==null?void 0:e.weekly)!=null&&t.enabled))return;let n=e.weekly.folder||"",r=e.weekly.format||"gggg-[W]ww",a=new Date,s=this.formatWeekDate(a,r),o=n?`${n}/${s}.md`:`${s}.md`,l=this.app.vault.getAbstractFileByPath(o);if(!(l instanceof At.TFile))return;let c=await this.app.vault.read(l),d=/```radcal\n(type:\s*week[\s\S]*?)```/g,u;for(;(u=d.exec(c))!==null;){let p=u[1],m=this.parseWeeklyTimeBlocks(p);this.weeklyTimeBlocks.push(...m)}let h=/```radcal-week\n([\s\S]*?)```/g;for(;(u=h.exec(c))!==null;){let p=u[1],m=this.parseWeeklyTimeBlocks(p);this.weeklyTimeBlocks.push(...m)}}catch(e){}}formatWeekDate(t,e){let n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),r=n.getUTCDay()||7;n.setUTCDate(n.getUTCDate()+4-r);let a=new Date(Date.UTC(n.getUTCFullYear(),0,1)),s=Math.ceil(((n.getTime()-a.getTime())/864e5+1)/7),o=n.getUTCFullYear(),l=String(s).padStart(2,"0");return e.replace("gggg",String(o)).replace("YYYY",String(o)).replace("[W]","W").replace("ww",l).replace("WW",l)}parseWeeklyTimeBlocks(t){let e=[],n=t.trim().split(`
`),r={sun:0,sunday:0,mon:1,monday:1,tue:2,tuesday:2,wed:3,wednesday:3,thu:4,thursday:4,fri:5,friday:5,sat:6,saturday:6},a=!1;for(let s of n){let o=s.trim();if(o==="---"){a=!a;continue}if(a||!o)continue;let l=o.match(/^(\w+)\s+(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})\s+(\w+):\s*(.+)$/);if(l){let d=l[1].toLowerCase(),u=r[d];if(u===void 0&&(u=parseInt(d,10),isNaN(u)||u<0||u>6))continue;e.push({dayOfWeek:u,startHour:parseInt(l[2],10),startMinute:parseInt(l[3],10),endHour:parseInt(l[4],10),endMinute:parseInt(l[5],10),color:l[6].toLowerCase(),label:l[7].trim()});continue}let c=o.match(/^(\w+)\s+(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})\s+(.+?)(?:\s*\|\s*(\w+))?$/);if(c){let d=c[1].toLowerCase(),u=r[d];if(u===void 0&&(u=parseInt(d,10),isNaN(u)||u<0||u>6))continue;e.push({dayOfWeek:u,startHour:parseInt(c[2],10),startMinute:parseInt(c[3],10),endHour:parseInt(c[4],10),endMinute:parseInt(c[5],10),label:c[6].trim(),color:c[7]||"blue"})}}return e}async loadMonthlyTimeBlocks(){var t;this.monthlyTimeBlocks=[];try{let e=this.getPeriodicNotesSettings();if(!((t=e==null?void 0:e.monthly)!=null&&t.enabled))return;let n=e.monthly.folder||"",r=e.monthly.format||"YYYY-MM",a=new Date,s=this.formatDate(a,r),o=n?`${n}/${s}.md`:`${s}.md`,l=this.app.vault.getAbstractFileByPath(o);if(!(l instanceof At.TFile))return;let c=await this.app.vault.read(l),d=/```radcal\n(type:\s*month[\s\S]*?)```/g,u;for(;(u=d.exec(c))!==null;){let p=u[1],m=this.parseMonthlyTimeBlocks(p);this.monthlyTimeBlocks.push(...m)}let h=/```radcal-month\n([\s\S]*?)```/g;for(;(u=h.exec(c))!==null;){let p=u[1],m=this.parseMonthlyTimeBlocks(p);this.monthlyTimeBlocks.push(...m)}}catch(e){}}parseMonthlyTimeBlocks(t){let e=[],n=t.trim().split(`
`),r=!1;for(let a of n){let s=a.trim();if(s==="---"){r=!r;continue}if(r||!s||s.startsWith("type:"))continue;let o=s.match(/^(\d{1,2})\s*-\s*(\d{1,2})\s+(\w+):\s*(.+)$/);if(o){let d=parseInt(o[1],10);if(d<1||d>31)continue;e.push({dayOfMonth:d,endDay:parseInt(o[2],10),color:o[3].toLowerCase(),label:o[4].trim()});continue}let l=s.match(/^(\d{1,2})\s+(\w+):\s*(.+)$/);if(l){let d=parseInt(l[1],10);if(d<1||d>31)continue;e.push({dayOfMonth:d,color:l[2].toLowerCase(),label:l[3].trim()});continue}let c=s.match(/^(\d{1,2})(?:\s*-\s*(\d{1,2}))?\s+(.+?)(?:\s*\|\s*(\w+))?$/);if(c){let d=parseInt(c[1],10);if(d<1||d>31)continue;let u=c[2]?parseInt(c[2],10):void 0;e.push({dayOfMonth:d,endDay:u,label:c[3].trim(),color:c[4]||"blue"})}}return e}startUpdates(){this.updateInterval=window.setInterval(()=>{this.render()},60*1e3)}stopUpdates(){this.updateInterval&&(window.clearInterval(this.updateInterval),this.updateInterval=null)}render(){let t=this.containerEl.children[1];t.empty(),t.addClass("memento-mori-container");let n=t.createDiv({cls:"memento-mori-header"}).createEl("button",{cls:"memento-refresh-btn",attr:{"aria-label":"Refresh"}});n.innerHTML="\u21BB",n.addEventListener("click",async()=>{n.addClass("memento-refresh-spinning"),await this.loadAllTimeBlocks(),this.render()});let r=t.createDiv({cls:"memento-mori-wrapper"}),a=this.settings.rings.filter(h=>h.enabled).sort((h,p)=>h.order-p.order);if(a.length===0){r.createEl("p",{text:"Keine Ringe aktiviert. Aktiviere Ringe in den Einstellungen."});return}let s=document.createElementNS(U,"svg");s.setAttribute("viewBox",`0 0 ${bn} ${bn}`),s.setAttribute("class","memento-mori-svg"),s.style.width="100%",s.style.height="auto",s.style.maxWidth="600px";let o=document.createElementNS(U,"circle");o.setAttribute("cx",String(L)),o.setAttribute("cy",String(L)),o.setAttribute("r",String(rr+10)),o.setAttribute("class","memento-bg"),s.appendChild(o);let l=a.length,c=rr-fn,d=(l-1)*ar,u=(c-d)/l;a.forEach((h,p)=>{let m=fn+p*(u+ar),y=m+u;this.renderRing(s,h,m,y)}),this.renderCenter(s),r.appendChild(s)}renderRing(t,e,n,r){let a=new Date;switch(e.id){case"hour":this.renderHourRing(t,n,r,a);break;case"day":this.renderDayRing(t,n,r,a);break;case"custom-short":this.renderCustomShortRing(t,n,r,a,e.customDays||10);break;case"month":this.renderMonthRing(t,n,r,a);break;case"season":this.renderSeasonRing(t,n,r,a,e.customMonths||3);break;case"year":this.renderYearRing(t,n,r,a);break;case"life":this.renderLifeRing(t,n,r,a);break}}renderHourRing(t,e,n,r){let a=r.getMinutes(),s=60;if(a>0){let l=this.createArc(e,n,0,a,s);l.setAttribute("class","memento-past"),t.appendChild(l)}let o=this.createArc(e,n,a,a+1,s);if(o.setAttribute("class","memento-present"),t.appendChild(o),a<59){let l=this.createArc(e,n,a+1,s,s);l.setAttribute("class","memento-future"),t.appendChild(l)}this.addRingLabel(t,n,"H")}renderDayRing(t,e,n,r){let a=r.getHours(),s=r.getMinutes(),o=a+s/60,l=24,c=document.createElementNS(U,"g");if(c.setAttribute("class","memento-ring-day"),c.style.cursor="context-menu",o>0){let h=Math.floor(o);if(h>0){let p=this.createArc(e,n,0,h,l);p.setAttribute("class","memento-past"),c.appendChild(p)}}let d=Math.floor(o),u=this.createArc(e,n,d,d+1,l);if(u.setAttribute("class","memento-present"),c.appendChild(u),d<23){let h=this.createArc(e,n,d+1,l,l);h.setAttribute("class","memento-future"),c.appendChild(h)}c.addEventListener("contextmenu",h=>{h.preventDefault(),this.showRingContextMenu(h,"day")}),t.appendChild(c),this.renderTimeBlocks(t,e,n),this.renderCurrentTimeIndicator(t,e,n,o,l),this.addRingLabel(t,n,"D")}renderTimeBlocks(t,e,n){for(let a of this.todayTimeBlocks){let s=a.startHour*60+a.startMinute,o=a.endHour*60+a.endMinute,l=this.createArcByMinutes(e,n,s,o,1440);l.setAttribute("class",`memento-block memento-block-${a.color}`),l.setAttribute("fill",this.getBlockColor(a.color)),l.setAttribute("opacity","0.7");let c=document.createElementNS(U,"title");c.textContent=`${a.startHour}:${String(a.startMinute).padStart(2,"0")} - ${a.endHour}:${String(a.endMinute).padStart(2,"0")}
${a.label}`,l.appendChild(c),t.appendChild(l)}}createArcByMinutes(t,e,n,r,a){let s=n/a*2*Math.PI-Math.PI/2,o=r/a*2*Math.PI-Math.PI/2,l=L+t*Math.cos(s),c=L+t*Math.sin(s),d=L+e*Math.cos(s),u=L+e*Math.sin(s),h=L+e*Math.cos(o),p=L+e*Math.sin(o),m=L+t*Math.cos(o),y=L+t*Math.sin(o),f=o-s>Math.PI?1:0,S=[`M ${l} ${c}`,`L ${d} ${u}`,`A ${e} ${e} 0 ${f} 1 ${h} ${p}`,`L ${m} ${y}`,`A ${t} ${t} 0 ${f} 0 ${l} ${c}`,"Z"].join(" "),A=document.createElementNS(U,"path");return A.setAttribute("d",S),A}getBlockColor(t){let e={blue:"var(--color-blue)",green:"var(--color-green)",red:"var(--color-red)",orange:"var(--color-orange)",yellow:"var(--color-yellow)",purple:"var(--color-purple)",pink:"var(--color-pink)",teal:"var(--color-cyan)",cyan:"var(--color-cyan)",gray:"var(--text-muted)",grey:"var(--text-muted)"};return e[t.toLowerCase()]||e.blue}renderCurrentTimeIndicator(t,e,n,r,a){let s=r/a*2*Math.PI-Math.PI/2,o=L+e*Math.cos(s),l=L+e*Math.sin(s),c=L+(n+2)*Math.cos(s),d=L+(n+2)*Math.sin(s),u=document.createElementNS(U,"line");u.setAttribute("x1",String(o)),u.setAttribute("y1",String(l)),u.setAttribute("x2",String(c)),u.setAttribute("y2",String(d)),u.setAttribute("class","memento-time-indicator"),u.setAttribute("stroke","var(--color-red)"),u.setAttribute("stroke-width","2"),t.appendChild(u)}renderCustomShortRing(t,e,n,r,a){let s=new Date(r.getFullYear(),0,1),l=Math.floor((r.getTime()-s.getTime())/(24*60*60*1e3))%a,c=a,d=document.createElementNS(U,"g");if(d.setAttribute("class","memento-ring-custom"),d.style.cursor="context-menu",l>0){let h=this.createArc(e,n,0,l,c);h.setAttribute("class","memento-past"),d.appendChild(h)}let u=this.createArc(e,n,l,l+1,c);if(u.setAttribute("class","memento-present"),d.appendChild(u),l<a-1){let h=this.createArc(e,n,l+1,c,c);h.setAttribute("class","memento-future"),d.appendChild(h)}d.addEventListener("contextmenu",h=>{h.preventDefault(),this.showRingContextMenu(h,"custom-short",a)}),t.appendChild(d),a===7&&this.renderWeeklyTimeBlocks(t,e,n,r),this.addRingLabel(t,n,`${a}d`)}renderWeeklyTimeBlocks(t,e,n,r){if(this.weeklyTimeBlocks.length===0)return;let a=7,s=r.getDay();for(let o of this.weeklyTimeBlocks){let l=o.dayOfWeek/a,c=(o.dayOfWeek+1)/a,d=(o.startHour*60+o.startMinute)/(24*60),u=(o.endHour*60+o.endMinute)/(24*60),h=l+(c-l)*d,p=l+(c-l)*u,m=this.createArcByFraction(e,n,h,p);m.setAttribute("class",`memento-block memento-block-${o.color}`),m.setAttribute("fill",this.getBlockColor(o.color)),m.setAttribute("opacity","0.7");let y=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],f=document.createElementNS(U,"title");f.textContent=`${y[o.dayOfWeek]} ${o.startHour}:${String(o.startMinute).padStart(2,"0")} - ${o.endHour}:${String(o.endMinute).padStart(2,"0")}
${o.label}`,m.appendChild(f),t.appendChild(m)}}createArcByFraction(t,e,n,r){let a=n*2*Math.PI-Math.PI/2,s=r*2*Math.PI-Math.PI/2,o=L+t*Math.cos(a),l=L+t*Math.sin(a),c=L+e*Math.cos(a),d=L+e*Math.sin(a),u=L+e*Math.cos(s),h=L+e*Math.sin(s),p=L+t*Math.cos(s),m=L+t*Math.sin(s),y=s-a>Math.PI?1:0,f=[`M ${o} ${l}`,`L ${c} ${d}`,`A ${e} ${e} 0 ${y} 1 ${u} ${h}`,`L ${p} ${m}`,`A ${t} ${t} 0 ${y} 0 ${o} ${l}`,"Z"].join(" "),S=document.createElementNS(U,"path");return S.setAttribute("d",f),S}renderMonthRing(t,e,n,r){let a=r.getDate(),s=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),o=document.createElementNS(U,"g");if(o.setAttribute("class","memento-ring-month"),o.style.cursor="context-menu",a>1){let c=this.createArc(e,n,0,a-1,s);c.setAttribute("class","memento-past"),o.appendChild(c)}let l=this.createArc(e,n,a-1,a,s);if(l.setAttribute("class","memento-present"),o.appendChild(l),a<s){let c=this.createArc(e,n,a,s,s);c.setAttribute("class","memento-future"),o.appendChild(c)}o.addEventListener("contextmenu",c=>{c.preventDefault(),this.showRingContextMenu(c,"month")}),t.appendChild(o),this.renderMonthlyTimeBlocks(t,e,n,s),this.addRingLabel(t,n,"M")}renderMonthlyTimeBlocks(t,e,n,r){if(this.monthlyTimeBlocks.length!==0)for(let a of this.monthlyTimeBlocks){let s=a.dayOfMonth,o=a.endDay||a.dayOfMonth;if(s>r)continue;let l=Math.min(o,r),c=this.createArc(e,n,s-1,l,r);c.setAttribute("class",`memento-block memento-block-${a.color}`),c.setAttribute("fill",this.getBlockColor(a.color)),c.setAttribute("opacity","0.7");let d=document.createElementNS(U,"title");a.endDay&&a.endDay!==a.dayOfMonth?d.textContent=`${a.dayOfMonth}-${l}: ${a.label}`:d.textContent=`${a.dayOfMonth}: ${a.label}`,c.appendChild(d),t.appendChild(c)}}renderSeasonRing(t,e,n,r,a){let s=r.getMonth(),o=s%a,l=r.getDate(),c=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),d=0,u=0,h=s-o;for(let y=0;y<a;y++){let f=h+y,S=new Date(r.getFullYear(),f+1,0).getDate();d+=S,y<o?u+=S:y===o&&(u+=l-1)}let p=document.createElementNS(U,"g");if(p.setAttribute("class","memento-ring-season"),p.style.cursor="context-menu",u>0){let y=this.createArc(e,n,0,u,d);y.setAttribute("class","memento-past"),p.appendChild(y)}let m=this.createArc(e,n,u,u+1,d);if(m.setAttribute("class","memento-present"),p.appendChild(m),u+1<d){let y=this.createArc(e,n,u+1,d,d);y.setAttribute("class","memento-future"),p.appendChild(y)}p.addEventListener("contextmenu",y=>{y.preventDefault(),this.showRingContextMenu(y,"season")}),t.appendChild(p),this.addRingLabel(t,n,"Q")}renderYearRing(t,e,n,r){let a=new Date(r.getFullYear(),0,1),s=new Date(r.getFullYear()+1,0,1),o=Math.floor((s.getTime()-a.getTime())/(24*60*60*1e3)),l=Math.floor((r.getTime()-a.getTime())/(24*60*60*1e3)),c=document.createElementNS(U,"g");if(c.setAttribute("class","memento-ring-year"),c.style.cursor="context-menu",l>0){let u=this.createArc(e,n,0,l,o);u.setAttribute("class","memento-past"),c.appendChild(u)}let d=this.createArc(e,n,l,l+1,o);if(d.setAttribute("class","memento-present"),c.appendChild(d),l+1<o){let u=this.createArc(e,n,l+1,o,o);u.setAttribute("class","memento-future"),c.appendChild(u)}c.addEventListener("contextmenu",u=>{u.preventDefault(),this.showRingContextMenu(u,"year")}),t.appendChild(c),this.addRingLabel(t,n,"Y")}renderLifeRing(t,e,n,r){let s=(r.getTime()-this.birthDate.getTime())/(365.25*24*60*60*1e3),o=this.lifeExpectancy,l=Math.floor(s),c=Math.min(l,o);if(c>0){let d=this.createArc(e,n,0,c,o);d.setAttribute("class","memento-past"),t.appendChild(d)}if(l<o){let d=this.createArc(e,n,l,l+1,o);d.setAttribute("class","memento-present"),t.appendChild(d)}if(l+1<o){let d=this.createArc(e,n,l+1,o,o);d.setAttribute("class","memento-future"),t.appendChild(d)}this.addRingLabel(t,n,"L")}createArc(t,e,n,r,a){let s=n/a*2*Math.PI-Math.PI/2,o=r/a*2*Math.PI-Math.PI/2,l=L+t*Math.cos(s),c=L+t*Math.sin(s),d=L+e*Math.cos(s),u=L+e*Math.sin(s),h=L+e*Math.cos(o),p=L+e*Math.sin(o),m=L+t*Math.cos(o),y=L+t*Math.sin(o),f=o-s>Math.PI?1:0,S=[`M ${l} ${c}`,`L ${d} ${u}`,`A ${e} ${e} 0 ${f} 1 ${h} ${p}`,`L ${m} ${y}`,`A ${t} ${t} 0 ${f} 0 ${l} ${c}`,"Z"].join(" "),A=document.createElementNS(U,"path");return A.setAttribute("d",S),A}addRingLabel(t,e,n){let r=-Math.PI/2,a=e+12,s=L+a*Math.cos(r),o=L+a*Math.sin(r),l=document.createElementNS(U,"text");l.setAttribute("x",String(s)),l.setAttribute("y",String(o)),l.setAttribute("class","memento-ring-label"),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","central"),l.textContent=n,t.appendChild(l)}renderCenter(t){let e=new Date,n=`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`,r=document.createElementNS(U,"circle");r.setAttribute("cx",String(L)),r.setAttribute("cy",String(L)),r.setAttribute("r",String(fn-5)),r.setAttribute("class","memento-center-bg"),t.appendChild(r);let a=document.createElementNS(U,"text");a.setAttribute("x",String(L)),a.setAttribute("y",String(L-5)),a.setAttribute("class","memento-center-time"),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","central"),a.textContent=n,t.appendChild(a);let s=`${e.getDate()}.${e.getMonth()+1}.`,o=document.createElementNS(U,"text");o.setAttribute("x",String(L)),o.setAttribute("y",String(L+15)),o.setAttribute("class","memento-center-date"),o.setAttribute("text-anchor","middle"),o.setAttribute("dominant-baseline","central"),o.textContent=s,t.appendChild(o)}showRingContextMenu(t,e,n){var o,l;let r=new At.Menu,a=Wr[e];if(e==="custom-short"&&n===7&&(a="periodic-notes:open-weekly-note"),!a)return;if(!((l=(o=this.app.commands)==null?void 0:o.commands)==null?void 0:l[a]))r.addItem(c=>{c.setTitle("Periodic Notes Plugin required").setIcon("alert-circle").setDisabled(!0)}),r.addItem(c=>{c.setTitle("Install from Community Plugins").setIcon("download").onClick(()=>{var d,u,h;(d=this.app.setting)==null||d.open(),(h=(u=this.app.setting)==null?void 0:u.openTabById)==null||h.call(u,"community-plugins")})});else{let c=this.getCommandLabel(e,n);r.addItem(d=>{d.setTitle(c).setIcon("calendar").onClick(()=>{this.app.commands.executeCommandById(a)})})}r.showAtMouseEvent(t)}getCommandLabel(t,e){let n={day:"Open Daily Note","custom-short-7":"Open Weekly Note",month:"Open Monthly Note",season:"Open Quarterly Note",year:"Open Yearly Note"};return t==="custom-short"&&e===7?n["custom-short-7"]:n[t]||"Open Note"}};var Yt=require("obsidian");J();var sr={style:"annual",showLabels:!0,showToday:!0,showAnniversaries:!1,segments:"none"};function ir(g){let i={...sr},t=g.trim().split(`
`),e=!1,n=!1,r=!1,a=0,s=[],o=[],l=[],c=null;for(let d of t){let u=d.trim();if(!u||u.startsWith("#"))continue;if(r)if(d.length-d.trimStart().length>a||u.startsWith("-")){s.push(d);continue}else r=!1,i.filter=ke(s);if(u.startsWith("- ")){if(e){c&&c.folder&&o.push({folder:c.folder,color:c.color||"blue",label:c.label});let f=u.match(/^-\s*folder:\s*["']?([^"'\n]+)["']?/);f?c={folder:f[1].trim()}:c={};continue}if(n){let f=u.slice(2).trim().replace(/["']/g,"");l.push(f);continue}}if(e&&c&&(d.startsWith("    ")||d.startsWith("	"))){let[f,...S]=u.split(":"),A=S.join(":").trim().replace(/["']/g,"");switch(f.trim()){case"folder":c.folder=A;break;case"color":c.color=A;break;case"label":c.label=A;break}continue}let h=u.indexOf(":");if(h===-1)continue;let p=u.slice(0,h).trim(),m=u.slice(h+1).trim();if(p==="rings"&&(!m||m==="")){c&&c.folder&&o.push({folder:c.folder,color:c.color||"blue",label:c.label}),e=!0,n=!1,c=null;continue}if(p==="folders"&&(!m||m==="")){n=!0,e=!1;continue}!d.startsWith(" ")&&!d.startsWith("	")&&!u.startsWith("-")&&(e&&c&&c.folder&&(o.push({folder:c.folder,color:c.color||"blue",label:c.label}),c=null),e=!1,n=!1);let y=m.replace(/["']/g,"");switch(p){case"year":i.year=parseInt(y,10);break;case"style":(y==="annual"||y==="life")&&(i.style=y);break;case"dateProperty":i.dateProperty=y;break;case"folder":i.folder=y;break;case"filter":case"filters":y?i.filter=y:(r=!0,a=d.indexOf(p));break;case"showLabels":i.showLabels=y==="true";break;case"showToday":i.showToday=y==="true";break;case"showAnniversaries":i.showAnniversaries=y==="true";break;case"segments":["none","seasons","quarters","weeks"].includes(y)&&(i.segments=y);break;case"birthYear":i.birthYear=parseInt(y,10);break;case"lifespan":i.lifespan=parseInt(y,10);break}}return c&&c.folder&&o.push({folder:c.folder,color:c.color||"blue",label:c.label}),r&&s.length>0&&(i.filter=ke(s)),o.length>0&&(i.rings=o),l.length>0&&(i.folders=l),i}function ke(g){let i={},t=null,e=[],n=[],r=-1;for(let a of g){let s=a.trim();if(!s)continue;let o=a.length-a.trimStart().length;if(r>=0)if(o>r){n.push(a);continue}else n.length>0&&(e.push(ke(n)),n=[]),r=-1;if(s==="and:"||s==="or:"||s==="not:"){t&&e.length>0&&(i[t]=[...e],e.length=0),t=s.slice(0,-1);continue}if(s.startsWith("- ")){let l=s.slice(2).trim();l==="and:"||l==="or:"||l==="not:"?(r=o,n=[a]):e.push(l)}}return n.length>0&&e.push(ke(n)),t&&e.length>0&&(i[t]=e),i}J();z();var Sn=800,G=Sn/2,It=380,lr=30,Nt=145,Ur=Nt+lr,or=4,zr=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Le=class{render(i,t,e,n){var o;let r=this.createSVG();this.renderBackground(r);let a=((o=i.rings)==null?void 0:o.length)||1,s=this.calculateRingRadii(a);if(i.rings&&i.rings.length>0)i.rings.forEach((l,c)=>{let d=s.get(c);if(d){let u=E[l.color]||E.blue;this.renderDataRing(r,e,t,d,u,l.folder,n)}});else{let l=s.get(0);if(l){let c=E.blue;this.renderDataRing(r,e,t,l,c,i.folder,n)}}return this.renderMonthSeparators(r),i.showLabels&&this.renderMonthLabels(r),i.showToday&&this.renderTodayMarker(r,e),this.renderCenter(r,e),r}createSVG(){let i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("viewBox",`0 0 ${Sn} ${Sn}`),i.setAttribute("class","radcal-svg"),i.style.width="100%",i.style.height="auto",i.style.maxWidth="800px",i}renderBackground(i){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",String(G)),t.setAttribute("cy",String(G)),t.setAttribute("r",String(It)),t.setAttribute("class","rc-background"),i.appendChild(t)}calculateRingRadii(i){let t=new Map,e=It-Ur,n=(i-1)*or,r=(e-n)/i;for(let a=0;a<i;a++){let s=It-a*(r+or),o=s-r;t.set(a,{innerRadius:o,outerRadius:s})}return t}renderDataRing(i,t,e,n,r,a,s){for(let o=1;o<=12;o++){let l=x(t,o),c=this.monthToAngle(o),u=Math.PI/6/l;for(let h=1;h<=l;h++){let p=C(t,o,h),m=`${t}-${String(o).padStart(2,"0")}-${String(h).padStart(2,"0")}`,y=e.get(m)||[];a&&(y=y.filter(M=>M.metadata.folder.startsWith(a)));let f=c+(h-1)*u,S=f+u,A=document.createElementNS("http://www.w3.org/2000/svg","path"),w=this.createArcPath(n.innerRadius,n.outerRadius,f,S);if(A.setAttribute("d",w),A.setAttribute("class","rc-day-arc"),y.length>0&&(A.style.fill=r,A.style.opacity=String(Math.min(.3+y.length*.15,1)),A.style.cursor="pointer",A.setAttribute("data-date",m),A.setAttribute("data-count",String(y.length)),A.setAttribute("data-names",y.map(M=>M.displayName).join("|")),s)){let M=p,T=y;A.addEventListener("click",k=>s(k,M,T))}i.appendChild(A)}}}renderMonthSeparators(i){for(let t=1;t<=12;t++){let e=this.monthToAngle(t)-Math.PI/2,n=G+Nt*Math.cos(e),r=G+Nt*Math.sin(e),a=G+It*Math.cos(e),s=G+It*Math.sin(e),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(n)),o.setAttribute("y1",String(r)),o.setAttribute("x2",String(a)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-month-separator"),i.appendChild(o)}}renderMonthLabels(i){let t=Nt+lr/2;for(let e=1;e<=12;e++){let n=this.monthToAngle(e)+Math.PI/12-Math.PI/2,r=G+t*Math.cos(n),a=G+t*Math.sin(n),s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(r)),s.setAttribute("y",String(a)),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.setAttribute("class","rc-month-label"),s.textContent=zr[e-1],i.appendChild(s)}}renderTodayMarker(i,t){let e=N();if(e.year!==t)return;let n=x(t,e.month),r=this.monthToAngle(e.month),a=Math.PI/6/n,o=r+(e.day-.5)*a-Math.PI/2,l=G+Nt*Math.cos(o),c=G+Nt*Math.sin(o),d=G+It*Math.cos(o),u=G+It*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(l)),h.setAttribute("y1",String(c)),h.setAttribute("x2",String(d)),h.setAttribute("y2",String(u)),h.setAttribute("class","rc-today-marker"),i.appendChild(h)}renderCenter(i,t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(G)),e.setAttribute("cy",String(G)),e.setAttribute("r",String(Nt-5)),e.setAttribute("class","rc-center"),i.appendChild(e);let n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",String(G)),n.setAttribute("y",String(G)),n.setAttribute("text-anchor","middle"),n.setAttribute("dominant-baseline","central"),n.setAttribute("class","rc-center-text"),n.textContent=String(t),i.appendChild(n)}createArcPath(i,t,e,n){let r=e-Math.PI/2,a=n-Math.PI/2,s=G+i*Math.cos(r),o=G+i*Math.sin(r),l=G+i*Math.cos(a),c=G+i*Math.sin(a),d=G+t*Math.cos(r),u=G+t*Math.sin(r),h=G+t*Math.cos(a),p=G+t*Math.sin(a),m=n-e>Math.PI?1:0;return`
      M ${s} ${o}
      L ${d} ${u}
      A ${t} ${t} 0 ${m} 1 ${h} ${p}
      L ${l} ${c}
      A ${i} ${i} 0 ${m} 0 ${s} ${o}
      Z
    `}monthToAngle(i){return(i-1)*Math.PI/6}};var Ie=class{constructor(i){this.app=i}createContext(i){var a,s,o;let t=this.app.metadataCache.getFileCache(i),e=[];if((a=t==null?void 0:t.frontmatter)!=null&&a.tags){let l=t.frontmatter.tags;Array.isArray(l)?e.push(...l.map(c=>this.normalizeTag(c))):typeof l=="string"&&e.push(this.normalizeTag(l))}if(t!=null&&t.tags)for(let l of t.tags)e.push(this.normalizeTag(l.tag));let n=[];if(t!=null&&t.links)for(let l of t.links)n.push(l.link);if(t!=null&&t.frontmatterLinks)for(let l of t.frontmatterLinks)n.push(l.link);let r={};if(t!=null&&t.frontmatter)for(let[l,c]of Object.entries(t.frontmatter))l!=="position"&&(r[l.toLowerCase()]=c);return{file:i,metadata:t,tags:[...new Set(e)],folder:(o=(s=i.parent)==null?void 0:s.path)!=null?o:"",links:[...new Set(n)],properties:r}}normalizeTag(i){return i.replace(/^#/,"").toLowerCase()}evaluate(i,t){return typeof i=="string"?this.evaluateString(i,t):Array.isArray(i)?i.every(e=>this.evaluate(e,t)):this.evaluateYaml(i,t)}evaluateYaml(i,t){return i.and?i.and.every(e=>this.evaluate(e,t)):i.or?i.or.some(e=>this.evaluate(e,t)):i.not?i.not.every(e=>!this.evaluate(e,t)):!0}evaluateString(i,t){let e=i.trim();if(!e)return!0;if(e.startsWith("(")&&e.endsWith(")"))return this.evaluateString(e.slice(1,-1),t);let n=this.splitByOperator(e,"||");if(n.length>1)return n.some(a=>this.evaluateString(a,t));let r=this.splitByOperator(e,"&&");return r.length>1?r.every(a=>this.evaluateString(a,t)):e.startsWith("!")?!this.evaluateString(e.slice(1),t):this.evaluateFunction(e,t)}splitByOperator(i,t){let e=[],n="",r=0,a=0;for(;a<i.length;){let s=i[a];if(s==="(")r++,n+=s;else if(s===")")r--,n+=s;else if(r===0&&i.slice(a,a+t.length)===t){e.push(n.trim()),n="",a+=t.length;continue}else n+=s;a++}return n.trim()&&e.push(n.trim()),e}evaluateFunction(i,t){let e=i.match(/^file\.hasTag\s*\(\s*["']([^"']+)["']\s*\)$/);if(e){let d=this.normalizeTag(e[1]);return t.tags.some(u=>u===d||u.startsWith(d+"/"))}let n=i.match(/^file\.tagContains\s*\(\s*["']([^"']+)["']\s*\)$/);if(n){let d=n[1].toLowerCase();return t.tags.some(u=>u.includes(d))}let r=i.match(/^file\.inFolder\s*\(\s*["']([^"']+)["']\s*\)$/);if(r){let d=r[1].replace(/^\/|\/$/g,""),u=t.folder.replace(/^\/|\/$/g,"");return u===d||u.startsWith(d+"/")}let a=i.match(/^file\.hasLink\s*\(\s*["']([^"']+)["']\s*\)$/);if(a){let d=a[1].toLowerCase();return t.links.some(u=>u.toLowerCase()===d||u.toLowerCase().endsWith("/"+d))}let s=i.match(/^file\.name\s*\(\s*["']([^"']+)["']\s*\)$/);if(s){let d=s[1].toLowerCase();return t.file.basename.toLowerCase()===d}let o=i.match(/^file\.nameContains\s*\(\s*["']([^"']+)["']\s*\)$/);if(o){let d=o[1].toLowerCase();return t.file.basename.toLowerCase().includes(d)}let l=i.match(/^file\.property\s*\(\s*["']([^"']+)["']\s*,\s*["']([^"']+)["']\s*\)$/);if(l){let d=l[1].toLowerCase(),u=l[2].toLowerCase(),h=t.properties[d];return h==null?!1:String(h).toLowerCase()===u}let c=i.match(/^file\.hasProperty\s*\(\s*["']([^"']+)["']\s*\)$/);if(c){let d=c[1].toLowerCase(),u=t.properties[d];return u!=null&&u!==""}throw new Error(`Unknown filter function: ${i}`)}};var ne=require("obsidian");z();var ut=400,v=ut/2,Y=180,dt=100,cr=75,P="http://www.w3.org/2000/svg",An={sun:0,so:0,mon:1,mo:1,tue:2,di:2,wed:3,mi:3,thu:4,do:4,fri:5,fr:5,sat:6,sa:6},vn=["So","Mo","Di","Mi","Do","Fr","Sa"];function dr(g){let i=g.trim().split(`
`),t={type:"day",showCurrentTime:!0,startHour:0},e=[],n=[],r=[],a=!1,s=[];for(let o of i){let l=o.trim();if(l==="---"){a?(t=jr(s),a=!1,s=[]):a=!0;continue}if(a){s.push(l);continue}if(l.startsWith("type:")){let c=l.slice(5).trim().toLowerCase();(c==="day"||c==="week"||c==="month")&&(t.type=c);continue}if(l)switch(t.type){case"day":let c=qr(l);c&&e.push(c);break;case"week":let d=Qr(l);d&&n.push(d);break;case"month":let u=Xr(l);u&&r.push(u);break}}return{config:t,dayBlocks:e,weekBlocks:n,monthBlocks:r}}function jr(g){let i={type:"day",showCurrentTime:!0,startHour:0};for(let t of g){let e=t.indexOf(":");if(e===-1)continue;let n=t.slice(0,e).trim().toLowerCase(),r=t.slice(e+1).trim().toLowerCase();n==="type"?(r==="day"||r==="week"||r==="month")&&(i.type=r):n==="showcurrenttime"?i.showCurrentTime=r!=="false":n==="starthour"&&(i.startHour=parseInt(r,10)||0)}return i}function qr(g){let i=g.match(/^(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})\s+(\w+):\s*(.+)$/);if(i)return{startHour:parseInt(i[1],10),startMinute:parseInt(i[2],10),endHour:parseInt(i[3],10),endMinute:parseInt(i[4],10),color:i[5].toLowerCase(),label:i[6].trim()};let t=g.match(/^(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})\s+(.+)$/);if(t)return{startHour:parseInt(t[1],10),startMinute:parseInt(t[2],10),endHour:parseInt(t[3],10),endMinute:parseInt(t[4],10),color:"blue",label:t[5].trim()};let e=g.match(/^(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})\s+(.+?)\s*\|\s*(\w+)$/);return e?{startHour:parseInt(e[1],10),startMinute:parseInt(e[2],10),endHour:parseInt(e[3],10),endMinute:parseInt(e[4],10),label:e[5].trim(),color:e[6].toLowerCase()}:null}function Qr(g){let i=g.match(/^(\w{2,3})\s+(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})\s+(\w+):\s*(.+)$/i);if(i){let n=i[1].toLowerCase(),r=An[n];return r===void 0?null:{dayOfWeek:r,startHour:parseInt(i[2],10),startMinute:parseInt(i[3],10),endHour:parseInt(i[4],10),endMinute:parseInt(i[5],10),color:i[6].toLowerCase(),label:i[7].trim()}}let t=g.match(/^(\w{2,3})\s+(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})\s+(.+)$/i);if(t){let n=t[1].toLowerCase(),r=An[n];return r===void 0?null:{dayOfWeek:r,startHour:parseInt(t[2],10),startMinute:parseInt(t[3],10),endHour:parseInt(t[4],10),endMinute:parseInt(t[5],10),color:"blue",label:t[6].trim()}}let e=g.match(/^(\w{2,3})\s+(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})\s+(.+?)\s*\|\s*(\w+)$/i);if(e){let n=e[1].toLowerCase(),r=An[n];return r===void 0?null:{dayOfWeek:r,startHour:parseInt(e[2],10),startMinute:parseInt(e[3],10),endHour:parseInt(e[4],10),endMinute:parseInt(e[5],10),label:e[6].trim(),color:e[7].toLowerCase()}}return null}function Xr(g){let i=g.match(/^(\d{1,2})\s*-\s*(\d{1,2})\s+(\w+):\s*(.+)$/);if(i)return{dayOfMonth:parseInt(i[1],10),endDay:parseInt(i[2],10),color:i[3].toLowerCase(),label:i[4].trim()};let t=g.match(/^(\d{1,2})\s+(\w+):\s*(.+)$/);if(t)return{dayOfMonth:parseInt(t[1],10),color:t[2].toLowerCase(),label:t[3].trim()};let e=g.match(/^(\d{1,2})\s*-\s*(\d{1,2})\s+(.+?)\s*\|\s*(\w+)$/);if(e)return{dayOfMonth:parseInt(e[1],10),endDay:parseInt(e[2],10),label:e[3].trim(),color:e[4].toLowerCase()};let n=g.match(/^(\d{1,2})\s+(.+?)\s*\|\s*(\w+)$/);if(n)return{dayOfMonth:parseInt(n[1],10),label:n[2].trim(),color:n[3].toLowerCase()};let r=g.match(/^(\d{1,2})\s*-\s*(\d{1,2})\s+(.+)$/);if(r)return{dayOfMonth:parseInt(r[1],10),endDay:parseInt(r[2],10),color:"blue",label:r[3].trim()};let a=g.match(/^(\d{1,2})\s+(.+)$/);return a?{dayOfMonth:parseInt(a[1],10),color:"blue",label:a[2].trim()}:null}function Ne(g,i,t){let e=(g-t)*60+i;return e=(e%(24*60)+24*60)%(24*60),e/(24*60)*2*Math.PI-Math.PI/2}function Gt(g,i,t,e){let n=v+g*Math.cos(t),r=v+g*Math.sin(t),a=v+i*Math.cos(t),s=v+i*Math.sin(t),o=v+i*Math.cos(e),l=v+i*Math.sin(e),c=v+g*Math.cos(e),d=v+g*Math.sin(e),u=e-t>Math.PI?1:0;return[`M ${n} ${r}`,`L ${a} ${s}`,`A ${i} ${i} 0 ${u} 1 ${o} ${l}`,`L ${c} ${d}`,`A ${g} ${g} 0 ${u} 0 ${n} ${r}`,"Z"].join(" ")}var Re=class extends ne.MarkdownRenderChild{constructor(t,e,n){super(t);this.config=e;this.blocks=n;this.updateInterval=null}onload(){this.render(),this.config.showCurrentTime&&(this.updateInterval=window.setInterval(()=>this.render(),60*1e3))}onunload(){this.updateInterval&&window.clearInterval(this.updateInterval)}render(){this.containerEl.empty();let t=document.createElementNS(P,"svg");t.setAttribute("viewBox",`0 0 ${ut} ${ut}`),t.setAttribute("class","radcal-day-svg"),t.style.width="100%",t.style.height="auto",t.style.maxWidth="400px";let e=document.createElementNS(P,"circle");e.setAttribute("cx",String(v)),e.setAttribute("cy",String(v)),e.setAttribute("r",String(Y)),e.setAttribute("class","radcal-day-bg"),t.appendChild(e);let n=document.createElementNS(P,"circle");n.setAttribute("cx",String(v)),n.setAttribute("cy",String(v)),n.setAttribute("r",String(dt)),n.setAttribute("class","radcal-day-center"),t.appendChild(n),this.renderHourMarkers(t);for(let a of this.blocks)this.renderTimeBlock(t,a);this.config.showCurrentTime&&this.renderCurrentTime(t),this.renderCenterText(t),this.containerEl.createDiv({cls:"radcal-day-wrapper"}).appendChild(t),this.setupTooltips(t)}renderHourMarkers(t){for(let e=0;e<24;e++){let n=Ne(e,0,this.config.startHour),r=Y-10,a=v+r*Math.cos(n),s=v+r*Math.sin(n),o=v+Y*Math.cos(n),l=v+Y*Math.sin(n),c=document.createElementNS(P,"line");if(c.setAttribute("x1",String(a)),c.setAttribute("y1",String(s)),c.setAttribute("x2",String(o)),c.setAttribute("y2",String(l)),c.setAttribute("class","radcal-day-tick"),t.appendChild(c),e%3===0){let d=v+cr*Math.cos(n),u=v+cr*Math.sin(n),h=document.createElementNS(P,"text");h.setAttribute("x",String(d)),h.setAttribute("y",String(u)),h.setAttribute("class","radcal-day-hour-label"),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","central"),h.textContent=String(e),t.appendChild(h)}}}renderTimeBlock(t,e){let n=Ne(e.startHour,e.startMinute,this.config.startHour),r=Ne(e.endHour,e.endMinute,this.config.startHour),a=document.createElementNS(P,"path");a.setAttribute("d",Gt(dt+5,Y-15,n,r)),a.setAttribute("class","radcal-day-block"),a.setAttribute("fill",E[e.color]||E.blue),a.setAttribute("data-label",e.label),a.setAttribute("data-time",`${e.startHour}:${String(e.startMinute).padStart(2,"0")} - ${e.endHour}:${String(e.endMinute).padStart(2,"0")}`),t.appendChild(a)}renderCurrentTime(t){let e=new Date,n=Ne(e.getHours(),e.getMinutes(),this.config.startHour),r=v+(Y-5)*Math.cos(n),a=v+(Y-5)*Math.sin(n),s=document.createElementNS(P,"line");s.setAttribute("x1",String(v)),s.setAttribute("y1",String(v)),s.setAttribute("x2",String(r)),s.setAttribute("y2",String(a)),s.setAttribute("class","radcal-day-now"),t.appendChild(s);let o=document.createElementNS(P,"circle");o.setAttribute("cx",String(r)),o.setAttribute("cy",String(a)),o.setAttribute("r","6"),o.setAttribute("class","radcal-day-now-dot"),t.appendChild(o)}renderCenterText(t){let e=new Date,n=`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`,r=document.createElementNS(P,"text");r.setAttribute("x",String(v)),r.setAttribute("y",String(v)),r.setAttribute("class","radcal-day-center-time"),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.textContent=n,t.appendChild(r)}setupTooltips(t){t.querySelectorAll(".radcal-day-block").forEach(n=>{n.addEventListener("mouseenter",r=>{let a=r.target,s=a.getAttribute("data-label")||"",o=a.getAttribute("data-time")||"",l=document.createElement("div");l.className="radcal-day-tooltip",l.innerHTML=`<strong>${o}</strong><br>${s}`,this.containerEl.appendChild(l);let c=r,d=this.containerEl.getBoundingClientRect();l.style.left=`${c.clientX-d.left+10}px`,l.style.top=`${c.clientY-d.top+10}px`}),n.addEventListener("mouseleave",()=>{let r=this.containerEl.querySelector(".radcal-day-tooltip");r&&r.remove()})})}},Fe=class extends ne.MarkdownRenderChild{constructor(t,e,n){super(t);this.config=e;this.blocks=n;this.updateInterval=null}onload(){this.render(),this.config.showCurrentTime&&(this.updateInterval=window.setInterval(()=>this.render(),60*1e3))}onunload(){this.updateInterval&&window.clearInterval(this.updateInterval)}render(){this.containerEl.empty();let t=document.createElementNS(P,"svg");t.setAttribute("viewBox",`0 0 ${ut} ${ut}`),t.setAttribute("class","radcal-week-svg"),t.style.width="100%",t.style.height="auto",t.style.maxWidth="400px";let e=document.createElementNS(P,"circle");e.setAttribute("cx",String(v)),e.setAttribute("cy",String(v)),e.setAttribute("r",String(Y)),e.setAttribute("class","radcal-week-bg"),t.appendChild(e);let n=document.createElementNS(P,"circle");n.setAttribute("cx",String(v)),n.setAttribute("cy",String(v)),n.setAttribute("r",String(dt)),n.setAttribute("class","radcal-week-center"),t.appendChild(n),this.renderDaySegments(t);for(let a of this.blocks)this.renderTimeBlock(t,a);this.config.showCurrentTime&&this.renderCurrentTime(t),this.renderCenterText(t),this.containerEl.createDiv({cls:"radcal-week-wrapper"}).appendChild(t),this.setupTooltips(t)}renderDaySegments(t){let e=2*Math.PI/7;for(let n=0;n<7;n++){let r=(n+1)%7,a=n*e-Math.PI/2,s=(n+1)*e-Math.PI/2,o=v+Y*Math.cos(a),l=v+Y*Math.sin(a),c=document.createElementNS(P,"line");c.setAttribute("x1",String(v)),c.setAttribute("y1",String(v)),c.setAttribute("x2",String(o)),c.setAttribute("y2",String(l)),c.setAttribute("class","radcal-week-divider"),t.appendChild(c);let d=(a+s)/2,u=dt-20,h=v+u*Math.cos(d),p=v+u*Math.sin(d),m=document.createElementNS(P,"text");m.setAttribute("x",String(h)),m.setAttribute("y",String(p)),m.setAttribute("class","radcal-week-day-label"),m.setAttribute("text-anchor","middle"),m.setAttribute("dominant-baseline","central"),m.textContent=vn[r],t.appendChild(m)}}renderTimeBlock(t,e){let n=2*Math.PI/7,a=(e.dayOfWeek+6)%7*n-Math.PI/2,s=(e.startHour+e.startMinute/60)/24,o=(e.endHour+e.endMinute/60)/24,l=a+s*n,c=a+o*n,d=document.createElementNS(P,"path");d.setAttribute("d",Gt(dt+5,Y-15,l,c)),d.setAttribute("class","radcal-week-block"),d.setAttribute("fill",E[e.color]||E.blue),d.setAttribute("data-label",e.label),d.setAttribute("data-day",vn[e.dayOfWeek]),d.setAttribute("data-time",`${e.startHour}:${String(e.startMinute).padStart(2,"0")} - ${e.endHour}:${String(e.endMinute).padStart(2,"0")}`),t.appendChild(d)}renderCurrentTime(t){let e=new Date,r=(e.getDay()+6)%7,a=2*Math.PI/7,o=r*a-Math.PI/2+a/2,l=(e.getHours()+e.getMinutes()/60)/24,c=dt+(Y-dt)*l*.9,d=v+c*Math.cos(o),u=v+c*Math.sin(o),h=document.createElementNS(P,"circle");h.setAttribute("cx",String(d)),h.setAttribute("cy",String(u)),h.setAttribute("r","8"),h.setAttribute("class","radcal-week-now"),t.appendChild(h)}renderCenterText(t){let e=new Date,n=this.getWeekNumber(e),r=document.createElementNS(P,"text");r.setAttribute("x",String(v)),r.setAttribute("y",String(v)),r.setAttribute("class","radcal-week-center-text"),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.textContent=`KW ${n}`,t.appendChild(r)}getWeekNumber(t){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),n=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-n);let r=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e.getTime()-r.getTime())/864e5+1)/7)}setupTooltips(t){t.querySelectorAll(".radcal-week-block").forEach(n=>{n.addEventListener("mouseenter",r=>{let a=r.target,s=a.getAttribute("data-label")||"",o=a.getAttribute("data-day")||"",l=a.getAttribute("data-time")||"",c=document.createElement("div");c.className="radcal-week-tooltip",c.innerHTML=`<strong>${o} ${l}</strong><br>${s}`,this.containerEl.appendChild(c);let d=r,u=this.containerEl.getBoundingClientRect();c.style.left=`${d.clientX-u.left+10}px`,c.style.top=`${d.clientY-u.top+10}px`}),n.addEventListener("mouseleave",()=>{let r=this.containerEl.querySelector(".radcal-week-tooltip");r&&r.remove()})})}},$e=class extends ne.MarkdownRenderChild{constructor(t,e,n){super(t);this.config=e;this.blocks=n;this.updateInterval=null}onload(){this.render(),this.updateInterval=window.setInterval(()=>this.render(),60*60*1e3)}onunload(){this.updateInterval&&window.clearInterval(this.updateInterval)}render(){this.containerEl.empty();let t=new Date,e=new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),n=document.createElementNS(P,"svg");n.setAttribute("viewBox",`0 0 ${ut} ${ut}`),n.setAttribute("class","radcal-month-svg"),n.style.width="100%",n.style.height="auto",n.style.maxWidth="400px";let r=document.createElementNS(P,"circle");r.setAttribute("cx",String(v)),r.setAttribute("cy",String(v)),r.setAttribute("r",String(Y)),r.setAttribute("class","radcal-month-bg"),n.appendChild(r);let a=document.createElementNS(P,"circle");a.setAttribute("cx",String(v)),a.setAttribute("cy",String(v)),a.setAttribute("r",String(dt)),a.setAttribute("class","radcal-month-center"),n.appendChild(a),this.renderDayMarkers(n,e);for(let o of this.blocks)this.renderTimeBlock(n,o,e);this.config.showCurrentTime&&this.renderCurrentDay(n,t.getDate(),e),this.renderCenterText(n,t),this.containerEl.createDiv({cls:"radcal-month-wrapper"}).appendChild(n),this.setupTooltips(n)}renderDayMarkers(t,e){let n=2*Math.PI/e;for(let r=1;r<=e;r++){let a=(r-1)*n-Math.PI/2,s=v+(Y-8)*Math.cos(a),o=v+(Y-8)*Math.sin(a),l=v+Y*Math.cos(a),c=v+Y*Math.sin(a),d=document.createElementNS(P,"line");if(d.setAttribute("x1",String(s)),d.setAttribute("y1",String(o)),d.setAttribute("x2",String(l)),d.setAttribute("y2",String(c)),d.setAttribute("class","radcal-month-tick"),t.appendChild(d),r%5===0||r===1){let u=Y+15,h=v+u*Math.cos(a),p=v+u*Math.sin(a),m=document.createElementNS(P,"text");m.setAttribute("x",String(h)),m.setAttribute("y",String(p)),m.setAttribute("class","radcal-month-day-label"),m.setAttribute("text-anchor","middle"),m.setAttribute("dominant-baseline","central"),m.textContent=String(r),t.appendChild(m)}}}renderTimeBlock(t,e,n){let r=2*Math.PI/n,a=e.dayOfMonth,s=e.endDay||e.dayOfMonth,o=(a-1)*r-Math.PI/2,l=s*r-Math.PI/2,c=document.createElementNS(P,"path");c.setAttribute("d",Gt(dt+10,Y-15,o,l)),c.setAttribute("class","radcal-month-block"),c.setAttribute("fill",E[e.color]||E.blue),c.setAttribute("data-label",e.label),c.setAttribute("data-days",e.endDay?`${a}-${s}`:String(a)),t.appendChild(c)}renderCurrentDay(t,e,n){let r=2*Math.PI/n,a=(e-.5)*r-Math.PI/2,s=v+(Y-5)*Math.cos(a),o=v+(Y-5)*Math.sin(a),l=document.createElementNS(P,"circle");l.setAttribute("cx",String(s)),l.setAttribute("cy",String(o)),l.setAttribute("r","6"),l.setAttribute("class","radcal-month-now"),t.appendChild(l)}renderCenterText(t,e){let n=["Jan","Feb","M\xE4r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],r=document.createElementNS(P,"text");r.setAttribute("x",String(v)),r.setAttribute("y",String(v)),r.setAttribute("class","radcal-month-center-text"),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.textContent=`${n[e.getMonth()]} ${e.getFullYear()}`,t.appendChild(r)}setupTooltips(t){t.querySelectorAll(".radcal-month-block").forEach(n=>{n.addEventListener("mouseenter",r=>{let a=r.target,s=a.getAttribute("data-label")||"",o=a.getAttribute("data-days")||"",l=document.createElement("div");l.className="radcal-month-tooltip",l.innerHTML=`<strong>Tag ${o}</strong><br>${s}`,this.containerEl.appendChild(l);let c=r,d=this.containerEl.getBoundingClientRect();l.style.left=`${c.clientX-d.left+10}px`,l.style.top=`${c.clientY-d.top+10}px`}),n.addEventListener("mouseleave",()=>{let r=this.containerEl.querySelector(".radcal-month-tooltip");r&&r.remove()})})}},Ve=class extends ne.MarkdownRenderChild{constructor(t,e,n,r,a){super(t);this.config=e;this.dayBlocks=n;this.weekBlocks=r;this.monthBlocks=a;this.updateInterval=null}onload(){this.render(),this.config.showCurrentTime&&(this.updateInterval=window.setInterval(()=>this.render(),60*1e3))}onunload(){this.updateInterval&&window.clearInterval(this.updateInterval)}render(){this.containerEl.empty();let t=this.dayBlocks.length>0,e=this.weekBlocks.length>0,n=this.monthBlocks.length>0,r=(t?1:0)+(e?1:0)+(n?1:0);if(r===0){this.containerEl.createEl("p",{text:"Keine Zeitbl\xF6cke gefunden."});return}let a=document.createElementNS(P,"svg");a.setAttribute("viewBox",`0 0 ${ut} ${ut}`),a.setAttribute("class","radcal-multi-svg"),a.style.width="100%",a.style.height="auto",a.style.maxWidth="500px";let s=document.createElementNS(P,"circle");s.setAttribute("cx",String(v)),s.setAttribute("cy",String(v)),s.setAttribute("r",String(Y+10)),s.setAttribute("class","radcal-multi-bg"),a.appendChild(s);let o=(Y-50)/r,l=Y;if(n){let h=l-o+5;this.renderMonthRing(a,l,h),l=h-5}if(e){let h=l-o+5;this.renderWeekRing(a,l,h),l=h-5}if(t){let h=l-o+5;this.renderDayRing(a,l,h),l=h-5}let c=Math.max(l,40),d=document.createElementNS(P,"circle");d.setAttribute("cx",String(v)),d.setAttribute("cy",String(v)),d.setAttribute("r",String(c)),d.setAttribute("class","radcal-multi-center"),a.appendChild(d),this.renderCenterTime(a),this.containerEl.createDiv({cls:"radcal-multi-wrapper"}).appendChild(a),this.setupTooltips(a)}renderDayRing(t,e,n){let r=new Date,a=document.createElementNS(P,"circle");a.setAttribute("cx",String(v)),a.setAttribute("cy",String(v)),a.setAttribute("r",String((e+n)/2)),a.setAttribute("fill","none"),a.setAttribute("stroke","var(--background-modifier-border)"),a.setAttribute("stroke-width",String(e-n)),a.setAttribute("class","radcal-multi-ring-bg"),t.appendChild(a);for(let s=0;s<24;s+=3){let o=s/24*2*Math.PI-Math.PI/2,l=v+n*Math.cos(o),c=v+n*Math.sin(o),d=v+e*Math.cos(o),u=v+e*Math.sin(o),h=document.createElementNS(P,"line");h.setAttribute("x1",String(l)),h.setAttribute("y1",String(c)),h.setAttribute("x2",String(d)),h.setAttribute("y2",String(u)),h.setAttribute("class","radcal-multi-tick"),t.appendChild(h)}for(let s of this.dayBlocks){let o=(s.startHour+s.startMinute/60)/24*2*Math.PI-Math.PI/2,l=(s.endHour+s.endMinute/60)/24*2*Math.PI-Math.PI/2,c=document.createElementNS(P,"path");c.setAttribute("d",Gt(n+2,e-2,o,l)),c.setAttribute("class","radcal-multi-block"),c.setAttribute("fill",E[s.color]||E.blue),c.setAttribute("data-type","day"),c.setAttribute("data-label",s.label),c.setAttribute("data-time",`${s.startHour}:${String(s.startMinute).padStart(2,"0")} - ${s.endHour}:${String(s.endMinute).padStart(2,"0")}`),t.appendChild(c)}if(this.config.showCurrentTime){let s=(r.getHours()+r.getMinutes()/60)/24*2*Math.PI-Math.PI/2,o=v+n*Math.cos(s),l=v+n*Math.sin(s),c=v+e*Math.cos(s),d=v+e*Math.sin(s),u=document.createElementNS(P,"line");u.setAttribute("x1",String(o)),u.setAttribute("y1",String(l)),u.setAttribute("x2",String(c)),u.setAttribute("y2",String(d)),u.setAttribute("class","radcal-multi-now-line"),t.appendChild(u)}}renderWeekRing(t,e,n){let r=new Date,a=2*Math.PI/7,s=document.createElementNS(P,"circle");s.setAttribute("cx",String(v)),s.setAttribute("cy",String(v)),s.setAttribute("r",String((e+n)/2)),s.setAttribute("fill","none"),s.setAttribute("stroke","var(--background-modifier-border)"),s.setAttribute("stroke-width",String(e-n)),s.setAttribute("class","radcal-multi-ring-bg"),t.appendChild(s);for(let o=0;o<7;o++){let l=o*a-Math.PI/2,c=v+n*Math.cos(l),d=v+n*Math.sin(l),u=v+e*Math.cos(l),h=v+e*Math.sin(l),p=document.createElementNS(P,"line");p.setAttribute("x1",String(c)),p.setAttribute("y1",String(d)),p.setAttribute("x2",String(u)),p.setAttribute("y2",String(h)),p.setAttribute("class","radcal-multi-tick"),t.appendChild(p)}for(let o of this.weekBlocks){let c=(o.dayOfWeek+6)%7*a-Math.PI/2,d=(o.startHour+o.startMinute/60)/24,u=(o.endHour+o.endMinute/60)/24,h=c+d*a,p=c+u*a,m=document.createElementNS(P,"path");m.setAttribute("d",Gt(n+2,e-2,h,p)),m.setAttribute("class","radcal-multi-block"),m.setAttribute("fill",E[o.color]||E.blue),m.setAttribute("data-type","week"),m.setAttribute("data-label",o.label),m.setAttribute("data-day",vn[o.dayOfWeek]),m.setAttribute("data-time",`${o.startHour}:${String(o.startMinute).padStart(2,"0")} - ${o.endHour}:${String(o.endMinute).padStart(2,"0")}`),t.appendChild(m)}if(this.config.showCurrentTime){let l=((r.getDay()+6)%7+.5)*a-Math.PI/2,c=v+n*Math.cos(l),d=v+n*Math.sin(l),u=v+e*Math.cos(l),h=v+e*Math.sin(l),p=document.createElementNS(P,"line");p.setAttribute("x1",String(c)),p.setAttribute("y1",String(d)),p.setAttribute("x2",String(u)),p.setAttribute("y2",String(h)),p.setAttribute("class","radcal-multi-now-line"),t.appendChild(p)}}renderMonthRing(t,e,n){let r=new Date,a=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),s=2*Math.PI/a,o=document.createElementNS(P,"circle");o.setAttribute("cx",String(v)),o.setAttribute("cy",String(v)),o.setAttribute("r",String((e+n)/2)),o.setAttribute("fill","none"),o.setAttribute("stroke","var(--background-modifier-border)"),o.setAttribute("stroke-width",String(e-n)),o.setAttribute("class","radcal-multi-ring-bg"),t.appendChild(o);for(let l=1;l<=a;l+=5){let c=(l-1)*s-Math.PI/2,d=v+n*Math.cos(c),u=v+n*Math.sin(c),h=v+e*Math.cos(c),p=v+e*Math.sin(c),m=document.createElementNS(P,"line");m.setAttribute("x1",String(d)),m.setAttribute("y1",String(u)),m.setAttribute("x2",String(h)),m.setAttribute("y2",String(p)),m.setAttribute("class","radcal-multi-tick"),t.appendChild(m)}for(let l of this.monthBlocks){let c=(l.dayOfMonth-1)*s-Math.PI/2,d=l.endDay||l.dayOfMonth,u=d*s-Math.PI/2,h=document.createElementNS(P,"path");h.setAttribute("d",Gt(n+2,e-2,c,u)),h.setAttribute("class","radcal-multi-block"),h.setAttribute("fill",E[l.color]||E.blue),h.setAttribute("data-type","month"),h.setAttribute("data-label",l.label),h.setAttribute("data-days",l.endDay?`${l.dayOfMonth}-${d}`:String(l.dayOfMonth)),t.appendChild(h)}if(this.config.showCurrentTime){let l=(r.getDate()-.5)*s-Math.PI/2,c=v+n*Math.cos(l),d=v+n*Math.sin(l),u=v+e*Math.cos(l),h=v+e*Math.sin(l),p=document.createElementNS(P,"line");p.setAttribute("x1",String(c)),p.setAttribute("y1",String(d)),p.setAttribute("x2",String(u)),p.setAttribute("y2",String(h)),p.setAttribute("class","radcal-multi-now-line"),t.appendChild(p)}}renderCenterTime(t){let e=new Date,n=`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`,r=document.createElementNS(P,"text");r.setAttribute("x",String(v)),r.setAttribute("y",String(v)),r.setAttribute("class","radcal-multi-center-time"),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.textContent=n,t.appendChild(r)}setupTooltips(t){t.querySelectorAll(".radcal-multi-block").forEach(n=>{n.addEventListener("mouseenter",r=>{let a=r.target,s=a.getAttribute("data-type")||"",o=a.getAttribute("data-label")||"",l="";if(s==="day")l=a.getAttribute("data-time")||"";else if(s==="week"){let h=a.getAttribute("data-day")||"",p=a.getAttribute("data-time")||"";l=`${h} ${p}`}else s==="month"&&(l=`Tag ${a.getAttribute("data-days")||""}`);let c=document.createElement("div");c.className="radcal-multi-tooltip",c.innerHTML=`<strong>${l}</strong><br>${o}`,this.containerEl.appendChild(c);let d=r,u=this.containerEl.getBoundingClientRect();c.style.left=`${d.clientX-u.left+10}px`,c.style.top=`${d.clientY-u.top+10}px`}),n.addEventListener("mouseleave",()=>{let r=this.containerEl.querySelector(".radcal-multi-tooltip");r&&r.remove()})})}};var wn=class extends Yt.MarkdownRenderChild{constructor(t,e,n,r,a){super(t);this.app=e;this.service=n;this.config=r;this.openFile=a;this.unsubscribe=null;this.filterEngine=new Ie(e)}onload(){this.render(),this.unsubscribe=this.service.subscribeToUpdates(()=>{this.render()})}onunload(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}render(){var d;this.containerEl.empty();let t=(d=this.config.year)!=null?d:this.service.getCurrentYear(),e=this.loadFilteredEntries(t),r=new Le().render(this.config,e,t,(u,h,p)=>this.handleDayClick(u,h,p)),s=this.containerEl.createDiv({cls:"radcal-block-header"}).createEl("button",{cls:"radcal-edit-btn",attr:{"aria-label":"Edit source"}});s.innerHTML="&lt;/&gt;";let o=()=>{this.app.commands.executeCommandById("markdown:toggle-preview")};s.addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),o()}),this.containerEl.addEventListener("dblclick",u=>{let h=u.target;(h.classList.contains("radcal-block")||h.classList.contains("radcal-block-content")||h.tagName==="svg")&&(u.preventDefault(),u.stopPropagation(),o())});let l=this.containerEl.createDiv({cls:"radcal-tooltip"});this.containerEl.createDiv({cls:"radcal-block-content"}).appendChild(r),this.setupTooltips(r,l,t)}loadFilteredEntries(t){let e=new Map;if(this.config.dateProperty)return this.loadEntriesByProperty(t);for(let n=1;n<=12;n++){let r=x(t,n);for(let a=1;a<=r;a++){let s=C(t,n,a),o=`${t}-${String(n).padStart(2,"0")}-${String(a).padStart(2,"0")}`,l=[...this.service.getEntriesForDate(s)];if(this.config.filter&&(l=l.filter(c=>{let d=this.app.vault.getAbstractFileByPath(c.filePath);if(!(d instanceof Yt.TFile))return!1;let u=this.filterEngine.createContext(d);return this.filterEngine.evaluate(this.config.filter,u)})),!this.config.filter&&this.config.folder){let c=this.config.folder;l=l.filter(d=>d.metadata.folder===c||d.metadata.folder.startsWith(c+"/"))}if(!this.config.filter&&this.config.folders&&this.config.folders.length>0){let c=this.config.folders;l=l.filter(d=>c.some(u=>d.metadata.folder===u||d.metadata.folder.startsWith(u+"/")))}l.length>0&&e.set(o,l)}}return e}loadEntriesByProperty(t){var a,s;let e=new Map,n=this.config.dateProperty,r=this.app.vault.getMarkdownFiles();for(let o of r){if(this.config.filter){let m=this.filterEngine.createContext(o);if(!this.filterEngine.evaluate(this.config.filter,m))continue}let l=this.app.metadataCache.getFileCache(o),c=l==null?void 0:l.frontmatter;if(!c)continue;let d=c[n];if(!d)continue;let u=this.parseDate(d);if(!u||u.year!==t)continue;let h=`${u.year}-${String(u.month).padStart(2,"0")}-${String(u.day).padStart(2,"0")}`,p={id:o.path,filePath:o.path,fileName:o.name,displayName:o.basename,startDate:u,endDate:null,isMultiDay:!1,isAnniversary:!1,metadata:{tags:[],folder:(s=(a=o.parent)==null?void 0:a.path)!=null?s:"",properties:{}}};e.has(h)||e.set(h,[]),e.get(h).push(p)}return e}parseDate(t){if(!t)return null;if(t instanceof Date)return C(t.getFullYear(),t.getMonth()+1,t.getDate());if(typeof t=="string"){let e=t.match(/(\d{4})-(\d{2})-(\d{2})/);if(e)return C(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10))}return null}handleDayClick(t,e,n){n.length===1?this.openFile(n[0].filePath):n.length>1&&this.showEntryMenu(t,e,n)}showEntryMenu(t,e,n){let r=new Yt.Menu,a=`${e.day}.${e.month}.${e.year}`;r.addItem(s=>{s.setTitle(a).setIcon("calendar").setDisabled(!0)}),r.addSeparator();for(let s of n.slice(0,15))r.addItem(o=>{o.setTitle(s.displayName).setIcon("file-text").onClick(()=>{this.openFile(s.filePath)})});n.length>15&&r.addItem(s=>{s.setTitle(`+${n.length-15} more...`).setDisabled(!0)}),r.showAtMouseEvent(t)}setupTooltips(t,e,n){t.querySelectorAll(".rc-day-arc[data-date]").forEach(a=>{a.addEventListener("mouseenter",s=>{var A;let o=s,l=s.target,c=l.getAttribute("data-date")||"",d=l.getAttribute("data-count")||"0",u=((A=l.getAttribute("data-names"))==null?void 0:A.split("|"))||[],[h,p,m]=c.split("-").map(Number),f=`<div class="radcal-tooltip-date">${`${m}.${p}.${h}`}</div>`;if(u.length>0){f+='<div class="radcal-tooltip-entries">';for(let w of u.slice(0,5))f+=`<div class="radcal-tooltip-entry">${w}</div>`;u.length>5&&(f+=`<div class="radcal-tooltip-more">+${u.length-5} more</div>`),f+="</div>"}e.innerHTML=f,e.style.display="block";let S=this.containerEl.getBoundingClientRect();e.style.left=`${o.clientX-S.left+15}px`,e.style.top=`${o.clientY-S.top+15}px`}),a.addEventListener("mouseleave",()=>{e.style.display="none"})})}},Oe=class{constructor(i,t,e){this.app=i;this.service=t;this.openFile=e}process(i,t,e){try{if(i.match(/^type:\s*(day|week|month)/im)){let{config:o,dayBlocks:l,weekBlocks:c,monthBlocks:d}=dr(i),u=l.length>0,h=c.length>0,p=d.length>0,m=(u?1:0)+(h?1:0)+(p?1:0);console.log("[Radcal] Time blocks:",{dayBlocks:l.length,weekBlocks:c.length,monthBlocks:d.length});let y;if(m>1){let f=t.createDiv({cls:"radcal-multi-container"});y=new Ve(f,o,l,c,d)}else{let f=t.createDiv({cls:`radcal-${o.type}-container`});switch(o.type){case"day":y=new Re(f,o,l);break;case"week":y=new Fe(f,o,c);break;case"month":y=new $e(f,o,d);break;default:throw new Error(`Unknown type: ${o.type}`)}}e.addChild(y);return}let r=ir(i),a=t.createDiv({cls:"radcal-block"}),s=new wn(a,this.app,this.service,r,this.openFile);e.addChild(s)}catch(n){t.createDiv({cls:"radcal-error",text:`Radcal Error: ${n instanceof Error?n.message:String(n)}`})}}};var gr=require("obsidian");z();var Dn=400,_=Dn/2,_t=180,ur=100,hr=75,ht="http://www.w3.org/2000/svg";function Kr(g){let i=g.trim().split(`
`),t={showCurrentTime:!0,startHour:0},e=[],n=!1,r=[];for(let a of i){let s=a.trim();if(s==="---"){n?(t=Zr(r),n=!1,r=[]):n=!0;continue}if(n){r.push(s);continue}if(!s)continue;let o=s.match(/^(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})\s+(.+?)(?:\s*\|\s*(\w+))?$/);o&&e.push({startHour:parseInt(o[1],10),startMinute:parseInt(o[2],10),endHour:parseInt(o[3],10),endMinute:parseInt(o[4],10),label:o[5].trim(),color:o[6]||"blue"})}return{config:t,blocks:e}}function Zr(g){let i={showCurrentTime:!0,startHour:0};for(let t of g){let[e,n]=t.split(":").map(r=>r.trim());e==="showCurrentTime"?i.showCurrentTime=n!=="false":e==="startHour"&&(i.startHour=parseInt(n,10)||0)}return i}function Be(g,i,t){let e=(g-t)*60+i;return e=(e%(24*60)+24*60)%(24*60),e/(24*60)*2*Math.PI-Math.PI/2}function Jr(g,i,t,e){let n=_+g*Math.cos(t),r=_+g*Math.sin(t),a=_+i*Math.cos(t),s=_+i*Math.sin(t),o=_+i*Math.cos(e),l=_+i*Math.sin(e),c=_+g*Math.cos(e),d=_+g*Math.sin(e),u=e-t>Math.PI?1:0;return[`M ${n} ${r}`,`L ${a} ${s}`,`A ${i} ${i} 0 ${u} 1 ${o} ${l}`,`L ${c} ${d}`,`A ${g} ${g} 0 ${u} 0 ${n} ${r}`,"Z"].join(" ")}var Mn=class extends gr.MarkdownRenderChild{constructor(t,e,n){super(t);this.config=e;this.blocks=n;this.updateInterval=null}onload(){this.render(),this.config.showCurrentTime&&(this.updateInterval=window.setInterval(()=>{this.render()},60*1e3))}onunload(){this.updateInterval&&(window.clearInterval(this.updateInterval),this.updateInterval=null)}render(){this.containerEl.empty();let t=document.createElementNS(ht,"svg");t.setAttribute("viewBox",`0 0 ${Dn} ${Dn}`),t.setAttribute("class","radcal-day-svg"),t.style.width="100%",t.style.height="auto",t.style.maxWidth="400px";let e=document.createElementNS(ht,"circle");e.setAttribute("cx",String(_)),e.setAttribute("cy",String(_)),e.setAttribute("r",String(_t)),e.setAttribute("class","radcal-day-bg"),t.appendChild(e);let n=document.createElementNS(ht,"circle");n.setAttribute("cx",String(_)),n.setAttribute("cy",String(_)),n.setAttribute("r",String(ur)),n.setAttribute("class","radcal-day-center"),t.appendChild(n),this.renderHourMarkers(t);for(let a of this.blocks)this.renderTimeBlock(t,a);this.config.showCurrentTime&&this.renderCurrentTime(t),this.renderCenterText(t),this.containerEl.createDiv({cls:"radcal-day-wrapper"}).appendChild(t),this.setupTooltips(t)}renderHourMarkers(t){for(let e=0;e<24;e++){let n=Be(e,0,this.config.startHour),r=_t-10,a=_t,s=_+r*Math.cos(n),o=_+r*Math.sin(n),l=_+a*Math.cos(n),c=_+a*Math.sin(n),d=document.createElementNS(ht,"line");if(d.setAttribute("x1",String(s)),d.setAttribute("y1",String(o)),d.setAttribute("x2",String(l)),d.setAttribute("y2",String(c)),d.setAttribute("class","radcal-day-tick"),t.appendChild(d),e%3===0){let u=_+hr*Math.cos(n),h=_+hr*Math.sin(n),p=document.createElementNS(ht,"text");p.setAttribute("x",String(u)),p.setAttribute("y",String(h)),p.setAttribute("class","radcal-day-hour-label"),p.setAttribute("text-anchor","middle"),p.setAttribute("dominant-baseline","central"),p.textContent=String(e),t.appendChild(p)}}}renderTimeBlock(t,e){let n=Be(e.startHour,e.startMinute,this.config.startHour),r=Be(e.endHour,e.endMinute,this.config.startHour),a=document.createElementNS(ht,"path");a.setAttribute("d",Jr(ur+5,_t-15,n,r)),a.setAttribute("class","radcal-day-block"),a.setAttribute("fill",E[e.color]||E.blue),a.setAttribute("data-label",e.label),a.setAttribute("data-time",`${e.startHour}:${String(e.startMinute).padStart(2,"0")} - ${e.endHour}:${String(e.endMinute).padStart(2,"0")}`),t.appendChild(a)}renderCurrentTime(t){let e=new Date,n=Be(e.getHours(),e.getMinutes(),this.config.startHour),r=_,a=_,s=_+(_t-5)*Math.cos(n),o=_+(_t-5)*Math.sin(n),l=document.createElementNS(ht,"line");l.setAttribute("x1",String(r)),l.setAttribute("y1",String(a)),l.setAttribute("x2",String(s)),l.setAttribute("y2",String(o)),l.setAttribute("class","radcal-day-now"),t.appendChild(l);let c=document.createElementNS(ht,"circle");c.setAttribute("cx",String(s)),c.setAttribute("cy",String(o)),c.setAttribute("r","6"),c.setAttribute("class","radcal-day-now-dot"),t.appendChild(c)}renderCenterText(t){let e=new Date,n=`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`,r=document.createElementNS(ht,"text");r.setAttribute("x",String(_)),r.setAttribute("y",String(_)),r.setAttribute("class","radcal-day-center-time"),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.textContent=n,t.appendChild(r)}setupTooltips(t){t.querySelectorAll(".radcal-day-block").forEach(n=>{n.addEventListener("mouseenter",r=>{let a=r.target,s=a.getAttribute("data-label")||"",o=a.getAttribute("data-time")||"",l=document.createElement("div");l.className="radcal-day-tooltip",l.innerHTML=`<strong>${o}</strong><br>${s}`,this.containerEl.appendChild(l);let c=r,d=this.containerEl.getBoundingClientRect();l.style.left=`${c.clientX-d.left+10}px`,l.style.top=`${c.clientY-d.top+10}px`}),n.addEventListener("mouseleave",()=>{let r=this.containerEl.querySelector(".radcal-day-tooltip");r&&r.remove()})})}},Ge=class{constructor(i){this.app=i}process(i,t,e){try{let{config:n,blocks:r}=Kr(i),a=t.createDiv({cls:"radcal-day-container"}),s=new Mn(a,n,r);e.addChild(s)}catch(n){t.createDiv({cls:"radcal-error",text:`Day View Error: ${n instanceof Error?n.message:String(n)}`})}}};var D=require("obsidian");z();var Ye=require("obsidian"),st=class extends Ye.AbstractInputSuggest{constructor(i,t){super(i,t),this.textInputEl=t}getSuggestions(i){let t=this.getAllFolders(),e=i.toLowerCase().trim();return e===""?t:t.filter(n=>n.path.toLowerCase().includes(e))}renderSuggestion(i,t){t.addClass("folder-suggest-item");let e=t.createSpan({cls:"folder-suggest-icon"});e.innerHTML=this.getFolderIcon(),t.createSpan({cls:"folder-suggest-text"}).setText(i.path||"/")}selectSuggestion(i,t){this.textInputEl.value=i.path,this.textInputEl.trigger("input"),this.close()}getAllFolders(){let i=[],t=n=>{i.push(n);for(let r of n.children)r instanceof Ye.TFolder&&t(r)},e=this.app.vault.getRoot();return t(e),i.sort((n,r)=>n.isRoot()?-1:r.isRoot()?1:n.path.localeCompare(r.path))}getFolderIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>'}};var _e=class extends D.PluginSettingTab{constructor(t,e){super(t,e);this.activeTab="general";this.plugin=e}display(){let{containerEl:t}=this;t.empty(),this.createVersionHeader(t),this.createTabNavigation(t);let e=t.createDiv({cls:"radcal-settings-content"});this.renderActiveTab(e)}createTabNavigation(t){let e=[{id:"general",label:"General"},{id:"lifeview",label:"Life View"},{id:"rings",label:"Rings"},{id:"memento",label:"Memento Mori"},{id:"sync",label:"Sync"},{id:"advanced",label:"Advanced"},{id:"help",label:"Help"}],n=t.createDiv({cls:"radcal-settings-tabs"});for(let r of e)n.createEl("button",{text:r.label,cls:`radcal-settings-tab ${this.activeTab===r.id?"is-active":""}`}).addEventListener("click",()=>{this.activeTab=r.id,this.display()})}renderActiveTab(t){switch(this.activeTab){case"general":this.renderGeneralTab(t);break;case"lifeview":this.renderLifeViewTab(t);break;case"rings":this.renderRingsTab(t);break;case"memento":this.renderMementoTab(t);break;case"sync":this.renderSyncTab(t);break;case"advanced":this.renderAdvancedTab(t);break;case"help":this.renderHelpTab(t);break}}renderSyncTab(t){this.createCalendarSyncSection(t)}renderGeneralTab(t){this.createViewModeSection(t),this.createDailyNotesSection(t),this.createTemplateSection(t)}renderLifeViewTab(t){this.createLifeViewSection(t)}renderRingsTab(t){this.createRingConfigSection(t)}renderMementoTab(t){t.createEl("h3",{text:"Memento Mori"}),t.createEl("p",{text:"Konfiguriere die Zeit-Ringe f\xFCr die Memento Mori Ansicht.",cls:"setting-item-description"});let e=[...this.plugin.settings.mementoMori.rings].sort((o,l)=>o.order-l.order),n=t.createDiv({cls:"memento-ring-list"});for(let o=0;o<e.length;o++){let l=e[o];this.createMementoRingItem(n,l,o,e.length)}t.createEl("hr"),t.createEl("h4",{text:"Zeitbl\xF6cke in Periodic Notes"}),t.createEl("p",{text:"F\xFCge diese Codebl\xF6cke in deine Periodic Notes ein, um Zeitbl\xF6cke in den Ringen anzuzeigen:",cls:"setting-item-description"});let r=t.createDiv({cls:"memento-syntax-block"});r.createEl("strong",{text:"Daily Note:"}),r.createEl("pre",{text:"```radcal\ntype: day\n09:00-10:00 blue: Meeting\n14:00-16:00 orange: Projektarbeit\n```"});let a=t.createDiv({cls:"memento-syntax-block"});a.createEl("strong",{text:"Weekly Note:"}),a.createEl("pre",{text:"```radcal\ntype: week\nMo 09:00-17:00 blue: Arbeit\nMi 14:00-15:00 green: Team Meeting\nSa 10:00-12:00 orange: Sport\n```"});let s=t.createDiv({cls:"memento-syntax-block"});s.createEl("strong",{text:"Monthly Note:"}),s.createEl("pre",{text:"```radcal\ntype: month\n15 red: Zahnarzt\n20-22 blue: Konferenz\n25 green: Weihnachten\n```"}),t.createEl("p",{text:"Farben: blue, green, red, orange, purple, yellow, cyan, pink, teal, lime, amber, indigo",cls:"setting-item-description"}),t.createEl("p",{text:"Hinweis: Das Periodic Notes Plugin muss installiert und konfiguriert sein.",cls:"setting-item-description mod-warning"}),t.createEl("hr"),new D.Setting(t).setName("Auf Standardwerte zur\xFCcksetzen").setDesc("Setzt alle Memento Mori Einstellungen auf die Standardwerte zur\xFCck.").addButton(o=>o.setButtonText("Zur\xFCcksetzen").onClick(async()=>{let{DEFAULT_MEMENTO_MORI_SETTINGS:l}=await Promise.resolve().then(()=>(z(),Ot));this.plugin.settings.mementoMori={...l},await this.plugin.saveSettings(),this.display(),new D.Notice("Memento Mori Einstellungen zur\xFCckgesetzt")}))}createMementoRingItem(t,e,n,r){let a=t.createDiv({cls:"memento-ring-item"}),s=a.createDiv({cls:"memento-ring-arrows"});s.createEl("button",{text:"\u2191",cls:"memento-arrow-btn",attr:{disabled:n===0?"true":void 0}}).addEventListener("click",async()=>{n>0&&await this.swapMementoRings(n,n-1)}),s.createEl("button",{text:"\u2193",cls:"memento-arrow-btn",attr:{disabled:n===r-1?"true":void 0}}).addEventListener("click",async()=>{n<r-1&&await this.swapMementoRings(n,n+1)});let c=a.createDiv({cls:"memento-ring-info"}),d=c.createDiv({cls:"memento-ring-label"});if(d.createEl("strong",{text:e.label}),d.createEl("span",{text:` (${this.getMementoRingDescription(e)})`,cls:"memento-ring-desc"}),e.id==="custom-short"&&e.enabled){let p=c.createDiv({cls:"memento-ring-custom"});p.createEl("span",{text:"Tage: "});let m=p.createEl("input",{type:"number",value:String(e.customDays||10),cls:"memento-ring-input"});m.min="2",m.max="30",m.addEventListener("change",async()=>{let y=this.plugin.settings.mementoMori.rings.findIndex(f=>f.id===e.id);y>=0&&(this.plugin.settings.mementoMori.rings[y].customDays=parseInt(m.value)||10,await this.plugin.saveSettings())})}if(e.id==="season"&&e.enabled){let p=c.createDiv({cls:"memento-ring-custom"});p.createEl("span",{text:"Monate: "});let m=p.createEl("input",{type:"number",value:String(e.customMonths||3),cls:"memento-ring-input"});m.min="1",m.max="6",m.addEventListener("change",async()=>{let y=this.plugin.settings.mementoMori.rings.findIndex(f=>f.id===e.id);y>=0&&(this.plugin.settings.mementoMori.rings[y].customMonths=parseInt(m.value)||3,await this.plugin.saveSettings())})}let h=a.createDiv({cls:"memento-ring-toggle"}).createEl("input",{type:"checkbox",cls:"checkbox-container"});h.checked=e.enabled,h.addEventListener("change",async()=>{let p=this.plugin.settings.mementoMori.rings.findIndex(m=>m.id===e.id);p>=0&&(this.plugin.settings.mementoMori.rings[p].enabled=h.checked,await this.plugin.saveSettings(),this.display())})}async swapMementoRings(t,e){let n=this.plugin.settings.mementoMori.rings,r=[...n].sort((o,l)=>o.order-l.order),a=r[t],s=r[e];if(a&&s){let o=a.order,l=n.findIndex(d=>d.id===a.id),c=n.findIndex(d=>d.id===s.id);n[l].order=s.order,n[c].order=o,await this.plugin.saveSettings(),this.display()}}getMementoRingDescription(t){switch(t.id){case"hour":return"60 Minuten";case"day":return"24 Stunden";case"custom-short":return`${t.customDays||10} Tage`;case"month":return"~30 Tage";case"season":return`${t.customMonths||3} Monate`;case"year":return"365 Tage";case"life":return"Lebensspanne";default:return t.id}}renderAdvancedTab(t){this.createPresetsSection(t),this.createOuterSegmentsSection(t),this.createCenterDisplaySection(t),this.createMigrationSection(t)}createVersionHeader(t){var a;let n=t.createDiv({cls:"radcal-settings-header"}).createEl("div",{cls:"radcal-settings-title"});n.createEl("span",{text:"Radial Calendar",cls:"radcal-settings-name"});let r=((a=this.plugin.manifest)==null?void 0:a.version)||"unknown";n.createEl("span",{text:`v${r}`,cls:"radcal-settings-version"}),t.createEl("hr",{cls:"radcal-settings-separator"})}createViewModeSection(t){new D.Setting(t).setName("View Mode").setDesc("Switch between different calendar views").addDropdown(e=>{e.addOption("annual","Annual View").addOption("life","Life View").addOption("quarter","Quarter View").addOption("month","Month View").addOption("custom","Custom Period").setValue(this.plugin.settings.currentView).onChange(async n=>{this.plugin.settings.currentView=n,await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.currentView==="custom"&&new D.Setting(t).setName("Custom Period").setDesc("Format: 10d (10 days), 2w (2 weeks), 3m (3 months)").addText(e=>{e.setPlaceholder("e.g. 10d, 2w, 3m").setValue(this.plugin.settings.customPeriodString).onChange(async n=>{this.plugin.settings.customPeriodString=n,await this.plugin.saveSettings()})})}createLifeViewSection(t){t.createEl("h3",{text:"Life View Settings"}),new D.Setting(t).setName("Birth Date").setDesc("Your birth date (YYYY-MM-DD) for precise calculation").addText(n=>{n.setPlaceholder("e.g. 1977-03-27").setValue(this.plugin.settings.birthDate||"").onChange(async r=>{let a=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(a){let s=parseInt(a[1],10),o=parseInt(a[2],10),l=parseInt(a[3],10);s>1900&&s<=new Date().getFullYear()&&o>=1&&o<=12&&l>=1&&l<=31&&(this.plugin.settings.birthDate=r,this.plugin.settings.birthYear=s,await this.plugin.saveSettings())}else r===""&&(this.plugin.settings.birthDate=void 0,await this.plugin.saveSettings())})}),new D.Setting(t).setName("Birth Year (Fallback)").setDesc("Used when no full date is provided").addText(n=>{n.setPlaceholder("e.g. 1990").setValue(String(this.plugin.settings.birthYear)).onChange(async r=>{let a=parseInt(r,10);!isNaN(a)&&a>1900&&a<=new Date().getFullYear()&&(this.plugin.settings.birthYear=a,await this.plugin.saveSettings())})}),new D.Setting(t).setName("Expected Lifespan").setDesc("Expected lifespan in years").addText(n=>{n.setPlaceholder("e.g. 85").setValue(String(this.plugin.settings.expectedLifespan)).onChange(async r=>{let a=parseInt(r,10);!isNaN(a)&&a>0&&a<=150&&(this.plugin.settings.expectedLifespan=a,await this.plugin.saveSettings())})}),t.createEl("h4",{text:"Life Phases"}),new D.Setting(t).setName("Life Phases Folder (Legacy)").setDesc("Folder for phase-* properties. Or use radcal-showInLife: true anywhere.").addText(n=>{n.setPlaceholder("e.g. Life/Phases").setValue(this.plugin.settings.lifePhasesFolder).onChange(async r=>{this.plugin.settings.lifePhasesFolder=r,await this.plugin.saveSettings()}),new st(this.app,n.inputEl)});let e=t.createDiv({cls:"setting-item-description"});e.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Option 1: Unified Properties (recommended)</strong><br>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
radcal-start: 1983-09-01<br>
radcal-end: 1987-07-15<br>
radcal-color: blue<br>
radcal-label: Elementary School<br>
radcal-showInLife: true<br>
---
        </code>
        <br>
        <strong>Option 2: Legacy (folder-based)</strong><br>
        Files in the folder above with <code>phase-start</code>, <code>phase-end</code>, etc.<br><br>
        <em>Leave end empty for "ongoing" phases (shows faded arc until life expectancy)</em>
      </p>
    `}createDailyNotesSection(t){t.createEl("h3",{text:"Daily Notes"}),new D.Setting(t).setName("Notes Folder").setDesc("Folder where new notes are created (empty = vault root)").addText(n=>{n.setPlaceholder("e.g. Daily Notes").setValue(this.plugin.settings.dailyNoteFolder).onChange(async r=>{this.plugin.settings.dailyNoteFolder=r,await this.plugin.saveSettings()}),new st(this.app,n.inputEl)}),new D.Setting(t).setName("Filter Folder").setDesc("Only show notes from this folder (empty = all)").addText(n=>{n.setPlaceholder("e.g. Journal").setValue(this.plugin.settings.calendarFilterFolder).onChange(async r=>{this.plugin.settings.calendarFilterFolder=r,await this.plugin.saveSettings()}),new st(this.app,n.inputEl)}),new D.Setting(t).setName("Filename Format").setDesc("Format for new notes (YYYY-MM-DD)").addText(n=>{n.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.periodicNotesFormat.daily).onChange(async r=>{this.plugin.settings.periodicNotesFormat={...this.plugin.settings.periodicNotesFormat,daily:r||"YYYY-MM-DD"},await this.plugin.saveSettings()})}),new D.Setting(t).setName("Annual Recurring").setDesc("Folder for birthdays, anniversaries (use XXXX-MM-DD format, shown every year on that date)").addText(n=>{n.setPlaceholder("e.g. Birthdays").setValue(this.plugin.settings.annualRecurringFolder).onChange(async r=>{this.plugin.settings.annualRecurringFolder=r,await this.plugin.saveSettings()}),new st(this.app,n.inputEl)}),t.createEl("h4",{text:"Anniversary Properties"}),new D.Setting(t).setName("Additional Date Properties").setDesc("Comma-separated list of YAML properties to use for anniversary dates (in addition to radcal-start/radcal-end)").addText(n=>{var r;n.setPlaceholder("e.g. Birthday, Todestag, Hochzeitstag").setValue(((r=this.plugin.settings.anniversaryDateProperties)==null?void 0:r.join(", "))||"").onChange(async a=>{let s=a.split(",").map(o=>o.trim()).filter(o=>o.length>0);this.plugin.settings.anniversaryDateProperties=s,await this.plugin.saveSettings()})});let e=t.createDiv({cls:"setting-item-description"});e.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Anniversary Properties:</strong><br>
        Use <code>radcal-annual: true</code> to mark a note as anniversary.<br><br>
        <strong>Date sources (checked in order):</strong><br>
        1. <code>radcal-annual-fix</code> - Single fixed date (overrides all)<br>
        2. <code>radcal-start</code> / <code>radcal-end</code> - Birth + death dates<br>
        3. Properties from list above (e.g., <code>Birthday</code>)<br><br>
        <strong>Example:</strong>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
radcal-annual: true<br>
Birthday: 1982-09-24<br>
---
        </code>
      </p>
    `}createCalendarSyncSection(t){t.createEl("h3",{text:"Calendar Sync (Google Calendar)"}),(this.plugin.settings.calendarSources||[]).forEach((r,a)=>{this.createCalendarSourceSettings(t,r,a)}),new D.Setting(t).setName("Add Calendar Source").setDesc("Add a new Google Calendar or iCal source").addButton(r=>{r.setButtonText("+ Add Calendar").setCta().onClick(async()=>{let a={id:`gcal_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:"New Calendar",url:"",folder:"Calendar/Google",color:"blue",syncOnStart:!0,syncIntervalMinutes:0,enabled:!0,showAsRing:!0,showSpanningArcs:!0};this.plugin.settings.calendarSources||(this.plugin.settings.calendarSources=[]),this.plugin.settings.calendarSources.push(a),await this.plugin.saveSettings(),this.display()})});let n=t.createDiv({cls:"setting-item-description"});n.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>How to get your Google Calendar URL:</strong><br>
        1. Open Google Calendar \u2192 Settings \u2192 Calendar Settings<br>
        2. Select your calendar \u2192 Integrate calendar<br>
        3. Copy "Secret address in iCal format"<br><br>
        <em>Note: This URL is private and contains a secret key. Never share it publicly.</em>
      </p>
    `}createCalendarSourceSettings(t,e,n){let r=t.createEl("details",{cls:"radcal-calendar-details"}),a=r.createEl("summary",{cls:"radcal-calendar-summary"}),s=a.createSpan({cls:"radcal-calendar-swatch"});s.style.backgroundColor=E[e.color];let o=a.createSpan({text:e.name||`Calendar ${n+1}`,cls:"radcal-calendar-title"});e.folder&&a.createSpan({text:` \u2014 ${e.folder}`,cls:"radcal-calendar-folder"});let l=a.createSpan({cls:"radcal-calendar-status"});l.textContent=e.enabled?"\u25CF":"\u25CB",l.style.color=e.enabled?"var(--text-success)":"var(--text-muted)",l.setAttribute("title",e.enabled?"Enabled":"Disabled");let c=r.createDiv({cls:"radcal-calendar-content"});if(new D.Setting(c).setName("Name").setDesc("Display name for this calendar").addText(d=>{d.setPlaceholder("e.g. Work Calendar").setValue(e.name).onChange(async u=>{e.name=u,await this.plugin.saveSettings(),o.textContent=u||`Calendar ${n+1}`})}),new D.Setting(c).setName("iCal URL").setDesc("Private iCal/ICS URL (from Google Calendar settings)").addText(d=>{d.setPlaceholder("https://calendar.google.com/calendar/ical/...").setValue(e.url).onChange(async u=>{e.url=u,await this.plugin.saveSettings()}),d.inputEl.style.width="100%",d.inputEl.type="password"}),new D.Setting(c).setName("Target Folder").setDesc("Where synced events will be saved").addText(d=>{d.setPlaceholder("e.g. Calendar/Google/Work").setValue(e.folder).onChange(async u=>{e.folder=u,await this.plugin.saveSettings();let h=a.querySelector(".radcal-calendar-folder");h&&(h.textContent=u?` \u2014 ${u}`:"")}),new st(this.app,d.inputEl)}),new D.Setting(c).setName("Color").addDropdown(d=>{Object.keys(E).forEach(u=>{d.addOption(u,this.formatColorName(u))}),d.setValue(e.color).onChange(async u=>{e.color=u,await this.plugin.saveSettings(),s.style.backgroundColor=E[u]})}),new D.Setting(c).setName("Enabled").setDesc("Enable or disable this calendar source").addToggle(d=>{d.setValue(e.enabled).onChange(async u=>{e.enabled=u,await this.plugin.saveSettings(),l.textContent=u?"\u25CF":"\u25CB",l.style.color=u?"var(--text-success)":"var(--text-muted)"})}),new D.Setting(c).setName("Sync on Start").setDesc("Automatically sync when Obsidian starts").addToggle(d=>{d.setValue(e.syncOnStart).onChange(async u=>{e.syncOnStart=u,await this.plugin.saveSettings()})}),new D.Setting(c).setName("Auto-sync Interval").setDesc("How often to sync (0 = manual only)").addDropdown(d=>{d.addOption("0","Manual only").addOption("15","Every 15 minutes").addOption("30","Every 30 minutes").addOption("60","Every hour").addOption("360","Every 6 hours").addOption("1440","Daily").setValue(String(e.syncIntervalMinutes)).onChange(async u=>{e.syncIntervalMinutes=parseInt(u,10),await this.plugin.saveSettings()})}),new D.Setting(c).setName("Show as Ring").setDesc("Display this calendar as a ring in the annual view").addToggle(d=>{var u;d.setValue((u=e.showAsRing)!=null?u:!0).onChange(async h=>{e.showAsRing=h,await this.plugin.saveSettings()})}),new D.Setting(c).setName("Spanning Arcs").setDesc("Show multi-day events as continuous arcs").addToggle(d=>{var u;d.setValue((u=e.showSpanningArcs)!=null?u:!0).onChange(async h=>{e.showSpanningArcs=h,await this.plugin.saveSettings()})}),e.lastSync){let d=new Date(e.lastSync);c.createDiv({cls:"setting-item-description",text:`Last synced: ${d.toLocaleString()}`})}new D.Setting(c).addButton(d=>{d.setButtonText("Delete Calendar").setWarning().onClick(async()=>{this.plugin.settings.calendarSources.splice(n,1),await this.plugin.saveSettings(),this.display()})})}createRingConfigSection(t){t.createEl("h3",{text:"Configure Rings"});let e=this.plugin.settings.rings;e.forEach((n,r)=>{this.createRingSettings(t,n,r)}),new D.Setting(t).addButton(n=>{n.setButtonText("Add Ring").setCta().onClick(async()=>{let r=rn(e.length);this.plugin.settings.rings=[...e,r],await this.plugin.saveSettings(),this.display()})})}createRingSettings(t,e,n){let r=e.ringType==="global",a=t.createEl("details",{cls:"radcal-ring-details"}),s=a.createEl("summary",{cls:"radcal-ring-summary"}),o=s.createSpan({cls:"radcal-ring-swatch"});o.style.backgroundColor=E[e.color];let l=r?"\u{1F310} "+e.name:e.name||`Ring ${n+1}`;s.createSpan({text:l,cls:"radcal-ring-title"}),e.folder&&!r?s.createSpan({text:` \u2014 ${e.folder}`,cls:"radcal-ring-folder"}):r&&s.createSpan({text:" \u2014 Vault-wide (radcal-showInAnnual)",cls:"radcal-ring-folder"});let c=s.createSpan({cls:"radcal-ring-order-btns"}),d=c.createEl("button",{cls:"radcal-order-btn",attr:{"aria-label":"Move up (outer)"}});d.textContent="\u25B2",d.disabled=n===0,d.addEventListener("click",async p=>{p.preventDefault(),p.stopPropagation(),n>0&&await this.swapRings(n,n-1)});let u=c.createEl("button",{cls:"radcal-order-btn",attr:{"aria-label":"Move down (inner)"}});u.textContent="\u25BC",u.disabled=n===this.plugin.settings.rings.length-1,u.addEventListener("click",async p=>{p.preventDefault(),p.stopPropagation(),n<this.plugin.settings.rings.length-1&&await this.swapRings(n,n+1)});let h=a.createDiv({cls:"radcal-ring-content"});if(new D.Setting(h).setName("Name").addText(p=>{p.setPlaceholder("Ring Name").setValue(e.name).onChange(async m=>{await this.updateRing(n,{name:m});let y=s.querySelector(".radcal-ring-title");y&&(y.textContent=r?"\u{1F310} "+m:m||`Ring ${n+1}`)})}),!r)new D.Setting(h).setName("Folder").setDesc("Folder path in vault").addText(p=>{p.setPlaceholder("e.g. Projects/2024").setValue(e.folder).onChange(async m=>{await this.updateRing(n,{folder:m});let y=s.querySelector(".radcal-ring-folder");y&&(y.textContent=m?` \u2014 ${m}`:"")}),new st(this.app,p.inputEl)});else{let p=h.createDiv({cls:"setting-item-description"});p.innerHTML=`
        <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
          <strong>Global Ring:</strong> Automatically shows all notes with
          <code>radcal-showInAnnual: true</code> from the entire vault.<br>
          No folder configuration needed.
        </p>
      `}new D.Setting(h).setName("Color").setDesc(r?"Default color (individual notes can override)":void 0).addDropdown(p=>{Object.keys(E).forEach(m=>{p.addOption(m,this.formatColorName(m))}),p.setValue(e.color).onChange(async m=>{await this.updateRing(n,{color:m}),o.style.backgroundColor=E[m]})}),r&&new D.Setting(h).setName("Enabled").setDesc("Enable or disable the Global Ring").addToggle(p=>{p.setValue(e.enabled).onChange(async m=>{await this.updateRing(n,{enabled:m})})}),r||(new D.Setting(h).setName("Spanning Arcs").setDesc("Show multi-day events as continuous arcs").addToggle(p=>{var m;p.setValue((m=e.showSpanningArcs)!=null?m:!1).onChange(async y=>{await this.updateRing(n,{showSpanningArcs:y}),this.display()})}),e.showSpanningArcs&&this.createSpanningArcsPropertySettings(h,e,n),new D.Setting(h).addButton(p=>{p.setButtonText("Delete Ring").setWarning().onClick(async()=>{this.plugin.settings.rings=this.plugin.settings.rings.filter((m,y)=>y!==n),this.plugin.settings.rings=this.plugin.settings.rings.map((m,y)=>({...m,order:y})),await this.plugin.saveSettings(),this.display()})}))}async swapRings(t,e){let n=this.plugin.settings.rings;t<0||e<0||t>=n.length||e>=n.length||([n[t],n[e]]=[n[e],n[t]],n.forEach((r,a)=>{r.order=a}),await this.plugin.saveSettings(),this.display())}async updateRing(t,e){let n=[...this.plugin.settings.rings];n[t]={...n[t],...e},this.plugin.settings.rings=n,await this.plugin.saveSettings()}createSpanningArcsPropertySettings(t,e,n){let r=t.createDiv({cls:"radial-calendar-segment-config"});new D.Setting(r).setName("Start Date Property").setDesc("YAML frontmatter field for start date").addText(a=>{a.setPlaceholder("radcal-start").setValue(e.startDateField||"radcal-start").onChange(async s=>{this.updateRing(n,{startDateField:s||"radcal-start"})})}),new D.Setting(r).setName("End Date Property").setDesc("YAML frontmatter field for end date").addText(a=>{a.setPlaceholder("radcal-end").setValue(e.endDateField||"radcal-end").onChange(async s=>{this.updateRing(n,{endDateField:s||"radcal-end"})})}),new D.Setting(r).setName("Color Property").setDesc("YAML frontmatter field for color").addText(a=>{a.setPlaceholder("radcal-color").setValue(e.colorField||"radcal-color").onChange(async s=>{this.updateRing(n,{colorField:s||"radcal-color"})})}),new D.Setting(r).setName("Label Property").setDesc("YAML frontmatter field for label").addText(a=>{a.setPlaceholder("radcal-label").setValue(e.labelField||"radcal-label").onChange(async s=>{this.updateRing(n,{labelField:s||"radcal-label"})})})}formatColorName(t){return t.charAt(0).toUpperCase()+t.slice(1)}createOuterSegmentsSection(t){t.createEl("h3",{text:"Outer Segments"}),new D.Setting(t).setName("Segment Type").setDesc("Markers on the outer edge of the calendar").addDropdown(e=>{e.addOption("none","None").addOption("seasons","Seasons (4)").addOption("quarters","Quarters (4)").addOption("semester","Semesters (2)").addOption("ten-days","10-Day Phases (36)").addOption("weeks","Weeks (52)").addOption("custom","Custom").setValue(this.plugin.settings.annualSegmentType).onChange(async n=>{this.plugin.settings.annualSegmentType=n,await this.plugin.saveSettings(),this.display()})}),new D.Setting(t).setName("Show Labels").setDesc("Display segment labels").addToggle(e=>{e.setValue(this.plugin.settings.showSegmentLabels).onChange(async n=>{this.plugin.settings.showSegmentLabels=n,await this.plugin.saveSettings()})}),this.plugin.settings.annualSegmentType==="custom"&&this.createCustomSegmentsEditor(t),this.plugin.settings.currentView==="life"&&this.createLifeActsEditor(t)}createCustomSegmentsEditor(t){t.createEl("h4",{text:"Custom Segments"});let e=this.plugin.settings.customSegments;e.forEach((n,r)=>{this.createSegmentSettings(t,n,r)}),new D.Setting(t).addButton(n=>{n.setButtonText("Add Segment").onClick(async()=>{let r={id:`seg-${Date.now()}`,label:`Segment ${e.length+1}`,startDay:1,endDay:30};this.plugin.settings.customSegments=[...e,r],await this.plugin.saveSettings(),this.display()})})}createSegmentSettings(t,e,n){let r=t.createDiv({cls:"radial-calendar-segment-config"});new D.Setting(r).setName("Label").addText(a=>{a.setValue(e.label).onChange(async s=>{this.updateSegment(n,{label:s})})}),new D.Setting(r).setName("Start Day").setDesc("Day of year (1-365)").addText(a=>{a.setValue(String(e.startDay)).onChange(async s=>{let o=parseInt(s,10);!isNaN(o)&&o>=1&&o<=365&&this.updateSegment(n,{startDay:o})})}),new D.Setting(r).setName("End Day").setDesc("Day of year (1-365)").addText(a=>{a.setValue(String(e.endDay)).onChange(async s=>{let o=parseInt(s,10);!isNaN(o)&&o>=1&&o<=365&&this.updateSegment(n,{endDay:o})})}),new D.Setting(r).addButton(a=>{a.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.customSegments=this.plugin.settings.customSegments.filter((s,o)=>o!==n),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateSegment(t,e){let n=[...this.plugin.settings.customSegments];n[t]={...n[t],...e},this.plugin.settings.customSegments=n,await this.plugin.saveSettings()}createLifeActsEditor(t){t.createEl("h4",{text:"Life Acts"});let e=this.plugin.settings.lifeActs;e.forEach((n,r)=>{this.createLifeActSettings(t,n,r)}),new D.Setting(t).addButton(n=>{n.setButtonText("Add Life Act").onClick(async()=>{let r={id:`act-${Date.now()}`,label:`Act ${e.length+1}`,startAge:0,endAge:10};this.plugin.settings.lifeActs=[...e,r],await this.plugin.saveSettings(),this.display()})})}createLifeActSettings(t,e,n){let r=t.createDiv({cls:"radial-calendar-life-act-config"});new D.Setting(r).setName("Label").addText(a=>{a.setPlaceholder("e.g. Childhood").setValue(e.label).onChange(async s=>{this.updateLifeAct(n,{label:s})})}),new D.Setting(r).setName("Start Age").addText(a=>{a.setValue(String(e.startAge)).onChange(async s=>{let o=parseInt(s,10);!isNaN(o)&&o>=0&&this.updateLifeAct(n,{startAge:o})})}),new D.Setting(r).setName("End Age").addText(a=>{a.setValue(String(e.endAge)).onChange(async s=>{let o=parseInt(s,10);!isNaN(o)&&o>=0&&this.updateLifeAct(n,{endAge:o})})}),new D.Setting(r).setName("Color").addDropdown(a=>{a.addOption("","(Default)"),Object.keys(E).forEach(s=>{a.addOption(s,this.formatColorName(s))}),a.setValue(e.color||"").onChange(async s=>{this.updateLifeAct(n,{color:s||void 0})})}),new D.Setting(r).addButton(a=>{a.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.lifeActs=this.plugin.settings.lifeActs.filter((s,o)=>o!==n),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateLifeAct(t,e){let n=[...this.plugin.settings.lifeActs];n[t]={...n[t],...e},this.plugin.settings.lifeActs=n,await this.plugin.saveSettings()}createTemplateSection(t){t.createEl("h3",{text:"Templates"}),new D.Setting(t).setName("Template Folder").setDesc("Folder where templates are created").addText(e=>{e.setPlaceholder("e.g. Templates").setValue(this.plugin.settings.templateFolder||"Templates").onChange(async n=>{this.plugin.settings.templateFolder=n||"Templates",await this.plugin.saveSettings()}),new st(this.app,e.inputEl)}),new D.Setting(t).setName("Life Phase Template").setDesc("For life timeline phases (birth to death)").addButton(e=>{e.setButtonText("Create").onClick(async()=>{await this.createTemplate("Radial Calendar - Life Phase.md",Se)})}),new D.Setting(t).setName("Spanning Arc Template").setDesc("For date ranges (projects, events)").addButton(e=>{e.setButtonText("Create").onClick(async()=>{await this.createTemplate("Radial Calendar - Spanning Arc.md",Ae)})}),new D.Setting(t).setName("Anniversary Template").setDesc("For yearly recurring events (birthdays, etc.)").addButton(e=>{e.setButtonText("Create").onClick(async()=>{await this.createTemplate("Radial Calendar - Anniversary.md",ve)})}),new D.Setting(t).setName("Create All Templates").setDesc("Creates all templates at once").addButton(e=>{e.setButtonText("Create All").setCta().onClick(async()=>{await this.createAllTemplates()})})}async createTemplate(t,e){let n=this.plugin.settings.templateFolder||"Templates",r=`${n}/${t}`;try{return this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n),this.app.vault.getAbstractFileByPath(r)?(new D.Notice(`Template already exists: ${r}`),!1):(await this.app.vault.create(r,e),new D.Notice(`Template created: ${r}`),!0)}catch(a){return console.error("Failed to create template file:",a),new D.Notice(`Error creating template: ${t}`),!1}}async createAllTemplates(){let t=[{filename:"Radial Calendar - Life Phase.md",content:Se},{filename:"Radial Calendar - Spanning Arc.md",content:Ae},{filename:"Radial Calendar - Anniversary.md",content:ve}],e=0;for(let n of t)await this.createTemplate(n.filename,n.content)&&e++;e>0&&new D.Notice(`Created ${e} template(s)`)}createCenterDisplaySection(t){t.createEl("h3",{text:"Center Display"}),new D.Setting(t).setName("Display Mode").setDesc("What is shown in the center of the calendar").addDropdown(e=>{e.addOption("countdown","Countdown").addOption("stats","Statistics").addOption("navigation","Navigation").setValue(this.plugin.settings.centerDisplay).onChange(async n=>{this.plugin.settings.centerDisplay=n,await this.plugin.saveSettings()})})}createMigrationSection(t){t.createEl("h3",{text:"Migration"}),new D.Setting(t).setName("Migrate Legacy Properties").setDesc("Converts phase-* properties to radcal-* properties in all notes").addButton(e=>{e.setButtonText("Scan for Legacy Properties").onClick(async()=>{let n=await this.scanLegacyProperties();n.count===0?new D.Notice("No legacy properties found"):(new D.Notice(`Found ${n.count} files with legacy properties`),this.showMigrationConfirmation(t,n))})})}async scanLegacyProperties(){let t=this.app.vault.getMarkdownFiles(),e=[],n=["phase-start","phase-end","phase-color","phase-label","phase-category"];for(let r of t){let a=this.app.metadataCache.getFileCache(r),s=a==null?void 0:a.frontmatter;s&&n.some(l=>l in s)&&e.push(r.path)}return{count:e.length,files:e}}showMigrationConfirmation(t,e){let n=t.querySelector(".radcal-migration-confirm");n&&n.remove();let r=t.createDiv({cls:"radcal-migration-confirm"});r.createEl("p",{text:`Files to migrate (${e.count}):`});let a=r.createEl("ul",{cls:"radcal-migration-list"});for(let s of e.files.slice(0,10))a.createEl("li",{text:s});e.files.length>10&&a.createEl("li",{text:`... and ${e.files.length-10} more`}),new D.Setting(r).addButton(s=>{s.setButtonText("Migrate All").setCta().onClick(async()=>{let o=await this.migrateAllFiles(e.files);new D.Notice(`Migrated ${o} files`),r.remove()})}).addButton(s=>{s.setButtonText("Cancel").onClick(()=>{r.remove()})})}async migrateAllFiles(t){let e=0,n={"phase-start":"radcal-start","phase-end":"radcal-end","phase-color":"radcal-color","phase-label":"radcal-label","phase-category":"radcal-category"};for(let r of t){let a=this.app.vault.getFileByPath(r);if(a)try{let s=await this.app.vault.read(a),o=!1;for(let[l,c]of Object.entries(n)){let d=new RegExp(`^${l}:`,"gm");s.match(d)&&(s=s.replace(d,`${c}:`),o=!0)}o&&s.includes("radcal-start:")&&!s.includes("radcal-showInLife:")&&(s=s.replace(/(radcal-start:[^\n]*\n)/,`$1radcal-showInLife: true
`)),o&&(await this.app.vault.modify(a,s),e++)}catch(s){console.error(`Failed to migrate ${r}:`,s)}}return e}createPresetsSection(t){t.createEl("h3",{text:"Appearance Presets"});let e=t.createEl("p",{cls:"setting-item-description"});e.innerHTML=`
      Presets let you define reusable appearance combinations.
      Use <code>radcal-preset: name</code> in your notes to apply a preset.
      Explicit properties (radcal-color, etc.) override preset values.
    `,(this.plugin.settings.presets||[]).forEach((r,a)=>{this.createPresetSettings(t,r,a)}),new D.Setting(t).setName("Add Preset").setDesc("Create a new appearance preset").addButton(r=>{r.setButtonText("+ Add Preset").setCta().onClick(async()=>{let a={name:`preset-${Date.now().toString(36)}`,label:"New Preset",color:"blue"};this.plugin.settings.presets||(this.plugin.settings.presets=[]),this.plugin.settings.presets.push(a),await this.plugin.saveSettings(),this.display()})})}createPresetSettings(t,e,n){let r=t.createEl("details",{cls:"radcal-preset-details"}),a=r.createEl("summary",{cls:"radcal-preset-summary"}),s=a.createSpan({cls:"radcal-preset-swatch"});s.style.backgroundColor=E[e.color],e.icon&&(s.textContent=e.icon);let o=a.createSpan({text:e.label||e.name,cls:"radcal-preset-title"});a.createSpan({text:e.name,cls:"radcal-preset-name-badge"});let l=r.createDiv({cls:"radcal-preset-content"});new D.Setting(l).setName("Name").setDesc("Unique identifier (used in radcal-preset property)").addText(c=>{c.setPlaceholder("e.g. family").setValue(e.name).onChange(async d=>{let u=d.toLowerCase().replace(/\s+/g,"-");e.name=u,await this.plugin.saveSettings();let h=a.querySelector(".radcal-preset-name-badge");h&&(h.textContent=u)})}),new D.Setting(l).setName("Label").setDesc("Display name for this preset").addText(c=>{c.setPlaceholder("e.g. Family").setValue(e.label||"").onChange(async d=>{e.label=d||void 0,await this.plugin.saveSettings(),o.textContent=d||e.name})}),new D.Setting(l).setName("Color").addDropdown(c=>{Object.keys(E).forEach(d=>{c.addOption(d,this.formatColorName(d))}),c.setValue(e.color).onChange(async d=>{e.color=d,await this.plugin.saveSettings(),s.style.backgroundColor=E[d]})}),new D.Setting(l).setName("Pattern").setDesc("Fill pattern (optional)").addDropdown(c=>{c.addOption("","(None)"),nt.forEach(d=>{c.addOption(d,this.formatColorName(d))}),c.setValue(e.pattern||"").onChange(async d=>{e.pattern=d||void 0,await this.plugin.saveSettings()})}),new D.Setting(l).setName("Opacity").setDesc("Opacity 0-100 (leave empty for default 100)").addText(c=>{c.setPlaceholder("100").setValue(e.opacity!==void 0?String(e.opacity):"").onChange(async d=>{if(d==="")e.opacity=void 0;else{let u=parseInt(d,10);!isNaN(u)&&u>=0&&u<=100&&(e.opacity=u)}await this.plugin.saveSettings()})}),new D.Setting(l).setName("Icon").setDesc("Emoji or symbol to display (optional)").addText(c=>{c.setPlaceholder("e.g. \u{1F382}").setValue(e.icon||"").onChange(async d=>{e.icon=d.trim()||void 0,await this.plugin.saveSettings(),s.textContent=e.icon||""})}),new D.Setting(l).addButton(c=>{c.setButtonText("Delete Preset").setWarning().onClick(async()=>{this.plugin.settings.presets.splice(n,1),await this.plugin.saveSettings(),this.display()})})}renderHelpTab(t){t.createEl("h3",{text:"YAML Property Reference"});let e=`---
# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
# RADIAL CALENDAR - Complete YAML Reference
# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# BASIC PROPERTIES (required for spanning arcs)
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
radcal-start: 2025-01-15        # Start date (YYYY-MM-DD)
radcal-end: 2025-06-30          # End date (YYYY-MM-DD)
# radcal-end behavior:
#   - NOT SET     \u2192 Single-day event (showInAnnual) / Ongoing (showInLife)
#   - EMPTY ("")  \u2192 Open-ended (extends to year/life end)
#   - WITH VALUE  \u2192 Fixed end date
radcal-label: My Event          # Display label (optional, defaults to filename)

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# APPEARANCE
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
radcal-color: blue              # Color name (see list below)
radcal-pattern: solid           # Pattern: solid, striped, dotted, crosshatch, grid
radcal-opacity: 80              # Opacity 0-100 (default: 100)
radcal-fade: true               # Fade from today to end (default: false)
radcal-icon: \u{1F382}                 # Emoji/icon at arc start (optional)
radcal-preset: family           # Apply preset (color, pattern, opacity, icon)

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# ORGANIZATION
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
radcal-ring: Wohnorte           # Ring name for grouping in Life View
radcal-category: Deutschland    # Category within a ring (for sub-grouping)
radcal-showInLife: true         # Show in Life View (required for files outside lifePhasesFolder)
radcal-showInAnnual: true       # Show in Annual View (creates a "Global" ring)

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# ANNIVERSARIES (yearly recurring)
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
radcal-annual: true             # Mark as annual event
radcal-annual-fix: 2000-03-15   # Fixed date (uses month-day each year)

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# AVAILABLE COLORS
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# red, orange, yellow, green, blue, purple, pink,
# teal, cyan, magenta, lime, amber, indigo, violet,
# rose, gray, slate, stone

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# AVAILABLE PATTERNS
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# solid      - Solid fill (default)
# striped    - Diagonal stripes
# horizontal - Horizontal lines
# vertical   - Vertical lines
# dotted     - Dot pattern
# crosshatch - Crossed diagonal lines
# grid       - Grid pattern
# wavy       - Wavy lines

---`,a=t.createDiv({cls:"radcal-yaml-reference"}).createEl("pre").createEl("code");a.textContent=e,new D.Setting(t).addButton(o=>{o.setButtonText("Copy to Clipboard").setCta().onClick(async()=>{await navigator.clipboard.writeText(e),new D.Notice("YAML reference copied to clipboard")})}),t.createEl("h3",{text:"Quick Examples"});let s=[{title:"Life Phase (e.g., Job, Living Place)",yaml:`---
radcal-start: 2020-01-01
radcal-end: 2023-12-31
radcal-label: Software Developer
radcal-color: blue
radcal-ring: Karriere
radcal-showInLife: true
---`},{title:"Ongoing Phase (no end date)",yaml:`---
radcal-start: 2024-01-01
radcal-label: Current Project
radcal-color: green
radcal-fade: true
radcal-showInLife: true
---`},{title:"Anniversary with fixed date",yaml:`---
radcal-annual: true
radcal-annual-fix: 1990-05-20
radcal-label: Birthday
radcal-color: pink
radcal-icon: \u{1F382}
---`,desc:"Uses month-day from radcal-annual-fix each year"},{title:"Anniversary with date range",yaml:`---
radcal-annual: true
radcal-start: 1932-03-15
radcal-end: 2005-11-28
radcal-label: Opa Hans
radcal-color: gray
---`,desc:"Shows BOTH dates annually (birth + death)"},{title:"Using a Preset",yaml:`---
radcal-start: 2024-01-01
radcal-end: 2024-12-31
radcal-label: Family Vacation
radcal-preset: family
radcal-showInLife: true
---`,desc:"Applies preset appearance (color, pattern, icon). Define presets in Settings \u2192 Advanced."},{title:"Show in Annual View (fixed range)",yaml:`---
radcal-start: 2025-06-15
radcal-end: 2025-06-30
radcal-label: Summer Project
radcal-color: cyan
radcal-showInAnnual: true
---`,desc:'Fixed date range. Appears on the outermost "Global" ring.'},{title:"Single-day event",yaml:`---
radcal-start: 2025-06-15
radcal-label: Conference
radcal-color: amber
radcal-showInAnnual: true
---`,desc:"No radcal-end = single day. For Annual View only."},{title:"Open-ended event",yaml:`---
radcal-start: 2025-06-15
radcal-end:
radcal-label: Ongoing Project
radcal-color: green
radcal-showInAnnual: true
---`,desc:"Empty radcal-end = open-ended (extends to year end with fade effect)."}];for(let o of s){let l=t.createDiv({cls:"radcal-example"});l.createEl("h4",{text:o.title}),o.desc&&l.createEl("p",{text:o.desc,cls:"radcal-example-desc"});let c=l.createDiv({cls:"radcal-code-wrapper"}),d=c.createEl("button",{cls:"radcal-copy-btn",attr:{"aria-label":"Copy to clipboard"}});d.textContent="\u{1F4CB}",d.addEventListener("click",async()=>{await navigator.clipboard.writeText(o.yaml),d.textContent="\u2713",d.classList.add("radcal-copy-btn--success"),setTimeout(()=>{d.textContent="\u{1F4CB}",d.classList.remove("radcal-copy-btn--success")},1500)});let h=c.createEl("pre").createEl("code");h.textContent=o.yaml}t.createEl("h3",{text:"Reset"}),new D.Setting(t).setName("Reset Presets to Defaults").setDesc("Restore the default presets (family, work, education, health, travel, project, completed, cancelled)").addButton(o=>{o.setButtonText("Reset Presets").setWarning().onClick(async()=>{this.plugin.settings.presets=[...ye],await this.plugin.saveSettings(),new D.Notice("Presets reset to defaults")})})}};var vt=require("obsidian");async function mr(g){let i=[],e=ta(g).split(`
`),n=null;for(let r=0;r<e.length;r++){r>0&&r%200===0&&await new Promise(h=>setTimeout(h,0));let a=e[r].trim();if(a==="BEGIN:VEVENT"){n={};continue}if(a==="END:VEVENT"){n&&n.uid&&n.summary&&n.startDate&&i.push(n),n=null;continue}if(!n)continue;let s=a.indexOf(":");if(s===-1)continue;let o=a.substring(0,s),l=a.substring(s+1),c=o.indexOf(";"),d=c===-1?o:o.substring(0,c),u=c===-1?"":o.substring(c+1);switch(d){case"UID":n.uid=l;break;case"SUMMARY":n.summary=Cn(l);break;case"DESCRIPTION":n.description=Cn(l);break;case"LOCATION":n.location=Cn(l);break;case"DTSTART":let h=pr(l,u);n.startDate=h.date,n.isAllDay=h.isAllDay;break;case"DTEND":let p=pr(l,u);n.endDate=p.date;break;case"RRULE":n.isRecurring=!0,n.recurrenceRule=l;break;case"SEQUENCE":n.sequence=parseInt(l,10)||0;break;case"LAST-MODIFIED":n.lastModified=ea(l);break}}return i}function ta(g){return g.replace(/\r\n[ \t]/g,"").replace(/\n[ \t]/g,"")}function Cn(g){return g.replace(/\\n/g,`
`).replace(/\\,/g,",").replace(/\\;/g,";").replace(/\\\\/g,"\\")}function pr(g,i){if(i.includes("VALUE=DATE")&&!i.includes("VALUE=DATE-TIME")){let a=parseInt(g.substring(0,4),10),s=parseInt(g.substring(4,6),10)-1,o=parseInt(g.substring(6,8),10);return{date:new Date(a,s,o),isAllDay:!0}}let e=parseInt(g.substring(0,4),10),n=parseInt(g.substring(4,6),10)-1,r=parseInt(g.substring(6,8),10);if(g.length>=15){let a=parseInt(g.substring(9,11),10),s=parseInt(g.substring(11,13),10),o=parseInt(g.substring(13,15),10);return g.endsWith("Z")?{date:new Date(Date.UTC(e,n,r,a,s,o)),isAllDay:!1}:{date:new Date(e,n,r,a,s,o),isAllDay:!1}}return{date:new Date(e,n,r),isAllDay:!0}}function ea(g){let i=g.substring(0,4),t=g.substring(4,6),e=g.substring(6,8);if(g.length>=15){let n=g.substring(9,11),r=g.substring(11,13),a=g.substring(13,15);return`${i}-${t}-${e}T${n}:${r}:${a}Z`}return`${i}-${t}-${e}T00:00:00Z`}function yr(g){return g.isRecurring&&g.recurrenceRule!==void 0&&g.recurrenceRule.includes("FREQ=YEARLY")}function He(g){let i=g.getFullYear(),t=String(g.getMonth()+1).padStart(2,"0"),e=String(g.getDate()).padStart(2,"0");return`${i}-${t}-${e}`}function En(g){let i=String(g.getHours()).padStart(2,"0"),t=String(g.getMinutes()).padStart(2,"0");return`${i}:${t}`}function fr(g){return g.replace(/[<>:"/\\|?*]/g,"-").replace(/\s+/g," ").trim().substring(0,100)}var We=class{constructor(i){this.app=i;this.syncIntervals=new Map}async syncCalendar(i){let t={success:!1,calendarId:i.id,calendarName:i.name,eventsCreated:0,eventsUpdated:0,eventsSkipped:0,eventsDeleted:0,errors:[]};try{let e=await this.fetchICS(i.url);if(!e)return t.errors.push("Failed to fetch calendar data"),t;let n=await mr(e),r=new Set(n.map(o=>o.uid));await this.ensureFolder(i.folder);let a=20;for(let o=0;o<n.length;o+=a){let l=n.slice(o,o+a);for(let c of l)try{let d=await this.processEvent(c,i);d==="created"?t.eventsCreated++:d==="updated"?t.eventsUpdated++:t.eventsSkipped++}catch(d){t.errors.push(`Event "${c.summary}": ${d instanceof Error?d.message:String(d)}`)}o+a<n.length&&await this.yieldToMainThread()}let s=await this.handleOrphanedNotes(i.folder,r);t.eventsDeleted=s,t.success=!0}catch(e){t.errors.push(e instanceof Error?e.message:String(e))}return t}async syncAllCalendars(i){let t=[];for(let e of i)if(e.enabled){let n=await this.syncCalendar(e);t.push(n)}return t}startAutoSync(i,t){this.stopAutoSync();for(let e of i)if(e.enabled&&e.syncIntervalMinutes>0){let n=e.syncIntervalMinutes*60*1e3,r=window.setInterval(async()=>{let a=await this.syncCalendar(e);t(a)},n);this.syncIntervals.set(e.id,r)}}stopAutoSync(){for(let i of this.syncIntervals.values())window.clearInterval(i);this.syncIntervals.clear()}yieldToMainThread(){return new Promise(i=>setTimeout(i,0))}async handleOrphanedNotes(i,t){let e=this.app.vault.getAbstractFileByPath(i);if(!(e instanceof vt.TFolder))return 0;let n=0,r=`${i}/.deleted`,a=e.children.filter(s=>s instanceof vt.TFile&&s.extension==="md");for(let s of a)try{let l=(await this.app.vault.read(s)).match(/gcal-uid:\s*"([^"]+)"/);if(!l)continue;let c=l[1];if(!t.has(c)){await this.ensureFolder(r);let u=`${r}/${s.name}`,h=1;for(;this.app.vault.getAbstractFileByPath(u);){let p=s.basename;u=`${r}/${p}_${h}.md`,h++}await this.app.vault.rename(s,u),n++}}catch(o){console.error(`Failed to check orphan status for ${s.path}:`,o)}return n}async fetchICS(i){try{let t=await(0,vt.requestUrl)({url:i,method:"GET"});return t.status===200?t.text:null}catch(t){return console.error("Failed to fetch ICS:",t),null}}async ensureFolder(i){if(this.app.vault.getAbstractFileByPath(i)instanceof vt.TFolder)return;let e=i.split("/"),n="";for(let r of e)n=n?`${n}/${r}`:r,this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n)}async processEvent(i,t){let e=this.generateFilename(i),n=`${t.folder}/${e}.md`,r=this.app.vault.getAbstractFileByPath(n);if(r instanceof vt.TFile){let o=(await this.app.vault.read(r)).match(/gcal-sequence:\s*(\d+)/),l=o?parseInt(o[1],10):-1;if(i.sequence!==void 0&&l===i.sequence)return"skipped";let c=this.generateFileContent(i,t);return await this.app.vault.modify(r,c),"updated"}let a=this.generateFileContent(i,t);return await this.app.vault.create(n,a),"created"}generateFilename(i){let t=He(i.startDate),e=fr(i.summary);return`${t} ${e}`}generateFileContent(i,t){let e=["---"];if(e.push(`radcal-start: ${He(i.startDate)}`),i.endDate&&e.push(`radcal-end: ${He(i.endDate)}`),e.push(`radcal-color: ${t.color}`),e.push(`radcal-label: "${i.summary.replace(/"/g,'\\"')}"`),e.push(`gcal-uid: "${i.uid}"`),e.push(`gcal-source: "${t.name}"`),i.sequence!==void 0&&e.push(`gcal-sequence: ${i.sequence}`),i.lastModified&&e.push(`gcal-last-modified: "${i.lastModified}"`),i.isRecurring&&(e.push("gcal-recurring: true"),yr(i)&&e.push("anniversary: true")),i.location&&e.push(`location: "${i.location.replace(/"/g,'\\"')}"`),e.push("---"),e.push(""),e.push(`# ${i.summary}`),e.push(""),!i.isAllDay){let n=En(i.startDate);if(i.endDate){let r=En(i.endDate);e.push(`**Zeit:** ${n} - ${r}`)}else e.push(`**Zeit:** ${n}`);e.push("")}return i.location&&(e.push(`**Ort:** ${i.location}`),e.push("")),i.description&&(e.push("## Beschreibung"),e.push(""),e.push(na(i.description)),e.push("")),e.join(`
`)}};function na(g){return g.replace(/<br\s*\/?>/gi,`
`).replace(/<\/p>/gi,`

`).replace(/<\/li>/gi,`
`).replace(/<li>/gi,"- ").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\n{3,}/g,`

`).trim()}var Ar=require("obsidian"),ze=600,O=ze/2,wt=ze/2-30,Ht=wt-40,br=wt+15,Sr={blue:"#4a90d9",green:"#50c878",red:"#e74c3c",purple:"#9b59b6",orange:"#e67e22",teal:"#1abc9c",pink:"#e91e63",yellow:"#f1c40f",cyan:"#00bcd4",indigo:"#3f51b5"},Ue=["blue","green","red","purple","orange","teal","pink","yellow"],ra=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],xn=class extends Ar.BasesView{constructor(t,e){super(t);this.type="radial-calendar";this.svgEl=null;this.dateProperty="date";this.color="blue";this.containerEl=e,this.currentYear=new Date().getFullYear()}getConfigString(t,e){let n=this.config.get(t);if(n==null)return e;if(typeof n=="string"){if(/^\d+$/.test(n)&&t==="color"){let r=parseInt(n,10);if(r>=0&&r<Ue.length)return Ue[r]}return n}return typeof n=="number"?t==="color"&&n>=0&&n<Ue.length?Ue[n]:e:typeof n=="object"&&"value"in n?String(n.value):typeof n=="object"&&"label"in n?String(n.label).toLowerCase():e}onDataUpdated(){var n,r,a;console.log("Radial Calendar Bases: onDataUpdated called"),console.log("Radial Calendar Bases: raw config color =",this.config.get("color")),console.log("Radial Calendar Bases: raw config dateProperty =",this.config.get("dateProperty")),this.dateProperty=this.getConfigString("dateProperty","date"),this.color=this.getConfigString("color","blue");let t=this.config.get("year");t&&typeof t=="number"&&(this.currentYear=t),console.log("Radial Calendar Bases: parsed dateProperty =",this.dateProperty),console.log("Radial Calendar Bases: parsed color =",this.color),console.log("Radial Calendar Bases: year =",this.currentYear),console.log("Radial Calendar Bases: entries count =",(a=(r=(n=this.data)==null?void 0:n.data)==null?void 0:r.length)!=null?a:0),this.containerEl.empty(),this.containerEl.addClass("radial-calendar-bases-view"),this.renderHeader();let e=this.containerEl.createDiv({cls:"rc-bases-svg-container"});this.svgEl=this.createSVG(),e.appendChild(this.svgEl),this.renderCalendar()}createSVG(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox",`0 0 ${ze} ${ze}`),t.setAttribute("class","rc-bases-calendar"),t}renderHeader(){let t=this.containerEl.createDiv({cls:"rc-bases-header"});t.createEl("button",{cls:"rc-bases-nav-btn",text:"\u2190"}).addEventListener("click",()=>{this.currentYear--,this.onDataUpdated()}),t.createSpan({cls:"rc-bases-year",text:String(this.currentYear)}),t.createEl("button",{cls:"rc-bases-nav-btn",text:"\u2192"}).addEventListener("click",()=>{this.currentYear++,this.onDataUpdated()}),t.createEl("button",{cls:"rc-bases-today-btn",text:"Today"}).addEventListener("click",()=>{this.currentYear=new Date().getFullYear(),this.onDataUpdated()})}renderCalendar(){this.svgEl&&(this.svgEl.innerHTML="",this.renderBackgroundCircle(),this.renderMonthSegments(),this.renderEntryIndicators(),this.renderMonthLabels(),this.renderTodayMarker(),this.renderCenter())}renderBackgroundCircle(){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",String(O)),t.setAttribute("cy",String(O)),t.setAttribute("r",String(wt)),t.setAttribute("class","rc-bases-background"),this.svgEl.appendChild(t)}renderMonthSegments(){for(let t=0;t<12;t++){let e=this.monthToAngle(t)-Math.PI/2,n=O+Ht*Math.cos(e),r=O+Ht*Math.sin(e),a=O+wt*Math.cos(e),s=O+wt*Math.sin(e),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(n)),o.setAttribute("y1",String(r)),o.setAttribute("x2",String(a)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-bases-month-separator"),this.svgEl.appendChild(o)}}renderEntryIndicators(){var o;let t=this.data.data,e=new Map;if(t.length>0){let l=t[0];console.log("Radial Calendar Bases: Sample entry file:",(o=l.file)==null?void 0:o.basename),console.log('Radial Calendar Bases: Sample getValue("'+this.dateProperty+'"):',l.getValue(this.dateProperty))}let n=0,r=0,a=new Map;for(let l of t){let c=this.getEntryDate(l);if(!c){n++;continue}let d=c.getFullYear();if(a.set(d,(a.get(d)||0)+1),d!==this.currentYear){r++;continue}let u=this.getDayOfYear(c);e.has(u)||e.set(u,[]),e.get(u).push(l)}console.log("Radial Calendar Bases: No date:",n,"Wrong year:",r),console.log("Radial Calendar Bases: Entries by year:",Object.fromEntries(a)),console.log("Radial Calendar Bases: Days with entries in",this.currentYear+":",e.size);let s=Sr[this.color]||Sr.blue;console.log("Radial Calendar Bases: Using color:",this.color,"\u2192",s);for(let[l,c]of e)this.renderDayIndicator(l,c.length,s,c)}getEntryDate(t){var n,r,a;let e=t.getValue(this.dateProperty);if(e){let s=this.parseDate(e);if(s)return s}for(let s of["date","Date","created","birthday","Birthday","due","Due"]){let o=t.getValue(s);if(o){let l=this.parseDate(o);if(l)return l}}if((n=t.file)!=null&&n.basename){let s=t.file.basename.match(/^(\d{4})-(\d{2})-(\d{2})/);if(s)return new Date(parseInt(s[1]),parseInt(s[2])-1,parseInt(s[3]))}return(a=(r=t.file)==null?void 0:r.stat)!=null&&a.ctime?new Date(t.file.stat.ctime):null}parseDate(t){if(!t)return null;if(t instanceof Date)return t;if(typeof t=="object"&&t!==null){let e=t;if(typeof e.toJSDate=="function")return e.toJSDate();if(typeof e.ts=="number")return new Date(e.ts);if("value"in e)return this.parseDate(e.value);if("path"in e)return null}if(typeof t=="string"){let e=t.match(/^(\d{4})-(\d{2})-(\d{2})/);if(e)return new Date(parseInt(e[1]),parseInt(e[2])-1,parseInt(e[3]));let n=new Date(t);if(!isNaN(n.getTime()))return n}return typeof t=="number"?new Date(t):null}renderDayIndicator(t,e,n,r){let a=this.isLeapYear(this.currentYear)?366:365,s=(t-1)/a*2*Math.PI-Math.PI/2,o=t/a*2*Math.PI-Math.PI/2,l=this.createArcPath(Ht,wt,s,o),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("class","rc-bases-entry-indicator"),c.style.fill=n,c.style.opacity=Math.min(.3+e*.2,1).toString();let d=document.createElementNS("http://www.w3.org/2000/svg","title"),u=r.map(h=>{var p;return((p=h.file)==null?void 0:p.basename)||"Unknown"}).join(`
`);d.textContent=`${e} ${e===1?"entry":"entries"}:
${u}`,c.appendChild(d),c.addEventListener("click",()=>{r.length>0&&r[0].file&&this.app.workspace.getLeaf().openFile(r[0].file)}),c.style.cursor="pointer",this.svgEl.appendChild(c)}renderMonthLabels(){for(let t=0;t<12;t++){let e=this.monthToAngle(t)+Math.PI/12-Math.PI/2,n=O+br*Math.cos(e),r=O+br*Math.sin(e),a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",String(n)),a.setAttribute("y",String(r)),a.setAttribute("class","rc-bases-month-label"),a.textContent=ra[t],this.svgEl.appendChild(a)}}renderTodayMarker(){let t=new Date;if(t.getFullYear()!==this.currentYear)return;let e=this.getDayOfYear(t),n=this.isLeapYear(this.currentYear)?366:365,r=(e-.5)/n*2*Math.PI-Math.PI/2,a=O+(Ht-5)*Math.cos(r),s=O+(Ht-5)*Math.sin(r),o=O+(wt+5)*Math.cos(r),l=O+(wt+5)*Math.sin(r),c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("x1",String(a)),c.setAttribute("y1",String(s)),c.setAttribute("x2",String(o)),c.setAttribute("y2",String(l)),c.setAttribute("class","rc-bases-today-marker"),this.svgEl.appendChild(c)}renderCenter(){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",String(O)),t.setAttribute("cy",String(O)),t.setAttribute("r",String(Ht-10)),t.setAttribute("class","rc-bases-center"),this.svgEl.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x",String(O)),e.setAttribute("y",String(O)),e.setAttribute("class","rc-bases-center-text"),e.textContent=String(this.currentYear),this.svgEl.appendChild(e);let n=this.data.data.filter(a=>{let s=this.getEntryDate(a);return s&&s.getFullYear()===this.currentYear}).length,r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",String(O)),r.setAttribute("y",String(O+25)),r.setAttribute("class","rc-bases-entry-count"),r.textContent=`${n} entries`,this.svgEl.appendChild(r)}createArcPath(t,e,n,r){let a=O+t*Math.cos(n),s=O+t*Math.sin(n),o=O+e*Math.cos(n),l=O+e*Math.sin(n),c=O+e*Math.cos(r),d=O+e*Math.sin(r),u=O+t*Math.cos(r),h=O+t*Math.sin(r),p=r-n>Math.PI?1:0;return[`M ${a} ${s}`,`L ${o} ${l}`,`A ${e} ${e} 0 ${p} 1 ${c} ${d}`,`L ${u} ${h}`,`A ${t} ${t} 0 ${p} 0 ${a} ${s}`,"Z"].join(" ")}monthToAngle(t){return t/12*2*Math.PI}getDayOfYear(t){let e=new Date(t.getFullYear(),0,0),n=t.getTime()-e.getTime(),r=1e3*60*60*24;return Math.floor(n/r)}isLeapYear(t){return t%4===0&&t%100!==0||t%400===0}};function vr(g,i){return new xn(g,i)}var wr=require("obsidian");z();var je=class extends wr.FuzzySuggestModal{constructor(i,t){super(i),this.onSelect=t,this.setPlaceholder("Search for a color...")}getItems(){return Object.entries(E).map(([i,t])=>({name:i,hex:t}))}getItemText(i){return i.name}renderSuggestion(i,t){t.addClass("radial-calendar-color-suggestion");let e=t.createSpan({cls:"radial-calendar-color-preview"});e.style.backgroundColor=i.hex,e.style.width="16px",e.style.height="16px",e.style.borderRadius="50%",e.style.display="inline-block",e.style.marginRight="8px",e.style.verticalAlign="middle";let n=t.createSpan({cls:"radial-calendar-color-name"});n.setText(i.name.charAt(0).toUpperCase()+i.name.slice(1)),n.style.verticalAlign="middle";let r=t.createSpan({cls:"radial-calendar-color-hex"});r.setText(` (${i.hex})`),r.style.color="var(--text-muted)",r.style.fontSize="12px",r.style.verticalAlign="middle"}onChooseItem(i,t){this.onSelect(i.name)}};var qe=require("obsidian");z();var gt=class extends qe.Modal{constructor(i,t,e,n){super(i),this.propertyType=t,this.onSubmit=e,this.currentValue=n}onOpen(){let{contentEl:i}=this;i.empty(),i.addClass("radcal-property-modal");let t={color:"Select Color",pattern:"Select Pattern",opacity:"Set Opacity"}[this.propertyType];switch(i.createEl("h2",{text:t}),this.propertyType){case"color":this.renderColorPicker(i);break;case"pattern":this.renderPatternPicker(i);break;case"opacity":this.renderOpacitySlider(i);break}}onClose(){let{contentEl:i}=this;i.empty()}renderColorPicker(i){let t=i.createDiv({cls:"radcal-color-grid"});for(let[e,n]of Object.entries(E)){let r=t.createDiv({cls:`radcal-color-swatch ${this.currentValue===e?"is-selected":""}`});r.style.backgroundColor=n,r.setAttribute("data-color",e),r.setAttribute("title",e);let a=r.createDiv({cls:"radcal-color-label"});a.textContent=e,r.addEventListener("click",()=>{this.onSubmit(e),this.close()})}}renderPatternPicker(i){let t=i.createDiv({cls:"radcal-pattern-grid"}),e={solid:"Solid fill",striped:"Diagonal stripes",horizontal:"Horizontal lines",vertical:"Vertical lines",dotted:"Dot pattern",crosshatch:"Crossed diagonals",grid:"Grid pattern",wavy:"Wavy lines"};for(let n of nt){let r=t.createDiv({cls:`radcal-pattern-option ${this.currentValue===n?"is-selected":""}`}),a=this.createPatternPreview(n);r.appendChild(a);let s=r.createDiv({cls:"radcal-pattern-label"});s.textContent=n,r.setAttribute("title",e[n]),r.addEventListener("click",()=>{this.onSubmit(n),this.close()})}}createPatternPreview(i){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","40"),t.setAttribute("height","40"),t.setAttribute("viewBox","0 0 40 40"),t.classList.add("radcal-pattern-preview");let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("width","40"),e.setAttribute("height","40"),e.setAttribute("fill","var(--interactive-accent)"),t.appendChild(e);let n=document.createElementNS("http://www.w3.org/2000/svg","g");switch(n.setAttribute("stroke","var(--text-on-accent)"),n.setAttribute("stroke-width","2"),n.setAttribute("fill","none"),i){case"striped":for(let a=-40;a<80;a+=8){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(a)),s.setAttribute("y1","0"),s.setAttribute("x2",String(a+40)),s.setAttribute("y2","40"),n.appendChild(s)}break;case"horizontal":for(let a=5;a<40;a+=10){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","0"),s.setAttribute("y1",String(a)),s.setAttribute("x2","40"),s.setAttribute("y2",String(a)),n.appendChild(s)}break;case"vertical":for(let a=5;a<40;a+=10){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(a)),s.setAttribute("y1","0"),s.setAttribute("x2",String(a)),s.setAttribute("y2","40"),n.appendChild(s)}break;case"dotted":n.setAttribute("fill","var(--text-on-accent)");for(let a=10;a<40;a+=15)for(let s=10;s<40;s+=15){let o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx",String(a)),o.setAttribute("cy",String(s)),o.setAttribute("r","3"),n.appendChild(o)}break;case"crosshatch":for(let a=-40;a<80;a+=10){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(a)),s.setAttribute("y1","0"),s.setAttribute("x2",String(a+40)),s.setAttribute("y2","40"),n.appendChild(s);let o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(a+40)),o.setAttribute("y1","0"),o.setAttribute("x2",String(a)),o.setAttribute("y2","40"),n.appendChild(o)}break;case"grid":for(let a=10;a<40;a+=10){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(a)),s.setAttribute("y1","0"),s.setAttribute("x2",String(a)),s.setAttribute("y2","40"),n.appendChild(s)}for(let a=10;a<40;a+=10){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","0"),s.setAttribute("y1",String(a)),s.setAttribute("x2","40"),s.setAttribute("y2",String(a)),n.appendChild(s)}break;case"wavy":let r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","M0,10 Q10,5 20,10 T40,10 M0,25 Q10,20 20,25 T40,25"),n.appendChild(r);break;case"solid":default:break}return t.appendChild(n),t}renderOpacitySlider(i){let t=typeof this.currentValue=="number"?this.currentValue:100,e=i.createDiv({cls:"radcal-opacity-container"}),n=e.createDiv({cls:"radcal-opacity-value"});n.textContent=`${t}%`;let r=e.createEl("input",{type:"range",cls:"radcal-opacity-slider"});r.setAttribute("min","0"),r.setAttribute("max","100"),r.setAttribute("step","5"),r.value=String(t),r.addEventListener("input",()=>{n.textContent=`${r.value}%`});let a=e.createDiv({cls:"radcal-opacity-presets"});for(let s of[25,50,75,100])a.createEl("button",{text:`${s}%`,cls:`radcal-opacity-preset ${t===s?"is-selected":""}`}).addEventListener("click",()=>{this.onSubmit(s),this.close()});new qe.Setting(e).addButton(s=>{s.setButtonText("Apply").setCta().onClick(()=>{this.onSubmit(parseInt(r.value,10)),this.close()})}).addButton(s=>{s.setButtonText("Cancel").onClick(()=>{this.close()})})}};z();var Qe=class extends q.Plugin{constructor(){super(...arguments);this.service=null;this.calendarSync=null;this.settings={...fe}}async onload(){await this.loadSettings();let t={calendarWidth:"fit",dateProperties:["date","created","due"],endDateProperties:["endDate","end","until"],datePriority:"filename",dailyNoteFormat:this.settings.periodicNotesFormat.daily,dailyNoteFolder:this.settings.dailyNoteFolder,showMultiDayBars:!0,showWeekendHighlight:!0,anniversaryDateProperties:this.settings.anniversaryDateProperties||[]};this.service=new we(this.app,t),await this.service.initialize(),this.registerView(Kt,r=>{let a=new Ce(r);return a.initialize({service:this.service,openFile:async s=>{let o=this.app.vault.getAbstractFileByPath(s);o instanceof q.TFile&&await this.app.workspace.getLeaf().openFile(o)},settings:this.settings,onSettingsChange:async s=>{this.settings=s,await this.saveSettings()}}),a}),this.registerView(te,r=>{let a=new xe(r);return a.initialize({service:this.service,settings:this.settings,getActiveFileDate:()=>this.getActiveFileDate(),openFile:async s=>{let o=this.app.vault.getAbstractFileByPath(s);o instanceof q.TFile&&await this.app.workspace.getLeaf().openFile(o)}}),a}),this.registerView(ee,r=>{var a;return new Pe(r,this.settings.mementoMori,this.settings.birthDate||`${this.settings.birthYear}-01-01`,this.settings.expectedLifespan,this.settings.dailyNoteFolder||"",((a=this.settings.periodicNotesFormat)==null?void 0:a.daily)||"YYYY-MM-DD")});let e=new Oe(this.app,this.service,async r=>{let a=this.app.vault.getAbstractFileByPath(r);a instanceof q.TFile&&await this.app.workspace.getLeaf().openFile(a)});this.registerMarkdownCodeBlockProcessor("radcal",(r,a,s)=>e.process(r,a,s));let n=new Ge(this.app);this.registerMarkdownCodeBlockProcessor("radcal-day",(r,a,s)=>n.process(r,a,s)),this.registerBasesViewIfAvailable(),this.addSettingTab(new _e(this.app,this)),this.addRibbonIcon("circle","Open Radial Calendar",()=>{this.activateView()}),this.addRibbonIcon("clock","Open Local Calendar",()=>{this.activateLocalCalendarView()}),this.addRibbonIcon("hourglass","Open Memento Mori",()=>{this.activateMementoMoriView()}),this.addCommand({id:"open-radial-calendar",name:"Open Radial Calendar",callback:()=>{this.activateView()}}),this.addCommand({id:"open-local-calendar",name:"Open Local Calendar (Sidebar)",callback:()=>{this.activateLocalCalendarView()}}),this.addCommand({id:"open-memento-mori",name:"Open Memento Mori View",callback:()=>{this.activateMementoMoriView()}}),this.calendarSync=new We(this.app),this.addCommand({id:"sync-google-calendars",name:"Sync Google Calendars",callback:()=>{this.syncAllCalendars()}}),this.addCommand({id:"insert-color",name:"Insert Color",editorCallback:r=>{new je(this.app,a=>{r.replaceSelection(a)}).open()}}),this.addCommand({id:"set-color",name:"Set Color",checkCallback:r=>{let a=this.app.workspace.getActiveFile();if(!a||a.extension!=="md")return!1;if(r)return!0;let s=this.getCurrentProperty(a,"radcal-color");new gt(this.app,"color",o=>{this.updateFrontmatter(a,"radcal-color",o)},s).open()}}),this.addCommand({id:"set-pattern",name:"Set Pattern",checkCallback:r=>{let a=this.app.workspace.getActiveFile();if(!a||a.extension!=="md")return!1;if(r)return!0;let s=this.getCurrentProperty(a,"radcal-pattern");new gt(this.app,"pattern",o=>{this.updateFrontmatter(a,"radcal-pattern",o)},s).open()}}),this.addCommand({id:"set-opacity",name:"Set Opacity",checkCallback:r=>{let a=this.app.workspace.getActiveFile();if(!a||a.extension!=="md")return!1;if(r)return!0;let s=this.getCurrentProperty(a,"radcal-opacity");new gt(this.app,"opacity",o=>{this.updateFrontmatter(a,"radcal-opacity",o)},s).open()}}),this.registerEvent(this.app.workspace.on("file-menu",(r,a)=>{!(a instanceof q.TFile)||a.extension!=="md"||(r.addSeparator(),r.addItem(s=>{s.setTitle("Radcal: Set Color").setIcon("palette").onClick(()=>{let o=this.getCurrentProperty(a,"radcal-color");new gt(this.app,"color",l=>{this.updateFrontmatter(a,"radcal-color",l)},o).open()})}),r.addItem(s=>{s.setTitle("Radcal: Set Pattern").setIcon("shapes").onClick(()=>{let o=this.getCurrentProperty(a,"radcal-pattern");new gt(this.app,"pattern",l=>{this.updateFrontmatter(a,"radcal-pattern",l)},o).open()})}),r.addItem(s=>{s.setTitle("Radcal: Set Opacity").setIcon("blend").onClick(()=>{let o=this.getCurrentProperty(a,"radcal-opacity");new gt(this.app,"opacity",l=>{this.updateFrontmatter(a,"radcal-opacity",l)},o).open()})}))})),this.syncOnStart(),this.startAutoSync()}async onunload(){var t,e;(t=this.calendarSync)==null||t.stopAutoSync(),this.calendarSync=null,(e=this.service)==null||e.destroy(),this.service=null}async loadSettings(){let t=await this.loadData();if(this.settings=Object.assign({},fe,t),!this.settings.rings.some(n=>n.ringType==="global")){let n=an(0);this.settings.rings=this.settings.rings.map(r=>({...r,order:r.order+1})),this.settings.rings.unshift(n),await this.saveData(this.settings)}if(!this.settings.mementoMori){let{DEFAULT_MEMENTO_MORI_SETTINGS:n}=await Promise.resolve().then(()=>(z(),Ot));this.settings.mementoMori=n,await this.saveData(this.settings)}}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:t}=this.app,e=null,n=t.getLeavesOfType(Kt);n.length>0?e=n[0]:(e=t.getLeaf("tab"),e&&await e.setViewState({type:Kt,active:!0})),e&&t.revealLeaf(e)}getActiveFileDate(){let t=this.app.workspace.getActiveFile();if(!t)return null;let e=t.basename.match(/(\d{4})-(\d{2})-(\d{2})/);return e?C(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10)):null}async activateLocalCalendarView(){var n;let{workspace:t}=this.app,e=(n=t.getLeavesOfType(te)[0])!=null?n:null;e||(e=t.getRightLeaf(!1),e&&await e.setViewState({type:te,active:!0})),e&&t.revealLeaf(e)}async activateMementoMoriView(){var n;let{workspace:t}=this.app,e=(n=t.getLeavesOfType(ee)[0])!=null?n:null;e||(e=t.getRightLeaf(!1),e&&await e.setViewState({type:ee,active:!0})),e&&t.revealLeaf(e)}async syncAllCalendars(){var n;if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(r=>r.enabled&&r.url);if(t.length===0){new q.Notice("No calendar sources configured");return}new q.Notice(`Syncing ${t.length} calendar(s)...`);let e=await this.calendarSync.syncAllCalendars(t);this.showSyncResults(e);for(let r of e)if(r.success){let a=this.settings.calendarSources.find(s=>s.id===r.calendarId);a&&(a.lastSync=Date.now())}await this.saveSettings(),await((n=this.service)==null?void 0:n.initialize())}async syncOnStart(){if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(e=>e.enabled&&e.url&&e.syncOnStart);t.length!==0&&setTimeout(async()=>{var a;let e=await this.calendarSync.syncAllCalendars(t);for(let s of e)if(s.success){let o=this.settings.calendarSources.find(l=>l.id===s.calendarId);o&&(o.lastSync=Date.now())}await this.saveSettings();let n=e.filter(s=>s.success).length,r=e.reduce((s,o)=>s+o.eventsCreated+o.eventsUpdated,0);r>0&&new q.Notice(`Calendar sync: ${r} events updated from ${n} calendar(s)`),await((a=this.service)==null?void 0:a.initialize())},2e3)}startAutoSync(){if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(e=>e.enabled&&e.url&&e.syncIntervalMinutes>0);t.length!==0&&this.calendarSync.startAutoSync(t,async e=>{var r;if(e.success){let a=this.settings.calendarSources.find(s=>s.id===e.calendarId);a&&(a.lastSync=Date.now(),await this.saveSettings())}let n=e.eventsCreated+e.eventsUpdated;n>0&&new q.Notice(`${e.calendarName}: ${n} events synced`),await((r=this.service)==null?void 0:r.initialize())})}showSyncResults(t){let e=t.filter(o=>o.success).length,n=t.reduce((o,l)=>o+l.eventsCreated,0),r=t.reduce((o,l)=>o+l.eventsUpdated,0),a=t.reduce((o,l)=>o+l.errors.length,0),s=`Sync complete: ${e}/${t.length} calendars`;n>0&&(s+=`, ${n} created`),r>0&&(s+=`, ${r} updated`),a>0&&(s+=`, ${a} errors`),new q.Notice(s);for(let o of t)o.errors.length>0&&console.warn(`Calendar sync errors (${o.calendarName}):`,o.errors)}getCurrentProperty(t,e){let n=this.app.metadataCache.getFileCache(t),r=n==null?void 0:n.frontmatter;if(!r)return;let a=r[e];if(typeof a=="string"||typeof a=="number")return a}async updateFrontmatter(t,e,n){try{await this.app.fileManager.processFrontMatter(t,r=>{r[e]=n}),new q.Notice(`Set ${e} to ${n}`)}catch(r){console.error("Failed to update frontmatter:",r),new q.Notice(`Failed to update ${e}`)}}registerBasesViewIfAvailable(){if(typeof this.registerBasesView!="function"){console.log("Radial Calendar: Bases API not available (requires Obsidian 1.10+)");return}try{this.registerBasesView("radial-calendar",{name:"Radial Calendar",icon:"circle",factory:vr,options:()=>[{type:"text",key:"dateProperty",displayName:"Date property",placeholder:"e.g. date, birthday, due",default:"date"},{type:"dropdown",key:"color",displayName:"Color",default:"blue",options:{blue:"Blue",green:"Green",red:"Red",purple:"Purple",orange:"Orange",teal:"Teal",pink:"Pink",yellow:"Yellow"}}]})&&console.log("Radial Calendar: Bases view registered successfully")}catch(t){console.warn("Radial Calendar: Failed to register Bases view:",t)}}};
