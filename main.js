/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var G=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var ie=Object.prototype.hasOwnProperty;var oe=(s,e)=>{for(var t in e)G(s,t,{get:e[t],enumerable:!0})},se=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ae(e))!ie.call(s,r)&&r!==t&&G(s,r,{get:()=>e[r],enumerable:!(n=re(e,r))||n.enumerable});return s};var le=s=>se(G({},"__esModule",{value:!0}),s);var De={};oe(De,{default:()=>z});module.exports=le(De);var _=require("obsidian");var R=class{constructor(e){this.app=e}getAllMarkdownFiles(){return this.app.vault.getMarkdownFiles().map(t=>this.toFileInfo(t))}getMarkdownFilesInFolder(e){return this.getAllMarkdownFiles().filter(t=>t.folderPath?t.folderPath===e||t.folderPath.startsWith(e+"/"):!1)}getFileByPath(e){let t=this.app.vault.getAbstractFileByPath(e);return t instanceof this.getTFileClass()?t:null}async readFile(e){let t=this.getFileByPath(e);if(!t)return null;try{return await this.app.vault.read(t)}catch(n){return null}}async createOrOpenDailyNote(e,t=""){let n=this.getFileByPath(e);if(!n){let r=e.substring(0,e.lastIndexOf("/"));r&&await this.ensureFolderExists(r),n=await this.app.vault.create(e,t)}return n}async ensureFolderExists(e){this.app.vault.getAbstractFileByPath(e)||await this.app.vault.createFolder(e)}fileExists(e){return this.getFileByPath(e)!==null}getRoot(){return this.app.vault.getRoot()}toFileInfo(e){var t,n;return Object.freeze({path:e.path,basename:e.basename,name:e.name,extension:e.extension,folderPath:(n=(t=e.parent)==null?void 0:t.path)!=null?n:null})}getTFileClass(){let e=this.app.vault.getMarkdownFiles();return e.length>0?e[0].constructor:class{}}};var A=class{constructor(e){this.app=e}getMetadata(e){let t=this.app.metadataCache.getFileCache(e);return this.extractMetadata(t)}getMetadataByPath(e){let t=this.app.vault.getAbstractFileByPath(e);return!t||!this.isMarkdownFile(t)?null:this.getMetadata(t)}getProperty(e,t){var r;return(r=this.getMetadata(e).frontmatter)==null?void 0:r[t]}getStringProperty(e,t){let n=this.getProperty(e,t);return typeof n=="string"?n:n instanceof Date?this.formatDate(n):typeof n=="number"?String(n):null}getDateProperty(e,t){let n=this.getProperty(e,t);if(!n)return null;if(typeof n=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;let r=n.match(/^(\d{4}-\d{2}-\d{2})/);return r?r[1]:null}return n instanceof Date&&!isNaN(n.getTime())?this.formatDate(n):this.isLocalDateLike(n)?this.formatLocalDate(n):null}getTags(e){return this.getMetadata(e).tags}hasTag(e,t){let n=t.startsWith("#")?t:`#${t}`;return this.getTags(e).some(a=>a.tag.toLowerCase()===n.toLowerCase())}onMetadataChange(e){let t=n=>e(n);return this.app.metadataCache.on("changed",t),()=>this.app.metadataCache.off("changed",t)}extractMetadata(e){var r;let t=(r=e==null?void 0:e.frontmatter)!=null?r:null,n=[];if(t!=null&&t.tags){let a=Array.isArray(t.tags)?t.tags:[t.tags];for(let i of a)if(typeof i=="string"){let o=i.startsWith("#")?i:`#${i}`;n.push({tag:o,name:o.substring(1)})}}if(e!=null&&e.tags)for(let a of e.tags)n.find(o=>o.tag.toLowerCase()===a.tag.toLowerCase())||n.push({tag:a.tag,name:a.tag.substring(1)});return Object.freeze({frontmatter:t,tags:Object.freeze(n)})}formatDate(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}formatLocalDate(e){let t=e.year,n=String(e.month).padStart(2,"0"),r=String(e.day).padStart(2,"0");return`${t}-${n}-${r}`}isLocalDateLike(e){return typeof e=="object"&&e!==null&&"year"in e&&"month"in e&&"day"in e&&typeof e.year=="number"&&typeof e.month=="number"&&typeof e.day=="number"}isMarkdownFile(e){return typeof e=="object"&&e!==null&&"extension"in e&&e.extension==="md"}};function v(s,e,t){let n={year:s,month:e,day:t};if(!J(n))throw new Error(`Invalid date: ${s}-${e}-${t}`);return Object.freeze(n)}function M(s){let e=s.month.toString().padStart(2,"0"),t=s.day.toString().padStart(2,"0");return`${s.year}-${e}-${t}`}function f(s,e){return s.year!==e.year?s.year-e.year:s.month!==e.month?s.month-e.month:s.day-e.day}function P(s,e){return s.year===e.year&&s.month===e.month&&s.day===e.day}function J(s){let{year:e,month:t,day:n}=s;if(!Number.isInteger(e)||e<1||!Number.isInteger(t)||t<1||t>12||!Number.isInteger(n)||n<1)return!1;let r=D(e,t);return n<=r}function D(s,e){let t=[31,28,31,30,31,30,31,31,30,31,30,31];return e===2&&q(s)?29:t[e-1]}function q(s){return s%4===0&&s%100!==0||s%400===0}function w(s){let e=s.year,t=s.month,n=s.day;t<3&&(t+=12,e-=1);let r=n,a=t,i=e%100,o=Math.floor(e/100),l=(r+Math.floor(13*(a+1)/5)+i+Math.floor(i/4)+Math.floor(o/4)-2*o)%7;return l=(l%7+7)%7,(l+6)%7}function b(){let s=new Date;return Object.freeze({year:s.getFullYear(),month:s.getMonth()+1,day:s.getDate()})}var I=class{constructor(e={}){var t,n;this.entriesByPath=new Map,this.entriesByDate=new Map,this.multiDayEntriesByDate=new Map,this.stats={hits:0,misses:0,lastRebuild:0},this.config={maxEntries:(t=e.maxEntries)!=null?t:1e4,debug:(n=e.debug)!=null?n:!1}}addEntry(e){this.removeEntry(e.filePath),this.entriesByPath.set(e.filePath,e);let t=M(e.startDate);this.addToDateIndex(t,e,this.entriesByDate),e.isMultiDay&&e.endDate&&this.indexMultiDayEntry(e),this.log(`Added entry: ${e.filePath}`)}removeEntry(e){let t=this.entriesByPath.get(e);if(!t)return;this.entriesByPath.delete(e);let n=M(t.startDate);this.removeFromDateIndex(n,t.id,this.entriesByDate),t.isMultiDay&&t.endDate&&this.removeMultiDayEntry(t),this.log(`Removed entry: ${e}`)}getEntriesForDate(e){var i,o;let t=M(e),n=(i=this.entriesByDate.get(t))!=null?i:[],r=(o=this.multiDayEntriesByDate.get(t))!=null?o:[];n.length>0||r.length>0?this.stats.hits++:this.stats.misses++;let a=new Map;for(let l of n)a.set(l.id,l);for(let l of r)a.set(l.id,l);return Array.from(a.values())}getEntriesInRange(e,t){var r;let n=new Map;for(let a of this.entriesByPath.values()){let i=(r=a.endDate)!=null?r:a.startDate;f(a.startDate,t)<=0&&f(i,e)>=0&&n.set(a.id,a)}return Array.from(n.values())}getMultiDayEntries(){return Array.from(this.entriesByPath.values()).filter(e=>e.isMultiDay)}getEntryByPath(e){return this.entriesByPath.get(e)}hasEntry(e){return this.entriesByPath.has(e)}getAllEntries(){return Array.from(this.entriesByPath.values())}clear(){this.entriesByPath.clear(),this.entriesByDate.clear(),this.multiDayEntriesByDate.clear(),this.stats={hits:0,misses:0,lastRebuild:Date.now()},this.log("Cache cleared")}rebuild(e){this.clear(),this.stats.lastRebuild=Date.now();for(let t of e)this.addEntry(t);this.log(`Cache rebuilt with ${e.length} entries`)}getStats(){return Object.freeze({entryCount:this.entriesByPath.size,dateCount:this.entriesByDate.size+this.multiDayEntriesByDate.size,hits:this.stats.hits,misses:this.stats.misses,lastRebuild:this.stats.lastRebuild})}indexMultiDayEntry(e){if(!e.endDate)return;let t=e.startDate,n=e.endDate;for(;f(t,n)<0;)if(t=this.addOneDay(t),f(t,n)<=0){let r=M(t);this.addToDateIndex(r,e,this.multiDayEntriesByDate)}}removeMultiDayEntry(e){if(!e.endDate)return;let t=e.startDate,n=e.endDate;for(;f(t,n)<0;)if(t=this.addOneDay(t),f(t,n)<=0){let r=M(t);this.removeFromDateIndex(r,e.id,this.multiDayEntriesByDate)}}addToDateIndex(e,t,n){let r=n.get(e);r?r.push(t):n.set(e,[t])}removeFromDateIndex(e,t,n){let r=n.get(e);if(!r)return;let a=r.filter(i=>i.id!==t);a.length===0?n.delete(e):n.set(e,a)}addOneDay(e){let t=e.day+1,n=e.month,r=e.year,a=this.getDaysInMonth(r,n);return t>a&&(t=1,n+=1,n>12&&(n=1,r+=1)),{year:r,month:n,day:t}}getDaysInMonth(e,t){let n=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2?e%4===0&&e%100!==0||e%400===0?29:28:n[t-1]}log(e){this.config.debug&&console.log(`[EntryCache] ${e}`)}};var N=class N{parseDate(e){if(e==null)return null;if(typeof e=="string")return this.parseDateString(e);if(e instanceof Date)return isNaN(e.getTime())?null:{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()};if(typeof e=="object"&&e!==null){let t=e;if(typeof t.year=="number"&&typeof t.month=="number"&&typeof t.day=="number"&&this.isValidDate(t.year,t.month,t.day))return{year:t.year,month:t.month,day:t.day}}return null}parseDateString(e){let n=e.trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!n)return null;let r=parseInt(n[1],10),a=parseInt(n[2],10),i=parseInt(n[3],10);return this.isValidDate(r,a,i)?{year:r,month:a,day:i}:null}isValidDate(e,t,n){if(e<1900||e>2100||t<1||t>12||n<1||n>31)return!1;let r=this.getDaysInMonth(e,t);return!(n>r)}getDaysInMonth(e,t){let n=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2&&this.isLeapYear(e)?29:n[t-1]}isLeapYear(e){return e%4===0&&e%100!==0||e%400===0}extractFromFilename(e){let t={start:null,end:null};if(!e||typeof e!="string")return t;let n=e.match(N.DATE_PATTERN);return!n||n.length===0||(t.start=this.parseDate(n[0]),n.length>=2&&(t.end=this.parseDate(n[1]))),t}extractFromProperties(e,t){if(!e||typeof e!="object"||!Array.isArray(t))return null;for(let n of t){if(typeof n!="string"||!n)continue;let r=e[n];if(r==null)continue;let a=this.parseDate(r);if(a!==null)return a}return null}extractDates(e,t,n){let r={start:null,end:null},a=this.extractFromFilename(e);for(let i of n.priorities)i==="filename"?(r.start===null&&a.start!==null&&(r.start=a.start),r.end===null&&a.end!==null&&(r.end=a.end)):i==="properties"&&(r.start===null&&(r.start=this.extractFromProperties(t,n.startSources)),r.end===null&&(r.end=this.extractFromProperties(t,n.endSources)));return r}};N.DATE_PATTERN=/(\d{4}-\d{2}-\d{2})/g;var L=N,xe=new L;var de=["January","February","March","April","May","June","July","August","September","October","November","December"],O=class{getDaysInMonth(e,t){return D(e,t)}getFirstDayOfWeek(e,t){let n=v(e,t,1);return w(n)}isToday(e){let t=b();return P(e,t)}generateGrid(e){let t=[];for(let n=1;n<=12;n++)t.push(this.generateMonth(e,n));return{year:e,months:t}}generateMonth(e,t){let n=this.getDaysInMonth(e,t),r=this.getFirstDayOfWeek(e,t),a=[];for(let i=0;i<r;i++)a.push({date:v(e,t,1),isToday:!1,isEmpty:!0});for(let i=1;i<=n;i++){let o=v(e,t,i);a.push({date:o,isToday:this.isToday(o),isEmpty:!1})}return{month:t,name:de[t-1],startDayOfWeek:r,daysInMonth:n,days:a}}};var ce=24,F=class{calculateMonthSegments(e,t,n){let r=[];if(f(e,t)>0)return r;let a=e.year,i=e.month,o=0;for(;o<ce;){let l=a===e.year&&i===e.month,d=a===t.year&&i===t.month,c=l?e.day:1,y=d?t.day:D(a,i);if(r.push({year:a,month:i,startDay:c,endDay:y,entryId:n}),d)break;i++,i>12&&(i=1,a++),o++}return r}calculateBarPositions(e,t){let n=new Map;if(e.length===0)return n;let r=[...e].sort((i,o)=>i.startDay!==o.startDay?i.startDay-o.startDay:o.endDay-o.startDay-(i.endDay-i.startDay)),a=[];for(let i=0;i<=31;i++)a.push(new Set);for(let i of r){let o=(t.startDayOfWeek+i.startDay-1)%7,l=(t.startDayOfWeek+i.endDay-1)%7,d=i.endDay-i.startDay+1,c=0,y=!1;for(;!y;){let u=!0;for(let g=i.startDay;g<=i.endDay;g++)if(a[g].has(c)){u=!1;break}if(u){y=!0;for(let g=i.startDay;g<=i.endDay;g++)a[g].add(c)}else c++;if(c>100)break}n.set(i.entryId,{rowIndex:c,startColumn:o,endColumn:l,span:d})}return n}},Pe=new F;function W(s){let e=s.endDate!==null&&(s.startDate.year!==s.endDate.year||s.startDate.month!==s.endDate.month||s.startDate.day!==s.endDate.day);return Object.freeze({id:s.id,filePath:s.filePath,fileName:s.fileName,displayName:s.displayName,startDate:s.startDate,endDate:s.endDate,isMultiDay:e,metadata:Object.freeze({tags:Object.freeze([...s.metadata.tags]),folder:s.metadata.folder,properties:Object.freeze({...s.metadata.properties})})})}var k=class{constructor(e,t){this.unregisterMetadataListener=null;this.eventListeners=null;this.vaultRepository=new R(e),this.metadataRepository=new A(e),this.entryCache=new I({debug:!1}),this.dateEngine=new L,this.calendarEngine=new O,this.multiDayEngine=new F,this.settings=t,this.currentYear=b().year}async initialize(){await this.rebuildCache(),this.setupMetadataListener()}destroy(){this.unregisterMetadataListener&&(this.unregisterMetadataListener(),this.unregisterMetadataListener=null),this.eventListeners=null}setEventListeners(e){this.eventListeners=e}async updateSettings(e){let t=this.settings.dateProperties.join(",")!==e.dateProperties.join(",")||this.settings.endDateProperties.join(",")!==e.endDateProperties.join(",")||this.settings.datePriority!==e.datePriority;this.settings=e,t&&await this.rebuildCache()}getCurrentYear(){return this.currentYear}setCurrentYear(e){var t;this.currentYear!==e&&(this.currentYear=e,(t=this.eventListeners)==null||t.onYearChanged(e))}nextYear(){this.setCurrentYear(this.currentYear+1)}previousYear(){this.setCurrentYear(this.currentYear-1)}goToToday(){this.setCurrentYear(b().year)}generateCalendarGrid(){return this.calendarEngine.generateGrid(this.currentYear)}getEntriesForDate(e){return this.entryCache.getEntriesForDate(e)}getMultiDayEntries(){return this.entryCache.getMultiDayEntries().filter(e=>{var a;let t={year:this.currentYear,month:1,day:1},n={year:this.currentYear,month:12,day:31},r=(a=e.endDate)!=null?a:e.startDate;return e.startDate.year===this.currentYear||e.startDate.year<this.currentYear&&r.year>=this.currentYear})}calculateBarPositions(e,t){return new Map}async openDailyNote(e){let t=this.settings.dailyNoteFormat,n=this.settings.dailyNoteFolder,r=this.formatDailyNoteFilename(e,t),a=n?`${n}/${r}.md`:`${r}.md`,i=await this.vaultRepository.createOrOpenDailyNote(a);console.log(`Opening daily note: ${i.path}`)}getCacheStats(){let e=this.entryCache.getStats();return{entryCount:e.entryCount,dateCount:e.dateCount}}async rebuildCache(){var r;let e=this.vaultRepository.getAllMarkdownFiles(),t=[],n=this.getDateExtractionConfig();for(let a of e){let i=this.createEntryFromFile(a,n);i&&t.push(i)}this.entryCache.rebuild(t),(r=this.eventListeners)==null||r.onEntriesUpdated()}createEntryFromFile(e,t){var l,d,c;let n=this.metadataRepository.getMetadataByPath(e.path),r=(l=n==null?void 0:n.frontmatter)!=null?l:null,{start:a,end:i}=this.dateEngine.extractDates(e.name,r,t);if(!a)return null;let o={};if(r)for(let[y,u]of Object.entries(r))(typeof u=="string"||typeof u=="number"||typeof u=="boolean")&&(o[y]=u);return W({id:e.path,filePath:e.path,fileName:e.name,displayName:e.basename,startDate:a,endDate:i,metadata:{tags:(d=n==null?void 0:n.tags.map(y=>y.name))!=null?d:[],folder:(c=e.folderPath)!=null?c:"",properties:o}})}getDateExtractionConfig(){return{startSources:this.settings.dateProperties,endSources:this.settings.endDateProperties,priorities:this.settings.datePriority==="property"?["properties","filename"]:["filename","properties"]}}formatDailyNoteFilename(e,t){return t.replace("YYYY",String(e.year)).replace("MM",String(e.month).padStart(2,"0")).replace("DD",String(e.day).padStart(2,"0"))}setupMetadataListener(){this.unregisterMetadataListener=this.metadataRepository.onMetadataChange(e=>{this.handleFileChange(e.path)})}handleFileChange(e){var n;let t=this.vaultRepository.getAllMarkdownFiles().find(r=>r.path===e);if(!t)this.entryCache.removeEntry(e);else{let r=this.getDateExtractionConfig(),a=this.createEntryFromFile(t,r);a?this.entryCache.addEntry(a):this.entryCache.removeEntry(e)}(n=this.eventListeners)==null||n.onEntriesUpdated()}};var Y=require("obsidian");var T="radial-calendar-plugin",ue=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],K=["January","February","March","April","May","June","July","August","September","October","November","December"],H=800,p=H/2,E=380,C=120,X=100,Ze=(E-C)/31,B=class extends Y.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.tooltipEl=null}getViewType(){return T}getDisplayText(){return"Radial Calendar"}getIcon(){return"circle"}initialize(t){this.config=t,this.config.service.setEventListeners({onEntriesUpdated:()=>this.render(),onYearChanged:()=>this.render()})}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("radial-calendar-plugin"),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null,this.tooltipEl=null}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let n=this.config.service.getCurrentYear(),r=this.containerEl_.createDiv({cls:"rc-container"});this.renderHeader(r,n);let a=r.createDiv({cls:"rc-wrapper"});this.renderRadialCalendar(a,n),this.tooltipEl=r.createDiv({cls:"rc-tooltip"}),this.tooltipEl.style.display="none"}renderHeader(t,n){if(!this.config)return;let r=t.createDiv({cls:"rc-header"});r.createEl("button",{text:"\u2190",cls:"rc-nav-btn",attr:{"aria-label":"Previous year"}}).addEventListener("click",()=>{var l;(l=this.config)==null||l.service.previousYear()}),r.createEl("span",{text:String(n),cls:"rc-year-title"}),r.createEl("button",{text:"\u2192",cls:"rc-nav-btn",attr:{"aria-label":"Next year"}}).addEventListener("click",()=>{var l;(l=this.config)==null||l.service.nextYear()}),r.createEl("button",{text:"Today",cls:"rc-nav-btn rc-today-btn",attr:{"aria-label":"Go to today"}}).addEventListener("click",()=>{var l;(l=this.config)==null||l.service.goToToday()})}renderRadialCalendar(t,n){if(!this.config)return;let r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox",`0 0 ${H} ${H}`),r.setAttribute("class","rc-svg"),this.svgEl=r,this.renderBackgroundCircle(r);for(let a=1;a<=12;a++)this.renderMonthSegment(r,n,a);this.renderCenter(r,n),this.renderMonthLabels(r),this.renderTodayMarker(r,n),t.appendChild(r)}renderBackgroundCircle(t){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(p)),n.setAttribute("cy",String(p)),n.setAttribute("r",String(E)),n.setAttribute("class","rc-background"),t.appendChild(n)}renderCenter(t,n){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(p)),r.setAttribute("cy",String(p)),r.setAttribute("r",String(C-10)),r.setAttribute("class","rc-center"),t.appendChild(r)}renderMonthLabels(t){for(let n=0;n<12;n++){let r=this.monthToAngle(n+1)+Math.PI/12,a=p+X*Math.cos(r-Math.PI/2),i=p+X*Math.sin(r-Math.PI/2),o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x",String(a)),o.setAttribute("y",String(i)),o.setAttribute("class","rc-month-label"),o.setAttribute("text-anchor","middle"),o.setAttribute("dominant-baseline","central"),o.textContent=ue[n],t.appendChild(o)}}renderMonthSegment(t,n,r){if(!this.config)return;let a=D(n,r),i=this.monthToAngle(r),l=Math.PI/6/a,d=b(),c=d.year===n&&d.month===r;for(let y=1;y<=a;y++){let u=v(n,r,y),g=w(u),h=c&&d.day===y,S=g===0||g===6,x=i+(y-1)*l,te=x+l-.002,ne=this.config.service.getEntriesForDate(u);this.renderDayArc(t,u,x,te,h,S,ne)}this.renderMonthSeparator(t,i)}renderDayArc(t,n,r,a,i,o,l){if(!this.config)return;let d=C,c=E,y=this.createArcPath(d,c,r,a),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",y);let g=["rc-day-arc"];i&&g.push("rc-day-arc--today"),o&&g.push("rc-day-arc--weekend"),l.length>0&&g.push("rc-day-arc--has-notes"),l.length>3&&g.push("rc-day-arc--many-notes"),u.setAttribute("class",g.join(" ")),u.setAttribute("data-date",`${n.year}-${String(n.month).padStart(2,"0")}-${String(n.day).padStart(2,"0")}`),u.addEventListener("click",async h=>{var S;h.preventDefault(),await((S=this.config)==null?void 0:S.service.openDailyNote(n))}),u.addEventListener("mouseenter",h=>{this.showTooltip(h,n,l)}),u.addEventListener("mouseleave",()=>{this.hideTooltip()}),u.addEventListener("contextmenu",h=>{h.preventDefault(),l.length>0&&this.showDayContextMenu(h,n,l)}),t.appendChild(u),l.length>0&&this.renderNoteIndicators(t,r,a,l)}renderNoteIndicators(t,n,r,a){let i=E-15,o=E-5,l=Math.min(a.length,3),d=(r-n)/l;for(let c=0;c<l;c++){let y=n+c*d+.001,u=y+d-.002,g=this.createArcPath(i,o,y,u),h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",g),h.setAttribute("class","rc-note-indicator"),t.appendChild(h)}}renderMonthSeparator(t,n){let r=p+C*Math.cos(n-Math.PI/2),a=p+C*Math.sin(n-Math.PI/2),i=p+E*Math.cos(n-Math.PI/2),o=p+E*Math.sin(n-Math.PI/2),l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",String(r)),l.setAttribute("y1",String(a)),l.setAttribute("x2",String(i)),l.setAttribute("y2",String(o)),l.setAttribute("class","rc-month-separator"),t.appendChild(l)}renderTodayMarker(t,n){let r=b();if(r.year!==n)return;let a=D(n,r.month),i=this.monthToAngle(r.month),l=Math.PI/6/a,d=i+(r.day-.5)*l,c=p+(C-10)*Math.cos(d-Math.PI/2),y=p+(C-10)*Math.sin(d-Math.PI/2),u=p+(E+5)*Math.cos(d-Math.PI/2),g=p+(E+5)*Math.sin(d-Math.PI/2),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(c)),h.setAttribute("y1",String(y)),h.setAttribute("x2",String(u)),h.setAttribute("y2",String(g)),h.setAttribute("class","rc-today-marker"),t.appendChild(h)}createArcPath(t,n,r,a){let i=r-Math.PI/2,o=a-Math.PI/2,l=p+t*Math.cos(i),d=p+t*Math.sin(i),c=p+t*Math.cos(o),y=p+t*Math.sin(o),u=p+n*Math.cos(i),g=p+n*Math.sin(i),h=p+n*Math.cos(o),S=p+n*Math.sin(o),x=a-r>Math.PI?1:0;return`
      M ${l} ${d}
      L ${u} ${g}
      A ${n} ${n} 0 ${x} 1 ${h} ${S}
      L ${c} ${y}
      A ${t} ${t} 0 ${x} 0 ${l} ${d}
      Z
    `}monthToAngle(t){return(t-1)*Math.PI/6}showTooltip(t,n,r){var d;if(!this.tooltipEl)return;let o=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][w(n)]}, ${K[n.month-1]} ${n.day}, ${n.year}`}</div>`;if(r.length>0){o+='<div class="rc-tooltip-notes">';for(let c of r.slice(0,5))o+=`<div class="rc-tooltip-note">${c.displayName}</div>`;r.length>5&&(o+=`<div class="rc-tooltip-more">+${r.length-5} more</div>`),o+="</div>"}this.tooltipEl.innerHTML=o,this.tooltipEl.style.display="block";let l=(d=this.containerEl_)==null?void 0:d.getBoundingClientRect();if(l){let c=t.clientX-l.left+10,y=t.clientY-l.top+10;this.tooltipEl.style.left=`${c}px`,this.tooltipEl.style.top=`${y}px`}}hideTooltip(){this.tooltipEl&&(this.tooltipEl.style.display="none")}showDayContextMenu(t,n,r){if(!this.config)return;let a=new Y.Menu;a.addItem(i=>{i.setTitle(`Open ${K[n.month-1]} ${n.day}`).setIcon("calendar").onClick(async()=>{var o;await((o=this.config)==null?void 0:o.service.openDailyNote(n))})}),a.addSeparator();for(let i of r.slice(0,10))a.addItem(o=>{o.setTitle(i.displayName).setIcon("file").onClick(()=>{var l;(l=this.config)==null||l.openFile(i.filePath)})});r.length>10&&a.addItem(i=>{i.setTitle(`+${r.length-10} more...`).setDisabled(!0)}),a.showAtMouseEvent(t)}};var m=require("obsidian");var he=Object.freeze({fromFilename:!0,fromFrontmatter:!0,frontmatterField:"date",endDateField:"endDate",filenamePatterns:Object.freeze(["^(\\d{4}-\\d{2}-\\d{2})","(\\d{4}-\\d{2}-\\d{2})$","^(\\d{4}-\\d{2}-\\d{2})[-_\\s]","[-_\\s](\\d{4}-\\d{2}-\\d{2})\\.md$"]),useCreationDateFallback:!1}),me=Object.freeze({includeFolders:Object.freeze([]),excludeFolders:Object.freeze([])}),fe=Object.freeze({firstDayOfWeek:1,showWeekNumbers:!1,highlightToday:!0,showAdjacentMonths:!0,maxEntriesPerDay:3,showMultiDayBars:!0}),Mt=Object.freeze({dateExtraction:he,folderFilter:me,display:fe,locale:"en-US",debugMode:!1});var Z={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",teal:"#14b8a6",cyan:"#06b6d4",magenta:"#d946ef",lime:"#84cc16",amber:"#f59e0b",indigo:"#6366f1",violet:"#8b5cf6",rose:"#f43f5e",gray:"#6b7280",slate:"#64748b",stone:"#78716c"};function Q(s){return{id:`ring-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Ring ${s+1}`,folder:"",color:"blue",segmentType:"monthly",enabled:!0,order:s}}var U={currentView:"annual",birthYear:1990,expectedLifespan:85,currentYear:new Date().getFullYear(),rings:[],centerDisplay:"countdown",periodicNotesFormat:{yearly:"YYYY",monthly:"YYYY-MM",daily:"YYYY-MM-DD"},templateFolder:"Templates"},ee=`---
# === RADIAL CALENDAR TEMPLATE ===
# L\xF6sche die Zeilen, die du nicht brauchst

# FARBEN (w\xE4hle eine):
ring-color: blue
# ring-color: red
# ring-color: orange
# ring-color: yellow
# ring-color: green
# ring-color: teal
# ring-color: purple
# ring-color: magenta
# ring-color: pink
# ring-color: cyan
# ring-color: lime
# ring-color: amber
# ring-color: indigo

# STIL (w\xE4hle einen):
ring-style: solid
# ring-style: striped
# ring-style: dotted
# ring-style: gradient

# LABEL & ICON:
ring-label: ""
ring-icon: circle

# ZEITRAUM:
date: {{date}}
# end-date:

# FORTSCHRITT (0-100):
# ring-progress: 0
---

# {{title}}

`;var V=require("obsidian"),$=class extends V.AbstractInputSuggest{constructor(e,t){super(e,t),this.textInputEl=t}getSuggestions(e){let t=this.getAllFolders(),n=e.toLowerCase().trim();return n===""?t:t.filter(r=>r.path.toLowerCase().includes(n))}renderSuggestion(e,t){t.addClass("folder-suggest-item");let n=t.createSpan({cls:"folder-suggest-icon"});n.innerHTML=this.getFolderIcon(),t.createSpan({cls:"folder-suggest-text"}).setText(e.path||"/")}selectSuggestion(e,t){this.textInputEl.value=e.path,this.textInputEl.trigger("input"),this.close()}getAllFolders(){let e=[],t=r=>{e.push(r);for(let a of r.children)a instanceof V.TFolder&&t(a)},n=this.app.vault.getRoot();return t(n),e.sort((r,a)=>r.isRoot()?-1:a.isRoot()?1:r.path.localeCompare(a.path))}getFolderIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>'}};var j=class extends m.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),this.createViewModeSection(e),this.plugin.settings.currentView==="life"&&this.createLifeViewSection(e),this.createRingConfigSection(e),this.createTemplateSection(e),this.createCenterDisplaySection(e)}createViewModeSection(e){new m.Setting(e).setName("Ansichtsmodus").setDesc("Wechseln zwischen Jahres- und Lebensansicht").addDropdown(t=>{t.addOption("annual","Jahresansicht").addOption("life","Lebensansicht").setValue(this.plugin.settings.currentView).onChange(async n=>{this.plugin.settings.currentView=n,await this.plugin.saveSettings(),this.display()})})}createLifeViewSection(e){e.createEl("h3",{text:"Lebensansicht Einstellungen"}),new m.Setting(e).setName("Geburtsjahr").setDesc("Dein Geburtsjahr").addText(t=>{t.setPlaceholder("z.B. 1990").setValue(String(this.plugin.settings.birthYear)).onChange(async n=>{let r=parseInt(n,10);!isNaN(r)&&r>1900&&r<=new Date().getFullYear()&&(this.plugin.settings.birthYear=r,await this.plugin.saveSettings())})}),new m.Setting(e).setName("Erwartete Lebensspanne").setDesc("Erwartete Lebensdauer in Jahren").addText(t=>{t.setPlaceholder("z.B. 85").setValue(String(this.plugin.settings.expectedLifespan)).onChange(async n=>{let r=parseInt(n,10);!isNaN(r)&&r>0&&r<=150&&(this.plugin.settings.expectedLifespan=r,await this.plugin.saveSettings())})})}createRingConfigSection(e){e.createEl("h3",{text:"Ringe konfigurieren"});let t=this.plugin.settings.rings;t.forEach((n,r)=>{this.createRingSettings(e,n,r)}),new m.Setting(e).addButton(n=>{n.setButtonText("Ring hinzufugen").setCta().onClick(async()=>{let r=Q(t.length);this.plugin.settings.rings=[...t,r],await this.plugin.saveSettings(),this.display()})})}createRingSettings(e,t,n){let r=e.createDiv({cls:"radial-calendar-ring-config"}),a=new m.Setting(r).setName(`Ring ${n+1}`).setClass("radial-calendar-ring-header");new m.Setting(r).setName("Name").addText(i=>{i.setPlaceholder("Ring Name").setValue(t.name).onChange(async o=>{this.updateRing(n,{name:o})})}),new m.Setting(r).setName("Ordner").setDesc("Ordnerpfad im Vault").addText(i=>{i.setPlaceholder("z.B. Projects/2024").setValue(t.folder).onChange(async o=>{this.updateRing(n,{folder:o})}),new $(this.app,i.inputEl)}),new m.Setting(r).setName("Farbe").addDropdown(i=>{Object.keys(Z).forEach(o=>{i.addOption(o,this.formatColorName(o))}),i.setValue(t.color).onChange(async o=>{this.updateRing(n,{color:o})})}),new m.Setting(r).addButton(i=>{i.setButtonText("Loschen").setWarning().onClick(async()=>{this.plugin.settings.rings=this.plugin.settings.rings.filter((o,l)=>l!==n),this.plugin.settings.rings=this.plugin.settings.rings.map((o,l)=>({...o,order:l})),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateRing(e,t){let n=[...this.plugin.settings.rings];n[e]={...n[e],...t},this.plugin.settings.rings=n,await this.plugin.saveSettings()}formatColorName(e){return e.charAt(0).toUpperCase()+e.slice(1)}createTemplateSection(e){e.createEl("h3",{text:"Template"}),new m.Setting(e).setName("Template erstellen").setDesc("Erstellt eine Template-Datei fur Ring-Segmente im Vault").addButton(t=>{t.setButtonText("Template erstellen").onClick(async()=>{await this.createTemplateFile()})})}async createTemplateFile(){let e=this.plugin.settings.templateFolder||"Templates",t=`${e}/Radial Calendar Segment.md`;try{if(this.app.vault.getAbstractFileByPath(e)||await this.app.vault.createFolder(e),this.app.vault.getAbstractFileByPath(t)){new m.Notice(`Template existiert bereits: ${t}`);return}await this.app.vault.create(t,ee),new m.Notice(`Template erstellt: ${t}`)}catch(n){console.error("Failed to create template file:",n),new m.Notice("Fehler beim Erstellen des Templates")}}createCenterDisplaySection(e){e.createEl("h3",{text:"Zentrum Anzeige"}),new m.Setting(e).setName("Anzeigemodus").setDesc("Was im Zentrum des Kalenders angezeigt wird").addDropdown(t=>{t.addOption("countdown","Countdown").addOption("stats","Statistiken").addOption("navigation","Navigation").setValue(this.plugin.settings.centerDisplay).onChange(async n=>{this.plugin.settings.centerDisplay=n,await this.plugin.saveSettings()})})}};var z=class extends _.Plugin{constructor(){super(...arguments);this.service=null;this.settings={...U}}async onload(){await this.loadSettings();let t={dateProperties:["date","created","due"],endDateProperties:["endDate","end","until"],datePriority:"filename",dailyNoteFormat:this.settings.periodicNotesFormat.daily,dailyNoteFolder:""};this.service=new k(this.app,t),await this.service.initialize(),this.registerView(T,n=>{let r=new B(n);return r.initialize({service:this.service,openFile:async a=>{let i=this.app.vault.getAbstractFileByPath(a);i instanceof _.TFile&&await this.app.workspace.getLeaf().openFile(i)}}),r}),this.addSettingTab(new j(this.app,this)),this.addRibbonIcon("circle","Open Radial Calendar",()=>{this.activateView()}),this.addCommand({id:"open-radial-calendar",name:"Open Radial Calendar",callback:()=>{this.activateView()}})}async onunload(){var t;(t=this.service)==null||t.destroy(),this.service=null}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},U,t)}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:t}=this.app,n=null,r=t.getLeavesOfType(T);r.length>0?n=r[0]:(n=t.getLeaf("tab"),n&&await n.setViewState({type:T,active:!0})),n&&t.revealLeaf(n)}};
