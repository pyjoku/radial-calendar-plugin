/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var wt=Object.defineProperty;var De=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var ve=Object.prototype.hasOwnProperty;var Z=(o,e)=>()=>(o&&(e=o(o=0)),e);var Bt=(o,e)=>{for(var t in e)wt(o,t,{get:e[t],enumerable:!0})},Ee=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Se(e))!ve.call(o,a)&&a!==t&&wt(o,a,{get:()=>e[a],enumerable:!(n=De(e,a))||n.enumerable});return o};var _t=o=>Ee(wt({},"__esModule",{value:!0}),o);function C(o,e,t){let n={year:o,month:e,day:t};if(!et(n))throw new Error(`Invalid date: ${o}-${e}-${t}`);return Object.freeze(n)}function I(o){let e=o.month.toString().padStart(2,"0"),t=o.day.toString().padStart(2,"0");return`${o.year}-${e}-${t}`}function Wt(o){let e=o.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!e)return null;let t=parseInt(e[1],10),n=parseInt(e[2],10),a=parseInt(e[3],10),r={year:t,month:n,day:a};return et(r)?Object.freeze(r):null}function v(o,e){return o.year!==e.year?o.year-e.year:o.month!==e.month?o.month-e.month:o.day-e.day}function Y(o,e){return o.year===e.year&&o.month===e.month&&o.day===e.day}function et(o){let{year:e,month:t,day:n}=o;if(!Number.isInteger(e)||e<1||!Number.isInteger(t)||t<1||t>12||!Number.isInteger(n)||n<1)return!1;let a=w(e,t);return n<=a}function w(o,e){let t=[31,28,31,30,31,30,31,31,30,31,30,31];return e===2&&nt(o)?29:t[e-1]}function nt(o){return o%4===0&&o%100!==0||o%400===0}function F(o){let e=o.year,t=o.month,n=o.day;t<3&&(t+=12,e-=1);let a=n,r=t,i=e%100,s=Math.floor(e/100),l=(a+Math.floor(13*(r+1)/5)+i+Math.floor(i/4)+Math.floor(s/4)-2*s)%7;return l=(l%7+7)%7,(l+6)%7}function V(o,e){let t=o.year,n=o.month,a=o.day+e;for(;a>w(t,n);)a-=w(t,n),n+=1,n>12&&(n=1,t+=1);for(;a<1;)n-=1,n<1&&(n=12,t-=1),a+=w(t,n);return Object.freeze({year:t,month:n,day:a})}function jt(o,e){return V(o,-e)}function M(){let o=new Date;return Object.freeze({year:o.getFullYear(),month:o.getMonth()+1,day:o.getDate()})}function Ht(o,e){let t=zt(o);return zt(e)-t}function at(o,e){return v(o,e)<0}function rt(o,e){return v(o,e)>0}function Ut(o,e,t){return v(o,e)>=0&&v(o,t)<=0}function Jt(o){return Object.freeze({year:o.year,month:o.month,day:1})}function qt(o){let e=w(o.year,o.month);return Object.freeze({year:o.year,month:o.month,day:e})}function zt(o){let{year:e,month:t,day:n}=o,a=e*365+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400);return a+=[0,31,59,90,120,151,181,212,243,273,304,334][t-1],t>2&&nt(e)&&(a+=1),a+=n,a}var N=Z(()=>{"use strict"});function lt(o){let e=o.endDate!==null&&(o.startDate.year!==o.endDate.year||o.startDate.month!==o.endDate.month||o.startDate.day!==o.endDate.day);return Object.freeze({id:o.id,filePath:o.filePath,fileName:o.fileName,displayName:o.displayName,startDate:o.startDate,endDate:o.endDate,isMultiDay:e,metadata:Object.freeze({tags:Object.freeze([...o.metadata.tags]),folder:o.metadata.folder,properties:Object.freeze({...o.metadata.properties})})})}function Kt(){return Object.freeze({tags:Object.freeze([]),folder:"",properties:Object.freeze({})})}function Zt(o){if(typeof o!="object"||o===null)return!1;let e=o;return typeof e.id=="string"&&typeof e.filePath=="string"&&typeof e.fileName=="string"&&typeof e.displayName=="string"&&Xt(e.startDate)&&(e.endDate===null||Xt(e.endDate))&&typeof e.isMultiDay=="boolean"&&Me(e.metadata)}function Xt(o){if(typeof o!="object"||o===null)return!1;let e=o;return typeof e.year=="number"&&typeof e.month=="number"&&typeof e.day=="number"}function Me(o){if(typeof o!="object"||o===null)return!1;let e=o;return Array.isArray(e.tags)&&typeof e.folder=="string"&&typeof e.properties=="object"&&e.properties!==null}var At=Z(()=>{"use strict"});function Qt(o,e){if(v(o,e)>0)throw new Error("Start date must be before or equal to end date");return Object.freeze({start:o,end:e})}function te(o){return Object.freeze({start:o,end:o})}function Mt(o,e){return v(o.start,e.end)<=0&&v(e.start,o.end)<=0}function ee(o,e){return v(o,e.start)>=0&&v(o,e.end)<=0}function ne(o,e){return v(o.start,e.start)<=0&&v(o.end,e.end)>=0}function ae(o,e){if(!Mt(o,e))return null;let t=v(o.start,e.start)>=0?o.start:e.start,n=v(o.end,e.end)<=0?o.end:e.end;return Object.freeze({start:t,end:n})}function re(o){if(o.start.year===o.end.year&&o.start.month===o.end.month)return o.end.day-o.start.day+1;let e=0,t=o.start;for(;v(t,o.end)<=0;)e++,t=V(t,1);return e}function ie(o,e){let t=[],n=o.start.year,a=o.start.month,r=o.start.day;for(;n<o.end.year||n===o.end.year&&a<=o.end.month;){let i=w(n,a),s;n===o.end.year&&a===o.end.month?s=o.end.day:s=i,t.push(Object.freeze({year:n,month:a,startDay:r,endDay:s,entryId:e})),a++,a>12&&(a=1,n++),r=1}return Object.freeze(t)}function se(o,e,t,n){let a={year:e,month:t,day:1},r={year:e,month:t,day:w(e,t)};if(rt(o.start,r)||at(o.end,a))return null;let i=o.start.year===e&&o.start.month===t?o.start.day:1,s=o.end.year===e&&o.end.month===t?o.end.day:w(e,t);return Object.freeze({year:e,month:t,startDay:i,endDay:s,entryId:n})}function oe(o,e){return Object.freeze({start:{year:o,month:e,day:1},end:{year:o,month:e,day:w(o,e)}})}function le(o){return Y(o.start,o.end)}function ce(o,e,t){return Object.freeze({start:V(o.start,-e),end:V(o.end,t)})}var de=Z(()=>{"use strict";N()});var ge={};Bt(ge,{DEFAULT_DATE_EXTRACTION_CONFIG:()=>ct,DEFAULT_DISPLAY_CONFIG:()=>gt,DEFAULT_FOLDER_FILTER_CONFIG:()=>dt,DEFAULT_PLUGIN_SETTINGS:()=>Ct,DEFAULT_RADIAL_SETTINGS:()=>ut,DEFAULT_SETTINGS:()=>Le,PREDEFINED_QUARTERS:()=>Pt,PREDEFINED_SEASONS:()=>Ft,PREDEFINED_SEMESTERS:()=>Nt,RING_COLORS:()=>P,RING_SEGMENT_TEMPLATE:()=>Ot,addDays:()=>V,assignTracks:()=>xt,compareLocalDates:()=>v,computeSubRingRadii:()=>Tt,createCalendarEntry:()=>lt,createCurrentViewState:()=>xe,createDateRange:()=>Qt,createDefaultRing:()=>Lt,createEmptyMetadata:()=>Kt,createEventsRing:()=>Fe,createLifePhasesRing:()=>Re,createLocalDate:()=>C,createMonthRange:()=>oe,createPluginSettings:()=>Ce,createSingleDayRange:()=>te,createViewState:()=>Te,daysBetween:()=>Ht,extendRange:()=>ce,generate10DayPhases:()=>It,generateWeekSegments:()=>kt,getDaysInMonth:()=>w,getFirstDayOfMonth:()=>Jt,getLastDayOfMonth:()=>qt,getMaxTrackCount:()=>Rt,getMonthSegment:()=>se,getRangeDays:()=>re,getToday:()=>M,getWeekday:()=>F,intersectRanges:()=>ae,isAfter:()=>rt,isBefore:()=>at,isCalendarEntry:()=>Zt,isDateInRange:()=>ee,isLeapYear:()=>nt,isSingleDay:()=>le,isValidLocalDate:()=>et,isWithinRange:()=>Ut,keyToLocalDate:()=>Wt,localDateToKey:()=>I,localDatesEqual:()=>Y,rangeContains:()=>ne,rangesOverlap:()=>Mt,splitRangeByMonth:()=>ie,subtractDays:()=>jt});function Ce(o){var e,t;return Object.freeze({dateExtraction:o.dateExtraction?Object.freeze({...ct,...o.dateExtraction}):ct,folderFilter:o.folderFilter?Object.freeze({...dt,...o.folderFilter}):dt,display:o.display?Object.freeze({...gt,...o.display}):gt,locale:(e=o.locale)!=null?e:Ct.locale,debugMode:(t=o.debugMode)!=null?t:Ct.debugMode})}function xe(){let o=new Date;return Object.freeze({year:o.getFullYear(),month:o.getMonth()+1,selectedDate:null,focusedEntryId:null})}function Te(o,e){return Object.freeze({year:o,month:e,selectedDate:null,focusedEntryId:null})}function Lt(o){return{id:`ring-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Ring ${o+1}`,folder:"",color:"blue",segmentType:"monthly",enabled:!0,order:o,ringType:"year-days",segmentStyle:"fixed",folderPattern:"fixed",recursive:!1,showGaps:!1,showLabels:!1}}function Re(o,e=0){return{id:`life-phases-${Date.now()}`,name:"Lebensphasen",folder:o,color:"blue",segmentType:"custom",enabled:!0,order:e,ringType:"life-phases",segmentStyle:"from-yaml",folderPattern:"fixed",recursive:!1,startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",showGaps:!0,showLabels:!0}}function Fe(o,e=1){return{id:`events-${Date.now()}`,name:"Events",folder:o,color:"teal",segmentType:"custom",enabled:!0,order:e,ringType:"events",segmentStyle:"from-yaml",folderPattern:"year-substitution",recursive:!1,startDateField:"event-start",endDateField:"event-end",colorField:"event-color",labelField:"event-label",showGaps:!0,showLabels:!0}}function xt(o){let e=[...o].sort((n,a)=>n.startAngle-a.startAngle),t=[];return e.map(n=>{let a=t.findIndex(r=>r.endAngle<=n.startAngle);return a===-1?(a=t.length,t.push({endAngle:n.endAngle})):t[a].endAngle=n.endAngle,{...n,track:a}})}function Tt(o,e,t,n){let a=(o-e)/t;return{outer:o-n*a,inner:o-(n+1)*a}}function Rt(o){return o.length===0?1:Math.max(...o.map(e=>e.track))+1}function It(){let o=[],e=1,t=1;for(;e<=365;){let n=Math.min(e+9,365);o.push({id:`10d-${t}`,label:`P${t}`,startDay:e,endDay:n}),e=n+1,t++}return o}function kt(){let o=[];for(let e=1;e<=52;e++){let t=(e-1)*7+1,n=Math.min(e*7,365);o.push({id:`kw-${e}`,label:`KW${e}`,startDay:t,endDay:n})}return o}var ct,dt,gt,Ct,Le,P,Ft,Pt,Nt,ut,Ot,j=Z(()=>{"use strict";N();At();de();ct=Object.freeze({fromFilename:!0,fromFrontmatter:!0,frontmatterField:"date",endDateField:"endDate",filenamePatterns:Object.freeze(["^(\\d{4}-\\d{2}-\\d{2})","(\\d{4}-\\d{2}-\\d{2})$","^(\\d{4}-\\d{2}-\\d{2})[-_\\s]","[-_\\s](\\d{4}-\\d{2}-\\d{2})\\.md$"]),useCreationDateFallback:!1}),dt=Object.freeze({includeFolders:Object.freeze([]),excludeFolders:Object.freeze([])}),gt=Object.freeze({firstDayOfWeek:1,showWeekNumbers:!1,highlightToday:!0,showAdjacentMonths:!0,maxEntriesPerDay:3,showMultiDayBars:!0}),Ct=Object.freeze({dateExtraction:ct,folderFilter:dt,display:gt,locale:"en-US",debugMode:!1});Le={calendarWidth:"fit",dateProperties:["date","startDate","created"],endDateProperties:["endDate","due","deadline"],datePriority:"property",dailyNoteFolder:"",dailyNoteFormat:"YYYY-MM-DD",showMultiDayBars:!0,showWeekendHighlight:!0};P={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",teal:"#14b8a6",cyan:"#06b6d4",magenta:"#d946ef",lime:"#84cc16",amber:"#f59e0b",indigo:"#6366f1",violet:"#8b5cf6",rose:"#f43f5e",gray:"#6b7280",slate:"#64748b",stone:"#78716c"};Ft=[{id:"spring",label:"Fr\xFChling",startDay:60,endDay:152},{id:"summer",label:"Sommer",startDay:152,endDay:244},{id:"autumn",label:"Herbst",startDay:244,endDay:335},{id:"winter",label:"Winter",startDay:335,endDay:60}],Pt=[{id:"q1",label:"Q1",startDay:1,endDay:90},{id:"q2",label:"Q2",startDay:91,endDay:181},{id:"q3",label:"Q3",startDay:182,endDay:273},{id:"q4",label:"Q4",startDay:274,endDay:365}],Nt=[{id:"s1",label:"H1",startDay:1,endDay:181},{id:"s2",label:"H2",startDay:182,endDay:365}];ut={currentView:"annual",birthYear:1990,expectedLifespan:85,currentYear:new Date().getFullYear(),rings:[],centerDisplay:"countdown",periodicNotesFormat:{yearly:"YYYY",monthly:"YYYY-MM",daily:"YYYY-MM-DD"},templateFolder:"Templates",dailyNoteFolder:"",calendarFilterFolder:"",annualRecurringFolder:"",lifePhasesFolder:"",annualSegmentType:"none",customSegments:[],lifeActs:[],showSegmentLabels:!0},Ot=`---
# === RADIAL CALENDAR TEMPLATE ===
# L\xF6sche die Zeilen, die du nicht brauchst

# FARBEN (w\xE4hle eine):
ring-color: blue
# ring-color: red
# ring-color: orange
# ring-color: yellow
# ring-color: green
# ring-color: teal
# ring-color: purple
# ring-color: magenta
# ring-color: pink
# ring-color: cyan
# ring-color: lime
# ring-color: amber
# ring-color: indigo

# STIL (w\xE4hle einen):
ring-style: solid
# ring-style: striped
# ring-style: dotted
# ring-style: gradient

# LABEL & ICON:
ring-label: ""
ring-icon: circle

# ZEITRAUM:
date: {{date}}
# end-date:

# FORTSCHRITT (0-100):
# ring-progress: 0
---

# {{title}}

`});var $e={};Bt($e,{default:()=>vt});module.exports=_t($e);var K=require("obsidian");var Q=class{constructor(e){this.app=e}getAllMarkdownFiles(){return this.app.vault.getMarkdownFiles().map(t=>this.toFileInfo(t))}getMarkdownFilesInFolder(e){return this.getAllMarkdownFiles().filter(t=>t.folderPath?t.folderPath===e||t.folderPath.startsWith(e+"/"):!1)}getFileByPath(e){let t=this.app.vault.getAbstractFileByPath(e);return t instanceof this.getTFileClass()?t:null}async readFile(e){let t=this.getFileByPath(e);if(!t)return null;try{return await this.app.vault.read(t)}catch(n){return null}}async createOrOpenDailyNote(e,t=""){let n=this.getFileByPath(e);if(!n){let a=e.substring(0,e.lastIndexOf("/"));a&&await this.ensureFolderExists(a),n=await this.app.vault.create(e,t)}return n}async ensureFolderExists(e){this.app.vault.getAbstractFileByPath(e)||await this.app.vault.createFolder(e)}fileExists(e){return this.getFileByPath(e)!==null}getRoot(){return this.app.vault.getRoot()}toFileInfo(e){var t,n;return Object.freeze({path:e.path,basename:e.basename,name:e.name,extension:e.extension,folderPath:(n=(t=e.parent)==null?void 0:t.path)!=null?n:null})}getTFileClass(){let e=this.app.vault.getMarkdownFiles();return e.length>0?e[0].constructor:class{}}};var tt=class{constructor(e){this.app=e}getMetadata(e){let t=this.app.metadataCache.getFileCache(e);return this.extractMetadata(t)}getMetadataByPath(e){let t=this.app.vault.getAbstractFileByPath(e);return!t||!this.isMarkdownFile(t)?null:this.getMetadata(t)}getProperty(e,t){var a;return(a=this.getMetadata(e).frontmatter)==null?void 0:a[t]}getStringProperty(e,t){let n=this.getProperty(e,t);return typeof n=="string"?n:n instanceof Date?this.formatDate(n):typeof n=="number"?String(n):null}getDateProperty(e,t){let n=this.getProperty(e,t);if(!n)return null;if(typeof n=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;let a=n.match(/^(\d{4}-\d{2}-\d{2})/);return a?a[1]:null}return n instanceof Date&&!isNaN(n.getTime())?this.formatDate(n):this.isLocalDateLike(n)?this.formatLocalDate(n):null}getTags(e){return this.getMetadata(e).tags}hasTag(e,t){let n=t.startsWith("#")?t:`#${t}`;return this.getTags(e).some(r=>r.tag.toLowerCase()===n.toLowerCase())}onMetadataChange(e){let t=n=>e(n);return this.app.metadataCache.on("changed",t),()=>this.app.metadataCache.off("changed",t)}extractMetadata(e){var a;let t=(a=e==null?void 0:e.frontmatter)!=null?a:null,n=[];if(t!=null&&t.tags){let r=Array.isArray(t.tags)?t.tags:[t.tags];for(let i of r)if(typeof i=="string"){let s=i.startsWith("#")?i:`#${i}`;n.push({tag:s,name:s.substring(1)})}}if(e!=null&&e.tags)for(let r of e.tags)n.find(s=>s.tag.toLowerCase()===r.tag.toLowerCase())||n.push({tag:r.tag,name:r.tag.substring(1)});return Object.freeze({frontmatter:t,tags:Object.freeze(n)})}formatDate(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${a}`}formatLocalDate(e){let t=e.year,n=String(e.month).padStart(2,"0"),a=String(e.day).padStart(2,"0");return`${t}-${n}-${a}`}isLocalDateLike(e){return typeof e=="object"&&e!==null&&"year"in e&&"month"in e&&"day"in e&&typeof e.year=="number"&&typeof e.month=="number"&&typeof e.day=="number"}isMarkdownFile(e){return typeof e=="object"&&e!==null&&"extension"in e&&e.extension==="md"}};N();var it=class{constructor(e={}){var t,n;this.entriesByPath=new Map,this.entriesByDate=new Map,this.multiDayEntriesByDate=new Map,this.stats={hits:0,misses:0,lastRebuild:0},this.config={maxEntries:(t=e.maxEntries)!=null?t:1e4,debug:(n=e.debug)!=null?n:!1}}addEntry(e){this.removeEntry(e.filePath),this.entriesByPath.set(e.filePath,e);let t=I(e.startDate);this.addToDateIndex(t,e,this.entriesByDate),e.isMultiDay&&e.endDate&&this.indexMultiDayEntry(e),this.log(`Added entry: ${e.filePath}`)}removeEntry(e){let t=this.entriesByPath.get(e);if(!t)return;this.entriesByPath.delete(e);let n=I(t.startDate);this.removeFromDateIndex(n,t.id,this.entriesByDate),t.isMultiDay&&t.endDate&&this.removeMultiDayEntry(t),this.log(`Removed entry: ${e}`)}getEntriesForDate(e){var i,s;let t=I(e),n=(i=this.entriesByDate.get(t))!=null?i:[],a=(s=this.multiDayEntriesByDate.get(t))!=null?s:[];n.length>0||a.length>0?this.stats.hits++:this.stats.misses++;let r=new Map;for(let l of n)r.set(l.id,l);for(let l of a)r.set(l.id,l);return Array.from(r.values())}getEntriesInRange(e,t){var a;let n=new Map;for(let r of this.entriesByPath.values()){let i=(a=r.endDate)!=null?a:r.startDate;v(r.startDate,t)<=0&&v(i,e)>=0&&n.set(r.id,r)}return Array.from(n.values())}getMultiDayEntries(){return Array.from(this.entriesByPath.values()).filter(e=>e.isMultiDay)}getEntryByPath(e){return this.entriesByPath.get(e)}hasEntry(e){return this.entriesByPath.has(e)}getAllEntries(){return Array.from(this.entriesByPath.values())}clear(){this.entriesByPath.clear(),this.entriesByDate.clear(),this.multiDayEntriesByDate.clear(),this.stats={hits:0,misses:0,lastRebuild:Date.now()},this.log("Cache cleared")}rebuild(e){this.clear(),this.stats.lastRebuild=Date.now();for(let t of e)this.addEntry(t);this.log(`Cache rebuilt with ${e.length} entries`)}getStats(){return Object.freeze({entryCount:this.entriesByPath.size,dateCount:this.entriesByDate.size+this.multiDayEntriesByDate.size,hits:this.stats.hits,misses:this.stats.misses,lastRebuild:this.stats.lastRebuild})}indexMultiDayEntry(e){if(!e.endDate)return;let t=e.startDate,n=e.endDate;for(;v(t,n)<0;)if(t=this.addOneDay(t),v(t,n)<=0){let a=I(t);this.addToDateIndex(a,e,this.multiDayEntriesByDate)}}removeMultiDayEntry(e){if(!e.endDate)return;let t=e.startDate,n=e.endDate;for(;v(t,n)<0;)if(t=this.addOneDay(t),v(t,n)<=0){let a=I(t);this.removeFromDateIndex(a,e.id,this.multiDayEntriesByDate)}}addToDateIndex(e,t,n){let a=n.get(e);a?a.push(t):n.set(e,[t])}removeFromDateIndex(e,t,n){let a=n.get(e);if(!a)return;let r=a.filter(i=>i.id!==t);r.length===0?n.delete(e):n.set(e,r)}addOneDay(e){let t=e.day+1,n=e.month,a=e.year,r=this.getDaysInMonth(a,n);return t>r&&(t=1,n+=1,n>12&&(n=1,a+=1)),{year:a,month:n,day:t}}getDaysInMonth(e,t){let n=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2?e%4===0&&e%100!==0||e%400===0?29:28:n[t-1]}log(e){this.config.debug&&console.log(`[EntryCache] ${e}`)}};var st=class st{parseDate(e){if(e==null)return null;if(typeof e=="string")return this.parseDateString(e);if(e instanceof Date)return isNaN(e.getTime())?null:{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()};if(typeof e=="object"&&e!==null){let t=e;if(typeof t.year=="number"&&typeof t.month=="number"&&typeof t.day=="number"&&this.isValidDate(t.year,t.month,t.day))return{year:t.year,month:t.month,day:t.day}}return null}parseDateString(e){let n=e.trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!n)return null;let a=parseInt(n[1],10),r=parseInt(n[2],10),i=parseInt(n[3],10);return this.isValidDate(a,r,i)?{year:a,month:r,day:i}:null}isValidDate(e,t,n){if(e<1900||e>2100||t<1||t>12||n<1||n>31)return!1;let a=this.getDaysInMonth(e,t);return!(n>a)}getDaysInMonth(e,t){let n=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2&&this.isLeapYear(e)?29:n[t-1]}isLeapYear(e){return e%4===0&&e%100!==0||e%400===0}extractFromFilename(e){let t={start:null,end:null};if(!e||typeof e!="string")return t;let n=e.match(st.DATE_PATTERN);return!n||n.length===0||(t.start=this.parseDate(n[0]),n.length>=2&&(t.end=this.parseDate(n[1]))),t}extractFromProperties(e,t){if(!e||typeof e!="object"||!Array.isArray(t))return null;for(let n of t){if(typeof n!="string"||!n)continue;let a=e[n];if(a==null)continue;let r=this.parseDate(a);if(r!==null)return r}return null}extractDates(e,t,n){let a={start:null,end:null},r=this.extractFromFilename(e);for(let i of n.priorities)i==="filename"?(a.start===null&&r.start!==null&&(a.start=r.start),a.end===null&&r.end!==null&&(a.end=r.end)):i==="properties"&&(a.start===null&&(a.start=this.extractFromProperties(t,n.startSources)),a.end===null&&(a.end=this.extractFromProperties(t,n.endSources)));return a}};st.DATE_PATTERN=/(\d{4}-\d{2}-\d{2})/g;var z=st,He=new z;N();var we=["January","February","March","April","May","June","July","August","September","October","November","December"],ot=class{getDaysInMonth(e,t){return w(e,t)}getFirstDayOfWeek(e,t){let n=C(e,t,1);return F(n)}isToday(e){let t=M();return Y(e,t)}generateGrid(e){let t=[];for(let n=1;n<=12;n++)t.push(this.generateMonth(e,n));return{year:e,months:t}}generateMonth(e,t){let n=this.getDaysInMonth(e,t),a=this.getFirstDayOfWeek(e,t),r=[];for(let i=0;i<a;i++)r.push({date:C(e,t,1),isToday:!1,isEmpty:!0});for(let i=1;i<=n;i++){let s=C(e,t,i);r.push({date:s,isToday:this.isToday(s),isEmpty:!1})}return{month:t,name:we[t-1],startDayOfWeek:a,daysInMonth:n,days:r}}};N();var Ae=24,W=class{calculateMonthSegments(e,t,n){let a=[];if(v(e,t)>0)return a;let r=e.year,i=e.month,s=0;for(;s<Ae;){let l=r===e.year&&i===e.month,c=r===t.year&&i===t.month,u=l?e.day:1,d=c?t.day:w(r,i);if(a.push({year:r,month:i,startDay:u,endDay:d,entryId:n}),c)break;i++,i>12&&(i=1,r++),s++}return a}calculateBarPositions(e,t){let n=new Map;if(e.length===0)return n;let a=[...e].sort((i,s)=>i.startDay!==s.startDay?i.startDay-s.startDay:s.endDay-s.startDay-(i.endDay-i.startDay)),r=[];for(let i=0;i<=31;i++)r.push(new Set);for(let i of a){let s=(t.startDayOfWeek+i.startDay-1)%7,l=(t.startDayOfWeek+i.endDay-1)%7,c=i.endDay-i.startDay+1,u=0,d=!1;for(;!d;){let h=!0;for(let g=i.startDay;g<=i.endDay;g++)if(r[g].has(u)){h=!1;break}if(h){d=!0;for(let g=i.startDay;g<=i.endDay;g++)r[g].add(u)}else u++;if(u>100)break}n.set(i.entryId,{rowIndex:u,startColumn:s,endColumn:l,span:c})}return n}},Ze=new W;At();N();N();var ht=class{constructor(e,t){this.unregisterMetadataListener=null;this.eventListeners=null;this.vaultRepository=new Q(e),this.metadataRepository=new tt(e),this.entryCache=new it({debug:!1}),this.dateEngine=new z,this.calendarEngine=new ot,this.multiDayEngine=new W,this.settings=t,this.currentYear=M().year}async initialize(){await this.rebuildCache(),this.setupMetadataListener()}destroy(){this.unregisterMetadataListener&&(this.unregisterMetadataListener(),this.unregisterMetadataListener=null),this.eventListeners=null}setEventListeners(e){this.eventListeners=e}async updateSettings(e){let t=this.settings.dateProperties.join(",")!==e.dateProperties.join(",")||this.settings.endDateProperties.join(",")!==e.endDateProperties.join(",")||this.settings.datePriority!==e.datePriority;this.settings=e,t&&await this.rebuildCache()}getCurrentYear(){return this.currentYear}setCurrentYear(e){var t;this.currentYear!==e&&(this.currentYear=e,(t=this.eventListeners)==null||t.onYearChanged(e))}setYear(e){this.setCurrentYear(e)}nextYear(){this.setCurrentYear(this.currentYear+1)}previousYear(){this.setCurrentYear(this.currentYear-1)}goToToday(){this.setCurrentYear(M().year)}generateCalendarGrid(){return this.calendarEngine.generateGrid(this.currentYear)}getEntriesForDate(e){return this.entryCache.getEntriesForDate(e)}getMultiDayEntries(){return this.entryCache.getMultiDayEntries().filter(e=>{var r;let t={year:this.currentYear,month:1,day:1},n={year:this.currentYear,month:12,day:31},a=(r=e.endDate)!=null?r:e.startDate;return e.startDate.year===this.currentYear||e.startDate.year<this.currentYear&&a.year>=this.currentYear})}calculateBarPositions(e,t){return new Map}async openDailyNote(e){let t=this.settings.dailyNoteFormat,n=this.settings.dailyNoteFolder,a=this.formatDailyNoteFilename(e,t),r=n?`${n}/${a}.md`:`${a}.md`,i=await this.vaultRepository.createOrOpenDailyNote(r);console.log(`Opening daily note: ${i.path}`)}getCacheStats(){let e=this.entryCache.getStats();return{entryCount:e.entryCount,dateCount:e.dateCount}}loadLifePhases(e,t={startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label"}){if(!e)return[];let n=this.vaultRepository.getAllMarkdownFiles(),a=[],r=e.endsWith("/")?e:`${e}/`,i=n.filter(s=>s.path===`${e}.md`||s.path.startsWith(r));for(let s of i){let l=this.metadataRepository.getMetadataByPath(s.path),c=l==null?void 0:l.frontmatter;if(!c)continue;let u=c[t.startDateField];if(!u||typeof u!="string")continue;let d=this.parseYAMLDate(u);if(!d)continue;let h=c[t.endDateField],g=null;h&&typeof h=="string"&&h.trim()!==""&&(g=this.parseYAMLDate(h));let p=c[t.colorField],y=this.isValidColor(p)?p:"blue",f=c[t.labelField]||s.basename;a.push({filePath:s.path,label:String(f),startDate:d,endDate:g,color:y})}return a.sort((s,l)=>s.startDate.year!==l.startDate.year?s.startDate.year-l.startDate.year:s.startDate.month!==l.startDate.month?s.startDate.month-l.startDate.month:s.startDate.day-l.startDate.day)}parseYAMLDate(e){let t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return null;let n=parseInt(t[1],10),a=parseInt(t[2],10),r=parseInt(t[3],10);return a<1||a>12||r<1||r>31?null:C(n,a,r)}isValidColor(e){return typeof e=="string"&&["red","orange","yellow","green","blue","purple","pink","teal","cyan","magenta","lime","amber","indigo","violet","rose","gray","slate","stone"].includes(e)}computeLifePhaseSegments(e,t,n){let a=t+n,r=n,i=M();return e.map(s=>{let l=this.dateToYearFraction(s.startDate),u=(s.startDate.year-t+l)/r*2*Math.PI-Math.PI/2,d,h,g=!1;s.endDate?(h=s.endDate,d=this.dateToYearFraction(s.endDate)):(g=!0,h={year:a,month:12,day:31},d=1);let y=(h.year-t+d)/r*2*Math.PI-Math.PI/2,f;if(g){let x=this.dateToYearFraction(i);f=(i.year-t+x)/r*2*Math.PI-Math.PI/2}let{RING_COLORS:D}=(j(),_t(ge)),S=D[s.color]||D.blue;return{id:s.filePath,filePath:s.filePath,label:s.label,startAngle:u,endAngle:y,color:S,entries:[],isOngoing:g,todayAngle:f}})}dateToYearFraction(e){let t=this.isLeapYear(e.year)?366:365;return(this.getDayOfYear(e)-1)/t}isLeapYear(e){return e%4===0&&e%100!==0||e%400===0}getDayOfYear(e){let t=[31,28,31,30,31,30,31,31,30,31,30,31];this.isLeapYear(e.year)&&(t[1]=29);let n=e.day;for(let a=0;a<e.month-1;a++)n+=t[a];return n}async rebuildCache(){var a;let e=this.vaultRepository.getAllMarkdownFiles(),t=[],n=this.getDateExtractionConfig();for(let r of e){let i=this.createEntryFromFile(r,n);i&&t.push(i)}this.entryCache.rebuild(t),(a=this.eventListeners)==null||a.onEntriesUpdated()}createEntryFromFile(e,t){var l,c,u;let n=this.metadataRepository.getMetadataByPath(e.path),a=(l=n==null?void 0:n.frontmatter)!=null?l:null,{start:r,end:i}=this.dateEngine.extractDates(e.name,a,t);if(!r)return null;let s={};if(a)for(let[d,h]of Object.entries(a))(typeof h=="string"||typeof h=="number"||typeof h=="boolean")&&(s[d]=h);return lt({id:e.path,filePath:e.path,fileName:e.name,displayName:e.basename,startDate:r,endDate:i,metadata:{tags:(c=n==null?void 0:n.tags.map(d=>d.name))!=null?c:[],folder:(u=e.folderPath)!=null?u:"",properties:s}})}getDateExtractionConfig(){return{startSources:this.settings.dateProperties,endSources:this.settings.endDateProperties,priorities:this.settings.datePriority==="property"?["properties","filename"]:["filename","properties"]}}formatDailyNoteFilename(e,t){return t.replace("YYYY",String(e.year)).replace("MM",String(e.month).padStart(2,"0")).replace("DD",String(e.day).padStart(2,"0"))}setupMetadataListener(){this.unregisterMetadataListener=this.metadataRepository.onMetadataChange(e=>{this.handleFileChange(e.path)})}handleFileChange(e){var n;let t=this.vaultRepository.getAllMarkdownFiles().find(a=>a.path===e);if(!t)this.entryCache.removeEntry(e);else{let a=this.getDateExtractionConfig(),r=this.createEntryFromFile(t,a);r?this.entryCache.addEntry(r):this.entryCache.removeEntry(e)}(n=this.eventListeners)==null||n.onEntriesUpdated()}};var yt=require("obsidian");N();j();var U="radial-calendar-plugin",ue=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Vt=["January","February","March","April","May","June","July","August","September","October","November","December"],$t=800,m=$t/2,G=380,he=340,Pe=335,Ne=260,H=255,B=150,Ie=140,T=380,k=120,pe=100,Cn=(T-k)/31,ye=4,ke=20,me=T+2,fe=T+8,be=T+14,pt=class extends yt.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.tooltipEl=null}getViewType(){return U}getDisplayText(){return"Radial Calendar"}getIcon(){return"circle"}initialize(t){this.config=t,this.config.service.setEventListeners({onEntriesUpdated:()=>this.render(),onYearChanged:()=>this.render()})}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("radial-calendar-plugin"),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null,this.tooltipEl=null}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let n=this.config.service.getCurrentYear(),a=this.containerEl_.createDiv({cls:"rc-container"});this.renderHeader(a,n);let r=a.createDiv({cls:"rc-wrapper"});this.renderRadialCalendar(r,n),this.tooltipEl=a.createDiv({cls:"rc-tooltip"}),this.tooltipEl.style.display="none"}renderHeader(t,n){if(!this.config)return;let a=t.createDiv({cls:"rc-header"});a.createEl("button",{text:"\u2190",cls:"rc-nav-btn",attr:{"aria-label":"Previous year"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.previousYear()}),a.createEl("span",{text:String(n),cls:"rc-year-title"}),a.createEl("button",{text:"\u2192",cls:"rc-nav-btn",attr:{"aria-label":"Next year"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.nextYear()}),a.createEl("button",{text:"Today",cls:"rc-nav-btn rc-today-btn",attr:{"aria-label":"Go to today"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.goToToday()}),a.createEl("button",{text:"\u21BB",cls:"rc-nav-btn rc-refresh-btn",attr:{"aria-label":"Refresh view"}}).addEventListener("click",()=>{this.render()}),this.renderViewModeToggle(a)}renderViewModeToggle(t){if(!this.config)return;let n=this.config.settings.currentView,a=t.createDiv({cls:"rc-view-toggle"});a.createEl("button",{text:"Jahresansicht",cls:`rc-toggle-btn ${n==="annual"?"rc-toggle-btn--active":""}`,attr:{"aria-label":"Switch to annual view"}}).addEventListener("click",async()=>{if(this.config&&this.config.settings.currentView!=="annual"){let s={...this.config.settings,currentView:"annual"};this.config.settings=s,await this.config.onSettingsChange(s),this.render()}}),a.createEl("button",{text:"Lebensansicht",cls:`rc-toggle-btn ${n==="life"?"rc-toggle-btn--active":""}`,attr:{"aria-label":"Switch to life view"}}).addEventListener("click",async()=>{if(this.config&&this.config.settings.currentView!=="life"){let s={...this.config.settings,currentView:"life"};this.config.settings=s,await this.config.onSettingsChange(s),this.render()}})}renderRadialCalendar(t,n){if(!this.config)return;let a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("viewBox",`0 0 ${$t} ${$t}`),a.setAttribute("class","rc-svg"),this.svgEl=a,this.config.settings.currentView==="life"?this.renderNestedClock(a,n):this.renderAnnualView(a,n),t.appendChild(a)}renderNestedClock(t,n){if(!this.config)return;let{birthYear:a,expectedLifespan:r}=this.config.settings,i=a+r,s=M(),l=s.year-a;this.renderBackgroundCircle(t),this.renderLifeRing(t,a,i,n),this.renderLifePhasesRing(t,a,r),this.renderYearRing(t,n),this.renderLifeActsOnRing(t,a,r),this.renderNestedCenter(t,n,l),this.renderLifePositionMarker(t,a,r,s.year,"today"),n!==s.year&&this.renderLifePositionMarker(t,a,r,n,"viewed"),n===s.year&&this.renderTodayMarkerOnYearRing(t)}renderLifeRing(t,n,a,r){let i=a-n,s=M();for(let l=n;l<a;l++){let c=l-n,u=c/i*2*Math.PI,d=(c+1)/i*2*Math.PI-.01,h=l<s.year,g=l===s.year,p=l===r,y=this.createArcPath(he,G,u,d),f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d",y);let D="rc-life-year";h&&(D+=" rc-life-year--past"),g&&(D+=" rc-life-year--current"),p&&(D+=" rc-life-year--selected"),f.setAttribute("class",D),f.setAttribute("data-year",String(l)),f.addEventListener("click",()=>{var S;(S=this.config)==null||S.service.setYear(l)}),f.addEventListener("mouseenter",S=>{this.showLifeYearTooltip(S,l,l-n)}),f.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(f)}for(let l=n;l<=a;l+=10){let u=(l-n)/i*2*Math.PI-Math.PI/2,d=G+12,h=m+d*Math.cos(u),g=m+d*Math.sin(u),p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x",String(h)),p.setAttribute("y",String(g)),p.setAttribute("class","rc-life-year-label"),p.setAttribute("text-anchor","middle"),p.setAttribute("dominant-baseline","central"),p.textContent=String(l),t.appendChild(p)}}renderLifePhasesRing(t,n,a){if(!this.config)return;let r=this.config.settings.lifePhasesFolder;if(!r||r.trim()==="")return;let i=this.config.service.loadLifePhases(r);if(i.length===0)return;let s=this.config.service.computeLifePhaseSegments(i,n,a),l=xt(s),c=Rt(l),u=this.getOrCreateDefs(t);for(let d of l)this.renderLifePhaseArc(t,u,d,c)}getOrCreateDefs(t){let n=t.querySelector("defs");return n||(n=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(n,t.firstChild)),n}renderLifePhaseArc(t,n,a,r){let i=Tt(Pe,Ne,r,a.track),s=this.createArcPath(i.inner,i.outer,a.startAngle,a.endAngle),l=document.createElementNS("http://www.w3.org/2000/svg","path");if(l.setAttribute("d",s),l.setAttribute("class","rc-life-phase"),a.isOngoing&&a.todayAngle!==void 0){let c=`phase-gradient-${a.id.replace(/[^a-zA-Z0-9]/g,"-")}`;this.createPhaseGradient(n,c,a),l.style.fill=`url(#${c})`}else l.style.fill=a.color;a.filePath&&(l.style.cursor="pointer",l.addEventListener("click",()=>{var c;(c=this.config)==null||c.openFile(a.filePath)})),l.addEventListener("mouseenter",c=>{this.showPhaseTooltip(c,a)}),l.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(l),a.label&&a.endAngle-a.startAngle>.15&&this.renderPhaseLabel(t,a,i)}createPhaseGradient(t,n,a){let r=a.endAngle-a.startAngle,i=(a.todayAngle-a.startAngle)/r,s=Math.max(0,Math.min(100,i*100)),l=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");l.setAttribute("id",n);let c=(a.startAngle+a.endAngle)/2-Math.PI/2,u=50+50*Math.cos(a.startAngle-Math.PI/2),d=50+50*Math.sin(a.startAngle-Math.PI/2),h=50+50*Math.cos(a.endAngle-Math.PI/2),g=50+50*Math.sin(a.endAngle-Math.PI/2);l.setAttribute("x1",`${u}%`),l.setAttribute("y1",`${d}%`),l.setAttribute("x2",`${h}%`),l.setAttribute("y2",`${g}%`);let p=document.createElementNS("http://www.w3.org/2000/svg","stop");p.setAttribute("offset","0%"),p.setAttribute("stop-color",a.color),p.setAttribute("stop-opacity","1"),l.appendChild(p);let y=document.createElementNS("http://www.w3.org/2000/svg","stop");y.setAttribute("offset",`${s}%`),y.setAttribute("stop-color",a.color),y.setAttribute("stop-opacity","1"),l.appendChild(y);let f=document.createElementNS("http://www.w3.org/2000/svg","stop");f.setAttribute("offset",`${s+1}%`),f.setAttribute("stop-color",a.color),f.setAttribute("stop-opacity","0.4"),l.appendChild(f);let D=document.createElementNS("http://www.w3.org/2000/svg","stop");D.setAttribute("offset","100%"),D.setAttribute("stop-color",a.color),D.setAttribute("stop-opacity","0.15"),l.appendChild(D),t.appendChild(l)}renderPhaseLabel(t,n,a){let r=(n.startAngle+n.endAngle)/2-Math.PI/2,i=(a.inner+a.outer)/2,s=m+i*Math.cos(r),l=m+i*Math.sin(r),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(s)),c.setAttribute("y",String(l)),c.setAttribute("class","rc-phase-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central");let u=(r+Math.PI/2)*180/Math.PI,d=u>90&&u<270?u+180:u;c.setAttribute("transform",`rotate(${d}, ${s}, ${l})`),c.textContent=n.label,t.appendChild(c)}showPhaseTooltip(t,n){var i;if(!this.tooltipEl)return;let a=`<div class="rc-tooltip-date">${n.label}</div>`;n.isOngoing&&(a+='<div class="rc-tooltip-note" style="color: var(--text-accent);">Aktiv (ongoing)</div>'),this.tooltipEl.innerHTML=a,this.tooltipEl.style.display="block";let r=(i=this.containerEl_)==null?void 0:i.getBoundingClientRect();if(r){let s=t.clientX-r.left+10,l=t.clientY-r.top+10;this.tooltipEl.style.left=`${s}px`,this.tooltipEl.style.top=`${l}px`}}renderYearRing(t,n){if(!this.config)return;let a=M();for(let r=1;r<=12;r++){let i=w(n,r),s=this.monthToAngle(r),c=Math.PI/6/i,u=a.year===n&&a.month===r;for(let d=1;d<=i;d++){let h=C(n,r,d),g=F(h),p=u&&a.day===d,y=g===0||g===6,f=s+(d-1)*c,D=f+c-.002,S=this.config.service.getEntriesForDate(h),x=this.createArcPath(B,H,f,D),A=document.createElementNS("http://www.w3.org/2000/svg","path");A.setAttribute("d",x);let L=["rc-day-arc"];p&&L.push("rc-day-arc--today"),y&&L.push("rc-day-arc--weekend"),S.length>0&&L.push("rc-day-arc--has-notes"),A.setAttribute("class",L.join(" ")),A.addEventListener("click",async()=>{var R;await((R=this.config)==null?void 0:R.service.openDailyNote(h))}),A.addEventListener("mouseenter",R=>{this.showTooltip(R,h,S)}),A.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(A)}}for(let r=1;r<=12;r++){let i=this.monthToAngle(r)-Math.PI/2,s=m+B*Math.cos(i),l=m+B*Math.sin(i),c=m+H*Math.cos(i),u=m+H*Math.sin(i),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",String(s)),d.setAttribute("y1",String(l)),d.setAttribute("x2",String(c)),d.setAttribute("y2",String(u)),d.setAttribute("class","rc-month-separator"),t.appendChild(d)}for(let r=0;r<12;r++){let i=this.monthToAngle(r+1)+Math.PI/12-Math.PI/2,s=B-15,l=m+s*Math.cos(i),c=m+s*Math.sin(i),u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",String(l)),u.setAttribute("y",String(c)),u.setAttribute("class","rc-month-label"),u.setAttribute("text-anchor","middle"),u.setAttribute("dominant-baseline","central"),u.textContent=ue[r],t.appendChild(u)}}renderLifeActsOnRing(t,n,a){if(!this.config)return;let r=this.config.settings.lifeActs;if(r.length!==0)for(let i of r){let s=i.startAge/a*2*Math.PI,l=i.endAge/a*2*Math.PI-.01,c=this.createArcPath(G+2,G+8,s,l),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",c),u.setAttribute("class","rc-life-act"),i.color&&(u.style.fill=P[i.color]),t.appendChild(u);let d=(s+l)/2-Math.PI/2,h=G+18,g=m+h*Math.cos(d),p=m+h*Math.sin(d),y=document.createElementNS("http://www.w3.org/2000/svg","text");y.setAttribute("x",String(g)),y.setAttribute("y",String(p)),y.setAttribute("class","rc-life-act-label"),y.setAttribute("text-anchor","middle"),y.setAttribute("dominant-baseline","central");let f=(d+Math.PI/2)*180/Math.PI,D=f>90&&f<270?f+180:f;y.setAttribute("transform",`rotate(${D}, ${g}, ${p})`),i.color&&(y.style.fill=P[i.color]),y.textContent=i.label,t.appendChild(y)}}renderLifePositionMarker(t,n,a,r,i){let l=(r-n)/a*2*Math.PI-Math.PI/2,c=he-5,u=G+5,d=m+c*Math.cos(l),h=m+c*Math.sin(l),g=m+u*Math.cos(l),p=m+u*Math.sin(l),y=document.createElementNS("http://www.w3.org/2000/svg","line");y.setAttribute("x1",String(d)),y.setAttribute("y1",String(h)),y.setAttribute("x2",String(g)),y.setAttribute("y2",String(p)),y.setAttribute("class",i==="today"?"rc-life-marker--today":"rc-life-marker--viewed"),t.appendChild(y)}renderTodayMarkerOnYearRing(t){let n=M(),a=w(n.year,n.month),r=this.monthToAngle(n.month),s=Math.PI/6/a,l=r+(n.day-.5)*s-Math.PI/2,c=m+(B-5)*Math.cos(l),u=m+(B-5)*Math.sin(l),d=m+(H+5)*Math.cos(l),h=m+(H+5)*Math.sin(l),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",String(c)),g.setAttribute("y1",String(u)),g.setAttribute("x2",String(d)),g.setAttribute("y2",String(h)),g.setAttribute("class","rc-today-marker"),t.appendChild(g)}renderNestedCenter(t,n,a){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(m)),r.setAttribute("cy",String(m)),r.setAttribute("r",String(Ie-10)),r.setAttribute("class","rc-center"),t.appendChild(r);let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",String(m)),i.setAttribute("y",String(m-20)),i.setAttribute("class","rc-center-year"),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","central"),i.textContent=String(n),t.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(m)),s.setAttribute("y",String(m+20)),s.setAttribute("class","rc-center-age"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=`${a} Jahre`,t.appendChild(s)}showLifeYearTooltip(t,n,a){var s;if(!this.tooltipEl)return;let r=`<div class="rc-tooltip-date">${n}</div>
      <div class="rc-tooltip-note">Alter: ${a} Jahre</div>`;this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block";let i=(s=this.containerEl_)==null?void 0:s.getBoundingClientRect();if(i){let l=t.clientX-i.left+10,c=t.clientY-i.top+10;this.tooltipEl.style.left=`${l}px`,this.tooltipEl.style.top=`${c}px`}}renderAnnualView(t,n){this.renderBackgroundCircle(t);let a=this.getEnabledRingsSorted();if(a.length===0)for(let r=1;r<=12;r++)this.renderMonthSegment(t,n,r);else{let r=this.calculateRingRadii(a.length);for(let i of a){let s=r.get(i.order);s&&this.renderRing(t,n,i,s)}}for(let r=1;r<=12;r++)this.renderMonthSeparator(t,this.monthToAngle(r));this.renderOuterSegments(t,n),this.renderCenter(t,n),this.renderMonthLabels(t),this.renderTodayMarker(t,n)}getEnabledRingsSorted(){return this.config?this.config.settings.rings.filter(t=>t.enabled).sort((t,n)=>t.order-n.order):[]}calculateRingRadii(t){let n=new Map;if(t===0)return n;let a=(t-1)*ye,r=T-k-a,i=Math.max(ke,r/t);for(let s=0;s<t;s++){let l=T-s*(i+ye),c=l-i;n.set(s,{outerRadius:l,innerRadius:c})}return n}renderRing(t,n,a,r){if(!this.config)return;let i=P[a.color]||P.blue;for(let s=1;s<=12;s++)this.renderRingMonthSegment(t,n,s,a,r,i)}renderRingMonthSegment(t,n,a,r,i,s){if(!this.config)return;let l=w(n,a),c=this.monthToAngle(a),d=Math.PI/6/l,h=M(),g=h.year===n&&h.month===a,p=this.config.service.getEntriesForDate(C(n,a,1));for(let y=1;y<=l;y++){let f=C(n,a,y),D=F(f),S=g&&h.day===y,x=D===0||D===6,A=c+(y-1)*d,L=A+d-.002,R=this.getEntriesForRing(f,r);this.renderRingDayArc(t,f,A,L,S,x,R,i,s,r)}}getEntriesForRing(t,n){if(!this.config)return[];let a=this.config.service.getEntriesForDate(t);if(!n.folder||n.folder.trim()==="")return a;let r=n.folder.replace(/^\/+|\/+$/g,"");return a.filter(i=>{let l=(i.metadata.folder||"").replace(/^\/+|\/+$/g,"");return l===r||l.startsWith(r+"/")})}renderRingDayArc(t,n,a,r,i,s,l,c,u,d){if(!this.config)return;let h=this.createArcPath(c.innerRadius,c.outerRadius,a,r),g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d",h);let p=["rc-day-arc",`rc-ring-${d.order}`];i&&p.push("rc-day-arc--today"),s&&p.push("rc-day-arc--weekend"),l.length>0&&p.push("rc-day-arc--has-notes"),l.length>3&&p.push("rc-day-arc--many-notes"),g.setAttribute("class",p.join(" ")),g.setAttribute("data-date",`${n.year}-${String(n.month).padStart(2,"0")}-${String(n.day).padStart(2,"0")}`),g.setAttribute("data-ring",d.id),l.length>0&&(g.style.fill=u,g.style.fillOpacity="0.6"),g.addEventListener("click",async y=>{var f;y.preventDefault(),l.length>0?this.showDayContextMenu(y,n,l):await((f=this.config)==null?void 0:f.service.openDailyNote(n))}),g.addEventListener("mouseenter",y=>{this.showRingTooltip(y,n,l,d)}),g.addEventListener("mouseleave",()=>{this.hideTooltip()}),g.addEventListener("contextmenu",y=>{y.preventDefault(),this.showDayContextMenu(y,n,l)}),t.appendChild(g),l.length>0&&this.renderRingNoteIndicators(t,a,r,l,c,u)}renderRingNoteIndicators(t,n,a,r,i,s){let l=Math.min(10,(i.outerRadius-i.innerRadius)*.3),c=i.outerRadius-l,u=i.outerRadius-2,d=Math.min(r.length,3),h=(a-n)/d;for(let g=0;g<d;g++){let p=n+g*h+.001,y=p+h-.002,f=this.createArcPath(c,u,p,y),D=document.createElementNS("http://www.w3.org/2000/svg","path");D.setAttribute("d",f),D.setAttribute("class","rc-note-indicator"),D.style.fill=s,t.appendChild(D)}}showRingTooltip(t,n,a,r){var u;if(!this.tooltipEl)return;let l=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][F(n)]}, ${Vt[n.month-1]} ${n.day}, ${n.year}`}</div>`;if(l+=`<div class="rc-tooltip-ring" style="color: ${P[r.color]}">${r.name}</div>`,a.length>0){l+='<div class="rc-tooltip-notes">';for(let d of a.slice(0,5))l+=`<div class="rc-tooltip-note">${d.displayName}</div>`;a.length>5&&(l+=`<div class="rc-tooltip-more">+${a.length-5} more</div>`),l+="</div>"}this.tooltipEl.innerHTML=l,this.tooltipEl.style.display="block";let c=(u=this.containerEl_)==null?void 0:u.getBoundingClientRect();if(c){let d=t.clientX-c.left+10,h=t.clientY-c.top+10;this.tooltipEl.style.left=`${d}px`,this.tooltipEl.style.top=`${h}px`}}renderBackgroundCircle(t){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(m)),n.setAttribute("cy",String(m)),n.setAttribute("r",String(T)),n.setAttribute("class","rc-background"),t.appendChild(n)}renderCenter(t,n){let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",String(m)),a.setAttribute("cy",String(m)),a.setAttribute("r",String(k-10)),a.setAttribute("class","rc-center"),t.appendChild(a)}renderMonthLabels(t){for(let n=0;n<12;n++){let a=this.monthToAngle(n+1)+Math.PI/12,r=m+pe*Math.cos(a-Math.PI/2),i=m+pe*Math.sin(a-Math.PI/2),s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(r)),s.setAttribute("y",String(i)),s.setAttribute("class","rc-month-label"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=ue[n],t.appendChild(s)}}renderMonthSegment(t,n,a){if(!this.config)return;let r=w(n,a),i=this.monthToAngle(a),l=Math.PI/6/r,c=M(),u=c.year===n&&c.month===a;for(let d=1;d<=r;d++){let h=C(n,a,d),g=F(h),p=u&&c.day===d,y=g===0||g===6,f=i+(d-1)*l,D=f+l-.002,S=this.config.service.getEntriesForDate(h);this.renderDayArc(t,h,f,D,p,y,S)}this.renderMonthSeparator(t,i)}renderDayArc(t,n,a,r,i,s,l){if(!this.config)return;let c=k,u=T,d=this.createArcPath(c,u,a,r),h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",d);let g=["rc-day-arc"];i&&g.push("rc-day-arc--today"),s&&g.push("rc-day-arc--weekend"),l.length>0&&g.push("rc-day-arc--has-notes"),l.length>3&&g.push("rc-day-arc--many-notes"),h.setAttribute("class",g.join(" ")),h.setAttribute("data-date",`${n.year}-${String(n.month).padStart(2,"0")}-${String(n.day).padStart(2,"0")}`),h.addEventListener("click",async p=>{var y;p.preventDefault(),await((y=this.config)==null?void 0:y.service.openDailyNote(n))}),h.addEventListener("mouseenter",p=>{this.showTooltip(p,n,l)}),h.addEventListener("mouseleave",()=>{this.hideTooltip()}),h.addEventListener("contextmenu",p=>{p.preventDefault(),l.length>0&&this.showDayContextMenu(p,n,l)}),t.appendChild(h),l.length>0&&this.renderNoteIndicators(t,a,r,l)}renderNoteIndicators(t,n,a,r){let i=T-15,s=T-5,l=Math.min(r.length,3),c=(a-n)/l;for(let u=0;u<l;u++){let d=n+u*c+.001,h=d+c-.002,g=this.createArcPath(i,s,d,h),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",g),p.setAttribute("class","rc-note-indicator"),t.appendChild(p)}}renderMonthSeparator(t,n){let a=m+k*Math.cos(n-Math.PI/2),r=m+k*Math.sin(n-Math.PI/2),i=m+T*Math.cos(n-Math.PI/2),s=m+T*Math.sin(n-Math.PI/2),l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",String(a)),l.setAttribute("y1",String(r)),l.setAttribute("x2",String(i)),l.setAttribute("y2",String(s)),l.setAttribute("class","rc-month-separator"),t.appendChild(l)}renderTodayMarker(t,n){let a=M();if(a.year!==n)return;let r=w(n,a.month),i=this.monthToAngle(a.month),l=Math.PI/6/r,c=i+(a.day-.5)*l,u=m+(k-10)*Math.cos(c-Math.PI/2),d=m+(k-10)*Math.sin(c-Math.PI/2),h=m+(T+5)*Math.cos(c-Math.PI/2),g=m+(T+5)*Math.sin(c-Math.PI/2),p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttribute("x1",String(u)),p.setAttribute("y1",String(d)),p.setAttribute("x2",String(h)),p.setAttribute("y2",String(g)),p.setAttribute("class","rc-today-marker"),t.appendChild(p)}createArcPath(t,n,a,r){let i=a-Math.PI/2,s=r-Math.PI/2,l=m+t*Math.cos(i),c=m+t*Math.sin(i),u=m+t*Math.cos(s),d=m+t*Math.sin(s),h=m+n*Math.cos(i),g=m+n*Math.sin(i),p=m+n*Math.cos(s),y=m+n*Math.sin(s),f=r-a>Math.PI?1:0;return`
      M ${l} ${c}
      L ${h} ${g}
      A ${n} ${n} 0 ${f} 1 ${p} ${y}
      L ${u} ${d}
      A ${t} ${t} 0 ${f} 0 ${l} ${c}
      Z
    `}monthToAngle(t){return(t-1)*Math.PI/6}showTooltip(t,n,a){var c;if(!this.tooltipEl)return;let s=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][F(n)]}, ${Vt[n.month-1]} ${n.day}, ${n.year}`}</div>`;if(a.length>0){s+='<div class="rc-tooltip-notes">';for(let u of a.slice(0,5))s+=`<div class="rc-tooltip-note">${u.displayName}</div>`;a.length>5&&(s+=`<div class="rc-tooltip-more">+${a.length-5} more</div>`),s+="</div>"}this.tooltipEl.innerHTML=s,this.tooltipEl.style.display="block";let l=(c=this.containerEl_)==null?void 0:c.getBoundingClientRect();if(l){let u=t.clientX-l.left+10,d=t.clientY-l.top+10;this.tooltipEl.style.left=`${u}px`,this.tooltipEl.style.top=`${d}px`}}hideTooltip(){this.tooltipEl&&(this.tooltipEl.style.display="none")}showDayContextMenu(t,n,a){if(!this.config)return;let r=new yt.Menu;r.addItem(i=>{i.setTitle(`Open ${Vt[n.month-1]} ${n.day}`).setIcon("calendar").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(n))})}),r.addSeparator();for(let i of a.slice(0,10))r.addItem(s=>{s.setTitle(i.displayName).setIcon("file").onClick(()=>{var l;(l=this.config)==null||l.openFile(i.filePath)})});a.length>10&&r.addItem(i=>{i.setTitle(`+${a.length-10} more...`).setDisabled(!0)}),r.showAtMouseEvent(t)}renderOuterSegments(t,n){if(!this.config)return;let a=this.getSegmentsForCurrentView();if(a.length!==0)for(let r of a)this.renderSegmentTick(t,r,n)}getSegmentsForCurrentView(){if(!this.config)return[];let t=this.config.settings;if(t.currentView==="life")return this.lifeActsToSegments(t.lifeActs);switch(t.annualSegmentType){case"seasons":return Ft;case"quarters":return Pt;case"semester":return Nt;case"ten-days":return It();case"weeks":return kt();case"custom":return t.customSegments;case"none":default:return[]}}lifeActsToSegments(t){if(!this.config)return[];let{birthYear:n,expectedLifespan:a}=this.config.settings,r=a;return t.map(i=>{let s=Math.floor(i.startAge/r*365)+1,l=Math.floor(i.endAge/r*365);return{id:i.id,label:i.label,startDay:s,endDay:l,color:i.color}})}renderSegmentTick(t,n,a){if(!this.config)return;let r=this.config.settings.showSegmentLabels,i=this.dayOfYearToAngle(n.startDay),s=n.endDay>n.startDay?this.dayOfYearToAngle(n.endDay):this.dayOfYearToAngle(n.endDay)+2*Math.PI,l=i-Math.PI/2,c=m+me*Math.cos(l),u=m+me*Math.sin(l),d=m+fe*Math.cos(l),h=m+fe*Math.sin(l),g=document.createElementNS("http://www.w3.org/2000/svg","line");if(g.setAttribute("x1",String(c)),g.setAttribute("y1",String(u)),g.setAttribute("x2",String(d)),g.setAttribute("y2",String(h)),g.setAttribute("class","rc-segment-tick"),n.color&&(g.style.stroke=P[n.color]),t.appendChild(g),r){let p=(i+(n.endDay>n.startDay?s:s-2*Math.PI))/2,y=p-Math.PI/2,f=m+be*Math.cos(y),D=m+be*Math.sin(y),S=document.createElementNS("http://www.w3.org/2000/svg","text");S.setAttribute("x",String(f)),S.setAttribute("y",String(D)),S.setAttribute("class","rc-segment-label"),S.setAttribute("text-anchor","middle"),S.setAttribute("dominant-baseline","central");let x=p*180/Math.PI,A=x>90&&x<270?x+180:x;S.setAttribute("transform",`rotate(${A}, ${f}, ${D})`),n.color&&(S.style.fill=P[n.color]),S.textContent=n.label,t.appendChild(S)}}dayOfYearToAngle(t){return(t-1)/365*2*Math.PI}};var bt=require("obsidian");N();var Oe=["Januar","Februar","M\xE4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],X="local-calendar-view",Yt=300,E=Yt/2,J=140,mt=115,q=105,_=40,Ve=35,ft=class extends bt.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.activeFileDate=null}getViewType(){return X}getDisplayText(){return"Local Calendar"}getIcon(){return"clock"}initialize(t){this.config=t,this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updateActiveFileDate(),this.render()})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.updateActiveFileDate(),this.render()}))}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("local-calendar-view"),this.updateActiveFileDate(),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null}updateActiveFileDate(){this.config&&(this.activeFileDate=this.config.getActiveFileDate())}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let t=this.containerEl_.createDiv({cls:"lc-container"}),n=t.createDiv({cls:"lc-title"});this.activeFileDate?n.textContent=`${this.activeFileDate.day}.${this.activeFileDate.month}.${this.activeFileDate.year}`:n.textContent="Keine Datums-Notiz";let a=t.createDiv({cls:"lc-wrapper"});this.renderNestedClock(a)}renderNestedClock(t){if(!this.config)return;let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("viewBox",`0 0 ${Yt} ${Yt}`),n.setAttribute("class","lc-svg"),this.svgEl=n;let{birthYear:a,expectedLifespan:r}=this.config.settings,i=a+r,s=M(),l=this.activeFileDate||s,c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx",String(E)),c.setAttribute("cy",String(E)),c.setAttribute("r",String(J)),c.setAttribute("class","lc-background"),n.appendChild(c),this.renderLifeRing(n,a,i,l.year,s.year),this.renderYearRing(n,l,s),this.renderCenter(n,l),this.activeFileDate&&this.renderNoteMarkers(n,a,r,this.activeFileDate),(!this.activeFileDate||this.activeFileDate.year!==s.year||this.activeFileDate.month!==s.month||this.activeFileDate.day!==s.day)&&this.renderTodayMarkers(n,a,r,s),t.appendChild(n)}renderLifeRing(t,n,a,r,i){let s=a-n;for(let l=0;l<s;l+=10){let c=l/s*2*Math.PI,u=Math.min((l+10)/s*2*Math.PI,2*Math.PI)-.02,d=this.createArcPath(mt,J,c,u),h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",d);let g=n+l,p=g+10<=i,y=g<=i&&i<g+10,f="lc-life-decade";p&&(f+=" lc-life-decade--past"),y&&(f+=" lc-life-decade--current"),h.setAttribute("class",f),t.appendChild(h);let D=(l+5)/s*2*Math.PI-Math.PI/2,S=(mt+J)/2,x=E+S*Math.cos(D),A=E+S*Math.sin(D),L=document.createElementNS("http://www.w3.org/2000/svg","text");L.setAttribute("x",String(x)),L.setAttribute("y",String(A)),L.setAttribute("class","lc-decade-label"),L.setAttribute("text-anchor","middle"),L.setAttribute("dominant-baseline","central"),L.textContent=String(n+l),t.appendChild(L)}}renderYearRing(t,n,a){if(!this.config)return;let r=n.year;for(let s=1;s<=12;s++){let l=w(r,s),c=this.monthToAngle(s),d=Math.PI/6/l;for(let h=1;h<=l;h++){let g=C(r,s,h),p=F(g),y=a.year===r&&a.month===s&&a.day===h,f=n.month===s&&n.day===h,D=p===0||p===6,S=c+(h-1)*d,x=S+d-.002,A=this.config.service.getEntriesForDate(g),L=this.createArcPath(_,q,S,x),R=document.createElementNS("http://www.w3.org/2000/svg","path");R.setAttribute("d",L);let $=["lc-day"];y&&$.push("lc-day--today"),f&&$.push("lc-day--note"),D&&$.push("lc-day--weekend"),A.length>0&&$.push("lc-day--has-notes"),A.length>2&&$.push("lc-day--many-notes"),R.setAttribute("class",$.join(" ")),R.style.cursor="pointer",R.addEventListener("click",Et=>{var Gt;Et.preventDefault(),Et.stopPropagation(),A.length>0?this.showDayContextMenu(Et,g,A):(Gt=this.config)==null||Gt.service.openDailyNote(g)}),t.appendChild(R)}}for(let s=1;s<=12;s++){let l=this.monthToAngle(s)-Math.PI/2,c=E+_*Math.cos(l),u=E+_*Math.sin(l),d=E+q*Math.cos(l),h=E+q*Math.sin(l),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",String(c)),g.setAttribute("y1",String(u)),g.setAttribute("x2",String(d)),g.setAttribute("y2",String(h)),g.setAttribute("class","lc-month-separator"),t.appendChild(g)}let i=["J","F","M","A","M","J","J","A","S","O","N","D"];for(let s=0;s<12;s++){let l=this.monthToAngle(s+1)+Math.PI/12-Math.PI/2,c=_-8,u=E+c*Math.cos(l),d=E+c*Math.sin(l),h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttribute("x",String(u)),h.setAttribute("y",String(d)),h.setAttribute("class","lc-month-label"),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","central"),h.textContent=i[s],t.appendChild(h)}}monthToAngle(t){return(t-1)*Math.PI/6}renderCenter(t,n){let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",String(E)),a.setAttribute("cy",String(E)),a.setAttribute("r",String(Ve-5)),a.setAttribute("class","lc-center"),t.appendChild(a);let r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",String(E)),r.setAttribute("y",String(E)),r.setAttribute("class","lc-center-day"),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.textContent=String(n.day),t.appendChild(r)}renderNoteMarkers(t,n,a,r){let s=(r.year-n)/a*2*Math.PI-Math.PI/2;this.drawMarker(t,s,mt-3,J+3,"lc-marker--note");let l=this.dateToAngle(r);this.drawMarker(t,l,_-3,q+3,"lc-marker--note")}renderTodayMarkers(t,n,a,r){let s=(r.year-n)/a*2*Math.PI-Math.PI/2;this.drawMarker(t,s,mt,J,"lc-marker--today");let l=this.dateToAngle(r);this.drawMarker(t,l,_,q,"lc-marker--today")}dateToAngle(t){let n=w(t.year,t.month),a=this.monthToAngle(t.month),i=Math.PI/6/n;return a+(t.day-.5)*i-Math.PI/2}drawMarker(t,n,a,r,i){let s=E+a*Math.cos(n),l=E+a*Math.sin(n),c=E+r*Math.cos(n),u=E+r*Math.sin(n),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",String(s)),d.setAttribute("y1",String(l)),d.setAttribute("x2",String(c)),d.setAttribute("y2",String(u)),d.setAttribute("class",i),t.appendChild(d)}showDayContextMenu(t,n,a){if(!this.config)return;let r=new bt.Menu;if(r.addItem(i=>{i.setTitle(`${n.day}. ${Oe[n.month-1]} ${n.year}`).setIcon("calendar").setDisabled(!0)}),r.addSeparator(),r.addItem(i=>{i.setTitle("Neue Notiz erstellen").setIcon("plus").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(n))})}),a.length>0){r.addSeparator();for(let i of a.slice(0,10))r.addItem(s=>{s.setTitle(i.displayName).setIcon("file").onClick(async()=>{var l;await((l=this.config)==null?void 0:l.openFile(i.filePath))})});a.length>10&&r.addItem(i=>{i.setTitle(`+${a.length-10} weitere...`).setDisabled(!0)})}r.showAtMouseEvent(t)}createArcPath(t,n,a,r){let i=a-Math.PI/2,s=r-Math.PI/2,l=E+t*Math.cos(i),c=E+t*Math.sin(i),u=E+t*Math.cos(s),d=E+t*Math.sin(s),h=E+n*Math.cos(i),g=E+n*Math.sin(i),p=E+n*Math.cos(s),y=E+n*Math.sin(s),f=r-a>Math.PI?1:0;return`
      M ${l} ${c}
      L ${h} ${g}
      A ${n} ${n} 0 ${f} 1 ${p} ${y}
      L ${u} ${d}
      A ${t} ${t} 0 ${f} 0 ${l} ${c}
      Z
    `}};var b=require("obsidian");j();var Dt=require("obsidian"),O=class extends Dt.AbstractInputSuggest{constructor(e,t){super(e,t),this.textInputEl=t}getSuggestions(e){let t=this.getAllFolders(),n=e.toLowerCase().trim();return n===""?t:t.filter(a=>a.path.toLowerCase().includes(n))}renderSuggestion(e,t){t.addClass("folder-suggest-item");let n=t.createSpan({cls:"folder-suggest-icon"});n.innerHTML=this.getFolderIcon(),t.createSpan({cls:"folder-suggest-text"}).setText(e.path||"/")}selectSuggestion(e,t){this.textInputEl.value=e.path,this.textInputEl.trigger("input"),this.close()}getAllFolders(){let e=[],t=a=>{e.push(a);for(let r of a.children)r instanceof Dt.TFolder&&t(r)},n=this.app.vault.getRoot();return t(n),e.sort((a,r)=>a.isRoot()?-1:r.isRoot()?1:a.path.localeCompare(r.path))}getFolderIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>'}};var St=class extends b.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),this.createViewModeSection(e),this.plugin.settings.currentView==="life"&&this.createLifeViewSection(e),this.createDailyNotesSection(e),this.createRingConfigSection(e),this.createOuterSegmentsSection(e),this.createTemplateSection(e),this.createCenterDisplaySection(e)}createViewModeSection(e){new b.Setting(e).setName("Ansichtsmodus").setDesc("Wechseln zwischen Jahres- und Lebensansicht").addDropdown(t=>{t.addOption("annual","Jahresansicht").addOption("life","Lebensansicht").setValue(this.plugin.settings.currentView).onChange(async n=>{this.plugin.settings.currentView=n,await this.plugin.saveSettings(),this.display()})})}createLifeViewSection(e){e.createEl("h3",{text:"Lebensansicht Einstellungen"}),new b.Setting(e).setName("Geburtsjahr").setDesc("Dein Geburtsjahr").addText(n=>{n.setPlaceholder("z.B. 1990").setValue(String(this.plugin.settings.birthYear)).onChange(async a=>{let r=parseInt(a,10);!isNaN(r)&&r>1900&&r<=new Date().getFullYear()&&(this.plugin.settings.birthYear=r,await this.plugin.saveSettings())})}),new b.Setting(e).setName("Erwartete Lebensspanne").setDesc("Erwartete Lebensdauer in Jahren").addText(n=>{n.setPlaceholder("z.B. 85").setValue(String(this.plugin.settings.expectedLifespan)).onChange(async a=>{let r=parseInt(a,10);!isNaN(r)&&r>0&&r<=150&&(this.plugin.settings.expectedLifespan=r,await this.plugin.saveSettings())})}),e.createEl("h4",{text:"Lebensphasen"}),new b.Setting(e).setName("Lebensphasen-Ordner").setDesc("Ordner mit Lebensphasen-Notizen (YAML: phase-start, phase-end, phase-color, phase-label)").addText(n=>{n.setPlaceholder("z.B. Life/Phases").setValue(this.plugin.settings.lifePhasesFolder).onChange(async a=>{this.plugin.settings.lifePhasesFolder=a,await this.plugin.saveSettings()}),new O(this.app,n.inputEl)});let t=e.createDiv({cls:"setting-item-description"});t.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Beispiel YAML f\xFCr eine Lebensphase:</strong><br>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
phase-start: 1983-09-01<br>
phase-end: 1987-07-15<br>
phase-color: blue<br>
phase-label: Grundschule<br>
---
        </code>
        <br>
        <em>Leer lassen f\xFCr "ongoing" (aktuelle Phasen zeigen Gradient bis Lebensende)</em>
      </p>
    `}createDailyNotesSection(e){e.createEl("h3",{text:"T\xE4gliche Notizen"}),new b.Setting(e).setName("Notizen-Ordner").setDesc("Ordner, in dem neue Notizen erstellt werden (leer = Root)").addText(t=>{t.setPlaceholder("z.B. Daily Notes").setValue(this.plugin.settings.dailyNoteFolder).onChange(async n=>{this.plugin.settings.dailyNoteFolder=n,await this.plugin.saveSettings()}),new O(this.app,t.inputEl)}),new b.Setting(e).setName("Filter-Ordner").setDesc("Nur Notizen aus diesem Ordner anzeigen (leer = alle)").addText(t=>{t.setPlaceholder("z.B. Journal").setValue(this.plugin.settings.calendarFilterFolder).onChange(async n=>{this.plugin.settings.calendarFilterFolder=n,await this.plugin.saveSettings()}),new O(this.app,t.inputEl)}),new b.Setting(e).setName("Dateiname-Format").setDesc("Format f\xFCr neue Notizen (YYYY-MM-DD)").addText(t=>{t.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.periodicNotesFormat.daily).onChange(async n=>{this.plugin.settings.periodicNotesFormat={...this.plugin.settings.periodicNotesFormat,daily:n||"YYYY-MM-DD"},await this.plugin.saveSettings()})}),new b.Setting(e).setName("J\xE4hrlich wiederkehrend").setDesc("Ordner f\xFCr Geburtstage, Jahrestage (z.B. 27.03.1977 wird jedes Jahr am 27.03. angezeigt)").addText(t=>{t.setPlaceholder("z.B. Geburtstage").setValue(this.plugin.settings.annualRecurringFolder).onChange(async n=>{this.plugin.settings.annualRecurringFolder=n,await this.plugin.saveSettings()}),new O(this.app,t.inputEl)})}createRingConfigSection(e){e.createEl("h3",{text:"Ringe konfigurieren"});let t=this.plugin.settings.rings;t.forEach((n,a)=>{this.createRingSettings(e,n,a)}),new b.Setting(e).addButton(n=>{n.setButtonText("Ring hinzufugen").setCta().onClick(async()=>{let a=Lt(t.length);this.plugin.settings.rings=[...t,a],await this.plugin.saveSettings(),this.display()})})}createRingSettings(e,t,n){let a=e.createDiv({cls:"radial-calendar-ring-config"}),r=new b.Setting(a).setName(`Ring ${n+1}`).setClass("radial-calendar-ring-header");new b.Setting(a).setName("Name").addText(i=>{i.setPlaceholder("Ring Name").setValue(t.name).onChange(async s=>{this.updateRing(n,{name:s})})}),new b.Setting(a).setName("Ordner").setDesc("Ordnerpfad im Vault").addText(i=>{i.setPlaceholder("z.B. Projects/2024").setValue(t.folder).onChange(async s=>{this.updateRing(n,{folder:s})}),new O(this.app,i.inputEl)}),new b.Setting(a).setName("Farbe").addDropdown(i=>{Object.keys(P).forEach(s=>{i.addOption(s,this.formatColorName(s))}),i.setValue(t.color).onChange(async s=>{this.updateRing(n,{color:s})})}),new b.Setting(a).addButton(i=>{i.setButtonText("Loschen").setWarning().onClick(async()=>{this.plugin.settings.rings=this.plugin.settings.rings.filter((s,l)=>l!==n),this.plugin.settings.rings=this.plugin.settings.rings.map((s,l)=>({...s,order:l})),await this.plugin.saveSettings(),this.display()})}),a.createEl("hr")}async updateRing(e,t){let n=[...this.plugin.settings.rings];n[e]={...n[e],...t},this.plugin.settings.rings=n,await this.plugin.saveSettings()}formatColorName(e){return e.charAt(0).toUpperCase()+e.slice(1)}createOuterSegmentsSection(e){e.createEl("h3",{text:"\xC4u\xDFere Segmente"}),new b.Setting(e).setName("Segment-Typ").setDesc("Markierungen am \xE4u\xDFeren Rand des Kalenders").addDropdown(t=>{t.addOption("none","Keine").addOption("seasons","Jahreszeiten (4)").addOption("quarters","Quartale (4)").addOption("semester","Semester (2)").addOption("ten-days","10-Tages-Phasen (36)").addOption("weeks","Wochen (52)").addOption("custom","Benutzerdefiniert").setValue(this.plugin.settings.annualSegmentType).onChange(async n=>{this.plugin.settings.annualSegmentType=n,await this.plugin.saveSettings(),this.display()})}),new b.Setting(e).setName("Labels anzeigen").setDesc("Segment-Beschriftungen anzeigen").addToggle(t=>{t.setValue(this.plugin.settings.showSegmentLabels).onChange(async n=>{this.plugin.settings.showSegmentLabels=n,await this.plugin.saveSettings()})}),this.plugin.settings.annualSegmentType==="custom"&&this.createCustomSegmentsEditor(e),this.plugin.settings.currentView==="life"&&this.createLifeActsEditor(e)}createCustomSegmentsEditor(e){e.createEl("h4",{text:"Benutzerdefinierte Segmente"});let t=this.plugin.settings.customSegments;t.forEach((n,a)=>{this.createSegmentSettings(e,n,a)}),new b.Setting(e).addButton(n=>{n.setButtonText("Segment hinzuf\xFCgen").onClick(async()=>{let a={id:`seg-${Date.now()}`,label:`Segment ${t.length+1}`,startDay:1,endDay:30};this.plugin.settings.customSegments=[...t,a],await this.plugin.saveSettings(),this.display()})})}createSegmentSettings(e,t,n){let a=e.createDiv({cls:"radial-calendar-segment-config"});new b.Setting(a).setName("Label").addText(r=>{r.setValue(t.label).onChange(async i=>{this.updateSegment(n,{label:i})})}),new b.Setting(a).setName("Start-Tag").setDesc("Tag des Jahres (1-365)").addText(r=>{r.setValue(String(t.startDay)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=1&&s<=365&&this.updateSegment(n,{startDay:s})})}),new b.Setting(a).setName("End-Tag").setDesc("Tag des Jahres (1-365)").addText(r=>{r.setValue(String(t.endDay)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=1&&s<=365&&this.updateSegment(n,{endDay:s})})}),new b.Setting(a).addButton(r=>{r.setButtonText("L\xF6schen").setWarning().onClick(async()=>{this.plugin.settings.customSegments=this.plugin.settings.customSegments.filter((i,s)=>s!==n),await this.plugin.saveSettings(),this.display()})}),a.createEl("hr")}async updateSegment(e,t){let n=[...this.plugin.settings.customSegments];n[e]={...n[e],...t},this.plugin.settings.customSegments=n,await this.plugin.saveSettings()}createLifeActsEditor(e){e.createEl("h4",{text:"Lebensakte"});let t=this.plugin.settings.lifeActs;t.forEach((n,a)=>{this.createLifeActSettings(e,n,a)}),new b.Setting(e).addButton(n=>{n.setButtonText("Lebensakt hinzuf\xFCgen").onClick(async()=>{let a={id:`act-${Date.now()}`,label:`Akt ${t.length+1}`,startAge:0,endAge:10};this.plugin.settings.lifeActs=[...t,a],await this.plugin.saveSettings(),this.display()})})}createLifeActSettings(e,t,n){let a=e.createDiv({cls:"radial-calendar-life-act-config"});new b.Setting(a).setName("Bezeichnung").addText(r=>{r.setPlaceholder("z.B. Kindheit").setValue(t.label).onChange(async i=>{this.updateLifeAct(n,{label:i})})}),new b.Setting(a).setName("Start-Alter").addText(r=>{r.setValue(String(t.startAge)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=0&&this.updateLifeAct(n,{startAge:s})})}),new b.Setting(a).setName("End-Alter").addText(r=>{r.setValue(String(t.endAge)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=0&&this.updateLifeAct(n,{endAge:s})})}),new b.Setting(a).setName("Farbe").addDropdown(r=>{r.addOption("","(Standard)"),Object.keys(P).forEach(i=>{r.addOption(i,this.formatColorName(i))}),r.setValue(t.color||"").onChange(async i=>{this.updateLifeAct(n,{color:i||void 0})})}),new b.Setting(a).addButton(r=>{r.setButtonText("L\xF6schen").setWarning().onClick(async()=>{this.plugin.settings.lifeActs=this.plugin.settings.lifeActs.filter((i,s)=>s!==n),await this.plugin.saveSettings(),this.display()})}),a.createEl("hr")}async updateLifeAct(e,t){let n=[...this.plugin.settings.lifeActs];n[e]={...n[e],...t},this.plugin.settings.lifeActs=n,await this.plugin.saveSettings()}createTemplateSection(e){e.createEl("h3",{text:"Template"}),new b.Setting(e).setName("Template erstellen").setDesc("Erstellt eine Template-Datei fur Ring-Segmente im Vault").addButton(t=>{t.setButtonText("Template erstellen").onClick(async()=>{await this.createTemplateFile()})})}async createTemplateFile(){let e=this.plugin.settings.templateFolder||"Templates",t=`${e}/Radial Calendar Segment.md`;try{if(this.app.vault.getAbstractFileByPath(e)||await this.app.vault.createFolder(e),this.app.vault.getAbstractFileByPath(t)){new b.Notice(`Template existiert bereits: ${t}`);return}await this.app.vault.create(t,Ot),new b.Notice(`Template erstellt: ${t}`)}catch(n){console.error("Failed to create template file:",n),new b.Notice("Fehler beim Erstellen des Templates")}}createCenterDisplaySection(e){e.createEl("h3",{text:"Zentrum Anzeige"}),new b.Setting(e).setName("Anzeigemodus").setDesc("Was im Zentrum des Kalenders angezeigt wird").addDropdown(t=>{t.addOption("countdown","Countdown").addOption("stats","Statistiken").addOption("navigation","Navigation").setValue(this.plugin.settings.centerDisplay).onChange(async n=>{this.plugin.settings.centerDisplay=n,await this.plugin.saveSettings()})})}};j();var vt=class extends K.Plugin{constructor(){super(...arguments);this.service=null;this.settings={...ut}}async onload(){await this.loadSettings();let t={calendarWidth:"fit",dateProperties:["date","created","due"],endDateProperties:["endDate","end","until"],datePriority:"filename",dailyNoteFormat:this.settings.periodicNotesFormat.daily,dailyNoteFolder:this.settings.dailyNoteFolder,showMultiDayBars:!0,showWeekendHighlight:!0};this.service=new ht(this.app,t),await this.service.initialize(),this.registerView(U,n=>{let a=new pt(n);return a.initialize({service:this.service,openFile:async r=>{let i=this.app.vault.getAbstractFileByPath(r);i instanceof K.TFile&&await this.app.workspace.getLeaf().openFile(i)},settings:this.settings,onSettingsChange:async r=>{this.settings=r,await this.saveSettings()}}),a}),this.registerView(X,n=>{let a=new ft(n);return a.initialize({service:this.service,settings:this.settings,getActiveFileDate:()=>this.getActiveFileDate(),openFile:async r=>{let i=this.app.vault.getAbstractFileByPath(r);i instanceof K.TFile&&await this.app.workspace.getLeaf().openFile(i)}}),a}),this.addSettingTab(new St(this.app,this)),this.addRibbonIcon("circle","Open Radial Calendar",()=>{this.activateView()}),this.addRibbonIcon("clock","Open Local Calendar",()=>{this.activateLocalCalendarView()}),this.addCommand({id:"open-radial-calendar",name:"Open Radial Calendar",callback:()=>{this.activateView()}}),this.addCommand({id:"open-local-calendar",name:"Open Local Calendar (Sidebar)",callback:()=>{this.activateLocalCalendarView()}})}async onunload(){var t;(t=this.service)==null||t.destroy(),this.service=null}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},ut,t)}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:t}=this.app,n=null,a=t.getLeavesOfType(U);a.length>0?n=a[0]:(n=t.getLeaf("tab"),n&&await n.setViewState({type:U,active:!0})),n&&t.revealLeaf(n)}getActiveFileDate(){let t=this.app.workspace.getActiveFile();if(!t)return null;let n=t.basename.match(/(\d{4})-(\d{2})-(\d{2})/);return n?C(parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)):null}async activateLocalCalendarView(){let{workspace:t}=this.app,n=t.getLeavesOfType(X)[0];n||(n=t.getRightLeaf(!1),n&&await n.setViewState({type:X,active:!0})),n&&t.revealLeaf(n)}};
