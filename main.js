/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var zt=Object.defineProperty;var an=Object.getOwnPropertyDescriptor;var sn=Object.getOwnPropertyNames;var on=Object.prototype.hasOwnProperty;var yt=(c,n)=>()=>(c&&(n=c(c=0)),n);var ye=(c,n)=>{for(var t in n)zt(c,t,{get:n[t],enumerable:!0})},ln=(c,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of sn(n))!on.call(c,r)&&r!==t&&zt(c,r,{get:()=>n[r],enumerable:!(e=an(n,r))||e.enumerable});return c};var Ut=c=>ln(zt({},"__esModule",{value:!0}),c);function M(c,n,t){let e={year:c,month:n,day:t};if(!bt(e))throw new Error(`Invalid date: ${c}-${n}-${t}`);return Object.freeze(e)}function j(c){let n=c.month.toString().padStart(2,"0"),t=c.day.toString().padStart(2,"0");return`${c.year}-${n}-${t}`}function fe(c){let n=c.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!n)return null;let t=parseInt(n[1],10),e=parseInt(n[2],10),r=parseInt(n[3],10),a={year:t,month:e,day:r};return bt(a)?Object.freeze(a):null}function L(c,n){return c.year!==n.year?c.year-n.year:c.month!==n.month?c.month-n.month:c.day-n.day}function Z(c,n){return c.year===n.year&&c.month===n.month&&c.day===n.day}function bt(c){let{year:n,month:t,day:e}=c;if(!Number.isInteger(n)||n<1||!Number.isInteger(t)||t<1||t>12||!Number.isInteger(e)||e<1)return!1;let r=C(n,t);return e<=r}function C(c,n){let t=[31,28,31,30,31,30,31,31,30,31,30,31];return n===2&&St(c)?29:t[n-1]}function St(c){return c%4===0&&c%100!==0||c%400===0}function $(c){let n=c.year,t=c.month,e=c.day;t<3&&(t+=12,n-=1);let r=e,a=t,i=n%100,s=Math.floor(n/100),o=(r+Math.floor(13*(a+1)/5)+i+Math.floor(i/4)+Math.floor(s/4)-2*s)%7;return o=(o%7+7)%7,(o+6)%7}function U(c,n){let t=c.year,e=c.month,r=c.day+n;for(;r>C(t,e);)r-=C(t,e),e+=1,e>12&&(e=1,t+=1);for(;r<1;)e-=1,e<1&&(e=12,t-=1),r+=C(t,e);return Object.freeze({year:t,month:e,day:r})}function be(c,n){return U(c,-n)}function P(){let c=new Date;return Object.freeze({year:c.getFullYear(),month:c.getMonth()+1,day:c.getDate()})}function Se(c,n){let t=me(c);return me(n)-t}function vt(c,n){return L(c,n)<0}function Dt(c,n){return L(c,n)>0}function ve(c,n,t){return L(c,n)>=0&&L(c,t)<=0}function De(c){return Object.freeze({year:c.year,month:c.month,day:1})}function we(c){let n=C(c.year,c.month);return Object.freeze({year:c.year,month:c.month,day:n})}function me(c){let{year:n,month:t,day:e}=c,r=n*365+Math.floor(n/4)-Math.floor(n/100)+Math.floor(n/400);return r+=[0,31,59,90,120,151,181,212,243,273,304,334][t-1],t>2&&St(n)&&(r+=1),r+=e,r}var V=yt(()=>{"use strict"});function B(c){var e;let n=c.endDate!==null&&(c.startDate.year!==c.endDate.year||c.startDate.month!==c.endDate.month||c.startDate.day!==c.endDate.day),t=(e=c.isAnniversary)!=null?e:c.startDate.year===0;return Object.freeze({id:c.id,filePath:c.filePath,fileName:c.fileName,displayName:c.displayName,startDate:c.startDate,endDate:c.endDate,isMultiDay:n,isAnniversary:t,metadata:Object.freeze({tags:Object.freeze([...c.metadata.tags]),folder:c.metadata.folder,properties:Object.freeze({...c.metadata.properties})})})}function Ee(){return Object.freeze({tags:Object.freeze([]),folder:"",properties:Object.freeze({})})}function Ce(c){if(typeof c!="object"||c===null)return!1;let n=c;return typeof n.id=="string"&&typeof n.filePath=="string"&&typeof n.fileName=="string"&&typeof n.displayName=="string"&&Ae(n.startDate)&&(n.endDate===null||Ae(n.endDate))&&typeof n.isMultiDay=="boolean"&&typeof n.isAnniversary=="boolean"&&un(n.metadata)}function Ae(c){if(typeof c!="object"||c===null)return!1;let n=c;return typeof n.year=="number"&&typeof n.month=="number"&&typeof n.day=="number"}function un(c){if(typeof c!="object"||c===null)return!1;let n=c;return Array.isArray(n.tags)&&typeof n.folder=="string"&&typeof n.properties=="object"&&n.properties!==null}var Xt=yt(()=>{"use strict"});function Me(c,n){if(L(c,n)>0)throw new Error("Start date must be before or equal to end date");return Object.freeze({start:c,end:n})}function Le(c){return Object.freeze({start:c,end:c})}function Kt(c,n){return L(c.start,n.end)<=0&&L(n.start,c.end)<=0}function xe(c,n){return L(c,n.start)>=0&&L(c,n.end)<=0}function Re(c,n){return L(c.start,n.start)<=0&&L(c.end,n.end)>=0}function Te(c,n){if(!Kt(c,n))return null;let t=L(c.start,n.start)>=0?c.start:n.start,e=L(c.end,n.end)<=0?c.end:n.end;return Object.freeze({start:t,end:e})}function Fe(c){if(c.start.year===c.end.year&&c.start.month===c.end.month)return c.end.day-c.start.day+1;let n=0,t=c.start;for(;L(t,c.end)<=0;)n++,t=U(t,1);return n}function Pe(c,n){let t=[],e=c.start.year,r=c.start.month,a=c.start.day;for(;e<c.end.year||e===c.end.year&&r<=c.end.month;){let i=C(e,r),s;e===c.end.year&&r===c.end.month?s=c.end.day:s=i,t.push(Object.freeze({year:e,month:r,startDay:a,endDay:s,entryId:n})),r++,r>12&&(r=1,e++),a=1}return Object.freeze(t)}function Ie(c,n,t,e){let r={year:n,month:t,day:1},a={year:n,month:t,day:C(n,t)};if(Dt(c.start,a)||vt(c.end,r))return null;let i=c.start.year===n&&c.start.month===t?c.start.day:1,s=c.end.year===n&&c.end.month===t?c.end.day:C(n,t);return Object.freeze({year:n,month:t,startDay:i,endDay:s,entryId:e})}function Ne(c,n){return Object.freeze({start:{year:c,month:n,day:1},end:{year:c,month:n,day:C(c,n)}})}function ke(c){return Z(c.start,c.end)}function $e(c,n,t){return Object.freeze({start:U(c.start,-n),end:U(c.end,t)})}var Ve=yt(()=>{"use strict";V()});var ae={};ye(ae,{DEFAULT_DATE_EXTRACTION_CONFIG:()=>Ct,DEFAULT_DISPLAY_CONFIG:()=>Lt,DEFAULT_FOLDER_FILTER_CONFIG:()=>Mt,DEFAULT_PLUGIN_SETTINGS:()=>qt,DEFAULT_RADIAL_SETTINGS:()=>xt,DEFAULT_SETTINGS:()=>gn,PREDEFINED_QUARTERS:()=>Zt,PREDEFINED_SEASONS:()=>Qt,PREDEFINED_SEMESTERS:()=>te,RING_COLORS:()=>N,RING_SEGMENT_TEMPLATE:()=>re,addDays:()=>U,assignTracks:()=>tt,compareLocalDates:()=>L,computeSubRingRadii:()=>X,createCalendarEntry:()=>B,createCurrentViewState:()=>pn,createDateRange:()=>Me,createDefaultRing:()=>Jt,createEmptyMetadata:()=>Ee,createEventsRing:()=>fn,createLifePhasesRing:()=>mn,createLocalDate:()=>M,createMonthRange:()=>Ne,createPluginSettings:()=>hn,createSingleDayRange:()=>Le,createViewState:()=>yn,daysBetween:()=>Se,extendRange:()=>$e,generate10DayPhases:()=>ee,generateWeekSegments:()=>ne,getDaysInMonth:()=>C,getFirstDayOfMonth:()=>De,getLastDayOfMonth:()=>we,getMaxTrackCount:()=>et,getMonthSegment:()=>Ie,getRangeDays:()=>Fe,getToday:()=>P,getWeekday:()=>$,intersectRanges:()=>Te,isAfter:()=>Dt,isBefore:()=>vt,isCalendarEntry:()=>Ce,isDateInRange:()=>xe,isLeapYear:()=>St,isSingleDay:()=>ke,isValidLocalDate:()=>bt,isWithinRange:()=>ve,keyToLocalDate:()=>fe,localDateToKey:()=>j,localDatesEqual:()=>Z,rangeContains:()=>Re,rangesOverlap:()=>Kt,splitRangeByMonth:()=>Pe,subtractDays:()=>be});function hn(c){var n,t;return Object.freeze({dateExtraction:c.dateExtraction?Object.freeze({...Ct,...c.dateExtraction}):Ct,folderFilter:c.folderFilter?Object.freeze({...Mt,...c.folderFilter}):Mt,display:c.display?Object.freeze({...Lt,...c.display}):Lt,locale:(n=c.locale)!=null?n:qt.locale,debugMode:(t=c.debugMode)!=null?t:qt.debugMode})}function pn(){let c=new Date;return Object.freeze({year:c.getFullYear(),month:c.getMonth()+1,selectedDate:null,focusedEntryId:null})}function yn(c,n){return Object.freeze({year:c,month:n,selectedDate:null,focusedEntryId:null})}function Jt(c){return{id:`ring-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Ring ${c+1}`,folder:"",color:"blue",segmentType:"monthly",enabled:!0,order:c,ringType:"year-days",segmentStyle:"fixed",folderPattern:"fixed",recursive:!1,showGaps:!1,showLabels:!1}}function mn(c,n=0){return{id:`life-phases-${Date.now()}`,name:"Life Phases",folder:c,color:"blue",segmentType:"custom",enabled:!0,order:n,ringType:"life-phases",segmentStyle:"from-yaml",folderPattern:"fixed",recursive:!1,startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",showGaps:!0,showLabels:!0}}function fn(c,n=1){return{id:`events-${Date.now()}`,name:"Events",folder:c,color:"teal",segmentType:"custom",enabled:!0,order:n,ringType:"events",segmentStyle:"from-yaml",folderPattern:"year-substitution",recursive:!1,startDateField:"event-start",endDateField:"event-end",colorField:"event-color",labelField:"event-label",showGaps:!0,showLabels:!0}}function tt(c){let n=[...c].sort((e,r)=>e.startAngle-r.startAngle),t=[];return n.map(e=>{let r=t.findIndex(a=>a.endAngle<=e.startAngle);return r===-1?(r=t.length,t.push({endAngle:e.endAngle})):t[r].endAngle=e.endAngle,{...e,track:r}})}function X(c,n,t,e){let r=(c-n)/t;return{outer:c-e*r,inner:c-(e+1)*r}}function et(c){return c.length===0?1:Math.max(...c.map(n=>n.track))+1}function ee(){let c=[],n=1,t=1;for(;n<=365;){let e=Math.min(n+9,365);c.push({id:`10d-${t}`,label:`P${t}`,startDay:n,endDay:e}),n=e+1,t++}return c}function ne(){let c=[];for(let n=1;n<=52;n++){let t=(n-1)*7+1,e=Math.min(n*7,365);c.push({id:`w-${n}`,label:`W${n}`,startDay:t,endDay:e})}return c}var Ct,Mt,Lt,qt,gn,N,Qt,Zt,te,xt,re,K=yt(()=>{"use strict";V();Xt();Ve();Ct=Object.freeze({fromFilename:!0,fromFrontmatter:!0,frontmatterField:"date",endDateField:"endDate",filenamePatterns:Object.freeze(["^(\\d{4}-\\d{2}-\\d{2})","(\\d{4}-\\d{2}-\\d{2})$","^(\\d{4}-\\d{2}-\\d{2})[-_\\s]","[-_\\s](\\d{4}-\\d{2}-\\d{2})\\.md$"]),useCreationDateFallback:!1}),Mt=Object.freeze({includeFolders:Object.freeze([]),excludeFolders:Object.freeze([])}),Lt=Object.freeze({firstDayOfWeek:1,showWeekNumbers:!1,highlightToday:!0,showAdjacentMonths:!0,maxEntriesPerDay:3,showMultiDayBars:!0}),qt=Object.freeze({dateExtraction:Ct,folderFilter:Mt,display:Lt,locale:"en-US",debugMode:!1});gn={calendarWidth:"fit",dateProperties:["date","startDate","created"],endDateProperties:["endDate","due","deadline"],datePriority:"property",dailyNoteFolder:"",dailyNoteFormat:"YYYY-MM-DD",showMultiDayBars:!0,showWeekendHighlight:!0,anniversaryDateProperties:[]};N={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",teal:"#14b8a6",cyan:"#06b6d4",magenta:"#d946ef",lime:"#84cc16",amber:"#f59e0b",indigo:"#6366f1",violet:"#8b5cf6",rose:"#f43f5e",gray:"#6b7280",slate:"#64748b",stone:"#78716c"};Qt=[{id:"spring",label:"Spring",startDay:60,endDay:152},{id:"summer",label:"Summer",startDay:152,endDay:244},{id:"autumn",label:"Autumn",startDay:244,endDay:335},{id:"winter",label:"Winter",startDay:335,endDay:60}],Zt=[{id:"q1",label:"Q1",startDay:1,endDay:90},{id:"q2",label:"Q2",startDay:91,endDay:181},{id:"q3",label:"Q3",startDay:182,endDay:273},{id:"q4",label:"Q4",startDay:274,endDay:365}],te=[{id:"s1",label:"H1",startDay:1,endDay:181},{id:"s2",label:"H2",startDay:182,endDay:365}];xt={currentView:"annual",birthYear:1990,expectedLifespan:85,currentYear:new Date().getFullYear(),rings:[],centerDisplay:"countdown",periodicNotesFormat:{yearly:"YYYY",monthly:"YYYY-MM",daily:"YYYY-MM-DD"},templateFolder:"Templates",dailyNoteFolder:"",calendarFilterFolder:"",annualRecurringFolder:"",lifePhasesFolder:"",annualSegmentType:"none",customSegments:[],lifeActs:[],showSegmentLabels:!0,anniversaryDateProperties:[],calendarSources:[]},re=`---
# === RADIAL CALENDAR TEMPLATE ===
# Delete the lines you don't need

# COLORS (choose one):
ring-color: blue
# ring-color: red
# ring-color: orange
# ring-color: yellow
# ring-color: green
# ring-color: teal
# ring-color: purple
# ring-color: magenta
# ring-color: pink
# ring-color: cyan
# ring-color: lime
# ring-color: amber
# ring-color: indigo

# STYLE (choose one):
ring-style: solid
# ring-style: striped
# ring-style: dotted
# ring-style: gradient

# LABEL & ICON:
ring-label: ""
ring-icon: circle

# DATE RANGE:
date: {{date}}
# end-date:

# PROGRESS (0-100):
# ring-progress: 0
---

# {{title}}

`});var Ln={};ye(Ln,{default:()=>Ht});module.exports=Ut(Ln);var O=require("obsidian");var mt=class{constructor(n){this.app=n}getAllMarkdownFiles(){return this.app.vault.getMarkdownFiles().map(t=>this.toFileInfo(t))}getMarkdownFilesInFolder(n){return this.getAllMarkdownFiles().filter(t=>t.folderPath?t.folderPath===n||t.folderPath.startsWith(n+"/"):!1)}getFileByPath(n){let t=this.app.vault.getAbstractFileByPath(n);return t instanceof this.getTFileClass()?t:null}async readFile(n){let t=this.getFileByPath(n);if(!t)return null;try{return await this.app.vault.read(t)}catch(e){return null}}async createOrOpenDailyNote(n,t=""){let e=this.getFileByPath(n);if(!e){let r=n.substring(0,n.lastIndexOf("/"));r&&await this.ensureFolderExists(r),e=await this.app.vault.create(n,t)}return e}async ensureFolderExists(n){this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n)}fileExists(n){return this.getFileByPath(n)!==null}getRoot(){return this.app.vault.getRoot()}toFileInfo(n){var t,e;return Object.freeze({path:n.path,basename:n.basename,name:n.name,extension:n.extension,folderPath:(e=(t=n.parent)==null?void 0:t.path)!=null?e:null})}getTFileClass(){let n=this.app.vault.getMarkdownFiles();return n.length>0?n[0].constructor:class{}}};var ft=class{constructor(n){this.app=n}getMetadata(n){let t=this.app.metadataCache.getFileCache(n);return this.extractMetadata(t)}getMetadataByPath(n){let t=this.app.vault.getAbstractFileByPath(n);return!t||!this.isMarkdownFile(t)?null:this.getMetadata(t)}getProperty(n,t){var r;return(r=this.getMetadata(n).frontmatter)==null?void 0:r[t]}getStringProperty(n,t){let e=this.getProperty(n,t);return typeof e=="string"?e:e instanceof Date?this.formatDate(e):typeof e=="number"?String(e):null}getDateProperty(n,t){let e=this.getProperty(n,t);if(!e)return null;if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;let r=e.match(/^(\d{4}-\d{2}-\d{2})/);return r?r[1]:null}return e instanceof Date&&!isNaN(e.getTime())?this.formatDate(e):this.isLocalDateLike(e)?this.formatLocalDate(e):null}getTags(n){return this.getMetadata(n).tags}hasTag(n,t){let e=t.startsWith("#")?t:`#${t}`;return this.getTags(n).some(a=>a.tag.toLowerCase()===e.toLowerCase())}onMetadataChange(n){let t=e=>n(e);return this.app.metadataCache.on("changed",t),()=>this.app.metadataCache.off("changed",t)}extractMetadata(n){var r;let t=(r=n==null?void 0:n.frontmatter)!=null?r:null,e=[];if(t!=null&&t.tags){let a=Array.isArray(t.tags)?t.tags:[t.tags];for(let i of a)if(typeof i=="string"){let s=i.startsWith("#")?i:`#${i}`;e.push({tag:s,name:s.substring(1)})}}if(n!=null&&n.tags)for(let a of n.tags)e.find(s=>s.tag.toLowerCase()===a.tag.toLowerCase())||e.push({tag:a.tag,name:a.tag.substring(1)});return Object.freeze({frontmatter:t,tags:Object.freeze(e)})}formatDate(n){let t=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${t}-${e}-${r}`}formatLocalDate(n){let t=n.year,e=String(n.month).padStart(2,"0"),r=String(n.day).padStart(2,"0");return`${t}-${e}-${r}`}isLocalDateLike(n){return typeof n=="object"&&n!==null&&"year"in n&&"month"in n&&"day"in n&&typeof n.year=="number"&&typeof n.month=="number"&&typeof n.day=="number"}isMarkdownFile(n){return typeof n=="object"&&n!==null&&"extension"in n&&n.extension==="md"}};V();var wt=class{constructor(n={}){var t,e;this.entriesByPath=new Map,this.entriesByDate=new Map,this.multiDayEntriesByDate=new Map,this.anniversaryEntriesByMonthDay=new Map,this.stats={hits:0,misses:0,lastRebuild:0},this.config={maxEntries:(t=n.maxEntries)!=null?t:1e4,debug:(e=n.debug)!=null?e:!1}}addEntry(n){if(this.removeEntry(n.filePath),this.entriesByPath.set(n.filePath,n),n.isAnniversary){let e=this.monthDayKey(n.startDate.month,n.startDate.day);this.addToDateIndex(e,n,this.anniversaryEntriesByMonthDay),this.log(`Added anniversary entry: ${n.filePath}`);return}let t=j(n.startDate);this.addToDateIndex(t,n,this.entriesByDate),n.isMultiDay&&n.endDate&&this.indexMultiDayEntry(n),this.log(`Added entry: ${n.filePath}`)}monthDayKey(n,t){return`${String(n).padStart(2,"0")}-${String(t).padStart(2,"0")}`}removeEntry(n){let t=this.entriesByPath.get(n);if(!t)return;if(this.entriesByPath.delete(n),t.isAnniversary){let r=this.monthDayKey(t.startDate.month,t.startDate.day);this.removeFromDateIndex(r,t.id,this.anniversaryEntriesByMonthDay),this.log(`Removed anniversary entry: ${n}`);return}let e=j(t.startDate);this.removeFromDateIndex(e,t.id,this.entriesByDate),t.isMultiDay&&t.endDate&&this.removeMultiDayEntry(t),this.log(`Removed entry: ${n}`)}getEntriesForDate(n){var o,l,d;let t=j(n),e=this.monthDayKey(n.month,n.day),r=(o=this.entriesByDate.get(t))!=null?o:[],a=(l=this.multiDayEntriesByDate.get(t))!=null?l:[],i=(d=this.anniversaryEntriesByMonthDay.get(e))!=null?d:[];r.length>0||a.length>0||i.length>0?this.stats.hits++:this.stats.misses++;let s=new Map;for(let h of r)s.set(h.id,h);for(let h of a)s.set(h.id,h);for(let h of i)s.set(h.id,h);return Array.from(s.values())}getEntriesInRange(n,t){var r;let e=new Map;for(let a of this.entriesByPath.values()){let i=(r=a.endDate)!=null?r:a.startDate;L(a.startDate,t)<=0&&L(i,n)>=0&&e.set(a.id,a)}return Array.from(e.values())}getMultiDayEntries(){return Array.from(this.entriesByPath.values()).filter(n=>n.isMultiDay)}getAnniversaryEntriesForDate(n){var e;let t=this.monthDayKey(n.month,n.day);return(e=this.anniversaryEntriesByMonthDay.get(t))!=null?e:[]}getAllAnniversaryEntries(){let n=[];for(let t of this.anniversaryEntriesByMonthDay.values())n.push(...t);return n}getEntryByPath(n){return this.entriesByPath.get(n)}hasEntry(n){return this.entriesByPath.has(n)}getAllEntries(){return Array.from(this.entriesByPath.values())}clear(){this.entriesByPath.clear(),this.entriesByDate.clear(),this.multiDayEntriesByDate.clear(),this.stats={hits:0,misses:0,lastRebuild:Date.now()},this.log("Cache cleared")}rebuild(n){this.clear(),this.stats.lastRebuild=Date.now();for(let t of n)this.addEntry(t);this.log(`Cache rebuilt with ${n.length} entries`)}getStats(){return Object.freeze({entryCount:this.entriesByPath.size,dateCount:this.entriesByDate.size+this.multiDayEntriesByDate.size,hits:this.stats.hits,misses:this.stats.misses,lastRebuild:this.stats.lastRebuild})}indexMultiDayEntry(n){if(!n.endDate)return;let t=n.startDate,e=n.endDate;for(;L(t,e)<0;)if(t=this.addOneDay(t),L(t,e)<=0){let r=j(t);this.addToDateIndex(r,n,this.multiDayEntriesByDate)}}removeMultiDayEntry(n){if(!n.endDate)return;let t=n.startDate,e=n.endDate;for(;L(t,e)<0;)if(t=this.addOneDay(t),L(t,e)<=0){let r=j(t);this.removeFromDateIndex(r,n.id,this.multiDayEntriesByDate)}}addToDateIndex(n,t,e){let r=e.get(n);r?r.push(t):e.set(n,[t])}removeFromDateIndex(n,t,e){let r=e.get(n);if(!r)return;let a=r.filter(i=>i.id!==t);a.length===0?e.delete(n):e.set(n,a)}addOneDay(n){let t=n.day+1,e=n.month,r=n.year,a=this.getDaysInMonth(r,e);return t>a&&(t=1,e+=1,e>12&&(e=1,r+=1)),{year:r,month:e,day:t}}getDaysInMonth(n,t){let e=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2?n%4===0&&n%100!==0||n%400===0?29:28:e[t-1]}log(n){this.config.debug&&console.log(`[EntryCache] ${n}`)}};var At=class At{parseDate(n){if(n==null)return null;if(typeof n=="string")return this.parseDateString(n);if(n instanceof Date)return isNaN(n.getTime())?null:{year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate()};if(typeof n=="object"&&n!==null){let t=n;if(typeof t.year=="number"&&typeof t.month=="number"&&typeof t.day=="number"&&this.isValidDate(t.year,t.month,t.day))return{year:t.year,month:t.month,day:t.day}}return null}parseDateString(n){let t=n.trim(),e=t.match(/^XXXX-(\d{2})-(\d{2})$/i);if(e){let o=parseInt(e[1],10),l=parseInt(e[2],10);return this.isValidDate(2e3,o,l)?{year:0,month:o,day:l}:null}let r=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!r)return null;let a=parseInt(r[1],10),i=parseInt(r[2],10),s=parseInt(r[3],10);return this.isValidDate(a,i,s)?{year:a,month:i,day:s}:null}isValidDate(n,t,e){if(n<1900||n>2100||t<1||t>12||e<1||e>31)return!1;let r=this.getDaysInMonth(n,t);return!(e>r)}getDaysInMonth(n,t){let e=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2&&this.isLeapYear(n)?29:e[t-1]}isLeapYear(n){return n%4===0&&n%100!==0||n%400===0}extractFromFilename(n){let t={start:null,end:null};if(!n||typeof n!="string")return t;let e=n.match(At.DATE_PATTERN);return!e||e.length===0||(t.start=this.parseDate(e[0]),e.length>=2&&(t.end=this.parseDate(e[1]))),t}extractFromProperties(n,t){if(!n||typeof n!="object"||!Array.isArray(t))return null;for(let e of t){if(typeof e!="string"||!e)continue;let r=n[e];if(r==null)continue;let a=this.parseDate(r);if(a!==null)return a}return null}extractDates(n,t,e){let r={start:null,end:null},a=this.extractFromFilename(n);for(let i of e.priorities)i==="filename"?(r.start===null&&a.start!==null&&(r.start=a.start),r.end===null&&a.end!==null&&(r.end=a.end)):i==="properties"&&(r.start===null&&(r.start=this.extractFromProperties(t,e.startSources)),r.end===null&&(r.end=this.extractFromProperties(t,e.endSources)));return r}};At.DATE_PATTERN=/(\d{4}-\d{2}-\d{2})/g;var lt=At,kn=new lt;V();var cn=["January","February","March","April","May","June","July","August","September","October","November","December"],Et=class{getDaysInMonth(n,t){return C(n,t)}getFirstDayOfWeek(n,t){let e=M(n,t,1);return $(e)}isToday(n){let t=P();return Z(n,t)}generateGrid(n){let t=[];for(let e=1;e<=12;e++)t.push(this.generateMonth(n,e));return{year:n,months:t}}generateMonth(n,t){let e=this.getDaysInMonth(n,t),r=this.getFirstDayOfWeek(n,t),a=[];for(let i=0;i<r;i++)a.push({date:M(n,t,1),isToday:!1,isEmpty:!0});for(let i=1;i<=e;i++){let s=M(n,t,i);a.push({date:s,isToday:this.isToday(s),isEmpty:!1})}return{month:t,name:cn[t-1],startDayOfWeek:r,daysInMonth:e,days:a}}};V();var dn=24,ct=class{calculateMonthSegments(n,t,e){let r=[];if(L(n,t)>0)return r;let a=n.year,i=n.month,s=0;for(;s<dn;){let o=a===n.year&&i===n.month,l=a===t.year&&i===t.month,d=o?n.day:1,h=l?t.day:C(a,i);if(r.push({year:a,month:i,startDay:d,endDay:h,entryId:e}),l)break;i++,i>12&&(i=1,a++),s++}return r}calculateBarPositions(n,t){let e=new Map;if(n.length===0)return e;let r=[...n].sort((i,s)=>i.startDay!==s.startDay?i.startDay-s.startDay:s.endDay-s.startDay-(i.endDay-i.startDay)),a=[];for(let i=0;i<=31;i++)a.push(new Set);for(let i of r){let s=(t.startDayOfWeek+i.startDay-1)%7,o=(t.startDayOfWeek+i.endDay-1)%7,l=i.endDay-i.startDay+1,d=0,h=!1;for(;!h;){let u=!0;for(let g=i.startDay;g<=i.endDay;g++)if(a[g].has(d)){u=!1;break}if(u){h=!0;for(let g=i.startDay;g<=i.endDay;g++)a[g].add(d)}else d++;if(d>100)break}e.set(i.entryId,{rowIndex:d,startColumn:s,endColumn:o,span:l})}return e}},Gn=new ct;Xt();V();V();var Rt=class{constructor(n,t){this.unregisterMetadataListener=null;this.eventListeners=null;this.updateSubscribers=new Set;this.vaultRepository=new mt(n),this.metadataRepository=new ft(n),this.entryCache=new wt({debug:!1}),this.dateEngine=new lt,this.calendarEngine=new Et,this.multiDayEngine=new ct,this.settings=t,this.currentYear=P().year}async initialize(){await this.rebuildCache(),this.setupMetadataListener()}destroy(){this.unregisterMetadataListener&&(this.unregisterMetadataListener(),this.unregisterMetadataListener=null),this.eventListeners=null}setEventListeners(n){this.eventListeners=n}subscribeToUpdates(n){return this.updateSubscribers.add(n),()=>{this.updateSubscribers.delete(n)}}notifySubscribers(){for(let n of this.updateSubscribers)try{n()}catch(t){console.error("Radcal subscriber error:",t)}}async updateSettings(n){let t=this.settings.dateProperties.join(",")!==n.dateProperties.join(",")||this.settings.endDateProperties.join(",")!==n.endDateProperties.join(",")||this.settings.datePriority!==n.datePriority;this.settings=n,t&&await this.rebuildCache()}getCurrentYear(){return this.currentYear}setCurrentYear(n){var t;this.currentYear!==n&&(this.currentYear=n,(t=this.eventListeners)==null||t.onYearChanged(n))}setYear(n){this.setCurrentYear(n)}nextYear(){this.setCurrentYear(this.currentYear+1)}previousYear(){this.setCurrentYear(this.currentYear-1)}goToToday(){this.setCurrentYear(P().year)}generateCalendarGrid(){return this.calendarEngine.generateGrid(this.currentYear)}getEntriesForDate(n){return this.entryCache.getEntriesForDate(n)}getMultiDayEntries(){return this.entryCache.getMultiDayEntries().filter(n=>{var a;let t={year:this.currentYear,month:1,day:1},e={year:this.currentYear,month:12,day:31},r=(a=n.endDate)!=null?a:n.startDate;return n.startDate.year===this.currentYear||n.startDate.year<this.currentYear&&r.year>=this.currentYear})}getAnniversaryEntriesForDate(n){return this.entryCache.getAnniversaryEntriesForDate(n)}getAllAnniversaryEntries(){return this.entryCache.getAllAnniversaryEntries()}calculateBarPositions(n,t){return new Map}async openDailyNote(n){let t=this.settings.dailyNoteFormat,e=this.settings.dailyNoteFolder,r=this.formatDailyNoteFilename(n,t),a=e?`${e}/${r}.md`:`${r}.md`,i=await this.vaultRepository.createOrOpenDailyNote(a);console.log(`Opening daily note: ${i.path}`)}getCacheStats(){let n=this.entryCache.getStats();return{entryCount:n.entryCount,dateCount:n.dateCount}}loadLifePhases(n,t={startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",categoryField:"phase-category"}){if(!n)return[];let e=this.vaultRepository.getAllMarkdownFiles(),r=[],a=n.endsWith("/")?n:`${n}/`,i=e.filter(s=>s.path===`${n}.md`||s.path.startsWith(a));for(let s of i){let o=this.metadataRepository.getMetadataByPath(s.path),l=o==null?void 0:o.frontmatter;if(!l)continue;let d=l[t.startDateField];if(!d||typeof d!="string")continue;let h=this.parseYAMLDate(d);if(!h)continue;let u=l[t.endDateField],g=null;u&&typeof u=="string"&&u.trim()!==""&&(g=this.parseYAMLDate(u));let p=l[t.colorField],m=this.isValidColor(p)?p:"blue",y=l[t.labelField]||s.basename,f=l[t.categoryField];r.push({filePath:s.path,label:String(y),startDate:h,endDate:g,color:m,category:f?String(f):void 0})}return r.sort((s,o)=>s.startDate.year!==o.startDate.year?s.startDate.year-o.startDate.year:s.startDate.month!==o.startDate.month?s.startDate.month-o.startDate.month:s.startDate.day-o.startDate.day)}parseYAMLDate(n){let t=n.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return null;let e=parseInt(t[1],10),r=parseInt(t[2],10),a=parseInt(t[3],10);return r<1||r>12||a<1||a>31?null:M(e,r,a)}isValidColor(n){return typeof n=="string"&&["red","orange","yellow","green","blue","purple","pink","teal","cyan","magenta","lime","amber","indigo","violet","rose","gray","slate","stone"].includes(n)}computeLifePhaseSegments(n,t,e,r){let a=r?this.parseYAMLDate(r)||M(t,1,1):M(t,1,1),i=M(a.year+e,a.month,a.day),s=this.daysBetweenDates(a,i),o=P();return n.map(l=>{let h=this.daysBetweenDates(a,l.startDate)/s*2*Math.PI,u,g=!1;l.endDate?u=l.endDate:(g=!0,u=i);let m=this.daysBetweenDates(a,u)/s*2*Math.PI,y;g&&(y=this.daysBetweenDates(a,o)/s*2*Math.PI);let{RING_COLORS:f}=(K(),Ut(ae)),S=f[l.color]||f.blue;return{id:l.filePath,filePath:l.filePath,label:l.label,startAngle:h,endAngle:m,color:S,entries:[],isOngoing:g,todayAngle:y,category:l.category}})}loadSpanningArcs(n,t,e={startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label"}){if(!n)return[];let r=this.vaultRepository.getAllMarkdownFiles(),a=[],i=n.endsWith("/")?n:`${n}/`,s=r.filter(d=>d.path===`${n}.md`||d.path.startsWith(i)),o=M(t,1,1),l=M(t,12,31);for(let d of s){let h=this.metadataRepository.getMetadataByPath(d.path),u=h==null?void 0:h.frontmatter;if(!u)continue;let g=u[e.startDateField];if(!g||typeof g!="string")continue;let p=this.parseYAMLDate(g);if(!p)continue;let m=u[e.endDateField],y=null;if(m&&typeof m=="string"&&m.trim()!==""&&(y=this.parseYAMLDate(m)),y||(y=p),y.year<t||p.year>t)continue;let f=this.compareDates(p,o)<0,S=this.compareDates(y,l)>0,v=f?o:p,D=S?l:y,A=u[e.colorField],E=this.isValidColor(A)?A:void 0,T=u[e.labelField]||d.basename,k=f?0:this.dateToYearAngle(v,t),H=S?2*Math.PI:this.dateToYearAngle(D,t),{RING_COLORS:jt}=(K(),Ut(ae)),Q=E?jt[E]:void 0;a.push({id:d.path,filePath:d.path,label:String(T),startAngle:k,endAngle:H,color:Q,entries:[],continuesFromPreviousYear:f,continuesIntoNextYear:S})}return a.sort((d,h)=>d.startAngle-h.startAngle)}dateToYearAngle(n,t){let e=this.isLeapYear(t)?366:365;return(this.getDayOfYear(n)-1)/e*2*Math.PI}compareDates(n,t){return n.year!==t.year?n.year-t.year:n.month!==t.month?n.month-t.month:n.day-t.day}daysBetweenDates(n,t){let e=new Date(n.year,n.month-1,n.day).getTime(),r=new Date(t.year,t.month-1,t.day).getTime();return Math.floor((r-e)/(1e3*60*60*24))}dateToYearFraction(n){let t=this.isLeapYear(n.year)?366:365;return(this.getDayOfYear(n)-1)/t}isLeapYear(n){return n%4===0&&n%100!==0||n%400===0}getDayOfYear(n){let t=[31,28,31,30,31,30,31,31,30,31,30,31];this.isLeapYear(n.year)&&(t[1]=29);let e=n.day;for(let r=0;r<n.month-1;r++)e+=t[r];return e}async rebuildCache(){var r;let n=this.vaultRepository.getAllMarkdownFiles(),t=[],e=this.getDateExtractionConfig();for(let a of n){let i=this.createEntriesFromFile(a,e);t.push(...i)}this.entryCache.rebuild(t),(r=this.eventListeners)==null||r.onEntriesUpdated(),this.notifySubscribers()}createEntriesFromFile(n,t){var d,h,u;let e=this.metadataRepository.getMetadataByPath(n.path),r=(d=e==null?void 0:e.frontmatter)!=null?d:null,{start:a,end:i}=this.dateEngine.extractDates(n.name,r,t),s=(r==null?void 0:r["radcal-annual"])===!0,o={};if(r)for(let[g,p]of Object.entries(r))(typeof p=="string"||typeof p=="number"||typeof p=="boolean")&&(o[g]=p);let l={tags:(h=e==null?void 0:e.tags.map(g=>g.name))!=null?h:[],folder:(u=n.folderPath)!=null?u:"",properties:o};if(s&&r){let g=[],p=this.parseFrontmatterDate(r["radcal-annual-fix"]);if(p)return g.push(B({id:`${n.path}#fix`,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:p,endDate:null,metadata:l,isAnniversary:!0})),g;let m=this.parseFrontmatterDate(r["radcal-start"]),y=this.parseFrontmatterDate(r["radcal-end"]);m&&g.push(B({id:`${n.path}#start`,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:m,endDate:null,metadata:l,isAnniversary:!0})),y&&g.push(B({id:`${n.path}#end`,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:y,endDate:null,metadata:l,isAnniversary:!0}));let f=this.settings.anniversaryDateProperties||[];for(let S of f){let v=this.parseFrontmatterDate(r[S]);if(v){let D=S.toLowerCase().replace(/\s+/g,"-");g.push(B({id:`${n.path}#${D}`,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:v,endDate:null,metadata:l,isAnniversary:!0}))}}return g.length===0&&a&&g.push(B({id:`${n.path}#fallback`,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:a,endDate:null,metadata:l,isAnniversary:!0})),g}return a?[B({id:n.path,filePath:n.path,fileName:n.name,displayName:n.basename,startDate:a,endDate:i,metadata:l,isAnniversary:!1})]:[]}parseFrontmatterDate(n){return n?typeof n=="string"?this.parseYAMLDate(n):n instanceof Date?M(n.getFullYear(),n.getMonth()+1,n.getDate()):null:null}getDateExtractionConfig(){return{startSources:this.settings.dateProperties,endSources:this.settings.endDateProperties,priorities:this.settings.datePriority==="property"?["properties","filename"]:["filename","properties"]}}formatDailyNoteFilename(n,t){return t.replace("YYYY",String(n.year)).replace("MM",String(n.month).padStart(2,"0")).replace("DD",String(n.day).padStart(2,"0"))}setupMetadataListener(){this.unregisterMetadataListener=this.metadataRepository.onMetadataChange(n=>{this.handleFileChange(n.path)})}handleFileChange(n){var e;let t=this.vaultRepository.getAllMarkdownFiles().find(r=>r.path===n);if(t){this.entryCache.removeEntry(n),this.entryCache.removeEntry(`${n}#start`),this.entryCache.removeEntry(`${n}#end`),this.entryCache.removeEntry(`${n}#fix`),this.entryCache.removeEntry(`${n}#fallback`);let r=this.settings.anniversaryDateProperties||[];for(let s of r){let o=s.toLowerCase().replace(/\s+/g,"-");this.entryCache.removeEntry(`${n}#${o}`)}let a=this.getDateExtractionConfig(),i=this.createEntriesFromFile(t,a);for(let s of i)this.entryCache.addEntry(s)}else{this.entryCache.removeEntry(n),this.entryCache.removeEntry(`${n}#start`),this.entryCache.removeEntry(`${n}#end`),this.entryCache.removeEntry(`${n}#fix`),this.entryCache.removeEntry(`${n}#fallback`);let r=this.settings.anniversaryDateProperties||[];for(let a of r){let i=a.toLowerCase().replace(/\s+/g,"-");this.entryCache.removeEntry(`${n}#${i}`)}}(e=this.eventListeners)==null||e.onEntriesUpdated(),this.notifySubscribers()}};var dt=require("obsidian");V();K();var ut="radial-calendar-plugin",Oe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],se=["January","February","March","April","May","June","July","August","September","October","November","December"],oe=800,b=oe/2,nt=380,Ye=340,rt=335,Tt=260,G=255,_=150,bn=140,I=380,le=30,Y=145,ie=Y+le,Be=Y+le/2,pr=(I-Y)/31,Ge=1,Sn=20,_e=I+2,We=I+8,He=I+14,je=I+12,vn=4,Ft=class extends dt.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.tooltipEl=null}getViewType(){return ut}getDisplayText(){return"Radial Calendar"}getIcon(){return"circle"}initialize(t){this.config=t,this.config.service.setEventListeners({onEntriesUpdated:()=>this.render(),onYearChanged:()=>this.render()})}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("radial-calendar-plugin"),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null,this.tooltipEl=null}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let e=this.config.service.getCurrentYear(),r=this.containerEl_.createDiv({cls:"rc-container"});this.renderHeader(r,e);let a=r.createDiv({cls:"rc-wrapper"});this.renderRadialCalendar(a,e),this.tooltipEl=r.createDiv({cls:"rc-tooltip"}),this.tooltipEl.style.display="none"}renderHeader(t,e){if(!this.config)return;let r=t.createDiv({cls:"rc-header"});r.createEl("button",{text:"\u2190",cls:"rc-nav-btn",attr:{"aria-label":"Previous year"}}).addEventListener("click",()=>{var l;(l=this.config)==null||l.service.previousYear()}),r.createEl("span",{text:String(e),cls:"rc-year-title"}),r.createEl("button",{text:"\u2192",cls:"rc-nav-btn",attr:{"aria-label":"Next year"}}).addEventListener("click",()=>{var l;(l=this.config)==null||l.service.nextYear()}),r.createEl("button",{text:"Today",cls:"rc-nav-btn rc-today-btn",attr:{"aria-label":"Go to today"}}).addEventListener("click",()=>{var l;(l=this.config)==null||l.service.goToToday()}),r.createEl("button",{text:"\u21BB",cls:"rc-nav-btn rc-refresh-btn",attr:{"aria-label":"Refresh view"}}).addEventListener("click",()=>{this.render()}),this.renderViewModeToggle(r)}renderViewModeToggle(t){if(!this.config)return;let e=this.config.settings.currentView,r=t.createDiv({cls:"rc-view-toggle"});r.createEl("button",{text:"Annual",cls:`rc-toggle-btn ${e==="annual"?"rc-toggle-btn--active":""}`,attr:{"aria-label":"Switch to annual view"}}).addEventListener("click",async()=>{if(this.config&&this.config.settings.currentView!=="annual"){let s={...this.config.settings,currentView:"annual"};this.config.settings=s,await this.config.onSettingsChange(s),this.render()}}),r.createEl("button",{text:"Life",cls:`rc-toggle-btn ${e==="life"?"rc-toggle-btn--active":""}`,attr:{"aria-label":"Switch to life view"}}).addEventListener("click",async()=>{if(this.config&&this.config.settings.currentView!=="life"){let s={...this.config.settings,currentView:"life"};this.config.settings=s,await this.config.onSettingsChange(s),this.render()}})}renderRadialCalendar(t,e){if(!this.config)return;let r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox",`0 0 ${oe} ${oe}`),r.setAttribute("class","rc-svg"),this.svgEl=r,this.config.settings.currentView==="life"?this.renderNestedClock(r,e):this.renderAnnualView(r,e),t.appendChild(r)}renderNestedClock(t,e){if(!this.config)return;let{birthYear:r,expectedLifespan:a}=this.config.settings,i=r+a,s=P(),o=s.year-r;this.renderBackgroundCircle(t),this.renderLifeRing(t,r,i,e),this.renderLifePhasesRing(t,r,a),this.renderYearRing(t,e),this.renderLifeActsOnRing(t,r,a),this.renderNestedCenter(t,e,o),this.renderLifePositionMarker(t,r,a,s.year,"today"),e!==s.year&&this.renderLifePositionMarker(t,r,a,e,"viewed"),e===s.year&&this.renderTodayMarkerOnYearRing(t),this.renderBirthdayMarkerOnYearRing(t,e)}renderLifeRing(t,e,r,a){let i=r-e,s=P();for(let o=e;o<r;o++){let l=o-e,d=l/i*2*Math.PI,h=(l+1)/i*2*Math.PI-.01,u=o<s.year,g=o===s.year,p=o===a,m=this.createArcPath(Ye,nt,d,h),y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttribute("d",m);let f="rc-life-year";u&&(f+=" rc-life-year--past"),g&&(f+=" rc-life-year--current"),p&&(f+=" rc-life-year--selected"),y.setAttribute("class",f),y.setAttribute("data-year",String(o)),y.addEventListener("click",()=>{var S;(S=this.config)==null||S.service.setYear(o)}),y.addEventListener("mouseenter",S=>{this.showLifeYearTooltip(S,o,o-e)}),y.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(y)}for(let o=e;o<=r;o+=10){let d=(o-e)/i*2*Math.PI-Math.PI/2,h=nt+12,u=b+h*Math.cos(d),g=b+h*Math.sin(d),p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x",String(u)),p.setAttribute("y",String(g)),p.setAttribute("class","rc-life-year-label"),p.setAttribute("text-anchor","middle"),p.setAttribute("dominant-baseline","central"),p.textContent=String(o),t.appendChild(p)}}renderLifePhasesRing(t,e,r){if(!this.config)return;let a=this.config.settings.lifePhasesFolder;if(!a||a.trim()==="")return;let i=this.config.service.loadLifePhases(a);if(i.length===0)return;let s=this.config.settings.birthDate,o=this.config.service.computeLifePhaseSegments(i,e,r,s),l=new Map,d=[];for(let f of o)if(f.category){let S=l.get(f.category)||[];S.push(f),l.set(f.category,S)}else d.push(f);let h=Array.from(l.keys()).sort(),u=h.length,g=tt(d),p=d.length>0?et(g):0,m=u+p;if(m===0)return;let y=this.getOrCreateDefs(t);h.forEach((f,S)=>{let v=l.get(f)||[],D=tt(v),A=et(D);for(let E of D){let T=rt-S/m*(rt-Tt),k=rt-(S+1)/m*(rt-Tt),H=X(T,k,A,E.track);this.renderLifePhaseArcWithRadii(t,y,E,H)}});for(let f of g){let S=rt-u/m*(rt-Tt),D=X(S,Tt,p,f.track);this.renderLifePhaseArcWithRadii(t,y,f,D)}}getOrCreateDefs(t){let e=t.querySelector("defs");return e||(e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(e,t.firstChild)),e}renderLifePhaseArcWithRadii(t,e,r,a){if(r.isOngoing&&r.todayAngle!==void 0&&r.todayAngle>r.startAngle){let i=this.createArcPath(a.inner,a.outer,r.startAngle,r.todayAngle),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",i),s.setAttribute("class","rc-life-phase"),s.style.fill=r.color,s.style.opacity="1";let o=this.createArcPath(a.inner,a.outer,r.todayAngle,r.endAngle),l=document.createElementNS("http://www.w3.org/2000/svg","path");if(l.setAttribute("d",o),l.setAttribute("class","rc-life-phase rc-life-phase-future"),l.style.fill=r.color,l.style.opacity="0.35",r.filePath){s.style.cursor="pointer",l.style.cursor="pointer";let u=()=>{var g;return(g=this.config)==null?void 0:g.openFile(r.filePath)};s.addEventListener("click",u),l.addEventListener("click",u)}let d=u=>this.showPhaseTooltip(u,r),h=()=>this.hideTooltip();s.addEventListener("mouseenter",d),s.addEventListener("mouseleave",h),l.addEventListener("mouseenter",d),l.addEventListener("mouseleave",h),t.appendChild(s),t.appendChild(l)}else{let i=this.createArcPath(a.inner,a.outer,r.startAngle,r.endAngle),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",i),s.setAttribute("class","rc-life-phase"),s.style.fill=r.color,r.filePath&&(s.style.cursor="pointer",s.addEventListener("click",()=>{var o;(o=this.config)==null||o.openFile(r.filePath)})),s.addEventListener("mouseenter",o=>{this.showPhaseTooltip(o,r)}),s.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(s)}r.label&&r.endAngle-r.startAngle>.15&&this.renderPhaseLabel(t,r,a)}createPhaseGradient(t,e,r){let a=r.endAngle-r.startAngle,i=(r.todayAngle-r.startAngle)/a,s=Math.max(0,Math.min(100,i*100)),o=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");o.setAttribute("id",e);let l=(r.startAngle+r.endAngle)/2-Math.PI/2,d=50+50*Math.cos(r.startAngle-Math.PI/2),h=50+50*Math.sin(r.startAngle-Math.PI/2),u=50+50*Math.cos(r.endAngle-Math.PI/2),g=50+50*Math.sin(r.endAngle-Math.PI/2);o.setAttribute("x1",`${d}%`),o.setAttribute("y1",`${h}%`),o.setAttribute("x2",`${u}%`),o.setAttribute("y2",`${g}%`);let p=document.createElementNS("http://www.w3.org/2000/svg","stop");p.setAttribute("offset","0%"),p.setAttribute("stop-color",r.color),p.setAttribute("stop-opacity","1"),o.appendChild(p);let m=document.createElementNS("http://www.w3.org/2000/svg","stop");m.setAttribute("offset",`${s}%`),m.setAttribute("stop-color",r.color),m.setAttribute("stop-opacity","1"),o.appendChild(m);let y=document.createElementNS("http://www.w3.org/2000/svg","stop");y.setAttribute("offset",`${s+1}%`),y.setAttribute("stop-color",r.color),y.setAttribute("stop-opacity","0.4"),o.appendChild(y);let f=document.createElementNS("http://www.w3.org/2000/svg","stop");f.setAttribute("offset","100%"),f.setAttribute("stop-color",r.color),f.setAttribute("stop-opacity","0.15"),o.appendChild(f),t.appendChild(o)}renderPhaseLabel(t,e,r){let a=(e.startAngle+e.endAngle)/2-Math.PI/2,i=(r.inner+r.outer)/2,s=b+i*Math.cos(a),o=b+i*Math.sin(a),l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",String(s)),l.setAttribute("y",String(o)),l.setAttribute("class","rc-phase-label"),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","central");let d=(a+Math.PI/2)*180/Math.PI,h=d>90&&d<270?d+180:d;l.setAttribute("transform",`rotate(${h}, ${s}, ${o})`),l.textContent=e.label,t.appendChild(l)}showPhaseTooltip(t,e){if(!this.tooltipEl)return;let r=`<div class="rc-tooltip-date">${e.label}</div>`;e.isOngoing&&(r+='<div class="rc-tooltip-note" style="color: var(--text-accent);">Active (ongoing)</div>'),this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block",this.centerTooltip()}renderYearRing(t,e){if(!this.config)return;let r=P();for(let s=1;s<=12;s++){let o=C(e,s),l=this.monthToAngle(s),h=Math.PI/6/o,u=r.year===e&&r.month===s;for(let g=1;g<=o;g++){let p=M(e,s,g),m=$(p),y=u&&r.day===g,f=m===0||m===6,S=l+(g-1)*h,v=S+h-.002,D=this.config.service.getEntriesForDate(p),A=this.createArcPath(_,G,S,v),E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("d",A);let T=["rc-day-arc"];y&&T.push("rc-day-arc--today"),f&&T.push("rc-day-arc--weekend"),D.length>0&&T.push("rc-day-arc--has-notes"),E.setAttribute("class",T.join(" ")),E.addEventListener("click",async()=>{var k;await((k=this.config)==null?void 0:k.service.openDailyNote(p))}),E.addEventListener("mouseenter",k=>{this.showTooltip(k,p,D)}),E.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(E)}}for(let s=1;s<=12;s++){let o=this.monthToAngle(s)-Math.PI/2,l=b+_*Math.cos(o),d=b+_*Math.sin(o),h=b+G*Math.cos(o),u=b+G*Math.sin(o),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",String(l)),g.setAttribute("y1",String(d)),g.setAttribute("x2",String(h)),g.setAttribute("y2",String(u)),g.setAttribute("class","rc-month-separator"),t.appendChild(g)}let i=(G-_)*.1;for(let s=0;s<12;s++){let o=this.monthToAngle(s+1)+Math.PI/12-Math.PI/2,l=_-15,d=b+l*Math.cos(o),h=b+l*Math.sin(o),u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",String(d)),u.setAttribute("y",String(h)),u.setAttribute("class","rc-month-label"),u.setAttribute("text-anchor","middle"),u.setAttribute("dominant-baseline","central"),u.style.fontSize=`${i}px`,u.textContent=Oe[s],t.appendChild(u)}}renderLifeActsOnRing(t,e,r){if(!this.config)return;let a=this.config.settings.lifeActs;if(a.length!==0)for(let i of a){let s=i.startAge/r*2*Math.PI,o=i.endAge/r*2*Math.PI-.01,l=this.createArcPath(nt+2,nt+8,s,o),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",l),d.setAttribute("class","rc-life-act"),i.color&&(d.style.fill=N[i.color]),t.appendChild(d);let h=(s+o)/2-Math.PI/2,u=nt+18,g=b+u*Math.cos(h),p=b+u*Math.sin(h),m=document.createElementNS("http://www.w3.org/2000/svg","text");m.setAttribute("x",String(g)),m.setAttribute("y",String(p)),m.setAttribute("class","rc-life-act-label"),m.setAttribute("text-anchor","middle"),m.setAttribute("dominant-baseline","central");let y=(h+Math.PI/2)*180/Math.PI,f=y>90&&y<270?y+180:y;m.setAttribute("transform",`rotate(${f}, ${g}, ${p})`),i.color&&(m.style.fill=N[i.color]),m.textContent=i.label,t.appendChild(m)}}renderLifePositionMarker(t,e,r,a,i){let s=a-e;if(i==="today"){let y=P(),f=y.year%4===0&&y.year%100!==0||y.year%400===0,S=f?366:365,v=[0,31,28,31,30,31,30,31,31,30,31,30,31];f&&(v[2]=29);let D=y.day;for(let A=1;A<y.month;A++)D+=v[A];s+=D/S}let o=s/r*2*Math.PI-Math.PI/2,l=Ye-5,d=nt+5,h=b+l*Math.cos(o),u=b+l*Math.sin(o),g=b+d*Math.cos(o),p=b+d*Math.sin(o),m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",String(h)),m.setAttribute("y1",String(u)),m.setAttribute("x2",String(g)),m.setAttribute("y2",String(p)),m.setAttribute("class",i==="today"?"rc-life-marker--today":"rc-life-marker--viewed"),t.appendChild(m)}renderTodayMarkerOnYearRing(t){let e=P(),r=C(e.year,e.month),a=this.monthToAngle(e.month),s=Math.PI/6/r,o=a+(e.day-.5)*s-Math.PI/2,l=b+(_-5)*Math.cos(o),d=b+(_-5)*Math.sin(o),h=b+(G+5)*Math.cos(o),u=b+(G+5)*Math.sin(o),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",String(l)),g.setAttribute("y1",String(d)),g.setAttribute("x2",String(h)),g.setAttribute("y2",String(u)),g.setAttribute("class","rc-today-marker"),t.appendChild(g)}renderBirthdayMarkerOnYearRing(t,e){if(!this.config)return;let r=this.config.settings.birthDate;if(!r)return;let a=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!a)return;let i=parseInt(a[2],10),s=parseInt(a[3],10),o=C(e,i),l=this.monthToAngle(i),h=Math.PI/6/o,u=l+(s-.5)*h-Math.PI/2,g=b+(_-3)*Math.cos(u),p=b+(_-3)*Math.sin(u),m=b+(G+3)*Math.cos(u),y=b+(G+3)*Math.sin(u),f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",String(g)),f.setAttribute("y1",String(p)),f.setAttribute("x2",String(m)),f.setAttribute("y2",String(y)),f.setAttribute("class","rc-birthday-marker"),t.appendChild(f);let S=G+12,v=b+S*Math.cos(u),D=b+S*Math.sin(u),A=document.createElementNS("http://www.w3.org/2000/svg","text");A.setAttribute("x",String(v)),A.setAttribute("y",String(D)),A.setAttribute("class","rc-birthday-icon"),A.setAttribute("text-anchor","middle"),A.setAttribute("dominant-baseline","central"),A.textContent="\u{1F382}",t.appendChild(A)}renderNestedCenter(t,e,r){let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",String(b)),a.setAttribute("cy",String(b)),a.setAttribute("r",String(bn-10)),a.setAttribute("class","rc-center"),t.appendChild(a);let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",String(b)),i.setAttribute("y",String(b-20)),i.setAttribute("class","rc-center-year"),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","central"),i.textContent=String(e),t.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(b)),s.setAttribute("y",String(b+20)),s.setAttribute("class","rc-center-age"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=`${r} years`,t.appendChild(s)}showLifeYearTooltip(t,e,r){if(!this.tooltipEl)return;let a=`<div class="rc-tooltip-date">${e}</div>
      <div class="rc-tooltip-note">Age: ${r} years</div>`;this.tooltipEl.innerHTML=a,this.tooltipEl.style.display="block",this.centerTooltip()}renderAnnualView(t,e){this.renderBackgroundCircle(t);let r=this.getEnabledRingsSorted(),a=this.calculateRingRadii(r.length);for(let i of r){let s=a.get(i.order);s&&(this.renderRing(t,e,i,s),this.renderRingSeparator(t,s.innerRadius))}for(let i=1;i<=12;i++)this.renderMonthSeparator(t,this.monthToAngle(i));this.renderLabelRingSeparator(t),this.renderOuterSegments(t,e),this.renderCenter(t,e),this.renderMonthLabels(t),this.renderTodayMarker(t,e),this.renderYearBoundaryMarker(t)}renderYearBoundaryMarker(t){let e=-Math.PI/2,r=b+(Y-5)*Math.cos(e),a=b+(Y-5)*Math.sin(e),i=b+(I+5)*Math.cos(e),s=b+(I+5)*Math.sin(e),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(r)),o.setAttribute("y1",String(a)),o.setAttribute("x2",String(i)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-year-boundary-marker"),t.appendChild(o);let l=b-I-12,d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("x",String(b)),d.setAttribute("y",String(l)),d.setAttribute("class","rc-year-boundary-label"),d.setAttribute("text-anchor","middle"),d.setAttribute("dominant-baseline","central"),d.textContent="\u25BC",t.appendChild(d)}renderLabelRingSeparator(t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(b)),e.setAttribute("cy",String(b)),e.setAttribute("r",String(ie)),e.setAttribute("class","rc-label-ring-separator"),t.appendChild(e)}renderRingSeparator(t,e){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(b)),r.setAttribute("cy",String(b)),r.setAttribute("r",String(e)),r.setAttribute("class","rc-ring-separator"),t.appendChild(r)}renderAnniversaryRing(t,e){var i;if(!this.config)return;let r=this.config.service.getAllAnniversaryEntries();if(r.length===0)return;let a=new Map;for(let s of r){let o=`${String(s.startDate.month).padStart(2,"0")}-${String(s.startDate.day).padStart(2,"0")}`,l=(i=a.get(o))!=null?i:[];l.push(s),a.set(o,l)}for(let[s,o]of a){let[l,d]=s.split("-"),h=parseInt(l,10),u=parseInt(d,10),g=C(e,h),p=this.monthToAngle(h),m=Math.PI/6,y=(u-.5)/g,f=p+y*m,S=b+je*Math.cos(f-Math.PI/2),v=b+je*Math.sin(f-Math.PI/2),D=document.createElementNS("http://www.w3.org/2000/svg","circle");D.setAttribute("cx",String(S)),D.setAttribute("cy",String(v)),D.setAttribute("r",String(vn)),D.setAttribute("class","rc-anniversary-dot");let A=o[0];D.addEventListener("mouseenter",E=>{this.showAnniversaryTooltip(E,o)}),D.addEventListener("mouseleave",()=>this.hideTooltip()),D.addEventListener("click",()=>{var E,T;o.length===1?(E=this.config)==null||E.openFile(A.filePath):(T=this.config)==null||T.openFile(A.filePath)}),t.appendChild(D)}}showAnniversaryTooltip(t,e){if(!this.tooltipEl||e.length===0)return;let r='<div class="rc-tooltip-date">\u{1F4C5}</div>';r+='<div class="rc-tooltip-notes">';for(let a of e.slice(0,5))r+=`<div class="rc-tooltip-note">${a.displayName}</div>`;e.length>5&&(r+=`<div class="rc-tooltip-more">+${e.length-5} more</div>`),r+="</div>",this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block",this.centerTooltip()}getEnabledRingsSorted(){if(!this.config)return[];let t=[],e=this.config.settings.dailyNoteFolder;t.push({id:"__daily_notes__",name:"Daily Notes",folder:(e==null?void 0:e.trim())||"",color:"blue",segmentType:"daily",enabled:!0,order:0});let r=this.config.settings.rings.filter(s=>s.enabled).sort((s,o)=>s.order-o.order).map((s,o)=>({...s,order:o+1}));t.push(...r);let i=(this.config.settings.calendarSources||[]).filter(s=>s.enabled&&s.showAsRing!==!1&&s.folder).map((s,o)=>({id:`__calendar_${s.id}__`,name:s.name,folder:s.folder,color:s.color,segmentType:"daily",enabled:!0,order:t.length+o,showSpanningArcs:s.showSpanningArcs!==!1,startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label"}));return t.push(...i),t}calculateRingRadii(t){let e=new Map;if(t===0)return e;let r=(t-1)*Ge,a=I-ie-r,i=Math.max(Sn,a/t);for(let s=0;s<t;s++){let o=I-s*(i+Ge),l=Math.max(ie,o-i);e.set(s,{outerRadius:o,innerRadius:l})}return e}renderRing(t,e,r,a){if(!this.config)return;let i=N[r.color]||N.blue,s=a.outerRadius-a.innerRadius;if(r.showSpanningArcs){let o=this.config.service.loadSpanningArcs(r.folder,e,{startDateField:r.startDateField||"radcal-start",endDateField:r.endDateField||"radcal-end",colorField:r.colorField||"radcal-color",labelField:r.labelField||"radcal-label"}),l=o.length>0?tt(o):[],d=l.length>0?et(l):0,h=d>0,u=this.ringHasDailyNotes(r,e);if(u&&!h)for(let g=1;g<=12;g++)this.renderRingMonthSegment(t,e,g,r,a,i);else if(h&&!u)for(let g of l){let p=X(a.outerRadius,a.innerRadius,d,g.track);this.renderSpanningArc(t,g,p,r,i)}else if(h&&u){let y=d*.15,f=Math.min(.6,y),S=Math.max(.4,1-f),v={innerRadius:a.innerRadius,outerRadius:a.innerRadius+s*S};for(let E=1;E<=12;E++)this.renderRingMonthSegment(t,e,E,r,v,i);let D=a.outerRadius,A=v.outerRadius;for(let E of l){let T=X(D,A,d,E.track);this.renderSpanningArc(t,E,T,r,i)}}else this.renderEmptyRingBackground(t,a)}else for(let o=1;o<=12;o++)this.renderRingMonthSegment(t,e,o,r,a,i)}ringHasDailyNotes(t,e){if(!this.config)return!1;for(let r=1;r<=12;r++){let a=M(e,r,1);if(this.getEntriesForRing(a,t).length>0)return!0;let s=M(e,r,15);if(this.getEntriesForRing(s,t).length>0)return!0}return!1}renderSpanningArcsRing(t,e,r,a,i){if(!this.config)return;let s=this.config.service.loadSpanningArcs(r.folder,e,{startDateField:r.startDateField||"radcal-start",endDateField:r.endDateField||"radcal-end",colorField:r.colorField||"radcal-color",labelField:r.labelField||"radcal-label"});if(s.length===0){this.renderEmptyRingBackground(t,a);return}let o=tt(s),l=et(o);for(let d of o){let h=X(a.outerRadius,a.innerRadius,l,d.track);this.renderSpanningArc(t,d,h,r,i)}}renderEmptyRingBackground(t,e){let r=this.createArcPath(e.innerRadius,e.outerRadius,0,2*Math.PI-.001),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",r),a.setAttribute("class","rc-ring-arc"),a.style.fill="var(--background-secondary)",a.style.fillOpacity="0.3",t.appendChild(a)}renderSpanningArc(t,e,r,a,i){if(!this.config)return;let s=this.createArcPath(r.inner,r.outer,e.startAngle,e.endAngle),o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",s),o.setAttribute("class","rc-ring-arc");let l=e.color||i;o.style.fill=l,e.filePath&&(o.style.cursor="pointer",o.addEventListener("click",()=>{var d;(d=this.config)==null||d.openFile(e.filePath)})),o.addEventListener("mouseenter",d=>{this.showSpanningArcTooltip(d,e,a)}),o.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(o),e.continuesFromPreviousYear&&this.renderCrossYearIndicator(t,r,0,l,"start"),e.continuesIntoNextYear&&this.renderCrossYearIndicator(t,r,2*Math.PI-.001,l,"end"),e.label&&e.endAngle-e.startAngle>.26&&this.renderSpanningArcLabel(t,e,r)}renderCrossYearIndicator(t,e,r,a,i){let s=r-Math.PI/2,l=(e.outer-e.inner)*.6,d=i==="end"?e.outer:e.inner,h=b+d*Math.cos(s),u=b+d*Math.sin(s),g=s+Math.PI/2,p=i==="end"?1:-1,m=i==="end"?-1:1,y=h+p*l*.6*Math.cos(g),f=u+p*l*.6*Math.sin(g),S=p*l*.3,v=h-S*Math.cos(g),D=u-S*Math.sin(g),A=l*.4,E=v+m*A*Math.cos(s),T=D+m*A*Math.sin(s),k=v-m*A*Math.cos(s),H=D-m*A*Math.sin(s),jt=`${y},${f} ${E},${T} ${k},${H}`,Q=document.createElementNS("http://www.w3.org/2000/svg","polygon");Q.setAttribute("points",jt),Q.setAttribute("class","rc-cross-year-indicator"),Q.style.fill=a,t.appendChild(Q)}renderSpanningArcLabel(t,e,r){let a=(e.startAngle+e.endAngle)/2-Math.PI/2,i=(r.inner+r.outer)/2,s=b+i*Math.cos(a),o=b+i*Math.sin(a),l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",String(s)),l.setAttribute("y",String(o)),l.setAttribute("class","rc-phase-label"),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","central");let d=(a+Math.PI/2)*180/Math.PI,h=d>90&&d<270?d+180:d;l.setAttribute("transform",`rotate(${h}, ${s}, ${o})`),l.textContent=e.label,t.appendChild(l)}showSpanningArcTooltip(t,e,r){if(!this.tooltipEl)return;let a=`<div class="rc-tooltip-ring" style="color: ${e.color}">${r.name}</div>`;a+=`<div class="rc-tooltip-date">${e.label}</div>`,this.tooltipEl.innerHTML=a,this.tooltipEl.style.display="block",this.centerTooltip()}renderRingMonthSegment(t,e,r,a,i,s){if(!this.config)return;let o=C(e,r),l=this.monthToAngle(r),h=Math.PI/6/o,u=P(),g=u.year===e&&u.month===r,p=this.config.service.getEntriesForDate(M(e,r,1));for(let m=1;m<=o;m++){let y=M(e,r,m),f=$(y),S=g&&u.day===m,v=f===0||f===6,D=l+(m-1)*h,A=D+h-.002,E=this.getEntriesForRing(y,a);this.renderRingDayArc(t,y,D,A,S,v,E,i,s,a)}}getEntriesForRing(t,e){if(!this.config)return[];let r=this.config.service.getEntriesForDate(t);if(!e.folder||e.folder.trim()==="")return r;let a=e.folder.replace(/^\/+|\/+$/g,"");return r.filter(i=>{let o=(i.metadata.folder||"").replace(/^\/+|\/+$/g,"");return o===a||o.startsWith(a+"/")})}renderRingDayArc(t,e,r,a,i,s,o,l,d,h){if(!this.config)return;let g=(l.outerRadius-l.innerRadius)*.1,p=l.outerRadius-g,m=this.config.service.getAnniversaryEntriesForDate(e),y=m.length>0,f=this.createArcPath(l.innerRadius,p,r,a),S=document.createElementNS("http://www.w3.org/2000/svg","path");S.setAttribute("d",f);let v=["rc-day-arc",`rc-ring-${h.order}`];i&&v.push("rc-day-arc--today"),s&&v.push("rc-day-arc--weekend"),o.length>0&&v.push("rc-day-arc--has-notes"),o.length>3&&v.push("rc-day-arc--many-notes"),S.setAttribute("class",v.join(" ")),S.setAttribute("data-date",`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`),S.setAttribute("data-ring",h.id),o.length>0&&(S.style.fill=d,S.style.fillOpacity="0.6"),S.addEventListener("click",async D=>{var A;D.preventDefault(),o.length>0?this.showDayContextMenu(D,e,o):await((A=this.config)==null?void 0:A.service.openDailyNote(e))}),S.addEventListener("mouseenter",D=>{this.showRingTooltip(D,e,o,h)}),S.addEventListener("mouseleave",()=>{this.hideTooltip()}),S.addEventListener("contextmenu",D=>{D.preventDefault(),this.showDayContextMenu(D,e,o)}),t.appendChild(S),y&&this.renderAnniversaryIndicator(t,r,a,p,l.outerRadius,m,e)}renderAnniversaryIndicator(t,e,r,a,i,s,o){if(!this.config)return;let l=this.createArcPath(a,i,e,r),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",l),d.setAttribute("class","rc-anniversary-indicator"),d.addEventListener("click",h=>{var u;h.stopPropagation(),s.length===1?(u=this.config)==null||u.openFile(s[0].filePath):s.length>1&&this.showAnniversaryMenu(h,s)}),d.addEventListener("mouseenter",h=>{this.showAnniversaryTooltip(h,s)}),d.addEventListener("mouseleave",()=>{this.hideTooltip()}),t.appendChild(d)}showAnniversaryMenu(t,e){if(!this.config)return;let r=new dt.Menu;for(let a of e.slice(0,15))r.addItem(i=>{i.setTitle(a.displayName).setIcon("cake").onClick(()=>{var s;(s=this.config)==null||s.openFile(a.filePath)})});e.length>15&&r.addItem(a=>{a.setTitle(`+${e.length-15} more...`).setDisabled(!0)}),r.showAtMouseEvent(t)}showRingTooltip(t,e,r,a){if(!this.tooltipEl)return;let o=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][$(e)]}, ${se[e.month-1]} ${e.day}, ${e.year}`}</div>`;if(o+=`<div class="rc-tooltip-ring" style="color: ${N[a.color]}">${a.name}</div>`,r.length>0){o+='<div class="rc-tooltip-notes">';for(let l of r.slice(0,5))o+=`<div class="rc-tooltip-note">${l.displayName}</div>`;r.length>5&&(o+=`<div class="rc-tooltip-more">+${r.length-5} more</div>`),o+="</div>"}this.tooltipEl.innerHTML=o,this.tooltipEl.style.display="block",this.centerTooltip()}renderBackgroundCircle(t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(b)),e.setAttribute("cy",String(b)),e.setAttribute("r",String(I)),e.setAttribute("class","rc-background"),t.appendChild(e)}renderCenter(t,e){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(b)),r.setAttribute("cy",String(b)),r.setAttribute("r",String(Y-10)),r.setAttribute("class","rc-center"),t.appendChild(r)}renderMonthLabels(t){let e=le*.4;for(let r=0;r<12;r++){let a=this.monthToAngle(r+1)+Math.PI/12,i=b+Be*Math.cos(a-Math.PI/2),s=b+Be*Math.sin(a-Math.PI/2),o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x",String(i)),o.setAttribute("y",String(s)),o.setAttribute("class","rc-month-label"),o.setAttribute("text-anchor","middle"),o.setAttribute("dominant-baseline","central"),o.style.fontSize=`${e}px`,o.textContent=Oe[r],t.appendChild(o)}}renderMonthSegment(t,e,r){if(!this.config)return;let a=C(e,r),i=this.monthToAngle(r),o=Math.PI/6/a,l=P(),d=l.year===e&&l.month===r;for(let h=1;h<=a;h++){let u=M(e,r,h),g=$(u),p=d&&l.day===h,m=g===0||g===6,y=i+(h-1)*o,f=y+o-.002,S=this.config.service.getEntriesForDate(u);this.renderDayArc(t,u,y,f,p,m,S)}this.renderMonthSeparator(t,i)}renderDayArc(t,e,r,a,i,s,o){if(!this.config)return;let l=Y,d=I,h=this.createArcPath(l,d,r,a),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",h);let g=["rc-day-arc"];i&&g.push("rc-day-arc--today"),s&&g.push("rc-day-arc--weekend"),o.length>0&&g.push("rc-day-arc--has-notes"),o.length>3&&g.push("rc-day-arc--many-notes"),u.setAttribute("class",g.join(" ")),u.setAttribute("data-date",`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`),u.addEventListener("click",async p=>{var m;p.preventDefault(),await((m=this.config)==null?void 0:m.service.openDailyNote(e))}),u.addEventListener("mouseenter",p=>{this.showTooltip(p,e,o)}),u.addEventListener("mouseleave",()=>{this.hideTooltip()}),u.addEventListener("contextmenu",p=>{p.preventDefault(),o.length>0&&this.showDayContextMenu(p,e,o)}),t.appendChild(u),o.length>0&&this.renderNoteIndicators(t,r,a,o)}renderNoteIndicators(t,e,r,a){let i=I-15,s=I-5,o=Math.min(a.length,3),l=(r-e)/o;for(let d=0;d<o;d++){let h=e+d*l+.001,u=h+l-.002,g=this.createArcPath(i,s,h,u),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",g),p.setAttribute("class","rc-note-indicator"),t.appendChild(p)}}renderMonthSeparator(t,e){let r=b+Y*Math.cos(e-Math.PI/2),a=b+Y*Math.sin(e-Math.PI/2),i=b+I*Math.cos(e-Math.PI/2),s=b+I*Math.sin(e-Math.PI/2),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(r)),o.setAttribute("y1",String(a)),o.setAttribute("x2",String(i)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-month-separator"),t.appendChild(o)}renderTodayMarker(t,e){let r=P();if(r.year!==e)return;let a=C(e,r.month),i=this.monthToAngle(r.month),o=Math.PI/6/a,l=i+(r.day-.5)*o,d=b+(Y-10)*Math.cos(l-Math.PI/2),h=b+(Y-10)*Math.sin(l-Math.PI/2),u=b+(I+5)*Math.cos(l-Math.PI/2),g=b+(I+5)*Math.sin(l-Math.PI/2),p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttribute("x1",String(d)),p.setAttribute("y1",String(h)),p.setAttribute("x2",String(u)),p.setAttribute("y2",String(g)),p.setAttribute("class","rc-today-marker"),t.appendChild(p)}createArcPath(t,e,r,a){let i=r-Math.PI/2,s=a-Math.PI/2,o=b+t*Math.cos(i),l=b+t*Math.sin(i),d=b+t*Math.cos(s),h=b+t*Math.sin(s),u=b+e*Math.cos(i),g=b+e*Math.sin(i),p=b+e*Math.cos(s),m=b+e*Math.sin(s),y=a-r>Math.PI?1:0;return`
      M ${o} ${l}
      L ${u} ${g}
      A ${e} ${e} 0 ${y} 1 ${p} ${m}
      L ${d} ${h}
      A ${t} ${t} 0 ${y} 0 ${o} ${l}
      Z
    `}monthToAngle(t){return(t-1)*Math.PI/6}showTooltip(t,e,r){if(!this.tooltipEl)return;let s=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][$(e)]}, ${se[e.month-1]} ${e.day}, ${e.year}`}</div>`;if(r.length>0){s+='<div class="rc-tooltip-notes">';for(let o of r.slice(0,5))s+=`<div class="rc-tooltip-note">${o.displayName}</div>`;r.length>5&&(s+=`<div class="rc-tooltip-more">+${r.length-5} more</div>`),s+="</div>"}this.tooltipEl.innerHTML=s,this.tooltipEl.style.display="block",this.centerTooltip()}hideTooltip(){this.tooltipEl&&(this.tooltipEl.style.display="none")}centerTooltip(){if(!this.tooltipEl||!this.containerEl_)return;let t=this.containerEl_.getBoundingClientRect();this.tooltipEl.style.left="50%",this.tooltipEl.style.top="50%",this.tooltipEl.style.transform="translate(-50%, -50%)"}showDayContextMenu(t,e,r){if(!this.config)return;let a=new dt.Menu;a.addItem(i=>{i.setTitle(`Open ${se[e.month-1]} ${e.day}`).setIcon("calendar").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(e))})}),a.addSeparator();for(let i of r.slice(0,10))a.addItem(s=>{s.setTitle(i.displayName).setIcon("file").onClick(()=>{var o;(o=this.config)==null||o.openFile(i.filePath)})});r.length>10&&a.addItem(i=>{i.setTitle(`+${r.length-10} more...`).setDisabled(!0)}),a.showAtMouseEvent(t)}renderOuterSegments(t,e){if(!this.config)return;let r=this.getSegmentsForCurrentView();if(r.length!==0)for(let a of r)this.renderSegmentTick(t,a,e)}getSegmentsForCurrentView(){if(!this.config)return[];let t=this.config.settings;if(t.currentView==="life")return this.lifeActsToSegments(t.lifeActs);switch(t.annualSegmentType){case"seasons":return Qt;case"quarters":return Zt;case"semester":return te;case"ten-days":return ee();case"weeks":return ne();case"custom":return t.customSegments;case"none":default:return[]}}lifeActsToSegments(t){if(!this.config)return[];let{birthYear:e,expectedLifespan:r}=this.config.settings,a=r;return t.map(i=>{let s=Math.floor(i.startAge/a*365)+1,o=Math.floor(i.endAge/a*365);return{id:i.id,label:i.label,startDay:s,endDay:o,color:i.color}})}renderSegmentTick(t,e,r){if(!this.config)return;let a=this.config.settings.showSegmentLabels,i=this.dayOfYearToAngle(e.startDay),s=e.endDay>e.startDay?this.dayOfYearToAngle(e.endDay):this.dayOfYearToAngle(e.endDay)+2*Math.PI,o=i-Math.PI/2,l=b+_e*Math.cos(o),d=b+_e*Math.sin(o),h=b+We*Math.cos(o),u=b+We*Math.sin(o),g=document.createElementNS("http://www.w3.org/2000/svg","line");if(g.setAttribute("x1",String(l)),g.setAttribute("y1",String(d)),g.setAttribute("x2",String(h)),g.setAttribute("y2",String(u)),g.setAttribute("class","rc-segment-tick"),e.color&&(g.style.stroke=N[e.color]),t.appendChild(g),a){let p;e.endDay>e.startDay?p=(i+s)/2:(p=(i+s)/2,p>2*Math.PI&&(p-=2*Math.PI));let m=p-Math.PI/2,y=b+He*Math.cos(m),f=b+He*Math.sin(m),S=document.createElementNS("http://www.w3.org/2000/svg","text");S.setAttribute("x",String(y)),S.setAttribute("y",String(f)),S.setAttribute("class","rc-segment-label"),S.setAttribute("text-anchor","middle"),S.setAttribute("dominant-baseline","central");let v=p*180/Math.PI,D=v>90&&v<270?v+180:v;S.setAttribute("transform",`rotate(${D}, ${y}, ${f})`),e.color&&(S.style.fill=N[e.color]),S.textContent=e.label,t.appendChild(S)}}dayOfYearToAngle(t){return(t-1)/365*2*Math.PI}};var Nt=require("obsidian");V();var Dn=["January","February","March","April","May","June","July","August","September","October","November","December"],pt="local-calendar-view",ce=300,x=ce/2,ht=140,Pt=115,gt=105,at=40,wn=35,It=class extends Nt.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.activeFileDate=null}getViewType(){return pt}getDisplayText(){return"Local Calendar"}getIcon(){return"clock"}initialize(t){this.config=t,this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updateActiveFileDate(),this.render()})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.updateActiveFileDate(),this.render()}))}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("local-calendar-view"),this.updateActiveFileDate(),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null}updateActiveFileDate(){this.config&&(this.activeFileDate=this.config.getActiveFileDate())}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let t=this.containerEl_.createDiv({cls:"lc-container"}),e=t.createDiv({cls:"lc-title"});this.activeFileDate?e.textContent=`${this.activeFileDate.day}.${this.activeFileDate.month}.${this.activeFileDate.year}`:e.textContent="Keine Datums-Notiz";let r=t.createDiv({cls:"lc-wrapper"});this.renderNestedClock(r)}renderNestedClock(t){if(!this.config)return;let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox",`0 0 ${ce} ${ce}`),e.setAttribute("class","lc-svg"),this.svgEl=e;let{birthYear:r,expectedLifespan:a}=this.config.settings,i=r+a,s=P(),o=this.activeFileDate||s,l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttribute("cx",String(x)),l.setAttribute("cy",String(x)),l.setAttribute("r",String(ht)),l.setAttribute("class","lc-background"),e.appendChild(l),this.renderLifeRing(e,r,i,o.year,s.year),this.renderYearRing(e,o,s),this.renderCenter(e,o),this.activeFileDate&&this.renderNoteMarkers(e,r,a,this.activeFileDate),(!this.activeFileDate||this.activeFileDate.year!==s.year||this.activeFileDate.month!==s.month||this.activeFileDate.day!==s.day)&&this.renderTodayMarkers(e,r,a,s),t.appendChild(e)}renderLifeRing(t,e,r,a,i){let s=r-e;for(let o=0;o<s;o+=10){let l=o/s*2*Math.PI,d=Math.min((o+10)/s*2*Math.PI,2*Math.PI)-.02,h=this.createArcPath(Pt,ht,l,d),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",h);let g=e+o,p=g+10<=i,m=g<=i&&i<g+10,y="lc-life-decade";p&&(y+=" lc-life-decade--past"),m&&(y+=" lc-life-decade--current"),u.setAttribute("class",y),t.appendChild(u);let f=(o+5)/s*2*Math.PI-Math.PI/2,S=(Pt+ht)/2,v=x+S*Math.cos(f),D=x+S*Math.sin(f),A=document.createElementNS("http://www.w3.org/2000/svg","text");A.setAttribute("x",String(v)),A.setAttribute("y",String(D)),A.setAttribute("class","lc-decade-label"),A.setAttribute("text-anchor","middle"),A.setAttribute("dominant-baseline","central"),A.textContent=String(e+o),t.appendChild(A)}}renderYearRing(t,e,r){if(!this.config)return;let a=e.year;for(let s=1;s<=12;s++){let o=C(a,s),l=this.monthToAngle(s),h=Math.PI/6/o;for(let u=1;u<=o;u++){let g=M(a,s,u),p=$(g),m=r.year===a&&r.month===s&&r.day===u,y=e.month===s&&e.day===u,f=p===0||p===6,S=l+(u-1)*h,v=S+h-.002,D=this.config.service.getEntriesForDate(g),A=this.createArcPath(at,gt,S,v),E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("d",A);let T=["lc-day"];m&&T.push("lc-day--today"),y&&T.push("lc-day--note"),f&&T.push("lc-day--weekend"),D.length>0&&T.push("lc-day--has-notes"),D.length>2&&T.push("lc-day--many-notes"),E.setAttribute("class",T.join(" ")),E.style.cursor="pointer",E.addEventListener("click",k=>{var H;k.preventDefault(),k.stopPropagation(),D.length>0?this.showDayContextMenu(k,g,D):(H=this.config)==null||H.service.openDailyNote(g)}),t.appendChild(E)}}for(let s=1;s<=12;s++){let o=this.monthToAngle(s)-Math.PI/2,l=x+at*Math.cos(o),d=x+at*Math.sin(o),h=x+gt*Math.cos(o),u=x+gt*Math.sin(o),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",String(l)),g.setAttribute("y1",String(d)),g.setAttribute("x2",String(h)),g.setAttribute("y2",String(u)),g.setAttribute("class","lc-month-separator"),t.appendChild(g)}let i=["J","F","M","A","M","J","J","A","S","O","N","D"];for(let s=0;s<12;s++){let o=this.monthToAngle(s+1)+Math.PI/12-Math.PI/2,l=at-8,d=x+l*Math.cos(o),h=x+l*Math.sin(o),u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",String(d)),u.setAttribute("y",String(h)),u.setAttribute("class","lc-month-label"),u.setAttribute("text-anchor","middle"),u.setAttribute("dominant-baseline","central"),u.textContent=i[s],t.appendChild(u)}}monthToAngle(t){return(t-1)*Math.PI/6}renderCenter(t,e){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(x)),r.setAttribute("cy",String(x)),r.setAttribute("r",String(wn-5)),r.setAttribute("class","lc-center"),t.appendChild(r);let a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",String(x)),a.setAttribute("y",String(x)),a.setAttribute("class","lc-center-day"),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","central"),a.textContent=String(e.day),t.appendChild(a)}renderNoteMarkers(t,e,r,a){let s=(a.year-e)/r*2*Math.PI-Math.PI/2;this.drawMarker(t,s,Pt-3,ht+3,"lc-marker--note");let o=this.dateToAngle(a);this.drawMarker(t,o,at-3,gt+3,"lc-marker--note")}renderTodayMarkers(t,e,r,a){let s=(a.year-e)/r*2*Math.PI-Math.PI/2;this.drawMarker(t,s,Pt,ht,"lc-marker--today");let o=this.dateToAngle(a);this.drawMarker(t,o,at,gt,"lc-marker--today")}dateToAngle(t){let e=C(t.year,t.month),r=this.monthToAngle(t.month),i=Math.PI/6/e;return r+(t.day-.5)*i-Math.PI/2}drawMarker(t,e,r,a,i){let s=x+r*Math.cos(e),o=x+r*Math.sin(e),l=x+a*Math.cos(e),d=x+a*Math.sin(e),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(s)),h.setAttribute("y1",String(o)),h.setAttribute("x2",String(l)),h.setAttribute("y2",String(d)),h.setAttribute("class",i),t.appendChild(h)}showDayContextMenu(t,e,r){if(!this.config)return;let a=new Nt.Menu;if(a.addItem(i=>{i.setTitle(`${e.day}. ${Dn[e.month-1]} ${e.year}`).setIcon("calendar").setDisabled(!0)}),a.addSeparator(),a.addItem(i=>{i.setTitle("Neue Notiz erstellen").setIcon("plus").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(e))})}),r.length>0){a.addSeparator();for(let i of r.slice(0,10))a.addItem(s=>{s.setTitle(i.displayName).setIcon("file").onClick(async()=>{var o;await((o=this.config)==null?void 0:o.openFile(i.filePath))})});r.length>10&&a.addItem(i=>{i.setTitle(`+${r.length-10} weitere...`).setDisabled(!0)})}a.showAtMouseEvent(t)}createArcPath(t,e,r,a){let i=r-Math.PI/2,s=a-Math.PI/2,o=x+t*Math.cos(i),l=x+t*Math.sin(i),d=x+t*Math.cos(s),h=x+t*Math.sin(s),u=x+e*Math.cos(i),g=x+e*Math.sin(i),p=x+e*Math.cos(s),m=x+e*Math.sin(s),y=a-r>Math.PI?1:0;return`
      M ${o} ${l}
      L ${u} ${g}
      A ${e} ${e} 0 ${y} 1 ${p} ${m}
      L ${d} ${h}
      A ${t} ${t} 0 ${y} 0 ${o} ${l}
      Z
    `}};var st=require("obsidian");V();var ze={style:"annual",showLabels:!0,showToday:!0,showAnniversaries:!1,segments:"none"};function Ue(c){let n={...ze},t=c.trim().split(`
`),e=!1,r=!1,a=!1,i=0,s=[],o=[],l=[],d=null;for(let h of t){let u=h.trim();if(!u||u.startsWith("#"))continue;if(a)if(h.length-h.trimStart().length>i||u.startsWith("-")){s.push(h);continue}else a=!1,n.filter=kt(s);if(u.startsWith("- ")){if(e){d&&d.folder&&o.push({folder:d.folder,color:d.color||"blue",label:d.label});let f=u.match(/^-\s*folder:\s*["']?([^"'\n]+)["']?/);f?d={folder:f[1].trim()}:d={};continue}if(r){let f=u.slice(2).trim().replace(/["']/g,"");l.push(f);continue}}if(e&&d&&(h.startsWith("    ")||h.startsWith("	"))){let[f,...S]=u.split(":"),v=S.join(":").trim().replace(/["']/g,"");switch(f.trim()){case"folder":d.folder=v;break;case"color":d.color=v;break;case"label":d.label=v;break}continue}let g=u.indexOf(":");if(g===-1)continue;let p=u.slice(0,g).trim(),m=u.slice(g+1).trim();if(p==="rings"&&(!m||m==="")){d&&d.folder&&o.push({folder:d.folder,color:d.color||"blue",label:d.label}),e=!0,r=!1,d=null;continue}if(p==="folders"&&(!m||m==="")){r=!0,e=!1;continue}!h.startsWith(" ")&&!h.startsWith("	")&&!u.startsWith("-")&&(e&&d&&d.folder&&(o.push({folder:d.folder,color:d.color||"blue",label:d.label}),d=null),e=!1,r=!1);let y=m.replace(/["']/g,"");switch(p){case"year":n.year=parseInt(y,10);break;case"style":(y==="annual"||y==="life")&&(n.style=y);break;case"dateProperty":n.dateProperty=y;break;case"folder":n.folder=y;break;case"filter":case"filters":y?n.filter=y:(a=!0,i=h.indexOf(p));break;case"showLabels":n.showLabels=y==="true";break;case"showToday":n.showToday=y==="true";break;case"showAnniversaries":n.showAnniversaries=y==="true";break;case"segments":["none","seasons","quarters","weeks"].includes(y)&&(n.segments=y);break;case"birthYear":n.birthYear=parseInt(y,10);break;case"lifespan":n.lifespan=parseInt(y,10);break}}return d&&d.folder&&o.push({folder:d.folder,color:d.color||"blue",label:d.label}),a&&s.length>0&&(n.filter=kt(s)),o.length>0&&(n.rings=o),l.length>0&&(n.folders=l),n}function kt(c){let n={},t=null,e=[],r=[],a=-1;for(let i of c){let s=i.trim();if(!s)continue;let o=i.length-i.trimStart().length;if(a>=0)if(o>a){r.push(i);continue}else r.length>0&&(e.push(kt(r)),r=[]),a=-1;if(s==="and:"||s==="or:"||s==="not:"){t&&e.length>0&&(n[t]=[...e],e.length=0),t=s.slice(0,-1);continue}if(s.startsWith("- ")){let l=s.slice(2).trim();l==="and:"||l==="or:"||l==="not:"?(a=o,r=[i]):e.push(l)}}return r.length>0&&e.push(kt(r)),t&&e.length>0&&(n[t]=e),n}V();K();var de=800,F=de/2,q=380,Ke=30,J=145,An=J+Ke,Xe=4,En=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],$t=class{render(n,t,e,r){var o;let a=this.createSVG();this.renderBackground(a);let i=((o=n.rings)==null?void 0:o.length)||1,s=this.calculateRingRadii(i);if(n.rings&&n.rings.length>0)n.rings.forEach((l,d)=>{let h=s.get(d);if(h){let u=N[l.color]||N.blue;this.renderDataRing(a,e,t,h,u,l.folder,r)}});else{let l=s.get(0);if(l){let d=N.blue;this.renderDataRing(a,e,t,l,d,n.folder,r)}}return this.renderMonthSeparators(a),n.showLabels&&this.renderMonthLabels(a),n.showToday&&this.renderTodayMarker(a,e),this.renderCenter(a,e),a}createSVG(){let n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("viewBox",`0 0 ${de} ${de}`),n.setAttribute("class","radcal-svg"),n.style.width="100%",n.style.height="auto",n.style.maxWidth="800px",n}renderBackground(n){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",String(F)),t.setAttribute("cy",String(F)),t.setAttribute("r",String(q)),t.setAttribute("class","rc-background"),n.appendChild(t)}calculateRingRadii(n){let t=new Map,e=q-An,r=(n-1)*Xe,a=(e-r)/n;for(let i=0;i<n;i++){let s=q-i*(a+Xe),o=s-a;t.set(i,{innerRadius:o,outerRadius:s})}return t}renderDataRing(n,t,e,r,a,i,s){for(let o=1;o<=12;o++){let l=C(t,o),d=this.monthToAngle(o),u=Math.PI/6/l;for(let g=1;g<=l;g++){let p=M(t,o,g),m=`${t}-${String(o).padStart(2,"0")}-${String(g).padStart(2,"0")}`,y=e.get(m)||[];i&&(y=y.filter(A=>A.metadata.folder.startsWith(i)));let f=d+(g-1)*u,S=f+u,v=document.createElementNS("http://www.w3.org/2000/svg","path"),D=this.createArcPath(r.innerRadius,r.outerRadius,f,S);if(v.setAttribute("d",D),v.setAttribute("class","rc-day-arc"),y.length>0&&(v.style.fill=a,v.style.opacity=String(Math.min(.3+y.length*.15,1)),v.style.cursor="pointer",v.setAttribute("data-date",m),v.setAttribute("data-count",String(y.length)),v.setAttribute("data-names",y.map(A=>A.displayName).join("|")),s)){let A=p,E=y;v.addEventListener("click",T=>s(T,A,E))}n.appendChild(v)}}}renderMonthSeparators(n){for(let t=1;t<=12;t++){let e=this.monthToAngle(t)-Math.PI/2,r=F+J*Math.cos(e),a=F+J*Math.sin(e),i=F+q*Math.cos(e),s=F+q*Math.sin(e),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(r)),o.setAttribute("y1",String(a)),o.setAttribute("x2",String(i)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-month-separator"),n.appendChild(o)}}renderMonthLabels(n){let t=J+Ke/2;for(let e=1;e<=12;e++){let r=this.monthToAngle(e)+Math.PI/12-Math.PI/2,a=F+t*Math.cos(r),i=F+t*Math.sin(r),s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(a)),s.setAttribute("y",String(i)),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.setAttribute("class","rc-month-label"),s.textContent=En[e-1],n.appendChild(s)}}renderTodayMarker(n,t){let e=P();if(e.year!==t)return;let r=C(t,e.month),a=this.monthToAngle(e.month),i=Math.PI/6/r,o=a+(e.day-.5)*i-Math.PI/2,l=F+J*Math.cos(o),d=F+J*Math.sin(o),h=F+q*Math.cos(o),u=F+q*Math.sin(o),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",String(l)),g.setAttribute("y1",String(d)),g.setAttribute("x2",String(h)),g.setAttribute("y2",String(u)),g.setAttribute("class","rc-today-marker"),n.appendChild(g)}renderCenter(n,t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(F)),e.setAttribute("cy",String(F)),e.setAttribute("r",String(J-5)),e.setAttribute("class","rc-center"),n.appendChild(e);let r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",String(F)),r.setAttribute("y",String(F)),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.setAttribute("class","rc-center-text"),r.textContent=String(t),n.appendChild(r)}createArcPath(n,t,e,r){let a=e-Math.PI/2,i=r-Math.PI/2,s=F+n*Math.cos(a),o=F+n*Math.sin(a),l=F+n*Math.cos(i),d=F+n*Math.sin(i),h=F+t*Math.cos(a),u=F+t*Math.sin(a),g=F+t*Math.cos(i),p=F+t*Math.sin(i),m=r-e>Math.PI?1:0;return`
      M ${s} ${o}
      L ${h} ${u}
      A ${t} ${t} 0 ${m} 1 ${g} ${p}
      L ${l} ${d}
      A ${n} ${n} 0 ${m} 0 ${s} ${o}
      Z
    `}monthToAngle(n){return(n-1)*Math.PI/6}};var Vt=class{constructor(n){this.app=n}createContext(n){var i,s,o;let t=this.app.metadataCache.getFileCache(n),e=[];if((i=t==null?void 0:t.frontmatter)!=null&&i.tags){let l=t.frontmatter.tags;Array.isArray(l)?e.push(...l.map(d=>this.normalizeTag(d))):typeof l=="string"&&e.push(this.normalizeTag(l))}if(t!=null&&t.tags)for(let l of t.tags)e.push(this.normalizeTag(l.tag));let r=[];if(t!=null&&t.links)for(let l of t.links)r.push(l.link);if(t!=null&&t.frontmatterLinks)for(let l of t.frontmatterLinks)r.push(l.link);let a={};if(t!=null&&t.frontmatter)for(let[l,d]of Object.entries(t.frontmatter))l!=="position"&&(a[l.toLowerCase()]=d);return{file:n,metadata:t,tags:[...new Set(e)],folder:(o=(s=n.parent)==null?void 0:s.path)!=null?o:"",links:[...new Set(r)],properties:a}}normalizeTag(n){return n.replace(/^#/,"").toLowerCase()}evaluate(n,t){return typeof n=="string"?this.evaluateString(n,t):Array.isArray(n)?n.every(e=>this.evaluate(e,t)):this.evaluateYaml(n,t)}evaluateYaml(n,t){return n.and?n.and.every(e=>this.evaluate(e,t)):n.or?n.or.some(e=>this.evaluate(e,t)):n.not?n.not.every(e=>!this.evaluate(e,t)):!0}evaluateString(n,t){let e=n.trim();if(!e)return!0;if(e.startsWith("(")&&e.endsWith(")"))return this.evaluateString(e.slice(1,-1),t);let r=this.splitByOperator(e,"||");if(r.length>1)return r.some(i=>this.evaluateString(i,t));let a=this.splitByOperator(e,"&&");return a.length>1?a.every(i=>this.evaluateString(i,t)):e.startsWith("!")?!this.evaluateString(e.slice(1),t):this.evaluateFunction(e,t)}splitByOperator(n,t){let e=[],r="",a=0,i=0;for(;i<n.length;){let s=n[i];if(s==="(")a++,r+=s;else if(s===")")a--,r+=s;else if(a===0&&n.slice(i,i+t.length)===t){e.push(r.trim()),r="",i+=t.length;continue}else r+=s;i++}return r.trim()&&e.push(r.trim()),e}evaluateFunction(n,t){let e=n.match(/^file\.hasTag\s*\(\s*["']([^"']+)["']\s*\)$/);if(e){let h=this.normalizeTag(e[1]);return t.tags.some(u=>u===h||u.startsWith(h+"/"))}let r=n.match(/^file\.tagContains\s*\(\s*["']([^"']+)["']\s*\)$/);if(r){let h=r[1].toLowerCase();return t.tags.some(u=>u.includes(h))}let a=n.match(/^file\.inFolder\s*\(\s*["']([^"']+)["']\s*\)$/);if(a){let h=a[1].replace(/^\/|\/$/g,""),u=t.folder.replace(/^\/|\/$/g,"");return u===h||u.startsWith(h+"/")}let i=n.match(/^file\.hasLink\s*\(\s*["']([^"']+)["']\s*\)$/);if(i){let h=i[1].toLowerCase();return t.links.some(u=>u.toLowerCase()===h||u.toLowerCase().endsWith("/"+h))}let s=n.match(/^file\.name\s*\(\s*["']([^"']+)["']\s*\)$/);if(s){let h=s[1].toLowerCase();return t.file.basename.toLowerCase()===h}let o=n.match(/^file\.nameContains\s*\(\s*["']([^"']+)["']\s*\)$/);if(o){let h=o[1].toLowerCase();return t.file.basename.toLowerCase().includes(h)}let l=n.match(/^file\.property\s*\(\s*["']([^"']+)["']\s*,\s*["']([^"']+)["']\s*\)$/);if(l){let h=l[1].toLowerCase(),u=l[2].toLowerCase(),g=t.properties[h];return g==null?!1:String(g).toLowerCase()===u}let d=n.match(/^file\.hasProperty\s*\(\s*["']([^"']+)["']\s*\)$/);if(d){let h=d[1].toLowerCase(),u=t.properties[h];return u!=null&&u!==""}throw new Error(`Unknown filter function: ${n}`)}};var ue=class extends st.MarkdownRenderChild{constructor(t,e,r,a,i){super(t);this.app=e;this.service=r;this.config=a;this.openFile=i;this.unsubscribe=null;this.filterEngine=new Vt(e)}onload(){this.render(),this.unsubscribe=this.service.subscribeToUpdates(()=>{this.render()})}onunload(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}render(){var h;this.containerEl.empty();let t=(h=this.config.year)!=null?h:this.service.getCurrentYear(),e=this.loadFilteredEntries(t),a=new $t().render(this.config,e,t,(u,g,p)=>this.handleDayClick(u,g,p)),s=this.containerEl.createDiv({cls:"radcal-block-header"}).createEl("button",{cls:"radcal-edit-btn",attr:{"aria-label":"Edit source"}});s.innerHTML="&lt;/&gt;";let o=()=>{this.app.commands.executeCommandById("markdown:toggle-preview")};s.addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),o()}),this.containerEl.addEventListener("dblclick",u=>{let g=u.target;(g.classList.contains("radcal-block")||g.classList.contains("radcal-block-content")||g.tagName==="svg")&&(u.preventDefault(),u.stopPropagation(),o())});let l=this.containerEl.createDiv({cls:"radcal-tooltip"});this.containerEl.createDiv({cls:"radcal-block-content"}).appendChild(a),this.setupTooltips(a,l,t)}loadFilteredEntries(t){let e=new Map;if(this.config.dateProperty)return this.loadEntriesByProperty(t);for(let r=1;r<=12;r++){let a=C(t,r);for(let i=1;i<=a;i++){let s=M(t,r,i),o=`${t}-${String(r).padStart(2,"0")}-${String(i).padStart(2,"0")}`,l=[...this.service.getEntriesForDate(s)];if(this.config.filter&&(l=l.filter(d=>{let h=this.app.vault.getAbstractFileByPath(d.filePath);if(!(h instanceof st.TFile))return!1;let u=this.filterEngine.createContext(h);return this.filterEngine.evaluate(this.config.filter,u)})),!this.config.filter&&this.config.folder){let d=this.config.folder;l=l.filter(h=>h.metadata.folder===d||h.metadata.folder.startsWith(d+"/"))}if(!this.config.filter&&this.config.folders&&this.config.folders.length>0){let d=this.config.folders;l=l.filter(h=>d.some(u=>h.metadata.folder===u||h.metadata.folder.startsWith(u+"/")))}l.length>0&&e.set(o,l)}}return e}loadEntriesByProperty(t){var i,s;let e=new Map,r=this.config.dateProperty,a=this.app.vault.getMarkdownFiles();for(let o of a){if(this.config.filter){let m=this.filterEngine.createContext(o);if(!this.filterEngine.evaluate(this.config.filter,m))continue}let l=this.app.metadataCache.getFileCache(o),d=l==null?void 0:l.frontmatter;if(!d)continue;let h=d[r];if(!h)continue;let u=this.parseDate(h);if(!u||u.year!==t)continue;let g=`${u.year}-${String(u.month).padStart(2,"0")}-${String(u.day).padStart(2,"0")}`,p={id:o.path,filePath:o.path,fileName:o.name,displayName:o.basename,startDate:u,endDate:null,isMultiDay:!1,isAnniversary:!1,metadata:{tags:[],folder:(s=(i=o.parent)==null?void 0:i.path)!=null?s:"",properties:{}}};e.has(g)||e.set(g,[]),e.get(g).push(p)}return e}parseDate(t){if(!t)return null;if(t instanceof Date)return M(t.getFullYear(),t.getMonth()+1,t.getDate());if(typeof t=="string"){let e=t.match(/(\d{4})-(\d{2})-(\d{2})/);if(e)return M(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10))}return null}handleDayClick(t,e,r){r.length===1?this.openFile(r[0].filePath):r.length>1&&this.showEntryMenu(t,e,r)}showEntryMenu(t,e,r){let a=new st.Menu,i=`${e.day}.${e.month}.${e.year}`;a.addItem(s=>{s.setTitle(i).setIcon("calendar").setDisabled(!0)}),a.addSeparator();for(let s of r.slice(0,15))a.addItem(o=>{o.setTitle(s.displayName).setIcon("file-text").onClick(()=>{this.openFile(s.filePath)})});r.length>15&&a.addItem(s=>{s.setTitle(`+${r.length-15} more...`).setDisabled(!0)}),a.showAtMouseEvent(t)}setupTooltips(t,e,r){t.querySelectorAll(".rc-day-arc[data-date]").forEach(i=>{i.addEventListener("mouseenter",s=>{var v;let o=s,l=s.target,d=l.getAttribute("data-date")||"",h=l.getAttribute("data-count")||"0",u=((v=l.getAttribute("data-names"))==null?void 0:v.split("|"))||[],[g,p,m]=d.split("-").map(Number),f=`<div class="radcal-tooltip-date">${`${m}.${p}.${g}`}</div>`;if(u.length>0){f+='<div class="radcal-tooltip-entries">';for(let D of u.slice(0,5))f+=`<div class="radcal-tooltip-entry">${D}</div>`;u.length>5&&(f+=`<div class="radcal-tooltip-more">+${u.length-5} more</div>`),f+="</div>"}e.innerHTML=f,e.style.display="block";let S=this.containerEl.getBoundingClientRect();e.style.left=`${o.clientX-S.left+15}px`,e.style.top=`${o.clientY-S.top+15}px`}),i.addEventListener("mouseleave",()=>{e.style.display="none"})})}},Ot=class{constructor(n,t,e){this.app=n;this.service=t;this.openFile=e}process(n,t,e){try{let r=Ue(n),a=t.createDiv({cls:"radcal-block"}),i=new ue(a,this.app,this.service,r,this.openFile);e.addChild(i)}catch(r){t.createDiv({cls:"radcal-error",text:`Radcal Error: ${r instanceof Error?r.message:String(r)}`})}}};var w=require("obsidian");K();var Yt=require("obsidian"),W=class extends Yt.AbstractInputSuggest{constructor(n,t){super(n,t),this.textInputEl=t}getSuggestions(n){let t=this.getAllFolders(),e=n.toLowerCase().trim();return e===""?t:t.filter(r=>r.path.toLowerCase().includes(e))}renderSuggestion(n,t){t.addClass("folder-suggest-item");let e=t.createSpan({cls:"folder-suggest-icon"});e.innerHTML=this.getFolderIcon(),t.createSpan({cls:"folder-suggest-text"}).setText(n.path||"/")}selectSuggestion(n,t){this.textInputEl.value=n.path,this.textInputEl.trigger("input"),this.close()}getAllFolders(){let n=[],t=r=>{n.push(r);for(let a of r.children)a instanceof Yt.TFolder&&t(a)},e=this.app.vault.getRoot();return t(e),n.sort((r,a)=>r.isRoot()?-1:a.isRoot()?1:r.path.localeCompare(a.path))}getFolderIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>'}};var Bt=class extends w.PluginSettingTab{constructor(n,t){super(n,t),this.plugin=t}display(){let{containerEl:n}=this;n.empty(),this.createViewModeSection(n),this.plugin.settings.currentView==="life"&&this.createLifeViewSection(n),this.createDailyNotesSection(n),this.createCalendarSyncSection(n),this.createRingConfigSection(n),this.createOuterSegmentsSection(n),this.createTemplateSection(n),this.createCenterDisplaySection(n)}createViewModeSection(n){new w.Setting(n).setName("View Mode").setDesc("Switch between Annual and Life view").addDropdown(t=>{t.addOption("annual","Annual View").addOption("life","Life View").setValue(this.plugin.settings.currentView).onChange(async e=>{this.plugin.settings.currentView=e,await this.plugin.saveSettings(),this.display()})})}createLifeViewSection(n){n.createEl("h3",{text:"Life View Settings"}),new w.Setting(n).setName("Birth Date").setDesc("Your birth date (YYYY-MM-DD) for precise calculation").addText(e=>{e.setPlaceholder("e.g. 1977-03-27").setValue(this.plugin.settings.birthDate||"").onChange(async r=>{let a=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(a){let i=parseInt(a[1],10),s=parseInt(a[2],10),o=parseInt(a[3],10);i>1900&&i<=new Date().getFullYear()&&s>=1&&s<=12&&o>=1&&o<=31&&(this.plugin.settings.birthDate=r,this.plugin.settings.birthYear=i,await this.plugin.saveSettings())}else r===""&&(this.plugin.settings.birthDate=void 0,await this.plugin.saveSettings())})}),new w.Setting(n).setName("Birth Year (Fallback)").setDesc("Used when no full date is provided").addText(e=>{e.setPlaceholder("e.g. 1990").setValue(String(this.plugin.settings.birthYear)).onChange(async r=>{let a=parseInt(r,10);!isNaN(a)&&a>1900&&a<=new Date().getFullYear()&&(this.plugin.settings.birthYear=a,await this.plugin.saveSettings())})}),new w.Setting(n).setName("Expected Lifespan").setDesc("Expected lifespan in years").addText(e=>{e.setPlaceholder("e.g. 85").setValue(String(this.plugin.settings.expectedLifespan)).onChange(async r=>{let a=parseInt(r,10);!isNaN(a)&&a>0&&a<=150&&(this.plugin.settings.expectedLifespan=a,await this.plugin.saveSettings())})}),n.createEl("h4",{text:"Life Phases"}),new w.Setting(n).setName("Life Phases Folder").setDesc("Folder with life phase notes (YAML: phase-start, phase-end, phase-color, phase-label)").addText(e=>{e.setPlaceholder("e.g. Life/Phases").setValue(this.plugin.settings.lifePhasesFolder).onChange(async r=>{this.plugin.settings.lifePhasesFolder=r,await this.plugin.saveSettings()}),new W(this.app,e.inputEl)});let t=n.createDiv({cls:"setting-item-description"});t.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Example YAML for a life phase:</strong><br>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
phase-start: 1983-09-01<br>
phase-end: 1987-07-15<br>
phase-color: blue<br>
phase-label: Elementary School<br>
---
        </code>
        <br>
        <em>Leave end empty for "ongoing" phases (shows faded arc until life expectancy)</em>
      </p>
    `}createDailyNotesSection(n){n.createEl("h3",{text:"Daily Notes"}),new w.Setting(n).setName("Notes Folder").setDesc("Folder where new notes are created (empty = vault root)").addText(e=>{e.setPlaceholder("e.g. Daily Notes").setValue(this.plugin.settings.dailyNoteFolder).onChange(async r=>{this.plugin.settings.dailyNoteFolder=r,await this.plugin.saveSettings()}),new W(this.app,e.inputEl)}),new w.Setting(n).setName("Filter Folder").setDesc("Only show notes from this folder (empty = all)").addText(e=>{e.setPlaceholder("e.g. Journal").setValue(this.plugin.settings.calendarFilterFolder).onChange(async r=>{this.plugin.settings.calendarFilterFolder=r,await this.plugin.saveSettings()}),new W(this.app,e.inputEl)}),new w.Setting(n).setName("Filename Format").setDesc("Format for new notes (YYYY-MM-DD)").addText(e=>{e.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.periodicNotesFormat.daily).onChange(async r=>{this.plugin.settings.periodicNotesFormat={...this.plugin.settings.periodicNotesFormat,daily:r||"YYYY-MM-DD"},await this.plugin.saveSettings()})}),new w.Setting(n).setName("Annual Recurring").setDesc("Folder for birthdays, anniversaries (use XXXX-MM-DD format, shown every year on that date)").addText(e=>{e.setPlaceholder("e.g. Birthdays").setValue(this.plugin.settings.annualRecurringFolder).onChange(async r=>{this.plugin.settings.annualRecurringFolder=r,await this.plugin.saveSettings()}),new W(this.app,e.inputEl)}),n.createEl("h4",{text:"Anniversary Properties"}),new w.Setting(n).setName("Additional Date Properties").setDesc("Comma-separated list of YAML properties to use for anniversary dates (in addition to radcal-start/radcal-end)").addText(e=>{var r;e.setPlaceholder("e.g. Birthday, Todestag, Hochzeitstag").setValue(((r=this.plugin.settings.anniversaryDateProperties)==null?void 0:r.join(", "))||"").onChange(async a=>{let i=a.split(",").map(s=>s.trim()).filter(s=>s.length>0);this.plugin.settings.anniversaryDateProperties=i,await this.plugin.saveSettings()})});let t=n.createDiv({cls:"setting-item-description"});t.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Anniversary Properties:</strong><br>
        Use <code>radcal-annual: true</code> to mark a note as anniversary.<br><br>
        <strong>Date sources (checked in order):</strong><br>
        1. <code>radcal-annual-fix</code> - Single fixed date (overrides all)<br>
        2. <code>radcal-start</code> / <code>radcal-end</code> - Birth + death dates<br>
        3. Properties from list above (e.g., <code>Birthday</code>)<br><br>
        <strong>Example:</strong>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
radcal-annual: true<br>
Birthday: 1982-09-24<br>
---
        </code>
      </p>
    `}createCalendarSyncSection(n){n.createEl("h3",{text:"Calendar Sync (Google Calendar)"}),(this.plugin.settings.calendarSources||[]).forEach((r,a)=>{this.createCalendarSourceSettings(n,r,a)}),new w.Setting(n).setName("Add Calendar Source").setDesc("Add a new Google Calendar or iCal source").addButton(r=>{r.setButtonText("+ Add Calendar").setCta().onClick(async()=>{let a={id:`gcal_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:"New Calendar",url:"",folder:"Calendar/Google",color:"blue",syncOnStart:!0,syncIntervalMinutes:0,enabled:!0,showAsRing:!0,showSpanningArcs:!0};this.plugin.settings.calendarSources||(this.plugin.settings.calendarSources=[]),this.plugin.settings.calendarSources.push(a),await this.plugin.saveSettings(),this.display()})});let e=n.createDiv({cls:"setting-item-description"});e.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>How to get your Google Calendar URL:</strong><br>
        1. Open Google Calendar \u2192 Settings \u2192 Calendar Settings<br>
        2. Select your calendar \u2192 Integrate calendar<br>
        3. Copy "Secret address in iCal format"<br><br>
        <em>Note: This URL is private and contains a secret key. Never share it publicly.</em>
      </p>
    `}createCalendarSourceSettings(n,t,e){let r=n.createDiv({cls:"radial-calendar-source-config"});if(new w.Setting(r).setName(`Calendar ${e+1}: ${t.name}`).setHeading().addButton(a=>{a.setIcon("trash").setWarning().setTooltip("Delete this calendar source").onClick(async()=>{this.plugin.settings.calendarSources.splice(e,1),await this.plugin.saveSettings(),this.display()})}),new w.Setting(r).setName("Name").setDesc("Display name for this calendar").addText(a=>{a.setPlaceholder("e.g. Work Calendar").setValue(t.name).onChange(async i=>{t.name=i,await this.plugin.saveSettings()})}),new w.Setting(r).setName("iCal URL").setDesc("Private iCal/ICS URL (from Google Calendar settings)").addText(a=>{a.setPlaceholder("https://calendar.google.com/calendar/ical/...").setValue(t.url).onChange(async i=>{t.url=i,await this.plugin.saveSettings()}),a.inputEl.style.width="100%",a.inputEl.type="password"}),new w.Setting(r).setName("Target Folder").setDesc("Where synced events will be saved").addText(a=>{a.setPlaceholder("e.g. Calendar/Google/Work").setValue(t.folder).onChange(async i=>{t.folder=i,await this.plugin.saveSettings()}),new W(this.app,a.inputEl)}),new w.Setting(r).setName("Color").setDesc("Color for this calendar in the radial view").addDropdown(a=>{Object.keys(N).forEach(i=>{a.addOption(i,i.charAt(0).toUpperCase()+i.slice(1))}),a.setValue(t.color).onChange(async i=>{t.color=i,await this.plugin.saveSettings()})}),new w.Setting(r).setName("Sync on Start").setDesc("Automatically sync when Obsidian starts").addToggle(a=>{a.setValue(t.syncOnStart).onChange(async i=>{t.syncOnStart=i,await this.plugin.saveSettings()})}),new w.Setting(r).setName("Auto-sync Interval").setDesc("How often to sync (0 = manual only)").addDropdown(a=>{a.addOption("0","Manual only").addOption("15","Every 15 minutes").addOption("30","Every 30 minutes").addOption("60","Every hour").addOption("360","Every 6 hours").addOption("1440","Daily").setValue(String(t.syncIntervalMinutes)).onChange(async i=>{t.syncIntervalMinutes=parseInt(i,10),await this.plugin.saveSettings()})}),new w.Setting(r).setName("Enabled").setDesc("Enable or disable this calendar source").addToggle(a=>{a.setValue(t.enabled).onChange(async i=>{t.enabled=i,await this.plugin.saveSettings()})}),new w.Setting(r).setName("Show as Ring").setDesc("Display this calendar as a ring in the annual view").addToggle(a=>{var i;a.setValue((i=t.showAsRing)!=null?i:!0).onChange(async s=>{t.showAsRing=s,await this.plugin.saveSettings()})}),new w.Setting(r).setName("Spanning Arcs").setDesc("Show multi-day events as continuous arcs").addToggle(a=>{var i;a.setValue((i=t.showSpanningArcs)!=null?i:!0).onChange(async s=>{t.showSpanningArcs=s,await this.plugin.saveSettings()})}),t.lastSync){let i=new Date(t.lastSync).toLocaleString();r.createDiv({cls:"setting-item-description",text:`Last synced: ${i}`})}r.createEl("hr")}createRingConfigSection(n){n.createEl("h3",{text:"Configure Rings"});let t=this.plugin.settings.rings;t.forEach((e,r)=>{this.createRingSettings(n,e,r)}),new w.Setting(n).addButton(e=>{e.setButtonText("Add Ring").setCta().onClick(async()=>{let r=Jt(t.length);this.plugin.settings.rings=[...t,r],await this.plugin.saveSettings(),this.display()})})}createRingSettings(n,t,e){let r=n.createDiv({cls:"radial-calendar-ring-config"}),a=new w.Setting(r).setName(`Ring ${e+1}`).setClass("radial-calendar-ring-header");new w.Setting(r).setName("Name").addText(i=>{i.setPlaceholder("Ring Name").setValue(t.name).onChange(async s=>{this.updateRing(e,{name:s})})}),new w.Setting(r).setName("Folder").setDesc("Folder path in vault").addText(i=>{i.setPlaceholder("e.g. Projects/2024").setValue(t.folder).onChange(async s=>{this.updateRing(e,{folder:s})}),new W(this.app,i.inputEl)}),new w.Setting(r).setName("Color").addDropdown(i=>{Object.keys(N).forEach(s=>{i.addOption(s,this.formatColorName(s))}),i.setValue(t.color).onChange(async s=>{this.updateRing(e,{color:s})})}),new w.Setting(r).setName("Spanning Arcs").setDesc("Show multi-day events as continuous arcs").addToggle(i=>{var s;i.setValue((s=t.showSpanningArcs)!=null?s:!1).onChange(async o=>{await this.updateRing(e,{showSpanningArcs:o}),this.display()})}),t.showSpanningArcs&&this.createSpanningArcsPropertySettings(r,t,e),new w.Setting(r).addButton(i=>{i.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.rings=this.plugin.settings.rings.filter((s,o)=>o!==e),this.plugin.settings.rings=this.plugin.settings.rings.map((s,o)=>({...s,order:o})),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateRing(n,t){let e=[...this.plugin.settings.rings];e[n]={...e[n],...t},this.plugin.settings.rings=e,await this.plugin.saveSettings()}createSpanningArcsPropertySettings(n,t,e){let r=n.createDiv({cls:"radial-calendar-segment-config"});new w.Setting(r).setName("Start Date Property").setDesc("YAML frontmatter field for start date").addText(a=>{a.setPlaceholder("radcal-start").setValue(t.startDateField||"radcal-start").onChange(async i=>{this.updateRing(e,{startDateField:i||"radcal-start"})})}),new w.Setting(r).setName("End Date Property").setDesc("YAML frontmatter field for end date").addText(a=>{a.setPlaceholder("radcal-end").setValue(t.endDateField||"radcal-end").onChange(async i=>{this.updateRing(e,{endDateField:i||"radcal-end"})})}),new w.Setting(r).setName("Color Property").setDesc("YAML frontmatter field for color").addText(a=>{a.setPlaceholder("radcal-color").setValue(t.colorField||"radcal-color").onChange(async i=>{this.updateRing(e,{colorField:i||"radcal-color"})})}),new w.Setting(r).setName("Label Property").setDesc("YAML frontmatter field for label").addText(a=>{a.setPlaceholder("radcal-label").setValue(t.labelField||"radcal-label").onChange(async i=>{this.updateRing(e,{labelField:i||"radcal-label"})})})}formatColorName(n){return n.charAt(0).toUpperCase()+n.slice(1)}createOuterSegmentsSection(n){n.createEl("h3",{text:"Outer Segments"}),new w.Setting(n).setName("Segment Type").setDesc("Markers on the outer edge of the calendar").addDropdown(t=>{t.addOption("none","None").addOption("seasons","Seasons (4)").addOption("quarters","Quarters (4)").addOption("semester","Semesters (2)").addOption("ten-days","10-Day Phases (36)").addOption("weeks","Weeks (52)").addOption("custom","Custom").setValue(this.plugin.settings.annualSegmentType).onChange(async e=>{this.plugin.settings.annualSegmentType=e,await this.plugin.saveSettings(),this.display()})}),new w.Setting(n).setName("Show Labels").setDesc("Display segment labels").addToggle(t=>{t.setValue(this.plugin.settings.showSegmentLabels).onChange(async e=>{this.plugin.settings.showSegmentLabels=e,await this.plugin.saveSettings()})}),this.plugin.settings.annualSegmentType==="custom"&&this.createCustomSegmentsEditor(n),this.plugin.settings.currentView==="life"&&this.createLifeActsEditor(n)}createCustomSegmentsEditor(n){n.createEl("h4",{text:"Custom Segments"});let t=this.plugin.settings.customSegments;t.forEach((e,r)=>{this.createSegmentSettings(n,e,r)}),new w.Setting(n).addButton(e=>{e.setButtonText("Add Segment").onClick(async()=>{let r={id:`seg-${Date.now()}`,label:`Segment ${t.length+1}`,startDay:1,endDay:30};this.plugin.settings.customSegments=[...t,r],await this.plugin.saveSettings(),this.display()})})}createSegmentSettings(n,t,e){let r=n.createDiv({cls:"radial-calendar-segment-config"});new w.Setting(r).setName("Label").addText(a=>{a.setValue(t.label).onChange(async i=>{this.updateSegment(e,{label:i})})}),new w.Setting(r).setName("Start Day").setDesc("Day of year (1-365)").addText(a=>{a.setValue(String(t.startDay)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=1&&s<=365&&this.updateSegment(e,{startDay:s})})}),new w.Setting(r).setName("End Day").setDesc("Day of year (1-365)").addText(a=>{a.setValue(String(t.endDay)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=1&&s<=365&&this.updateSegment(e,{endDay:s})})}),new w.Setting(r).addButton(a=>{a.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.customSegments=this.plugin.settings.customSegments.filter((i,s)=>s!==e),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateSegment(n,t){let e=[...this.plugin.settings.customSegments];e[n]={...e[n],...t},this.plugin.settings.customSegments=e,await this.plugin.saveSettings()}createLifeActsEditor(n){n.createEl("h4",{text:"Life Acts"});let t=this.plugin.settings.lifeActs;t.forEach((e,r)=>{this.createLifeActSettings(n,e,r)}),new w.Setting(n).addButton(e=>{e.setButtonText("Add Life Act").onClick(async()=>{let r={id:`act-${Date.now()}`,label:`Act ${t.length+1}`,startAge:0,endAge:10};this.plugin.settings.lifeActs=[...t,r],await this.plugin.saveSettings(),this.display()})})}createLifeActSettings(n,t,e){let r=n.createDiv({cls:"radial-calendar-life-act-config"});new w.Setting(r).setName("Label").addText(a=>{a.setPlaceholder("e.g. Childhood").setValue(t.label).onChange(async i=>{this.updateLifeAct(e,{label:i})})}),new w.Setting(r).setName("Start Age").addText(a=>{a.setValue(String(t.startAge)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=0&&this.updateLifeAct(e,{startAge:s})})}),new w.Setting(r).setName("End Age").addText(a=>{a.setValue(String(t.endAge)).onChange(async i=>{let s=parseInt(i,10);!isNaN(s)&&s>=0&&this.updateLifeAct(e,{endAge:s})})}),new w.Setting(r).setName("Color").addDropdown(a=>{a.addOption("","(Default)"),Object.keys(N).forEach(i=>{a.addOption(i,this.formatColorName(i))}),a.setValue(t.color||"").onChange(async i=>{this.updateLifeAct(e,{color:i||void 0})})}),new w.Setting(r).addButton(a=>{a.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.lifeActs=this.plugin.settings.lifeActs.filter((i,s)=>s!==e),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateLifeAct(n,t){let e=[...this.plugin.settings.lifeActs];e[n]={...e[n],...t},this.plugin.settings.lifeActs=e,await this.plugin.saveSettings()}createTemplateSection(n){n.createEl("h3",{text:"Template"}),new w.Setting(n).setName("Create Template").setDesc("Creates a template file for ring segments in your vault").addButton(t=>{t.setButtonText("Create Template").onClick(async()=>{await this.createTemplateFile()})})}async createTemplateFile(){let n=this.plugin.settings.templateFolder||"Templates",t=`${n}/Radial Calendar Segment.md`;try{if(this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n),this.app.vault.getAbstractFileByPath(t)){new w.Notice(`Template already exists: ${t}`);return}await this.app.vault.create(t,re),new w.Notice(`Template created: ${t}`)}catch(e){console.error("Failed to create template file:",e),new w.Notice("Error creating template")}}createCenterDisplaySection(n){n.createEl("h3",{text:"Center Display"}),new w.Setting(n).setName("Display Mode").setDesc("What is shown in the center of the calendar").addDropdown(t=>{t.addOption("countdown","Countdown").addOption("stats","Statistics").addOption("navigation","Navigation").setValue(this.plugin.settings.centerDisplay).onChange(async e=>{this.plugin.settings.centerDisplay=e,await this.plugin.saveSettings()})})}};var it=require("obsidian");function Je(c){let n=[],e=Cn(c).split(`
`),r=null;for(let a of e){let i=a.trim();if(i==="BEGIN:VEVENT"){r={};continue}if(i==="END:VEVENT"){r&&r.uid&&r.summary&&r.startDate&&n.push(r),r=null;continue}if(!r)continue;let s=i.indexOf(":");if(s===-1)continue;let o=i.substring(0,s),l=i.substring(s+1),d=o.indexOf(";"),h=d===-1?o:o.substring(0,d),u=d===-1?"":o.substring(d+1);switch(h){case"UID":r.uid=l;break;case"SUMMARY":r.summary=he(l);break;case"DESCRIPTION":r.description=he(l);break;case"LOCATION":r.location=he(l);break;case"DTSTART":let g=qe(l,u);r.startDate=g.date,r.isAllDay=g.isAllDay;break;case"DTEND":let p=qe(l,u);r.endDate=p.date;break;case"RRULE":r.isRecurring=!0,r.recurrenceRule=l;break}}return n}function Cn(c){return c.replace(/\r\n[ \t]/g,"").replace(/\n[ \t]/g,"")}function he(c){return c.replace(/\\n/g,`
`).replace(/\\,/g,",").replace(/\\;/g,";").replace(/\\\\/g,"\\")}function qe(c,n){if(n.includes("VALUE=DATE")&&!n.includes("VALUE=DATE-TIME")){let i=parseInt(c.substring(0,4),10),s=parseInt(c.substring(4,6),10)-1,o=parseInt(c.substring(6,8),10);return{date:new Date(i,s,o),isAllDay:!0}}let e=parseInt(c.substring(0,4),10),r=parseInt(c.substring(4,6),10)-1,a=parseInt(c.substring(6,8),10);if(c.length>=15){let i=parseInt(c.substring(9,11),10),s=parseInt(c.substring(11,13),10),o=parseInt(c.substring(13,15),10);return c.endsWith("Z")?{date:new Date(Date.UTC(e,r,a,i,s,o)),isAllDay:!1}:{date:new Date(e,r,a,i,s,o),isAllDay:!1}}return{date:new Date(e,r,a),isAllDay:!0}}function Qe(c){return c.isRecurring&&c.recurrenceRule!==void 0&&c.recurrenceRule.includes("FREQ=YEARLY")}function Gt(c){let n=c.getFullYear(),t=String(c.getMonth()+1).padStart(2,"0"),e=String(c.getDate()).padStart(2,"0");return`${n}-${t}-${e}`}function ge(c){let n=String(c.getHours()).padStart(2,"0"),t=String(c.getMinutes()).padStart(2,"0");return`${n}:${t}`}function Ze(c){return c.replace(/[<>:"/\\|?*]/g,"-").replace(/\s+/g," ").trim().substring(0,100)}var _t=class{constructor(n){this.app=n;this.syncIntervals=new Map}async syncCalendar(n){let t={success:!1,calendarId:n.id,calendarName:n.name,eventsCreated:0,eventsUpdated:0,eventsSkipped:0,errors:[]};try{let e=await this.fetchICS(n.url);if(!e)return t.errors.push("Failed to fetch calendar data"),t;let r=Je(e);await this.ensureFolder(n.folder);for(let a of r)try{let i=await this.processEvent(a,n);i==="created"?t.eventsCreated++:i==="updated"?t.eventsUpdated++:t.eventsSkipped++}catch(i){t.errors.push(`Event "${a.summary}": ${i instanceof Error?i.message:String(i)}`)}t.success=!0}catch(e){t.errors.push(e instanceof Error?e.message:String(e))}return t}async syncAllCalendars(n){let t=[];for(let e of n)if(e.enabled){let r=await this.syncCalendar(e);t.push(r)}return t}startAutoSync(n,t){this.stopAutoSync();for(let e of n)if(e.enabled&&e.syncIntervalMinutes>0){let r=e.syncIntervalMinutes*60*1e3,a=window.setInterval(async()=>{let i=await this.syncCalendar(e);t(i)},r);this.syncIntervals.set(e.id,a)}}stopAutoSync(){for(let n of this.syncIntervals.values())window.clearInterval(n);this.syncIntervals.clear()}async fetchICS(n){try{let t=await(0,it.requestUrl)({url:n,method:"GET"});return t.status===200?t.text:null}catch(t){return console.error("Failed to fetch ICS:",t),null}}async ensureFolder(n){if(this.app.vault.getAbstractFileByPath(n)instanceof it.TFolder)return;let e=n.split("/"),r="";for(let a of e)r=r?`${r}/${a}`:a,this.app.vault.getAbstractFileByPath(r)||await this.app.vault.createFolder(r)}async processEvent(n,t){let e=this.generateFilename(n),r=`${t.folder}/${e}.md`,a=this.app.vault.getAbstractFileByPath(r),i=this.generateFileContent(n,t);if(a instanceof it.TFile){if((await this.app.vault.read(a)).includes(`gcal-uid: "${n.uid}"`)){let o=a.stat.mtime;if(Date.now()-o<60*60*1e3)return"skipped"}return await this.app.vault.modify(a,i),"updated"}return await this.app.vault.create(r,i),"created"}generateFilename(n){let t=Gt(n.startDate),e=Ze(n.summary);return`${t} ${e}`}generateFileContent(n,t){let e=["---"];if(e.push(`radcal-start: ${Gt(n.startDate)}`),n.endDate&&e.push(`radcal-end: ${Gt(n.endDate)}`),e.push(`radcal-color: ${t.color}`),e.push(`radcal-label: "${n.summary.replace(/"/g,'\\"')}"`),e.push(`gcal-uid: "${n.uid}"`),e.push(`gcal-source: "${t.name}"`),n.isRecurring&&(e.push("gcal-recurring: true"),Qe(n)&&e.push("anniversary: true")),n.location&&e.push(`location: "${n.location.replace(/"/g,'\\"')}"`),e.push("---"),e.push(""),e.push(`# ${n.summary}`),e.push(""),!n.isAllDay){let r=ge(n.startDate);if(n.endDate){let a=ge(n.endDate);e.push(`**Zeit:** ${r} - ${a}`)}else e.push(`**Zeit:** ${r}`);e.push("")}return n.location&&(e.push(`**Ort:** ${n.location}`),e.push("")),n.description&&(e.push("## Beschreibung"),e.push(""),e.push(n.description),e.push("")),e.join(`
`)}};var nn=require("obsidian"),Wt=600,R=Wt/2,z=Wt/2-30,ot=z-40,tn=z+15,en={blue:"#4a90d9",green:"#50c878",red:"#e74c3c",purple:"#9b59b6",orange:"#e67e22",teal:"#1abc9c",pink:"#e91e63",yellow:"#f1c40f",cyan:"#00bcd4",indigo:"#3f51b5"},Mn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],pe=class extends nn.BasesView{constructor(t,e){super(t);this.type="radial-calendar";this.svgEl=null;this.dateProperty="date";this.color="blue";this.containerEl=e,this.currentYear=new Date().getFullYear()}onDataUpdated(){var r,a;this.dateProperty=String((r=this.config.get("dateProperty"))!=null?r:"date"),this.color=String((a=this.config.get("color"))!=null?a:"blue");let t=this.config.get("year");t&&typeof t=="number"&&(this.currentYear=t),this.containerEl.empty(),this.containerEl.addClass("radial-calendar-bases-view"),this.renderHeader();let e=this.containerEl.createDiv({cls:"rc-bases-svg-container"});this.svgEl=this.createSVG(),e.appendChild(this.svgEl),this.renderCalendar()}createSVG(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox",`0 0 ${Wt} ${Wt}`),t.setAttribute("class","rc-bases-calendar"),t}renderHeader(){let t=this.containerEl.createDiv({cls:"rc-bases-header"});t.createEl("button",{cls:"rc-bases-nav-btn",text:"\u2190"}).addEventListener("click",()=>{this.currentYear--,this.onDataUpdated()}),t.createSpan({cls:"rc-bases-year",text:String(this.currentYear)}),t.createEl("button",{cls:"rc-bases-nav-btn",text:"\u2192"}).addEventListener("click",()=>{this.currentYear++,this.onDataUpdated()}),t.createEl("button",{cls:"rc-bases-today-btn",text:"Today"}).addEventListener("click",()=>{this.currentYear=new Date().getFullYear(),this.onDataUpdated()})}renderCalendar(){this.svgEl&&(this.svgEl.innerHTML="",this.renderBackgroundCircle(),this.renderMonthSegments(),this.renderEntryIndicators(),this.renderMonthLabels(),this.renderTodayMarker(),this.renderCenter())}renderBackgroundCircle(){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",String(R)),t.setAttribute("cy",String(R)),t.setAttribute("r",String(z)),t.setAttribute("class","rc-bases-background"),this.svgEl.appendChild(t)}renderMonthSegments(){for(let t=0;t<12;t++){let e=this.monthToAngle(t)-Math.PI/2,r=R+ot*Math.cos(e),a=R+ot*Math.sin(e),i=R+z*Math.cos(e),s=R+z*Math.sin(e),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(r)),o.setAttribute("y1",String(a)),o.setAttribute("x2",String(i)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-bases-month-separator"),this.svgEl.appendChild(o)}}renderEntryIndicators(){let t=this.data.data,e=new Map;for(let a of t){let i=this.getEntryDate(a);if(!i||i.getFullYear()!==this.currentYear)continue;let s=this.getDayOfYear(i);e.has(s)||e.set(s,[]),e.get(s).push(a)}let r=en[this.color]||en.blue;for(let[a,i]of e)this.renderDayIndicator(a,i.length,r,i)}getEntryDate(t){var r,a;let e=t.getValue(this.dateProperty);if(e){let i=this.parseDate(e);if(i)return i}for(let i of["date","Date","created","birthday","Birthday","due","Due"]){let s=t.getValue(i);if(s){let o=this.parseDate(s);if(o)return o}}return(a=(r=t.file)==null?void 0:r.stat)!=null&&a.ctime?new Date(t.file.stat.ctime):null}parseDate(t){if(!t)return null;if(t instanceof Date)return t;if(typeof t=="string"){let e=new Date(t);if(!isNaN(e.getTime()))return e;let r=t.match(/^(\d{4})-(\d{2})-(\d{2})/);if(r)return new Date(parseInt(r[1]),parseInt(r[2])-1,parseInt(r[3]))}return typeof t=="number"?new Date(t):typeof t=="object"&&t!==null&&"value"in t?this.parseDate(t.value):null}renderDayIndicator(t,e,r,a){let i=this.isLeapYear(this.currentYear)?366:365,s=(t-1)/i*2*Math.PI-Math.PI/2,o=t/i*2*Math.PI-Math.PI/2,l=this.createArcPath(ot,z,s,o),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",l),d.setAttribute("class","rc-bases-entry-indicator"),d.style.fill=r,d.style.opacity=Math.min(.3+e*.2,1).toString();let h=document.createElementNS("http://www.w3.org/2000/svg","title"),u=a.map(g=>{var p;return((p=g.file)==null?void 0:p.basename)||"Unknown"}).join(`
`);h.textContent=`${e} ${e===1?"entry":"entries"}:
${u}`,d.appendChild(h),d.addEventListener("click",()=>{a.length>0&&a[0].file&&this.app.workspace.getLeaf().openFile(a[0].file)}),d.style.cursor="pointer",this.svgEl.appendChild(d)}renderMonthLabels(){for(let t=0;t<12;t++){let e=this.monthToAngle(t)+Math.PI/12-Math.PI/2,r=R+tn*Math.cos(e),a=R+tn*Math.sin(e),i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",String(r)),i.setAttribute("y",String(a)),i.setAttribute("class","rc-bases-month-label"),i.textContent=Mn[t],this.svgEl.appendChild(i)}}renderTodayMarker(){let t=new Date;if(t.getFullYear()!==this.currentYear)return;let e=this.getDayOfYear(t),r=this.isLeapYear(this.currentYear)?366:365,a=(e-.5)/r*2*Math.PI-Math.PI/2,i=R+(ot-5)*Math.cos(a),s=R+(ot-5)*Math.sin(a),o=R+(z+5)*Math.cos(a),l=R+(z+5)*Math.sin(a),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",String(i)),d.setAttribute("y1",String(s)),d.setAttribute("x2",String(o)),d.setAttribute("y2",String(l)),d.setAttribute("class","rc-bases-today-marker"),this.svgEl.appendChild(d)}renderCenter(){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",String(R)),t.setAttribute("cy",String(R)),t.setAttribute("r",String(ot-10)),t.setAttribute("class","rc-bases-center"),this.svgEl.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x",String(R)),e.setAttribute("y",String(R)),e.setAttribute("class","rc-bases-center-text"),e.textContent=String(this.currentYear),this.svgEl.appendChild(e);let r=this.data.data.filter(i=>{let s=this.getEntryDate(i);return s&&s.getFullYear()===this.currentYear}).length,a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",String(R)),a.setAttribute("y",String(R+25)),a.setAttribute("class","rc-bases-entry-count"),a.textContent=`${r} entries`,this.svgEl.appendChild(a)}createArcPath(t,e,r,a){let i=R+t*Math.cos(r),s=R+t*Math.sin(r),o=R+e*Math.cos(r),l=R+e*Math.sin(r),d=R+e*Math.cos(a),h=R+e*Math.sin(a),u=R+t*Math.cos(a),g=R+t*Math.sin(a),p=a-r>Math.PI?1:0;return[`M ${i} ${s}`,`L ${o} ${l}`,`A ${e} ${e} 0 ${p} 1 ${d} ${h}`,`L ${u} ${g}`,`A ${t} ${t} 0 ${p} 0 ${i} ${s}`,"Z"].join(" ")}monthToAngle(t){return t/12*2*Math.PI}getDayOfYear(t){let e=new Date(t.getFullYear(),0,0),r=t.getTime()-e.getTime(),a=1e3*60*60*24;return Math.floor(r/a)}isLeapYear(t){return t%4===0&&t%100!==0||t%400===0}};function rn(c,n){return new pe(c,n)}K();var Ht=class extends O.Plugin{constructor(){super(...arguments);this.service=null;this.calendarSync=null;this.settings={...xt}}async onload(){await this.loadSettings();let t={calendarWidth:"fit",dateProperties:["date","created","due"],endDateProperties:["endDate","end","until"],datePriority:"filename",dailyNoteFormat:this.settings.periodicNotesFormat.daily,dailyNoteFolder:this.settings.dailyNoteFolder,showMultiDayBars:!0,showWeekendHighlight:!0,anniversaryDateProperties:this.settings.anniversaryDateProperties||[]};this.service=new Rt(this.app,t),await this.service.initialize(),this.registerView(ut,r=>{let a=new Ft(r);return a.initialize({service:this.service,openFile:async i=>{let s=this.app.vault.getAbstractFileByPath(i);s instanceof O.TFile&&await this.app.workspace.getLeaf().openFile(s)},settings:this.settings,onSettingsChange:async i=>{this.settings=i,await this.saveSettings()}}),a}),this.registerView(pt,r=>{let a=new It(r);return a.initialize({service:this.service,settings:this.settings,getActiveFileDate:()=>this.getActiveFileDate(),openFile:async i=>{let s=this.app.vault.getAbstractFileByPath(i);s instanceof O.TFile&&await this.app.workspace.getLeaf().openFile(s)}}),a});let e=new Ot(this.app,this.service,async r=>{let a=this.app.vault.getAbstractFileByPath(r);a instanceof O.TFile&&await this.app.workspace.getLeaf().openFile(a)});this.registerMarkdownCodeBlockProcessor("radcal",(r,a,i)=>e.process(r,a,i)),this.registerBasesViewIfAvailable(),this.addSettingTab(new Bt(this.app,this)),this.addRibbonIcon("circle","Open Radial Calendar",()=>{this.activateView()}),this.addRibbonIcon("clock","Open Local Calendar",()=>{this.activateLocalCalendarView()}),this.addCommand({id:"open-radial-calendar",name:"Open Radial Calendar",callback:()=>{this.activateView()}}),this.addCommand({id:"open-local-calendar",name:"Open Local Calendar (Sidebar)",callback:()=>{this.activateLocalCalendarView()}}),this.calendarSync=new _t(this.app),this.addCommand({id:"sync-google-calendars",name:"Sync Google Calendars",callback:()=>{this.syncAllCalendars()}}),this.syncOnStart(),this.startAutoSync()}async onunload(){var t,e;(t=this.calendarSync)==null||t.stopAutoSync(),this.calendarSync=null,(e=this.service)==null||e.destroy(),this.service=null}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},xt,t)}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:t}=this.app,e=null,r=t.getLeavesOfType(ut);r.length>0?e=r[0]:(e=t.getLeaf("tab"),e&&await e.setViewState({type:ut,active:!0})),e&&t.revealLeaf(e)}getActiveFileDate(){let t=this.app.workspace.getActiveFile();if(!t)return null;let e=t.basename.match(/(\d{4})-(\d{2})-(\d{2})/);return e?M(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10)):null}async activateLocalCalendarView(){var r;let{workspace:t}=this.app,e=(r=t.getLeavesOfType(pt)[0])!=null?r:null;e||(e=t.getRightLeaf(!1),e&&await e.setViewState({type:pt,active:!0})),e&&t.revealLeaf(e)}async syncAllCalendars(){var r;if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(a=>a.enabled&&a.url);if(t.length===0){new O.Notice("No calendar sources configured");return}new O.Notice(`Syncing ${t.length} calendar(s)...`);let e=await this.calendarSync.syncAllCalendars(t);this.showSyncResults(e);for(let a of e)if(a.success){let i=this.settings.calendarSources.find(s=>s.id===a.calendarId);i&&(i.lastSync=Date.now())}await this.saveSettings(),await((r=this.service)==null?void 0:r.initialize())}async syncOnStart(){if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(e=>e.enabled&&e.url&&e.syncOnStart);t.length!==0&&setTimeout(async()=>{var i;let e=await this.calendarSync.syncAllCalendars(t);for(let s of e)if(s.success){let o=this.settings.calendarSources.find(l=>l.id===s.calendarId);o&&(o.lastSync=Date.now())}await this.saveSettings();let r=e.filter(s=>s.success).length,a=e.reduce((s,o)=>s+o.eventsCreated+o.eventsUpdated,0);a>0&&new O.Notice(`Calendar sync: ${a} events updated from ${r} calendar(s)`),await((i=this.service)==null?void 0:i.initialize())},2e3)}startAutoSync(){if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(e=>e.enabled&&e.url&&e.syncIntervalMinutes>0);t.length!==0&&this.calendarSync.startAutoSync(t,async e=>{var a;if(e.success){let i=this.settings.calendarSources.find(s=>s.id===e.calendarId);i&&(i.lastSync=Date.now(),await this.saveSettings())}let r=e.eventsCreated+e.eventsUpdated;r>0&&new O.Notice(`${e.calendarName}: ${r} events synced`),await((a=this.service)==null?void 0:a.initialize())})}showSyncResults(t){let e=t.filter(o=>o.success).length,r=t.reduce((o,l)=>o+l.eventsCreated,0),a=t.reduce((o,l)=>o+l.eventsUpdated,0),i=t.reduce((o,l)=>o+l.errors.length,0),s=`Sync complete: ${e}/${t.length} calendars`;r>0&&(s+=`, ${r} created`),a>0&&(s+=`, ${a} updated`),i>0&&(s+=`, ${i} errors`),new O.Notice(s);for(let o of t)o.errors.length>0&&console.warn(`Calendar sync errors (${o.calendarName}):`,o.errors)}registerBasesViewIfAvailable(){if(typeof this.registerBasesView!="function"){console.log("Radial Calendar: Bases API not available (requires Obsidian 1.10+)");return}try{this.registerBasesView("radial-calendar",{name:"Radial Calendar",icon:"circle",factory:rn,options:()=>[{type:"text",key:"dateProperty",name:"Date property",description:"The property to use for positioning entries on the calendar",default:"date"},{type:"dropdown",key:"color",name:"Color",description:"Color for entry indicators",default:"blue",options:[{value:"blue",label:"Blue"},{value:"green",label:"Green"},{value:"red",label:"Red"},{value:"purple",label:"Purple"},{value:"orange",label:"Orange"},{value:"teal",label:"Teal"},{value:"pink",label:"Pink"},{value:"yellow",label:"Yellow"}]}]})&&console.log("Radial Calendar: Bases view registered successfully")}catch(t){console.warn("Radial Calendar: Failed to register Bases view:",t)}}};
