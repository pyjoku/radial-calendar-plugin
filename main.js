/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Vt=Object.defineProperty;var Oe=Object.getOwnPropertyDescriptor;var Ye=Object.getOwnPropertyNames;var Ge=Object.prototype.hasOwnProperty;var ct=(l,e)=>()=>(l&&(e=l(l=0)),e);var ne=(l,e)=>{for(var t in e)Vt(l,t,{get:e[t],enumerable:!0})},Be=(l,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ye(e))!Ge.call(l,r)&&r!==t&&Vt(l,r,{get:()=>e[r],enumerable:!(n=Oe(e,r))||n.enumerable});return l};var Ot=l=>Be(Vt({},"__esModule",{value:!0}),l);function M(l,e,t){let n={year:l,month:e,day:t};if(!gt(n))throw new Error(`Invalid date: ${l}-${e}-${t}`);return Object.freeze(n)}function O(l){let e=l.month.toString().padStart(2,"0"),t=l.day.toString().padStart(2,"0");return`${l.year}-${e}-${t}`}function ae(l){let e=l.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!e)return null;let t=parseInt(e[1],10),n=parseInt(e[2],10),r=parseInt(e[3],10),a={year:t,month:n,day:r};return gt(a)?Object.freeze(a):null}function C(l,e){return l.year!==e.year?l.year-e.year:l.month!==e.month?l.month-e.month:l.day-e.day}function X(l,e){return l.year===e.year&&l.month===e.month&&l.day===e.day}function gt(l){let{year:e,month:t,day:n}=l;if(!Number.isInteger(e)||e<1||!Number.isInteger(t)||t<1||t>12||!Number.isInteger(n)||n<1)return!1;let r=w(e,t);return n<=r}function w(l,e){let t=[31,28,31,30,31,30,31,31,30,31,30,31];return e===2&&ut(l)?29:t[e-1]}function ut(l){return l%4===0&&l%100!==0||l%400===0}function I(l){let e=l.year,t=l.month,n=l.day;t<3&&(t+=12,e-=1);let r=n,a=t,s=e%100,i=Math.floor(e/100),o=(r+Math.floor(13*(a+1)/5)+s+Math.floor(s/4)+Math.floor(i/4)-2*i)%7;return o=(o%7+7)%7,(o+6)%7}function W(l,e){let t=l.year,n=l.month,r=l.day+e;for(;r>w(t,n);)r-=w(t,n),n+=1,n>12&&(n=1,t+=1);for(;r<1;)n-=1,n<1&&(n=12,t-=1),r+=w(t,n);return Object.freeze({year:t,month:n,day:r})}function ie(l,e){return W(l,-e)}function F(){let l=new Date;return Object.freeze({year:l.getFullYear(),month:l.getMonth()+1,day:l.getDate()})}function se(l,e){let t=re(l);return re(e)-t}function pt(l,e){return C(l,e)<0}function yt(l,e){return C(l,e)>0}function oe(l,e,t){return C(l,e)>=0&&C(l,t)<=0}function le(l){return Object.freeze({year:l.year,month:l.month,day:1})}function ce(l){let e=w(l.year,l.month);return Object.freeze({year:l.year,month:l.month,day:e})}function re(l){let{year:e,month:t,day:n}=l,r=e*365+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400);return r+=[0,31,59,90,120,151,181,212,243,273,304,334][t-1],t>2&&ut(e)&&(r+=1),r+=n,r}var k=ct(()=>{"use strict"});function $(l){var n;let e=l.endDate!==null&&(l.startDate.year!==l.endDate.year||l.startDate.month!==l.endDate.month||l.startDate.day!==l.endDate.day),t=(n=l.isAnniversary)!=null?n:l.startDate.year===0;return Object.freeze({id:l.id,filePath:l.filePath,fileName:l.fileName,displayName:l.displayName,startDate:l.startDate,endDate:l.endDate,isMultiDay:e,isAnniversary:t,metadata:Object.freeze({tags:Object.freeze([...l.metadata.tags]),folder:l.metadata.folder,properties:Object.freeze({...l.metadata.properties})})})}function he(){return Object.freeze({tags:Object.freeze([]),folder:"",properties:Object.freeze({})})}function ge(l){if(typeof l!="object"||l===null)return!1;let e=l;return typeof e.id=="string"&&typeof e.filePath=="string"&&typeof e.fileName=="string"&&typeof e.displayName=="string"&&de(e.startDate)&&(e.endDate===null||de(e.endDate))&&typeof e.isMultiDay=="boolean"&&typeof e.isAnniversary=="boolean"&&je(e.metadata)}function de(l){if(typeof l!="object"||l===null)return!1;let e=l;return typeof e.year=="number"&&typeof e.month=="number"&&typeof e.day=="number"}function je(l){if(typeof l!="object"||l===null)return!1;let e=l;return Array.isArray(e.tags)&&typeof e.folder=="string"&&typeof e.properties=="object"&&e.properties!==null}var Yt=ct(()=>{"use strict"});function ue(l,e){if(C(l,e)>0)throw new Error("Start date must be before or equal to end date");return Object.freeze({start:l,end:e})}function pe(l){return Object.freeze({start:l,end:l})}function Gt(l,e){return C(l.start,e.end)<=0&&C(e.start,l.end)<=0}function ye(l,e){return C(l,e.start)>=0&&C(l,e.end)<=0}function me(l,e){return C(l.start,e.start)<=0&&C(l.end,e.end)>=0}function fe(l,e){if(!Gt(l,e))return null;let t=C(l.start,e.start)>=0?l.start:e.start,n=C(l.end,e.end)<=0?l.end:e.end;return Object.freeze({start:t,end:n})}function be(l){if(l.start.year===l.end.year&&l.start.month===l.end.month)return l.end.day-l.start.day+1;let e=0,t=l.start;for(;C(t,l.end)<=0;)e++,t=W(t,1);return e}function De(l,e){let t=[],n=l.start.year,r=l.start.month,a=l.start.day;for(;n<l.end.year||n===l.end.year&&r<=l.end.month;){let s=w(n,r),i;n===l.end.year&&r===l.end.month?i=l.end.day:i=s,t.push(Object.freeze({year:n,month:r,startDay:a,endDay:i,entryId:e})),r++,r>12&&(r=1,n++),a=1}return Object.freeze(t)}function ve(l,e,t,n){let r={year:e,month:t,day:1},a={year:e,month:t,day:w(e,t)};if(yt(l.start,a)||pt(l.end,r))return null;let s=l.start.year===e&&l.start.month===t?l.start.day:1,i=l.end.year===e&&l.end.month===t?l.end.day:w(e,t);return Object.freeze({year:e,month:t,startDay:s,endDay:i,entryId:n})}function Se(l,e){return Object.freeze({start:{year:l,month:e,day:1},end:{year:l,month:e,day:w(l,e)}})}function Ae(l){return X(l.start,l.end)}function Ee(l,e,t){return Object.freeze({start:W(l.start,-e),end:W(l.end,t)})}var we=ct(()=>{"use strict";k()});var Kt={};ne(Kt,{DEFAULT_DATE_EXTRACTION_CONFIG:()=>Dt,DEFAULT_DISPLAY_CONFIG:()=>St,DEFAULT_FOLDER_FILTER_CONFIG:()=>vt,DEFAULT_PLUGIN_SETTINGS:()=>Bt,DEFAULT_RADIAL_SETTINGS:()=>At,DEFAULT_SETTINGS:()=>He,PREDEFINED_QUARTERS:()=>jt,PREDEFINED_SEASONS:()=>Wt,PREDEFINED_SEMESTERS:()=>zt,RING_COLORS:()=>T,RING_SEGMENT_TEMPLATE:()=>Xt,addDays:()=>W,assignTracks:()=>nt,compareLocalDates:()=>C,computeSubRingRadii:()=>rt,createCalendarEntry:()=>$,createCurrentViewState:()=>Ue,createDateRange:()=>ue,createDefaultRing:()=>_t,createEmptyMetadata:()=>he,createEventsRing:()=>qe,createLifePhasesRing:()=>Ke,createLocalDate:()=>M,createMonthRange:()=>Se,createPluginSettings:()=>ze,createSingleDayRange:()=>pe,createViewState:()=>Xe,daysBetween:()=>se,extendRange:()=>Ee,generate10DayPhases:()=>Ht,generateWeekSegments:()=>Ut,getDaysInMonth:()=>w,getFirstDayOfMonth:()=>le,getLastDayOfMonth:()=>ce,getMaxTrackCount:()=>at,getMonthSegment:()=>ve,getRangeDays:()=>be,getToday:()=>F,getWeekday:()=>I,intersectRanges:()=>fe,isAfter:()=>yt,isBefore:()=>pt,isCalendarEntry:()=>ge,isDateInRange:()=>ye,isLeapYear:()=>ut,isSingleDay:()=>Ae,isValidLocalDate:()=>gt,isWithinRange:()=>oe,keyToLocalDate:()=>ae,localDateToKey:()=>O,localDatesEqual:()=>X,rangeContains:()=>me,rangesOverlap:()=>Gt,splitRangeByMonth:()=>De,subtractDays:()=>ie});function ze(l){var e,t;return Object.freeze({dateExtraction:l.dateExtraction?Object.freeze({...Dt,...l.dateExtraction}):Dt,folderFilter:l.folderFilter?Object.freeze({...vt,...l.folderFilter}):vt,display:l.display?Object.freeze({...St,...l.display}):St,locale:(e=l.locale)!=null?e:Bt.locale,debugMode:(t=l.debugMode)!=null?t:Bt.debugMode})}function Ue(){let l=new Date;return Object.freeze({year:l.getFullYear(),month:l.getMonth()+1,selectedDate:null,focusedEntryId:null})}function Xe(l,e){return Object.freeze({year:l,month:e,selectedDate:null,focusedEntryId:null})}function _t(l){return{id:`ring-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Ring ${l+1}`,folder:"",color:"blue",segmentType:"monthly",enabled:!0,order:l,ringType:"year-days",segmentStyle:"fixed",folderPattern:"fixed",recursive:!1,showGaps:!1,showLabels:!1}}function Ke(l,e=0){return{id:`life-phases-${Date.now()}`,name:"Life Phases",folder:l,color:"blue",segmentType:"custom",enabled:!0,order:e,ringType:"life-phases",segmentStyle:"from-yaml",folderPattern:"fixed",recursive:!1,startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",showGaps:!0,showLabels:!0}}function qe(l,e=1){return{id:`events-${Date.now()}`,name:"Events",folder:l,color:"teal",segmentType:"custom",enabled:!0,order:e,ringType:"events",segmentStyle:"from-yaml",folderPattern:"year-substitution",recursive:!1,startDateField:"event-start",endDateField:"event-end",colorField:"event-color",labelField:"event-label",showGaps:!0,showLabels:!0}}function nt(l){let e=[...l].sort((n,r)=>n.startAngle-r.startAngle),t=[];return e.map(n=>{let r=t.findIndex(a=>a.endAngle<=n.startAngle);return r===-1?(r=t.length,t.push({endAngle:n.endAngle})):t[r].endAngle=n.endAngle,{...n,track:r}})}function rt(l,e,t,n){let r=(l-e)/t;return{outer:l-n*r,inner:l-(n+1)*r}}function at(l){return l.length===0?1:Math.max(...l.map(e=>e.track))+1}function Ht(){let l=[],e=1,t=1;for(;e<=365;){let n=Math.min(e+9,365);l.push({id:`10d-${t}`,label:`P${t}`,startDay:e,endDay:n}),e=n+1,t++}return l}function Ut(){let l=[];for(let e=1;e<=52;e++){let t=(e-1)*7+1,n=Math.min(e*7,365);l.push({id:`w-${e}`,label:`W${e}`,startDay:t,endDay:n})}return l}var Dt,vt,St,Bt,He,T,Wt,jt,zt,At,Xt,j=ct(()=>{"use strict";k();Yt();we();Dt=Object.freeze({fromFilename:!0,fromFrontmatter:!0,frontmatterField:"date",endDateField:"endDate",filenamePatterns:Object.freeze(["^(\\d{4}-\\d{2}-\\d{2})","(\\d{4}-\\d{2}-\\d{2})$","^(\\d{4}-\\d{2}-\\d{2})[-_\\s]","[-_\\s](\\d{4}-\\d{2}-\\d{2})\\.md$"]),useCreationDateFallback:!1}),vt=Object.freeze({includeFolders:Object.freeze([]),excludeFolders:Object.freeze([])}),St=Object.freeze({firstDayOfWeek:1,showWeekNumbers:!1,highlightToday:!0,showAdjacentMonths:!0,maxEntriesPerDay:3,showMultiDayBars:!0}),Bt=Object.freeze({dateExtraction:Dt,folderFilter:vt,display:St,locale:"en-US",debugMode:!1});He={calendarWidth:"fit",dateProperties:["date","startDate","created"],endDateProperties:["endDate","due","deadline"],datePriority:"property",dailyNoteFolder:"",dailyNoteFormat:"YYYY-MM-DD",showMultiDayBars:!0,showWeekendHighlight:!0,anniversaryDateProperties:[]};T={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",teal:"#14b8a6",cyan:"#06b6d4",magenta:"#d946ef",lime:"#84cc16",amber:"#f59e0b",indigo:"#6366f1",violet:"#8b5cf6",rose:"#f43f5e",gray:"#6b7280",slate:"#64748b",stone:"#78716c"};Wt=[{id:"spring",label:"Spring",startDay:60,endDay:152},{id:"summer",label:"Summer",startDay:152,endDay:244},{id:"autumn",label:"Autumn",startDay:244,endDay:335},{id:"winter",label:"Winter",startDay:335,endDay:60}],jt=[{id:"q1",label:"Q1",startDay:1,endDay:90},{id:"q2",label:"Q2",startDay:91,endDay:181},{id:"q3",label:"Q3",startDay:182,endDay:273},{id:"q4",label:"Q4",startDay:274,endDay:365}],zt=[{id:"s1",label:"H1",startDay:1,endDay:181},{id:"s2",label:"H2",startDay:182,endDay:365}];At={currentView:"annual",birthYear:1990,expectedLifespan:85,currentYear:new Date().getFullYear(),rings:[],centerDisplay:"countdown",periodicNotesFormat:{yearly:"YYYY",monthly:"YYYY-MM",daily:"YYYY-MM-DD"},templateFolder:"Templates",dailyNoteFolder:"",calendarFilterFolder:"",annualRecurringFolder:"",lifePhasesFolder:"",annualSegmentType:"none",customSegments:[],lifeActs:[],showSegmentLabels:!0,anniversaryDateProperties:[]},Xt=`---
# === RADIAL CALENDAR TEMPLATE ===
# Delete the lines you don't need

# COLORS (choose one):
ring-color: blue
# ring-color: red
# ring-color: orange
# ring-color: yellow
# ring-color: green
# ring-color: teal
# ring-color: purple
# ring-color: magenta
# ring-color: pink
# ring-color: cyan
# ring-color: lime
# ring-color: amber
# ring-color: indigo

# STYLE (choose one):
ring-style: solid
# ring-style: striped
# ring-style: dotted
# ring-style: gradient

# LABEL & ICON:
ring-label: ""
ring-icon: circle

# DATE RANGE:
date: {{date}}
# end-date:

# PROGRESS (0-100):
# ring-progress: 0
---

# {{title}}

`});var an={};ne(an,{default:()=>$t});module.exports=Ot(an);var Z=require("obsidian");var dt=class{constructor(e){this.app=e}getAllMarkdownFiles(){return this.app.vault.getMarkdownFiles().map(t=>this.toFileInfo(t))}getMarkdownFilesInFolder(e){return this.getAllMarkdownFiles().filter(t=>t.folderPath?t.folderPath===e||t.folderPath.startsWith(e+"/"):!1)}getFileByPath(e){let t=this.app.vault.getAbstractFileByPath(e);return t instanceof this.getTFileClass()?t:null}async readFile(e){let t=this.getFileByPath(e);if(!t)return null;try{return await this.app.vault.read(t)}catch(n){return null}}async createOrOpenDailyNote(e,t=""){let n=this.getFileByPath(e);if(!n){let r=e.substring(0,e.lastIndexOf("/"));r&&await this.ensureFolderExists(r),n=await this.app.vault.create(e,t)}return n}async ensureFolderExists(e){this.app.vault.getAbstractFileByPath(e)||await this.app.vault.createFolder(e)}fileExists(e){return this.getFileByPath(e)!==null}getRoot(){return this.app.vault.getRoot()}toFileInfo(e){var t,n;return Object.freeze({path:e.path,basename:e.basename,name:e.name,extension:e.extension,folderPath:(n=(t=e.parent)==null?void 0:t.path)!=null?n:null})}getTFileClass(){let e=this.app.vault.getMarkdownFiles();return e.length>0?e[0].constructor:class{}}};var ht=class{constructor(e){this.app=e}getMetadata(e){let t=this.app.metadataCache.getFileCache(e);return this.extractMetadata(t)}getMetadataByPath(e){let t=this.app.vault.getAbstractFileByPath(e);return!t||!this.isMarkdownFile(t)?null:this.getMetadata(t)}getProperty(e,t){var r;return(r=this.getMetadata(e).frontmatter)==null?void 0:r[t]}getStringProperty(e,t){let n=this.getProperty(e,t);return typeof n=="string"?n:n instanceof Date?this.formatDate(n):typeof n=="number"?String(n):null}getDateProperty(e,t){let n=this.getProperty(e,t);if(!n)return null;if(typeof n=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;let r=n.match(/^(\d{4}-\d{2}-\d{2})/);return r?r[1]:null}return n instanceof Date&&!isNaN(n.getTime())?this.formatDate(n):this.isLocalDateLike(n)?this.formatLocalDate(n):null}getTags(e){return this.getMetadata(e).tags}hasTag(e,t){let n=t.startsWith("#")?t:`#${t}`;return this.getTags(e).some(a=>a.tag.toLowerCase()===n.toLowerCase())}onMetadataChange(e){let t=n=>e(n);return this.app.metadataCache.on("changed",t),()=>this.app.metadataCache.off("changed",t)}extractMetadata(e){var r;let t=(r=e==null?void 0:e.frontmatter)!=null?r:null,n=[];if(t!=null&&t.tags){let a=Array.isArray(t.tags)?t.tags:[t.tags];for(let s of a)if(typeof s=="string"){let i=s.startsWith("#")?s:`#${s}`;n.push({tag:i,name:i.substring(1)})}}if(e!=null&&e.tags)for(let a of e.tags)n.find(i=>i.tag.toLowerCase()===a.tag.toLowerCase())||n.push({tag:a.tag,name:a.tag.substring(1)});return Object.freeze({frontmatter:t,tags:Object.freeze(n)})}formatDate(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}formatLocalDate(e){let t=e.year,n=String(e.month).padStart(2,"0"),r=String(e.day).padStart(2,"0");return`${t}-${n}-${r}`}isLocalDateLike(e){return typeof e=="object"&&e!==null&&"year"in e&&"month"in e&&"day"in e&&typeof e.year=="number"&&typeof e.month=="number"&&typeof e.day=="number"}isMarkdownFile(e){return typeof e=="object"&&e!==null&&"extension"in e&&e.extension==="md"}};k();var mt=class{constructor(e={}){var t,n;this.entriesByPath=new Map,this.entriesByDate=new Map,this.multiDayEntriesByDate=new Map,this.anniversaryEntriesByMonthDay=new Map,this.stats={hits:0,misses:0,lastRebuild:0},this.config={maxEntries:(t=e.maxEntries)!=null?t:1e4,debug:(n=e.debug)!=null?n:!1}}addEntry(e){if(this.removeEntry(e.filePath),this.entriesByPath.set(e.filePath,e),e.isAnniversary){let n=this.monthDayKey(e.startDate.month,e.startDate.day);this.addToDateIndex(n,e,this.anniversaryEntriesByMonthDay),this.log(`Added anniversary entry: ${e.filePath}`);return}let t=O(e.startDate);this.addToDateIndex(t,e,this.entriesByDate),e.isMultiDay&&e.endDate&&this.indexMultiDayEntry(e),this.log(`Added entry: ${e.filePath}`)}monthDayKey(e,t){return`${String(e).padStart(2,"0")}-${String(t).padStart(2,"0")}`}removeEntry(e){let t=this.entriesByPath.get(e);if(!t)return;if(this.entriesByPath.delete(e),t.isAnniversary){let r=this.monthDayKey(t.startDate.month,t.startDate.day);this.removeFromDateIndex(r,t.id,this.anniversaryEntriesByMonthDay),this.log(`Removed anniversary entry: ${e}`);return}let n=O(t.startDate);this.removeFromDateIndex(n,t.id,this.entriesByDate),t.isMultiDay&&t.endDate&&this.removeMultiDayEntry(t),this.log(`Removed entry: ${e}`)}getEntriesForDate(e){var o,c,d;let t=O(e),n=this.monthDayKey(e.month,e.day),r=(o=this.entriesByDate.get(t))!=null?o:[],a=(c=this.multiDayEntriesByDate.get(t))!=null?c:[],s=(d=this.anniversaryEntriesByMonthDay.get(n))!=null?d:[];r.length>0||a.length>0||s.length>0?this.stats.hits++:this.stats.misses++;let i=new Map;for(let h of r)i.set(h.id,h);for(let h of a)i.set(h.id,h);for(let h of s)i.set(h.id,h);return Array.from(i.values())}getEntriesInRange(e,t){var r;let n=new Map;for(let a of this.entriesByPath.values()){let s=(r=a.endDate)!=null?r:a.startDate;C(a.startDate,t)<=0&&C(s,e)>=0&&n.set(a.id,a)}return Array.from(n.values())}getMultiDayEntries(){return Array.from(this.entriesByPath.values()).filter(e=>e.isMultiDay)}getAnniversaryEntriesForDate(e){var n;let t=this.monthDayKey(e.month,e.day);return(n=this.anniversaryEntriesByMonthDay.get(t))!=null?n:[]}getAllAnniversaryEntries(){let e=[];for(let t of this.anniversaryEntriesByMonthDay.values())e.push(...t);return e}getEntryByPath(e){return this.entriesByPath.get(e)}hasEntry(e){return this.entriesByPath.has(e)}getAllEntries(){return Array.from(this.entriesByPath.values())}clear(){this.entriesByPath.clear(),this.entriesByDate.clear(),this.multiDayEntriesByDate.clear(),this.stats={hits:0,misses:0,lastRebuild:Date.now()},this.log("Cache cleared")}rebuild(e){this.clear(),this.stats.lastRebuild=Date.now();for(let t of e)this.addEntry(t);this.log(`Cache rebuilt with ${e.length} entries`)}getStats(){return Object.freeze({entryCount:this.entriesByPath.size,dateCount:this.entriesByDate.size+this.multiDayEntriesByDate.size,hits:this.stats.hits,misses:this.stats.misses,lastRebuild:this.stats.lastRebuild})}indexMultiDayEntry(e){if(!e.endDate)return;let t=e.startDate,n=e.endDate;for(;C(t,n)<0;)if(t=this.addOneDay(t),C(t,n)<=0){let r=O(t);this.addToDateIndex(r,e,this.multiDayEntriesByDate)}}removeMultiDayEntry(e){if(!e.endDate)return;let t=e.startDate,n=e.endDate;for(;C(t,n)<0;)if(t=this.addOneDay(t),C(t,n)<=0){let r=O(t);this.removeFromDateIndex(r,e.id,this.multiDayEntriesByDate)}}addToDateIndex(e,t,n){let r=n.get(e);r?r.push(t):n.set(e,[t])}removeFromDateIndex(e,t,n){let r=n.get(e);if(!r)return;let a=r.filter(s=>s.id!==t);a.length===0?n.delete(e):n.set(e,a)}addOneDay(e){let t=e.day+1,n=e.month,r=e.year,a=this.getDaysInMonth(r,n);return t>a&&(t=1,n+=1,n>12&&(n=1,r+=1)),{year:r,month:n,day:t}}getDaysInMonth(e,t){let n=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2?e%4===0&&e%100!==0||e%400===0?29:28:n[t-1]}log(e){this.config.debug&&console.log(`[EntryCache] ${e}`)}};var ft=class ft{parseDate(e){if(e==null)return null;if(typeof e=="string")return this.parseDateString(e);if(e instanceof Date)return isNaN(e.getTime())?null:{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()};if(typeof e=="object"&&e!==null){let t=e;if(typeof t.year=="number"&&typeof t.month=="number"&&typeof t.day=="number"&&this.isValidDate(t.year,t.month,t.day))return{year:t.year,month:t.month,day:t.day}}return null}parseDateString(e){let t=e.trim(),n=t.match(/^XXXX-(\d{2})-(\d{2})$/i);if(n){let o=parseInt(n[1],10),c=parseInt(n[2],10);return this.isValidDate(2e3,o,c)?{year:0,month:o,day:c}:null}let r=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!r)return null;let a=parseInt(r[1],10),s=parseInt(r[2],10),i=parseInt(r[3],10);return this.isValidDate(a,s,i)?{year:a,month:s,day:i}:null}isValidDate(e,t,n){if(e<1900||e>2100||t<1||t>12||n<1||n>31)return!1;let r=this.getDaysInMonth(e,t);return!(n>r)}getDaysInMonth(e,t){let n=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2&&this.isLeapYear(e)?29:n[t-1]}isLeapYear(e){return e%4===0&&e%100!==0||e%400===0}extractFromFilename(e){let t={start:null,end:null};if(!e||typeof e!="string")return t;let n=e.match(ft.DATE_PATTERN);return!n||n.length===0||(t.start=this.parseDate(n[0]),n.length>=2&&(t.end=this.parseDate(n[1]))),t}extractFromProperties(e,t){if(!e||typeof e!="object"||!Array.isArray(t))return null;for(let n of t){if(typeof n!="string"||!n)continue;let r=e[n];if(r==null)continue;let a=this.parseDate(r);if(a!==null)return a}return null}extractDates(e,t,n){let r={start:null,end:null},a=this.extractFromFilename(e);for(let s of n.priorities)s==="filename"?(r.start===null&&a.start!==null&&(r.start=a.start),r.end===null&&a.end!==null&&(r.end=a.end)):s==="properties"&&(r.start===null&&(r.start=this.extractFromProperties(t,n.startSources)),r.end===null&&(r.end=this.extractFromProperties(t,n.endSources)));return r}};ft.DATE_PATTERN=/(\d{4}-\d{2}-\d{2})/g;var tt=ft,un=new tt;k();var _e=["January","February","March","April","May","June","July","August","September","October","November","December"],bt=class{getDaysInMonth(e,t){return w(e,t)}getFirstDayOfWeek(e,t){let n=M(e,t,1);return I(n)}isToday(e){let t=F();return X(e,t)}generateGrid(e){let t=[];for(let n=1;n<=12;n++)t.push(this.generateMonth(e,n));return{year:e,months:t}}generateMonth(e,t){let n=this.getDaysInMonth(e,t),r=this.getFirstDayOfWeek(e,t),a=[];for(let s=0;s<r;s++)a.push({date:M(e,t,1),isToday:!1,isEmpty:!0});for(let s=1;s<=n;s++){let i=M(e,t,s);a.push({date:i,isToday:this.isToday(i),isEmpty:!1})}return{month:t,name:_e[t-1],startDayOfWeek:r,daysInMonth:n,days:a}}};k();var We=24,et=class{calculateMonthSegments(e,t,n){let r=[];if(C(e,t)>0)return r;let a=e.year,s=e.month,i=0;for(;i<We;){let o=a===e.year&&s===e.month,c=a===t.year&&s===t.month,d=o?e.day:1,h=c?t.day:w(a,s);if(r.push({year:a,month:s,startDay:d,endDay:h,entryId:n}),c)break;s++,s>12&&(s=1,a++),i++}return r}calculateBarPositions(e,t){let n=new Map;if(e.length===0)return n;let r=[...e].sort((s,i)=>s.startDay!==i.startDay?s.startDay-i.startDay:i.endDay-i.startDay-(s.endDay-s.startDay)),a=[];for(let s=0;s<=31;s++)a.push(new Set);for(let s of r){let i=(t.startDayOfWeek+s.startDay-1)%7,o=(t.startDayOfWeek+s.endDay-1)%7,c=s.endDay-s.startDay+1,d=0,h=!1;for(;!h;){let g=!0;for(let u=s.startDay;u<=s.endDay;u++)if(a[u].has(d)){g=!1;break}if(g){h=!0;for(let u=s.startDay;u<=s.endDay;u++)a[u].add(d)}else d++;if(d>100)break}n.set(s.entryId,{rowIndex:d,startColumn:i,endColumn:o,span:c})}return n}},Dn=new et;Yt();k();k();var Et=class{constructor(e,t){this.unregisterMetadataListener=null;this.eventListeners=null;this.updateSubscribers=new Set;this.vaultRepository=new dt(e),this.metadataRepository=new ht(e),this.entryCache=new mt({debug:!1}),this.dateEngine=new tt,this.calendarEngine=new bt,this.multiDayEngine=new et,this.settings=t,this.currentYear=F().year}async initialize(){await this.rebuildCache(),this.setupMetadataListener()}destroy(){this.unregisterMetadataListener&&(this.unregisterMetadataListener(),this.unregisterMetadataListener=null),this.eventListeners=null}setEventListeners(e){this.eventListeners=e}subscribeToUpdates(e){return this.updateSubscribers.add(e),()=>{this.updateSubscribers.delete(e)}}notifySubscribers(){for(let e of this.updateSubscribers)try{e()}catch(t){console.error("Radcal subscriber error:",t)}}async updateSettings(e){let t=this.settings.dateProperties.join(",")!==e.dateProperties.join(",")||this.settings.endDateProperties.join(",")!==e.endDateProperties.join(",")||this.settings.datePriority!==e.datePriority;this.settings=e,t&&await this.rebuildCache()}getCurrentYear(){return this.currentYear}setCurrentYear(e){var t;this.currentYear!==e&&(this.currentYear=e,(t=this.eventListeners)==null||t.onYearChanged(e))}setYear(e){this.setCurrentYear(e)}nextYear(){this.setCurrentYear(this.currentYear+1)}previousYear(){this.setCurrentYear(this.currentYear-1)}goToToday(){this.setCurrentYear(F().year)}generateCalendarGrid(){return this.calendarEngine.generateGrid(this.currentYear)}getEntriesForDate(e){return this.entryCache.getEntriesForDate(e)}getMultiDayEntries(){return this.entryCache.getMultiDayEntries().filter(e=>{var a;let t={year:this.currentYear,month:1,day:1},n={year:this.currentYear,month:12,day:31},r=(a=e.endDate)!=null?a:e.startDate;return e.startDate.year===this.currentYear||e.startDate.year<this.currentYear&&r.year>=this.currentYear})}getAnniversaryEntriesForDate(e){return this.entryCache.getAnniversaryEntriesForDate(e)}getAllAnniversaryEntries(){return this.entryCache.getAllAnniversaryEntries()}calculateBarPositions(e,t){return new Map}async openDailyNote(e){let t=this.settings.dailyNoteFormat,n=this.settings.dailyNoteFolder,r=this.formatDailyNoteFilename(e,t),a=n?`${n}/${r}.md`:`${r}.md`,s=await this.vaultRepository.createOrOpenDailyNote(a);console.log(`Opening daily note: ${s.path}`)}getCacheStats(){let e=this.entryCache.getStats();return{entryCount:e.entryCount,dateCount:e.dateCount}}loadLifePhases(e,t={startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",categoryField:"phase-category"}){if(!e)return[];let n=this.vaultRepository.getAllMarkdownFiles(),r=[],a=e.endsWith("/")?e:`${e}/`,s=n.filter(i=>i.path===`${e}.md`||i.path.startsWith(a));for(let i of s){let o=this.metadataRepository.getMetadataByPath(i.path),c=o==null?void 0:o.frontmatter;if(!c)continue;let d=c[t.startDateField];if(!d||typeof d!="string")continue;let h=this.parseYAMLDate(d);if(!h)continue;let g=c[t.endDateField],u=null;g&&typeof g=="string"&&g.trim()!==""&&(u=this.parseYAMLDate(g));let p=c[t.colorField],m=this.isValidColor(p)?p:"blue",y=c[t.labelField]||i.basename,f=c[t.categoryField];r.push({filePath:i.path,label:String(y),startDate:h,endDate:u,color:m,category:f?String(f):void 0})}return r.sort((i,o)=>i.startDate.year!==o.startDate.year?i.startDate.year-o.startDate.year:i.startDate.month!==o.startDate.month?i.startDate.month-o.startDate.month:i.startDate.day-o.startDate.day)}parseYAMLDate(e){let t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return null;let n=parseInt(t[1],10),r=parseInt(t[2],10),a=parseInt(t[3],10);return r<1||r>12||a<1||a>31?null:M(n,r,a)}isValidColor(e){return typeof e=="string"&&["red","orange","yellow","green","blue","purple","pink","teal","cyan","magenta","lime","amber","indigo","violet","rose","gray","slate","stone"].includes(e)}computeLifePhaseSegments(e,t,n,r){let a=r?this.parseYAMLDate(r)||M(t,1,1):M(t,1,1),s=M(a.year+n,a.month,a.day),i=this.daysBetweenDates(a,s),o=F();return e.map(c=>{let h=this.daysBetweenDates(a,c.startDate)/i*2*Math.PI,g,u=!1;c.endDate?g=c.endDate:(u=!0,g=s);let m=this.daysBetweenDates(a,g)/i*2*Math.PI,y;u&&(y=this.daysBetweenDates(a,o)/i*2*Math.PI);let{RING_COLORS:f}=(j(),Ot(Kt)),D=f[c.color]||f.blue;return{id:c.filePath,filePath:c.filePath,label:c.label,startAngle:h,endAngle:m,color:D,entries:[],isOngoing:u,todayAngle:y,category:c.category}})}loadSpanningArcs(e,t,n={startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label"}){if(!e)return[];let r=this.vaultRepository.getAllMarkdownFiles(),a=[],s=e.endsWith("/")?e:`${e}/`,i=r.filter(d=>d.path===`${e}.md`||d.path.startsWith(s)),o=M(t,1,1),c=M(t,12,31);for(let d of i){let h=this.metadataRepository.getMetadataByPath(d.path),g=h==null?void 0:h.frontmatter;if(!g)continue;let u=g[n.startDateField];if(!u||typeof u!="string")continue;let p=this.parseYAMLDate(u);if(!p)continue;let m=g[n.endDateField],y=null;if(m&&typeof m=="string"&&m.trim()!==""&&(y=this.parseYAMLDate(m)),y||(y=p),y.year<t||p.year>t)continue;let f=this.compareDates(p,o)<0?o:p,D=this.compareDates(y,c)>0?c:y,v=g[n.colorField],S=this.isValidColor(v)?v:void 0,E=g[n.labelField]||d.basename,x=this.dateToYearAngle(f,t),P=this.dateToYearAngle(D,t),{RING_COLORS:_}=(j(),Ot(Kt)),U=S?_[S]:void 0;a.push({id:d.path,filePath:d.path,label:String(E),startAngle:x,endAngle:P,color:U,entries:[]})}return a.sort((d,h)=>d.startAngle-h.startAngle)}dateToYearAngle(e,t){let n=this.isLeapYear(t)?366:365;return(this.getDayOfYear(e)-1)/n*2*Math.PI}compareDates(e,t){return e.year!==t.year?e.year-t.year:e.month!==t.month?e.month-t.month:e.day-t.day}daysBetweenDates(e,t){let n=new Date(e.year,e.month-1,e.day).getTime(),r=new Date(t.year,t.month-1,t.day).getTime();return Math.floor((r-n)/(1e3*60*60*24))}dateToYearFraction(e){let t=this.isLeapYear(e.year)?366:365;return(this.getDayOfYear(e)-1)/t}isLeapYear(e){return e%4===0&&e%100!==0||e%400===0}getDayOfYear(e){let t=[31,28,31,30,31,30,31,31,30,31,30,31];this.isLeapYear(e.year)&&(t[1]=29);let n=e.day;for(let r=0;r<e.month-1;r++)n+=t[r];return n}async rebuildCache(){var r;let e=this.vaultRepository.getAllMarkdownFiles(),t=[],n=this.getDateExtractionConfig();for(let a of e){let s=this.createEntriesFromFile(a,n);t.push(...s)}this.entryCache.rebuild(t),(r=this.eventListeners)==null||r.onEntriesUpdated(),this.notifySubscribers()}createEntriesFromFile(e,t){var d,h,g;let n=this.metadataRepository.getMetadataByPath(e.path),r=(d=n==null?void 0:n.frontmatter)!=null?d:null,{start:a,end:s}=this.dateEngine.extractDates(e.name,r,t),i=(r==null?void 0:r["radcal-annual"])===!0,o={};if(r)for(let[u,p]of Object.entries(r))(typeof p=="string"||typeof p=="number"||typeof p=="boolean")&&(o[u]=p);let c={tags:(h=n==null?void 0:n.tags.map(u=>u.name))!=null?h:[],folder:(g=e.folderPath)!=null?g:"",properties:o};if(i&&r){let u=[],p=this.parseFrontmatterDate(r["radcal-annual-fix"]);if(p)return u.push($({id:`${e.path}#fix`,filePath:e.path,fileName:e.name,displayName:e.basename,startDate:p,endDate:null,metadata:c,isAnniversary:!0})),u;let m=this.parseFrontmatterDate(r["radcal-start"]),y=this.parseFrontmatterDate(r["radcal-end"]);m&&u.push($({id:`${e.path}#start`,filePath:e.path,fileName:e.name,displayName:e.basename,startDate:m,endDate:null,metadata:c,isAnniversary:!0})),y&&u.push($({id:`${e.path}#end`,filePath:e.path,fileName:e.name,displayName:e.basename,startDate:y,endDate:null,metadata:c,isAnniversary:!0}));let f=this.settings.anniversaryDateProperties||[];for(let D of f){let v=this.parseFrontmatterDate(r[D]);if(v){let S=D.toLowerCase().replace(/\s+/g,"-");u.push($({id:`${e.path}#${S}`,filePath:e.path,fileName:e.name,displayName:e.basename,startDate:v,endDate:null,metadata:c,isAnniversary:!0}))}}return u.length===0&&a&&u.push($({id:`${e.path}#fallback`,filePath:e.path,fileName:e.name,displayName:e.basename,startDate:a,endDate:null,metadata:c,isAnniversary:!0})),u}return a?[$({id:e.path,filePath:e.path,fileName:e.name,displayName:e.basename,startDate:a,endDate:s,metadata:c,isAnniversary:!1})]:[]}parseFrontmatterDate(e){return e?typeof e=="string"?this.parseYAMLDate(e):e instanceof Date?M(e.getFullYear(),e.getMonth()+1,e.getDate()):null:null}getDateExtractionConfig(){return{startSources:this.settings.dateProperties,endSources:this.settings.endDateProperties,priorities:this.settings.datePriority==="property"?["properties","filename"]:["filename","properties"]}}formatDailyNoteFilename(e,t){return t.replace("YYYY",String(e.year)).replace("MM",String(e.month).padStart(2,"0")).replace("DD",String(e.day).padStart(2,"0"))}setupMetadataListener(){this.unregisterMetadataListener=this.metadataRepository.onMetadataChange(e=>{this.handleFileChange(e.path)})}handleFileChange(e){var n;let t=this.vaultRepository.getAllMarkdownFiles().find(r=>r.path===e);if(t){this.entryCache.removeEntry(e),this.entryCache.removeEntry(`${e}#start`),this.entryCache.removeEntry(`${e}#end`),this.entryCache.removeEntry(`${e}#fix`),this.entryCache.removeEntry(`${e}#fallback`);let r=this.settings.anniversaryDateProperties||[];for(let i of r){let o=i.toLowerCase().replace(/\s+/g,"-");this.entryCache.removeEntry(`${e}#${o}`)}let a=this.getDateExtractionConfig(),s=this.createEntriesFromFile(t,a);for(let i of s)this.entryCache.addEntry(i)}else{this.entryCache.removeEntry(e),this.entryCache.removeEntry(`${e}#start`),this.entryCache.removeEntry(`${e}#end`),this.entryCache.removeEntry(`${e}#fix`),this.entryCache.removeEntry(`${e}#fallback`);let r=this.settings.anniversaryDateProperties||[];for(let a of r){let s=a.toLowerCase().replace(/\s+/g,"-");this.entryCache.removeEntry(`${e}#${s}`)}}(n=this.eventListeners)==null||n.onEntriesUpdated(),this.notifySubscribers()}};var Ct=require("obsidian");k();j();var it="radial-calendar-plugin",Me=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],qt=["January","February","March","April","May","June","July","August","September","October","November","December"],Qt=800,b=Qt/2,K=380,Ce=340,q=335,wt=260,Y=255,G=150,Je=140,N=380,Ne=30,V=145,Jt=V+Ne,Le=V+Ne/2,Hn=(N-V)/31,xe=4,Qe=20,Re=N+2,Fe=N+8,Te=N+14,Pe=N+12,Ze=4,Mt=class extends Ct.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.tooltipEl=null}getViewType(){return it}getDisplayText(){return"Radial Calendar"}getIcon(){return"circle"}initialize(t){this.config=t,this.config.service.setEventListeners({onEntriesUpdated:()=>this.render(),onYearChanged:()=>this.render()})}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("radial-calendar-plugin"),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null,this.tooltipEl=null}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let n=this.config.service.getCurrentYear(),r=this.containerEl_.createDiv({cls:"rc-container"});this.renderHeader(r,n);let a=r.createDiv({cls:"rc-wrapper"});this.renderRadialCalendar(a,n),this.tooltipEl=r.createDiv({cls:"rc-tooltip"}),this.tooltipEl.style.display="none"}renderHeader(t,n){if(!this.config)return;let r=t.createDiv({cls:"rc-header"});r.createEl("button",{text:"\u2190",cls:"rc-nav-btn",attr:{"aria-label":"Previous year"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.previousYear()}),r.createEl("span",{text:String(n),cls:"rc-year-title"}),r.createEl("button",{text:"\u2192",cls:"rc-nav-btn",attr:{"aria-label":"Next year"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.nextYear()}),r.createEl("button",{text:"Today",cls:"rc-nav-btn rc-today-btn",attr:{"aria-label":"Go to today"}}).addEventListener("click",()=>{var c;(c=this.config)==null||c.service.goToToday()}),r.createEl("button",{text:"\u21BB",cls:"rc-nav-btn rc-refresh-btn",attr:{"aria-label":"Refresh view"}}).addEventListener("click",()=>{this.render()}),this.renderViewModeToggle(r)}renderViewModeToggle(t){if(!this.config)return;let n=this.config.settings.currentView,r=t.createDiv({cls:"rc-view-toggle"});r.createEl("button",{text:"Annual",cls:`rc-toggle-btn ${n==="annual"?"rc-toggle-btn--active":""}`,attr:{"aria-label":"Switch to annual view"}}).addEventListener("click",async()=>{if(this.config&&this.config.settings.currentView!=="annual"){let i={...this.config.settings,currentView:"annual"};this.config.settings=i,await this.config.onSettingsChange(i),this.render()}}),r.createEl("button",{text:"Life",cls:`rc-toggle-btn ${n==="life"?"rc-toggle-btn--active":""}`,attr:{"aria-label":"Switch to life view"}}).addEventListener("click",async()=>{if(this.config&&this.config.settings.currentView!=="life"){let i={...this.config.settings,currentView:"life"};this.config.settings=i,await this.config.onSettingsChange(i),this.render()}})}renderRadialCalendar(t,n){if(!this.config)return;let r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox",`0 0 ${Qt} ${Qt}`),r.setAttribute("class","rc-svg"),this.svgEl=r,this.config.settings.currentView==="life"?this.renderNestedClock(r,n):this.renderAnnualView(r,n),t.appendChild(r)}renderNestedClock(t,n){if(!this.config)return;let{birthYear:r,expectedLifespan:a}=this.config.settings,s=r+a,i=F(),o=i.year-r;this.renderBackgroundCircle(t),this.renderLifeRing(t,r,s,n),this.renderLifePhasesRing(t,r,a),this.renderYearRing(t,n),this.renderLifeActsOnRing(t,r,a),this.renderNestedCenter(t,n,o),this.renderLifePositionMarker(t,r,a,i.year,"today"),n!==i.year&&this.renderLifePositionMarker(t,r,a,n,"viewed"),n===i.year&&this.renderTodayMarkerOnYearRing(t),this.renderBirthdayMarkerOnYearRing(t,n)}renderLifeRing(t,n,r,a){let s=r-n,i=F();for(let o=n;o<r;o++){let c=o-n,d=c/s*2*Math.PI,h=(c+1)/s*2*Math.PI-.01,g=o<i.year,u=o===i.year,p=o===a,m=this.createArcPath(Ce,K,d,h),y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttribute("d",m);let f="rc-life-year";g&&(f+=" rc-life-year--past"),u&&(f+=" rc-life-year--current"),p&&(f+=" rc-life-year--selected"),y.setAttribute("class",f),y.setAttribute("data-year",String(o)),y.addEventListener("click",()=>{var D;(D=this.config)==null||D.service.setYear(o)}),y.addEventListener("mouseenter",D=>{this.showLifeYearTooltip(D,o,o-n)}),y.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(y)}for(let o=n;o<=r;o+=10){let d=(o-n)/s*2*Math.PI-Math.PI/2,h=K+12,g=b+h*Math.cos(d),u=b+h*Math.sin(d),p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x",String(g)),p.setAttribute("y",String(u)),p.setAttribute("class","rc-life-year-label"),p.setAttribute("text-anchor","middle"),p.setAttribute("dominant-baseline","central"),p.textContent=String(o),t.appendChild(p)}}renderLifePhasesRing(t,n,r){if(!this.config)return;let a=this.config.settings.lifePhasesFolder;if(!a||a.trim()==="")return;let s=this.config.service.loadLifePhases(a);if(s.length===0)return;let i=this.config.settings.birthDate,o=this.config.service.computeLifePhaseSegments(s,n,r,i),c=new Map,d=[];for(let f of o)if(f.category){let D=c.get(f.category)||[];D.push(f),c.set(f.category,D)}else d.push(f);let h=Array.from(c.keys()).sort(),g=h.length,u=nt(d),p=d.length>0?at(u):0,m=g+p;if(m===0)return;let y=this.getOrCreateDefs(t);h.forEach((f,D)=>{let v=c.get(f)||[],S=nt(v),E=at(S);for(let x of S){let P=q-D/m*(q-wt),_=q-(D+1)/m*(q-wt),U=rt(P,_,E,x.track);this.renderLifePhaseArcWithRadii(t,y,x,U)}});for(let f of u){let D=q-g/m*(q-wt),S=rt(D,wt,p,f.track);this.renderLifePhaseArcWithRadii(t,y,f,S)}}getOrCreateDefs(t){let n=t.querySelector("defs");return n||(n=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(n,t.firstChild)),n}renderLifePhaseArcWithRadii(t,n,r,a){if(r.isOngoing&&r.todayAngle!==void 0&&r.todayAngle>r.startAngle){let s=this.createArcPath(a.inner,a.outer,r.startAngle,r.todayAngle),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",s),i.setAttribute("class","rc-life-phase"),i.style.fill=r.color,i.style.opacity="1";let o=this.createArcPath(a.inner,a.outer,r.todayAngle,r.endAngle),c=document.createElementNS("http://www.w3.org/2000/svg","path");if(c.setAttribute("d",o),c.setAttribute("class","rc-life-phase rc-life-phase-future"),c.style.fill=r.color,c.style.opacity="0.35",r.filePath){i.style.cursor="pointer",c.style.cursor="pointer";let g=()=>{var u;return(u=this.config)==null?void 0:u.openFile(r.filePath)};i.addEventListener("click",g),c.addEventListener("click",g)}let d=g=>this.showPhaseTooltip(g,r),h=()=>this.hideTooltip();i.addEventListener("mouseenter",d),i.addEventListener("mouseleave",h),c.addEventListener("mouseenter",d),c.addEventListener("mouseleave",h),t.appendChild(i),t.appendChild(c)}else{let s=this.createArcPath(a.inner,a.outer,r.startAngle,r.endAngle),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",s),i.setAttribute("class","rc-life-phase"),i.style.fill=r.color,r.filePath&&(i.style.cursor="pointer",i.addEventListener("click",()=>{var o;(o=this.config)==null||o.openFile(r.filePath)})),i.addEventListener("mouseenter",o=>{this.showPhaseTooltip(o,r)}),i.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(i)}r.label&&r.endAngle-r.startAngle>.15&&this.renderPhaseLabel(t,r,a)}createPhaseGradient(t,n,r){let a=r.endAngle-r.startAngle,s=(r.todayAngle-r.startAngle)/a,i=Math.max(0,Math.min(100,s*100)),o=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");o.setAttribute("id",n);let c=(r.startAngle+r.endAngle)/2-Math.PI/2,d=50+50*Math.cos(r.startAngle-Math.PI/2),h=50+50*Math.sin(r.startAngle-Math.PI/2),g=50+50*Math.cos(r.endAngle-Math.PI/2),u=50+50*Math.sin(r.endAngle-Math.PI/2);o.setAttribute("x1",`${d}%`),o.setAttribute("y1",`${h}%`),o.setAttribute("x2",`${g}%`),o.setAttribute("y2",`${u}%`);let p=document.createElementNS("http://www.w3.org/2000/svg","stop");p.setAttribute("offset","0%"),p.setAttribute("stop-color",r.color),p.setAttribute("stop-opacity","1"),o.appendChild(p);let m=document.createElementNS("http://www.w3.org/2000/svg","stop");m.setAttribute("offset",`${i}%`),m.setAttribute("stop-color",r.color),m.setAttribute("stop-opacity","1"),o.appendChild(m);let y=document.createElementNS("http://www.w3.org/2000/svg","stop");y.setAttribute("offset",`${i+1}%`),y.setAttribute("stop-color",r.color),y.setAttribute("stop-opacity","0.4"),o.appendChild(y);let f=document.createElementNS("http://www.w3.org/2000/svg","stop");f.setAttribute("offset","100%"),f.setAttribute("stop-color",r.color),f.setAttribute("stop-opacity","0.15"),o.appendChild(f),t.appendChild(o)}renderPhaseLabel(t,n,r){let a=(n.startAngle+n.endAngle)/2-Math.PI/2,s=(r.inner+r.outer)/2,i=b+s*Math.cos(a),o=b+s*Math.sin(a),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(i)),c.setAttribute("y",String(o)),c.setAttribute("class","rc-phase-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central");let d=(a+Math.PI/2)*180/Math.PI,h=d>90&&d<270?d+180:d;c.setAttribute("transform",`rotate(${h}, ${i}, ${o})`),c.textContent=n.label,t.appendChild(c)}showPhaseTooltip(t,n){var s;if(!this.tooltipEl)return;let r=`<div class="rc-tooltip-date">${n.label}</div>`;n.isOngoing&&(r+='<div class="rc-tooltip-note" style="color: var(--text-accent);">Active (ongoing)</div>'),this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block";let a=(s=this.containerEl_)==null?void 0:s.getBoundingClientRect();if(a){let i=t.clientX-a.left+10,o=t.clientY-a.top+10;this.tooltipEl.style.left=`${i}px`,this.tooltipEl.style.top=`${o}px`}}renderYearRing(t,n){if(!this.config)return;let r=F();for(let a=1;a<=12;a++){let s=w(n,a),i=this.monthToAngle(a),c=Math.PI/6/s,d=r.year===n&&r.month===a;for(let h=1;h<=s;h++){let g=M(n,a,h),u=I(g),p=d&&r.day===h,m=u===0||u===6,y=i+(h-1)*c,f=y+c-.002,D=this.config.service.getEntriesForDate(g),v=this.createArcPath(G,Y,y,f),S=document.createElementNS("http://www.w3.org/2000/svg","path");S.setAttribute("d",v);let E=["rc-day-arc"];p&&E.push("rc-day-arc--today"),m&&E.push("rc-day-arc--weekend"),D.length>0&&E.push("rc-day-arc--has-notes"),S.setAttribute("class",E.join(" ")),S.addEventListener("click",async()=>{var x;await((x=this.config)==null?void 0:x.service.openDailyNote(g))}),S.addEventListener("mouseenter",x=>{this.showTooltip(x,g,D)}),S.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(S)}}for(let a=1;a<=12;a++){let s=this.monthToAngle(a)-Math.PI/2,i=b+G*Math.cos(s),o=b+G*Math.sin(s),c=b+Y*Math.cos(s),d=b+Y*Math.sin(s),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(i)),h.setAttribute("y1",String(o)),h.setAttribute("x2",String(c)),h.setAttribute("y2",String(d)),h.setAttribute("class","rc-month-separator"),t.appendChild(h)}for(let a=0;a<12;a++){let s=this.monthToAngle(a+1)+Math.PI/12-Math.PI/2,i=G-15,o=b+i*Math.cos(s),c=b+i*Math.sin(s),d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("x",String(o)),d.setAttribute("y",String(c)),d.setAttribute("class","rc-month-label"),d.setAttribute("text-anchor","middle"),d.setAttribute("dominant-baseline","central"),d.textContent=Me[a],t.appendChild(d)}}renderLifeActsOnRing(t,n,r){if(!this.config)return;let a=this.config.settings.lifeActs;if(a.length!==0)for(let s of a){let i=s.startAge/r*2*Math.PI,o=s.endAge/r*2*Math.PI-.01,c=this.createArcPath(K+2,K+8,i,o),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",c),d.setAttribute("class","rc-life-act"),s.color&&(d.style.fill=T[s.color]),t.appendChild(d);let h=(i+o)/2-Math.PI/2,g=K+18,u=b+g*Math.cos(h),p=b+g*Math.sin(h),m=document.createElementNS("http://www.w3.org/2000/svg","text");m.setAttribute("x",String(u)),m.setAttribute("y",String(p)),m.setAttribute("class","rc-life-act-label"),m.setAttribute("text-anchor","middle"),m.setAttribute("dominant-baseline","central");let y=(h+Math.PI/2)*180/Math.PI,f=y>90&&y<270?y+180:y;m.setAttribute("transform",`rotate(${f}, ${u}, ${p})`),s.color&&(m.style.fill=T[s.color]),m.textContent=s.label,t.appendChild(m)}}renderLifePositionMarker(t,n,r,a,s){let i=a-n;if(s==="today"){let y=F(),f=y.year%4===0&&y.year%100!==0||y.year%400===0,D=f?366:365,v=[0,31,28,31,30,31,30,31,31,30,31,30,31];f&&(v[2]=29);let S=y.day;for(let E=1;E<y.month;E++)S+=v[E];i+=S/D}let o=i/r*2*Math.PI-Math.PI/2,c=Ce-5,d=K+5,h=b+c*Math.cos(o),g=b+c*Math.sin(o),u=b+d*Math.cos(o),p=b+d*Math.sin(o),m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",String(h)),m.setAttribute("y1",String(g)),m.setAttribute("x2",String(u)),m.setAttribute("y2",String(p)),m.setAttribute("class",s==="today"?"rc-life-marker--today":"rc-life-marker--viewed"),t.appendChild(m)}renderTodayMarkerOnYearRing(t){let n=F(),r=w(n.year,n.month),a=this.monthToAngle(n.month),i=Math.PI/6/r,o=a+(n.day-.5)*i-Math.PI/2,c=b+(G-5)*Math.cos(o),d=b+(G-5)*Math.sin(o),h=b+(Y+5)*Math.cos(o),g=b+(Y+5)*Math.sin(o),u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",String(c)),u.setAttribute("y1",String(d)),u.setAttribute("x2",String(h)),u.setAttribute("y2",String(g)),u.setAttribute("class","rc-today-marker"),t.appendChild(u)}renderBirthdayMarkerOnYearRing(t,n){if(!this.config)return;let r=this.config.settings.birthDate;if(!r)return;let a=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!a)return;let s=parseInt(a[2],10),i=parseInt(a[3],10),o=w(n,s),c=this.monthToAngle(s),h=Math.PI/6/o,g=c+(i-.5)*h-Math.PI/2,u=b+(G-3)*Math.cos(g),p=b+(G-3)*Math.sin(g),m=b+(Y+3)*Math.cos(g),y=b+(Y+3)*Math.sin(g),f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",String(u)),f.setAttribute("y1",String(p)),f.setAttribute("x2",String(m)),f.setAttribute("y2",String(y)),f.setAttribute("class","rc-birthday-marker"),t.appendChild(f);let D=Y+12,v=b+D*Math.cos(g),S=b+D*Math.sin(g),E=document.createElementNS("http://www.w3.org/2000/svg","text");E.setAttribute("x",String(v)),E.setAttribute("y",String(S)),E.setAttribute("class","rc-birthday-icon"),E.setAttribute("text-anchor","middle"),E.setAttribute("dominant-baseline","central"),E.textContent="\u{1F382}",t.appendChild(E)}renderNestedCenter(t,n,r){let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",String(b)),a.setAttribute("cy",String(b)),a.setAttribute("r",String(Je-10)),a.setAttribute("class","rc-center"),t.appendChild(a);let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(b)),s.setAttribute("y",String(b-20)),s.setAttribute("class","rc-center-year"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=String(n),t.appendChild(s);let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",String(b)),i.setAttribute("y",String(b+20)),i.setAttribute("class","rc-center-age"),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","central"),i.textContent=`${r} years`,t.appendChild(i)}showLifeYearTooltip(t,n,r){var i;if(!this.tooltipEl)return;let a=`<div class="rc-tooltip-date">${n}</div>
      <div class="rc-tooltip-note">Age: ${r} years</div>`;this.tooltipEl.innerHTML=a,this.tooltipEl.style.display="block";let s=(i=this.containerEl_)==null?void 0:i.getBoundingClientRect();if(s){let o=t.clientX-s.left+10,c=t.clientY-s.top+10;this.tooltipEl.style.left=`${o}px`,this.tooltipEl.style.top=`${c}px`}}renderAnnualView(t,n){this.renderBackgroundCircle(t);let r=this.getEnabledRingsSorted();if(r.length===0)return;let a=this.calculateRingRadii(r.length);for(let s of r){let i=a.get(s.order);i&&this.renderRing(t,n,s,i)}for(let s=1;s<=12;s++)this.renderMonthSeparator(t,this.monthToAngle(s));this.renderLabelRingSeparator(t),this.renderOuterSegments(t,n),this.renderAnniversaryRing(t,n),this.renderCenter(t,n),this.renderMonthLabels(t),this.renderTodayMarker(t,n)}renderLabelRingSeparator(t){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(b)),n.setAttribute("cy",String(b)),n.setAttribute("r",String(Jt)),n.setAttribute("class","rc-label-ring-separator"),t.appendChild(n)}renderAnniversaryRing(t,n){var s;if(!this.config)return;let r=this.config.service.getAllAnniversaryEntries();if(r.length===0)return;let a=new Map;for(let i of r){let o=`${String(i.startDate.month).padStart(2,"0")}-${String(i.startDate.day).padStart(2,"0")}`,c=(s=a.get(o))!=null?s:[];c.push(i),a.set(o,c)}for(let[i,o]of a){let[c,d]=i.split("-"),h=parseInt(c,10),g=parseInt(d,10),u=w(n,h),p=this.monthToAngle(h),m=Math.PI/6,y=(g-.5)/u,f=p+y*m,D=b+Pe*Math.cos(f-Math.PI/2),v=b+Pe*Math.sin(f-Math.PI/2),S=document.createElementNS("http://www.w3.org/2000/svg","circle");S.setAttribute("cx",String(D)),S.setAttribute("cy",String(v)),S.setAttribute("r",String(Ze)),S.setAttribute("class","rc-anniversary-dot");let E=o[0];S.addEventListener("mouseenter",x=>{this.showAnniversaryTooltip(x,o)}),S.addEventListener("mouseleave",()=>this.hideTooltip()),S.addEventListener("click",()=>{var x,P;o.length===1?(x=this.config)==null||x.openFile(E.filePath):(P=this.config)==null||P.openFile(E.filePath)}),t.appendChild(S)}}showAnniversaryTooltip(t,n){var s;if(!this.tooltipEl||n.length===0)return;let r='<div class="rc-tooltip-date">\u{1F4C5}</div>';r+='<div class="rc-tooltip-notes">';for(let i of n.slice(0,5))r+=`<div class="rc-tooltip-note">${i.displayName}</div>`;n.length>5&&(r+=`<div class="rc-tooltip-more">+${n.length-5} more</div>`),r+="</div>",this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block";let a=(s=this.containerEl_)==null?void 0:s.getBoundingClientRect();if(a){let i=t.clientX-a.left+10,o=t.clientY-a.top+10;this.tooltipEl.style.left=`${i}px`,this.tooltipEl.style.top=`${o}px`}}getEnabledRingsSorted(){if(!this.config)return[];let t=[],n=this.config.settings.dailyNoteFolder;n&&n.trim()!==""&&t.push({id:"__daily_notes__",name:"Daily Notes",folder:n,color:"blue",segmentType:"daily",enabled:!0,order:0});let r=this.config.settings.rings.filter(a=>a.enabled).sort((a,s)=>a.order-s.order).map((a,s)=>({...a,order:t.length>0?s+1:s}));return t.push(...r),t}calculateRingRadii(t){let n=new Map;if(t===0)return n;let r=(t-1)*xe,a=N-Jt-r,s=Math.max(Qe,a/t);for(let i=0;i<t;i++){let o=N-i*(s+xe),c=Math.max(Jt,o-s);n.set(i,{outerRadius:o,innerRadius:c})}return n}renderRing(t,n,r,a){if(!this.config)return;let s=T[r.color]||T.blue;if(r.showSpanningArcs)this.renderSpanningArcsRing(t,n,r,a,s);else for(let i=1;i<=12;i++)this.renderRingMonthSegment(t,n,i,r,a,s)}renderSpanningArcsRing(t,n,r,a,s){if(!this.config)return;let i=this.config.service.loadSpanningArcs(r.folder,n,{startDateField:r.startDateField||"radcal-start",endDateField:r.endDateField||"radcal-end",colorField:r.colorField||"radcal-color",labelField:r.labelField||"radcal-label"});if(i.length===0){this.renderEmptyRingBackground(t,a);return}let o=nt(i),c=at(o);for(let d of o){let h=rt(a.outerRadius,a.innerRadius,c,d.track);this.renderSpanningArc(t,d,h,r,s)}}renderEmptyRingBackground(t,n){let r=this.createArcPath(n.innerRadius,n.outerRadius,0,2*Math.PI-.001),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",r),a.setAttribute("class","rc-ring-arc"),a.style.fill="var(--background-secondary)",a.style.fillOpacity="0.3",t.appendChild(a)}renderSpanningArc(t,n,r,a,s){if(!this.config)return;let i=this.createArcPath(r.inner,r.outer,n.startAngle,n.endAngle),o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",i),o.setAttribute("class","rc-ring-arc"),o.style.fill=n.color||s,n.filePath&&(o.style.cursor="pointer",o.addEventListener("click",()=>{var c;(c=this.config)==null||c.openFile(n.filePath)})),o.addEventListener("mouseenter",c=>{this.showSpanningArcTooltip(c,n,a)}),o.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(o),n.label&&n.endAngle-n.startAngle>.26&&this.renderSpanningArcLabel(t,n,r)}renderSpanningArcLabel(t,n,r){let a=(n.startAngle+n.endAngle)/2-Math.PI/2,s=(r.inner+r.outer)/2,i=b+s*Math.cos(a),o=b+s*Math.sin(a),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(i)),c.setAttribute("y",String(o)),c.setAttribute("class","rc-phase-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central");let d=(a+Math.PI/2)*180/Math.PI,h=d>90&&d<270?d+180:d;c.setAttribute("transform",`rotate(${h}, ${i}, ${o})`),c.textContent=n.label,t.appendChild(c)}showSpanningArcTooltip(t,n,r){var i;if(!this.tooltipEl)return;let a=`<div class="rc-tooltip-ring" style="color: ${n.color}">${r.name}</div>`;a+=`<div class="rc-tooltip-date">${n.label}</div>`,this.tooltipEl.innerHTML=a,this.tooltipEl.style.display="block";let s=(i=this.containerEl_)==null?void 0:i.getBoundingClientRect();if(s){let o=t.clientX-s.left+10,c=t.clientY-s.top+10;this.tooltipEl.style.left=`${o}px`,this.tooltipEl.style.top=`${c}px`}}renderRingMonthSegment(t,n,r,a,s,i){if(!this.config)return;let o=w(n,r),c=this.monthToAngle(r),h=Math.PI/6/o,g=F(),u=g.year===n&&g.month===r,p=this.config.service.getEntriesForDate(M(n,r,1));for(let m=1;m<=o;m++){let y=M(n,r,m),f=I(y),D=u&&g.day===m,v=f===0||f===6,S=c+(m-1)*h,E=S+h-.002,x=this.getEntriesForRing(y,a);this.renderRingDayArc(t,y,S,E,D,v,x,s,i,a)}}getEntriesForRing(t,n){if(!this.config)return[];let r=this.config.service.getEntriesForDate(t);if(!n.folder||n.folder.trim()==="")return r;let a=n.folder.replace(/^\/+|\/+$/g,"");return r.filter(s=>{let o=(s.metadata.folder||"").replace(/^\/+|\/+$/g,"");return o===a||o.startsWith(a+"/")})}renderRingDayArc(t,n,r,a,s,i,o,c,d,h){if(!this.config)return;let g=this.createArcPath(c.innerRadius,c.outerRadius,r,a),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",g);let p=["rc-day-arc",`rc-ring-${h.order}`];s&&p.push("rc-day-arc--today"),i&&p.push("rc-day-arc--weekend"),o.length>0&&p.push("rc-day-arc--has-notes"),o.length>3&&p.push("rc-day-arc--many-notes"),u.setAttribute("class",p.join(" ")),u.setAttribute("data-date",`${n.year}-${String(n.month).padStart(2,"0")}-${String(n.day).padStart(2,"0")}`),u.setAttribute("data-ring",h.id),o.length>0&&(u.style.fill=d,u.style.fillOpacity="0.6"),u.addEventListener("click",async m=>{var y;m.preventDefault(),o.length>0?this.showDayContextMenu(m,n,o):await((y=this.config)==null?void 0:y.service.openDailyNote(n))}),u.addEventListener("mouseenter",m=>{this.showRingTooltip(m,n,o,h)}),u.addEventListener("mouseleave",()=>{this.hideTooltip()}),u.addEventListener("contextmenu",m=>{m.preventDefault(),this.showDayContextMenu(m,n,o)}),t.appendChild(u),o.length>0&&this.renderRingNoteIndicators(t,r,a,o,c,d)}renderRingNoteIndicators(t,n,r,a,s,i){let o=Math.min(10,(s.outerRadius-s.innerRadius)*.3),c=s.outerRadius-o,d=s.outerRadius-2,h=Math.min(a.length,3),g=(r-n)/h;for(let u=0;u<h;u++){let p=n+u*g+.001,m=p+g-.002,y=this.createArcPath(c,d,p,m),f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d",y),f.setAttribute("class","rc-note-indicator"),f.style.fill=i,t.appendChild(f)}}showRingTooltip(t,n,r,a){var d;if(!this.tooltipEl)return;let o=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][I(n)]}, ${qt[n.month-1]} ${n.day}, ${n.year}`}</div>`;if(o+=`<div class="rc-tooltip-ring" style="color: ${T[a.color]}">${a.name}</div>`,r.length>0){o+='<div class="rc-tooltip-notes">';for(let h of r.slice(0,5))o+=`<div class="rc-tooltip-note">${h.displayName}</div>`;r.length>5&&(o+=`<div class="rc-tooltip-more">+${r.length-5} more</div>`),o+="</div>"}this.tooltipEl.innerHTML=o,this.tooltipEl.style.display="block";let c=(d=this.containerEl_)==null?void 0:d.getBoundingClientRect();if(c){let h=t.clientX-c.left+10,g=t.clientY-c.top+10;this.tooltipEl.style.left=`${h}px`,this.tooltipEl.style.top=`${g}px`}}renderBackgroundCircle(t){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(b)),n.setAttribute("cy",String(b)),n.setAttribute("r",String(N)),n.setAttribute("class","rc-background"),t.appendChild(n)}renderCenter(t,n){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(b)),r.setAttribute("cy",String(b)),r.setAttribute("r",String(V-10)),r.setAttribute("class","rc-center"),t.appendChild(r)}renderMonthLabels(t){for(let n=0;n<12;n++){let r=this.monthToAngle(n+1)+Math.PI/12,a=b+Le*Math.cos(r-Math.PI/2),s=b+Le*Math.sin(r-Math.PI/2),i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",String(a)),i.setAttribute("y",String(s)),i.setAttribute("class","rc-month-label"),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","central"),i.textContent=Me[n],t.appendChild(i)}}renderMonthSegment(t,n,r){if(!this.config)return;let a=w(n,r),s=this.monthToAngle(r),o=Math.PI/6/a,c=F(),d=c.year===n&&c.month===r;for(let h=1;h<=a;h++){let g=M(n,r,h),u=I(g),p=d&&c.day===h,m=u===0||u===6,y=s+(h-1)*o,f=y+o-.002,D=this.config.service.getEntriesForDate(g);this.renderDayArc(t,g,y,f,p,m,D)}this.renderMonthSeparator(t,s)}renderDayArc(t,n,r,a,s,i,o){if(!this.config)return;let c=V,d=N,h=this.createArcPath(c,d,r,a),g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d",h);let u=["rc-day-arc"];s&&u.push("rc-day-arc--today"),i&&u.push("rc-day-arc--weekend"),o.length>0&&u.push("rc-day-arc--has-notes"),o.length>3&&u.push("rc-day-arc--many-notes"),g.setAttribute("class",u.join(" ")),g.setAttribute("data-date",`${n.year}-${String(n.month).padStart(2,"0")}-${String(n.day).padStart(2,"0")}`),g.addEventListener("click",async p=>{var m;p.preventDefault(),await((m=this.config)==null?void 0:m.service.openDailyNote(n))}),g.addEventListener("mouseenter",p=>{this.showTooltip(p,n,o)}),g.addEventListener("mouseleave",()=>{this.hideTooltip()}),g.addEventListener("contextmenu",p=>{p.preventDefault(),o.length>0&&this.showDayContextMenu(p,n,o)}),t.appendChild(g),o.length>0&&this.renderNoteIndicators(t,r,a,o)}renderNoteIndicators(t,n,r,a){let s=N-15,i=N-5,o=Math.min(a.length,3),c=(r-n)/o;for(let d=0;d<o;d++){let h=n+d*c+.001,g=h+c-.002,u=this.createArcPath(s,i,h,g),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",u),p.setAttribute("class","rc-note-indicator"),t.appendChild(p)}}renderMonthSeparator(t,n){let r=b+V*Math.cos(n-Math.PI/2),a=b+V*Math.sin(n-Math.PI/2),s=b+N*Math.cos(n-Math.PI/2),i=b+N*Math.sin(n-Math.PI/2),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(r)),o.setAttribute("y1",String(a)),o.setAttribute("x2",String(s)),o.setAttribute("y2",String(i)),o.setAttribute("class","rc-month-separator"),t.appendChild(o)}renderTodayMarker(t,n){let r=F();if(r.year!==n)return;let a=w(n,r.month),s=this.monthToAngle(r.month),o=Math.PI/6/a,c=s+(r.day-.5)*o,d=b+(V-10)*Math.cos(c-Math.PI/2),h=b+(V-10)*Math.sin(c-Math.PI/2),g=b+(N+5)*Math.cos(c-Math.PI/2),u=b+(N+5)*Math.sin(c-Math.PI/2),p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttribute("x1",String(d)),p.setAttribute("y1",String(h)),p.setAttribute("x2",String(g)),p.setAttribute("y2",String(u)),p.setAttribute("class","rc-today-marker"),t.appendChild(p)}createArcPath(t,n,r,a){let s=r-Math.PI/2,i=a-Math.PI/2,o=b+t*Math.cos(s),c=b+t*Math.sin(s),d=b+t*Math.cos(i),h=b+t*Math.sin(i),g=b+n*Math.cos(s),u=b+n*Math.sin(s),p=b+n*Math.cos(i),m=b+n*Math.sin(i),y=a-r>Math.PI?1:0;return`
      M ${o} ${c}
      L ${g} ${u}
      A ${n} ${n} 0 ${y} 1 ${p} ${m}
      L ${d} ${h}
      A ${t} ${t} 0 ${y} 0 ${o} ${c}
      Z
    `}monthToAngle(t){return(t-1)*Math.PI/6}showTooltip(t,n,r){var c;if(!this.tooltipEl)return;let i=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][I(n)]}, ${qt[n.month-1]} ${n.day}, ${n.year}`}</div>`;if(r.length>0){i+='<div class="rc-tooltip-notes">';for(let d of r.slice(0,5))i+=`<div class="rc-tooltip-note">${d.displayName}</div>`;r.length>5&&(i+=`<div class="rc-tooltip-more">+${r.length-5} more</div>`),i+="</div>"}this.tooltipEl.innerHTML=i,this.tooltipEl.style.display="block";let o=(c=this.containerEl_)==null?void 0:c.getBoundingClientRect();if(o){let d=t.clientX-o.left+10,h=t.clientY-o.top+10;this.tooltipEl.style.left=`${d}px`,this.tooltipEl.style.top=`${h}px`}}hideTooltip(){this.tooltipEl&&(this.tooltipEl.style.display="none")}showDayContextMenu(t,n,r){if(!this.config)return;let a=new Ct.Menu;a.addItem(s=>{s.setTitle(`Open ${qt[n.month-1]} ${n.day}`).setIcon("calendar").onClick(async()=>{var i;await((i=this.config)==null?void 0:i.service.openDailyNote(n))})}),a.addSeparator();for(let s of r.slice(0,10))a.addItem(i=>{i.setTitle(s.displayName).setIcon("file").onClick(()=>{var o;(o=this.config)==null||o.openFile(s.filePath)})});r.length>10&&a.addItem(s=>{s.setTitle(`+${r.length-10} more...`).setDisabled(!0)}),a.showAtMouseEvent(t)}renderOuterSegments(t,n){if(!this.config)return;let r=this.getSegmentsForCurrentView();if(r.length!==0)for(let a of r)this.renderSegmentTick(t,a,n)}getSegmentsForCurrentView(){if(!this.config)return[];let t=this.config.settings;if(t.currentView==="life")return this.lifeActsToSegments(t.lifeActs);switch(t.annualSegmentType){case"seasons":return Wt;case"quarters":return jt;case"semester":return zt;case"ten-days":return Ht();case"weeks":return Ut();case"custom":return t.customSegments;case"none":default:return[]}}lifeActsToSegments(t){if(!this.config)return[];let{birthYear:n,expectedLifespan:r}=this.config.settings,a=r;return t.map(s=>{let i=Math.floor(s.startAge/a*365)+1,o=Math.floor(s.endAge/a*365);return{id:s.id,label:s.label,startDay:i,endDay:o,color:s.color}})}renderSegmentTick(t,n,r){if(!this.config)return;let a=this.config.settings.showSegmentLabels,s=this.dayOfYearToAngle(n.startDay),i=n.endDay>n.startDay?this.dayOfYearToAngle(n.endDay):this.dayOfYearToAngle(n.endDay)+2*Math.PI,o=s-Math.PI/2,c=b+Re*Math.cos(o),d=b+Re*Math.sin(o),h=b+Fe*Math.cos(o),g=b+Fe*Math.sin(o),u=document.createElementNS("http://www.w3.org/2000/svg","line");if(u.setAttribute("x1",String(c)),u.setAttribute("y1",String(d)),u.setAttribute("x2",String(h)),u.setAttribute("y2",String(g)),u.setAttribute("class","rc-segment-tick"),n.color&&(u.style.stroke=T[n.color]),t.appendChild(u),a){let p;n.endDay>n.startDay?p=(s+i)/2:(p=(s+i)/2,p>2*Math.PI&&(p-=2*Math.PI));let m=p-Math.PI/2,y=b+Te*Math.cos(m),f=b+Te*Math.sin(m),D=document.createElementNS("http://www.w3.org/2000/svg","text");D.setAttribute("x",String(y)),D.setAttribute("y",String(f)),D.setAttribute("class","rc-segment-label"),D.setAttribute("text-anchor","middle"),D.setAttribute("dominant-baseline","central");let v=p*180/Math.PI,S=v>90&&v<270?v+180:v;D.setAttribute("transform",`rotate(${S}, ${y}, ${f})`),n.color&&(D.style.fill=T[n.color]),D.textContent=n.label,t.appendChild(D)}}dayOfYearToAngle(t){return(t-1)/365*2*Math.PI}};var Rt=require("obsidian");k();var tn=["January","February","March","April","May","June","July","August","September","October","November","December"],lt="local-calendar-view",Zt=300,L=Zt/2,st=140,Lt=115,ot=105,J=40,en=35,xt=class extends Rt.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.activeFileDate=null}getViewType(){return lt}getDisplayText(){return"Local Calendar"}getIcon(){return"clock"}initialize(t){this.config=t,this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updateActiveFileDate(),this.render()})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.updateActiveFileDate(),this.render()}))}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("local-calendar-view"),this.updateActiveFileDate(),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null}updateActiveFileDate(){this.config&&(this.activeFileDate=this.config.getActiveFileDate())}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let t=this.containerEl_.createDiv({cls:"lc-container"}),n=t.createDiv({cls:"lc-title"});this.activeFileDate?n.textContent=`${this.activeFileDate.day}.${this.activeFileDate.month}.${this.activeFileDate.year}`:n.textContent="Keine Datums-Notiz";let r=t.createDiv({cls:"lc-wrapper"});this.renderNestedClock(r)}renderNestedClock(t){if(!this.config)return;let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("viewBox",`0 0 ${Zt} ${Zt}`),n.setAttribute("class","lc-svg"),this.svgEl=n;let{birthYear:r,expectedLifespan:a}=this.config.settings,s=r+a,i=F(),o=this.activeFileDate||i,c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx",String(L)),c.setAttribute("cy",String(L)),c.setAttribute("r",String(st)),c.setAttribute("class","lc-background"),n.appendChild(c),this.renderLifeRing(n,r,s,o.year,i.year),this.renderYearRing(n,o,i),this.renderCenter(n,o),this.activeFileDate&&this.renderNoteMarkers(n,r,a,this.activeFileDate),(!this.activeFileDate||this.activeFileDate.year!==i.year||this.activeFileDate.month!==i.month||this.activeFileDate.day!==i.day)&&this.renderTodayMarkers(n,r,a,i),t.appendChild(n)}renderLifeRing(t,n,r,a,s){let i=r-n;for(let o=0;o<i;o+=10){let c=o/i*2*Math.PI,d=Math.min((o+10)/i*2*Math.PI,2*Math.PI)-.02,h=this.createArcPath(Lt,st,c,d),g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d",h);let u=n+o,p=u+10<=s,m=u<=s&&s<u+10,y="lc-life-decade";p&&(y+=" lc-life-decade--past"),m&&(y+=" lc-life-decade--current"),g.setAttribute("class",y),t.appendChild(g);let f=(o+5)/i*2*Math.PI-Math.PI/2,D=(Lt+st)/2,v=L+D*Math.cos(f),S=L+D*Math.sin(f),E=document.createElementNS("http://www.w3.org/2000/svg","text");E.setAttribute("x",String(v)),E.setAttribute("y",String(S)),E.setAttribute("class","lc-decade-label"),E.setAttribute("text-anchor","middle"),E.setAttribute("dominant-baseline","central"),E.textContent=String(n+o),t.appendChild(E)}}renderYearRing(t,n,r){if(!this.config)return;let a=n.year;for(let i=1;i<=12;i++){let o=w(a,i),c=this.monthToAngle(i),h=Math.PI/6/o;for(let g=1;g<=o;g++){let u=M(a,i,g),p=I(u),m=r.year===a&&r.month===i&&r.day===g,y=n.month===i&&n.day===g,f=p===0||p===6,D=c+(g-1)*h,v=D+h-.002,S=this.config.service.getEntriesForDate(u),E=this.createArcPath(J,ot,D,v),x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttribute("d",E);let P=["lc-day"];m&&P.push("lc-day--today"),y&&P.push("lc-day--note"),f&&P.push("lc-day--weekend"),S.length>0&&P.push("lc-day--has-notes"),S.length>2&&P.push("lc-day--many-notes"),x.setAttribute("class",P.join(" ")),x.style.cursor="pointer",x.addEventListener("click",_=>{var U;_.preventDefault(),_.stopPropagation(),S.length>0?this.showDayContextMenu(_,u,S):(U=this.config)==null||U.service.openDailyNote(u)}),t.appendChild(x)}}for(let i=1;i<=12;i++){let o=this.monthToAngle(i)-Math.PI/2,c=L+J*Math.cos(o),d=L+J*Math.sin(o),h=L+ot*Math.cos(o),g=L+ot*Math.sin(o),u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",String(c)),u.setAttribute("y1",String(d)),u.setAttribute("x2",String(h)),u.setAttribute("y2",String(g)),u.setAttribute("class","lc-month-separator"),t.appendChild(u)}let s=["J","F","M","A","M","J","J","A","S","O","N","D"];for(let i=0;i<12;i++){let o=this.monthToAngle(i+1)+Math.PI/12-Math.PI/2,c=J-8,d=L+c*Math.cos(o),h=L+c*Math.sin(o),g=document.createElementNS("http://www.w3.org/2000/svg","text");g.setAttribute("x",String(d)),g.setAttribute("y",String(h)),g.setAttribute("class","lc-month-label"),g.setAttribute("text-anchor","middle"),g.setAttribute("dominant-baseline","central"),g.textContent=s[i],t.appendChild(g)}}monthToAngle(t){return(t-1)*Math.PI/6}renderCenter(t,n){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(L)),r.setAttribute("cy",String(L)),r.setAttribute("r",String(en-5)),r.setAttribute("class","lc-center"),t.appendChild(r);let a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",String(L)),a.setAttribute("y",String(L)),a.setAttribute("class","lc-center-day"),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","central"),a.textContent=String(n.day),t.appendChild(a)}renderNoteMarkers(t,n,r,a){let i=(a.year-n)/r*2*Math.PI-Math.PI/2;this.drawMarker(t,i,Lt-3,st+3,"lc-marker--note");let o=this.dateToAngle(a);this.drawMarker(t,o,J-3,ot+3,"lc-marker--note")}renderTodayMarkers(t,n,r,a){let i=(a.year-n)/r*2*Math.PI-Math.PI/2;this.drawMarker(t,i,Lt,st,"lc-marker--today");let o=this.dateToAngle(a);this.drawMarker(t,o,J,ot,"lc-marker--today")}dateToAngle(t){let n=w(t.year,t.month),r=this.monthToAngle(t.month),s=Math.PI/6/n;return r+(t.day-.5)*s-Math.PI/2}drawMarker(t,n,r,a,s){let i=L+r*Math.cos(n),o=L+r*Math.sin(n),c=L+a*Math.cos(n),d=L+a*Math.sin(n),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(i)),h.setAttribute("y1",String(o)),h.setAttribute("x2",String(c)),h.setAttribute("y2",String(d)),h.setAttribute("class",s),t.appendChild(h)}showDayContextMenu(t,n,r){if(!this.config)return;let a=new Rt.Menu;if(a.addItem(s=>{s.setTitle(`${n.day}. ${tn[n.month-1]} ${n.year}`).setIcon("calendar").setDisabled(!0)}),a.addSeparator(),a.addItem(s=>{s.setTitle("Neue Notiz erstellen").setIcon("plus").onClick(async()=>{var i;await((i=this.config)==null?void 0:i.service.openDailyNote(n))})}),r.length>0){a.addSeparator();for(let s of r.slice(0,10))a.addItem(i=>{i.setTitle(s.displayName).setIcon("file").onClick(async()=>{var o;await((o=this.config)==null?void 0:o.openFile(s.filePath))})});r.length>10&&a.addItem(s=>{s.setTitle(`+${r.length-10} weitere...`).setDisabled(!0)})}a.showAtMouseEvent(t)}createArcPath(t,n,r,a){let s=r-Math.PI/2,i=a-Math.PI/2,o=L+t*Math.cos(s),c=L+t*Math.sin(s),d=L+t*Math.cos(i),h=L+t*Math.sin(i),g=L+n*Math.cos(s),u=L+n*Math.sin(s),p=L+n*Math.cos(i),m=L+n*Math.sin(i),y=a-r>Math.PI?1:0;return`
      M ${o} ${c}
      L ${g} ${u}
      A ${n} ${n} 0 ${y} 1 ${p} ${m}
      L ${d} ${h}
      A ${t} ${t} 0 ${y} 0 ${o} ${c}
      Z
    `}};var Q=require("obsidian");k();var Ie={style:"annual",showLabels:!0,showToday:!0,showAnniversaries:!1,segments:"none"};function ke(l){let e={...Ie},t=l.trim().split(`
`),n=!1,r=!1,a=!1,s=0,i=[],o=[],c=[],d=null;for(let h of t){let g=h.trim();if(!g||g.startsWith("#"))continue;if(a)if(h.length-h.trimStart().length>s||g.startsWith("-")){i.push(h);continue}else a=!1,e.filter=Ft(i);if(g.startsWith("- ")){if(n){d&&d.folder&&o.push({folder:d.folder,color:d.color||"blue",label:d.label});let f=g.match(/^-\s*folder:\s*["']?([^"'\n]+)["']?/);f?d={folder:f[1].trim()}:d={};continue}if(r){let f=g.slice(2).trim().replace(/["']/g,"");c.push(f);continue}}if(n&&d&&(h.startsWith("    ")||h.startsWith("	"))){let[f,...D]=g.split(":"),v=D.join(":").trim().replace(/["']/g,"");switch(f.trim()){case"folder":d.folder=v;break;case"color":d.color=v;break;case"label":d.label=v;break}continue}let u=g.indexOf(":");if(u===-1)continue;let p=g.slice(0,u).trim(),m=g.slice(u+1).trim();if(p==="rings"&&(!m||m==="")){d&&d.folder&&o.push({folder:d.folder,color:d.color||"blue",label:d.label}),n=!0,r=!1,d=null;continue}if(p==="folders"&&(!m||m==="")){r=!0,n=!1;continue}!h.startsWith(" ")&&!h.startsWith("	")&&!g.startsWith("-")&&(n&&d&&d.folder&&(o.push({folder:d.folder,color:d.color||"blue",label:d.label}),d=null),n=!1,r=!1);let y=m.replace(/["']/g,"");switch(p){case"year":e.year=parseInt(y,10);break;case"style":(y==="annual"||y==="life")&&(e.style=y);break;case"dateProperty":e.dateProperty=y;break;case"folder":e.folder=y;break;case"filter":y?e.filter=y:(a=!0,s=h.indexOf("filter"));break;case"showLabels":e.showLabels=y==="true";break;case"showToday":e.showToday=y==="true";break;case"showAnniversaries":e.showAnniversaries=y==="true";break;case"segments":["none","seasons","quarters","weeks"].includes(y)&&(e.segments=y);break;case"birthYear":e.birthYear=parseInt(y,10);break;case"lifespan":e.lifespan=parseInt(y,10);break}}return d&&d.folder&&o.push({folder:d.folder,color:d.color||"blue",label:d.label}),a&&i.length>0&&(e.filter=Ft(i)),o.length>0&&(e.rings=o),c.length>0&&(e.folders=c),e}function Ft(l){let e={},t=null,n=[],r=[],a=-1;for(let s of l){let i=s.trim();if(!i)continue;let o=s.length-s.trimStart().length;if(a>=0)if(o>a){r.push(s);continue}else r.length>0&&(n.push(Ft(r)),r=[]),a=-1;if(i==="and:"||i==="or:"||i==="not:"){t&&n.length>0&&(e[t]=[...n],n.length=0),t=i.slice(0,-1);continue}if(i.startsWith("- ")){let c=i.slice(2).trim();c==="and:"||c==="or:"||c==="not:"?(a=o,r=[s]):n.push(c)}}return r.length>0&&n.push(Ft(r)),t&&n.length>0&&(e[t]=n),e}k();j();var te=800,R=te/2,z=380,Ve=30,H=145,nn=H+Ve,$e=4,rn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Tt=class{render(e,t,n,r){var o;let a=this.createSVG();this.renderBackground(a);let s=((o=e.rings)==null?void 0:o.length)||1,i=this.calculateRingRadii(s);if(e.rings&&e.rings.length>0)e.rings.forEach((c,d)=>{let h=i.get(d);if(h){let g=T[c.color]||T.blue;this.renderDataRing(a,n,t,h,g,c.folder,r)}});else{let c=i.get(0);if(c){let d=T.blue;this.renderDataRing(a,n,t,c,d,e.folder,r)}}return this.renderMonthSeparators(a),e.showLabels&&this.renderMonthLabels(a),e.showToday&&this.renderTodayMarker(a,n),this.renderCenter(a,n),a}createSVG(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("viewBox",`0 0 ${te} ${te}`),e.setAttribute("class","radcal-svg"),e.style.width="100%",e.style.height="auto",e.style.maxWidth="800px",e}renderBackground(e){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",String(R)),t.setAttribute("cy",String(R)),t.setAttribute("r",String(z)),t.setAttribute("class","rc-background"),e.appendChild(t)}calculateRingRadii(e){let t=new Map,n=z-nn,r=(e-1)*$e,a=(n-r)/e;for(let s=0;s<e;s++){let i=z-s*(a+$e),o=i-a;t.set(s,{innerRadius:o,outerRadius:i})}return t}renderDataRing(e,t,n,r,a,s,i){for(let o=1;o<=12;o++){let c=w(t,o),d=this.monthToAngle(o),g=Math.PI/6/c;for(let u=1;u<=c;u++){let p=M(t,o,u),m=`${t}-${String(o).padStart(2,"0")}-${String(u).padStart(2,"0")}`,y=n.get(m)||[];s&&(y=y.filter(E=>E.metadata.folder.startsWith(s)));let f=d+(u-1)*g,D=f+g,v=document.createElementNS("http://www.w3.org/2000/svg","path"),S=this.createArcPath(r.innerRadius,r.outerRadius,f,D);if(v.setAttribute("d",S),v.setAttribute("class","rc-day-arc"),y.length>0&&(v.style.fill=a,v.style.opacity=String(Math.min(.3+y.length*.15,1)),v.style.cursor="pointer",v.setAttribute("data-date",m),v.setAttribute("data-count",String(y.length)),v.setAttribute("data-names",y.map(E=>E.displayName).join("|")),i)){let E=p,x=y;v.addEventListener("click",P=>i(P,E,x))}e.appendChild(v)}}}renderMonthSeparators(e){for(let t=1;t<=12;t++){let n=this.monthToAngle(t)-Math.PI/2,r=R+H*Math.cos(n),a=R+H*Math.sin(n),s=R+z*Math.cos(n),i=R+z*Math.sin(n),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(r)),o.setAttribute("y1",String(a)),o.setAttribute("x2",String(s)),o.setAttribute("y2",String(i)),o.setAttribute("class","rc-month-separator"),e.appendChild(o)}}renderMonthLabels(e){let t=H+Ve/2;for(let n=1;n<=12;n++){let r=this.monthToAngle(n)+Math.PI/12-Math.PI/2,a=R+t*Math.cos(r),s=R+t*Math.sin(r),i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",String(a)),i.setAttribute("y",String(s)),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","central"),i.setAttribute("class","rc-month-label"),i.textContent=rn[n-1],e.appendChild(i)}}renderTodayMarker(e,t){let n=F();if(n.year!==t)return;let r=w(t,n.month),a=this.monthToAngle(n.month),s=Math.PI/6/r,o=a+(n.day-.5)*s-Math.PI/2,c=R+H*Math.cos(o),d=R+H*Math.sin(o),h=R+z*Math.cos(o),g=R+z*Math.sin(o),u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",String(c)),u.setAttribute("y1",String(d)),u.setAttribute("x2",String(h)),u.setAttribute("y2",String(g)),u.setAttribute("class","rc-today-marker"),e.appendChild(u)}renderCenter(e,t){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(R)),n.setAttribute("cy",String(R)),n.setAttribute("r",String(H-5)),n.setAttribute("class","rc-center"),e.appendChild(n);let r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",String(R)),r.setAttribute("y",String(R)),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.setAttribute("class","rc-center-text"),r.textContent=String(t),e.appendChild(r)}createArcPath(e,t,n,r){let a=n-Math.PI/2,s=r-Math.PI/2,i=R+e*Math.cos(a),o=R+e*Math.sin(a),c=R+e*Math.cos(s),d=R+e*Math.sin(s),h=R+t*Math.cos(a),g=R+t*Math.sin(a),u=R+t*Math.cos(s),p=R+t*Math.sin(s),m=r-n>Math.PI?1:0;return`
      M ${i} ${o}
      L ${h} ${g}
      A ${t} ${t} 0 ${m} 1 ${u} ${p}
      L ${c} ${d}
      A ${e} ${e} 0 ${m} 0 ${i} ${o}
      Z
    `}monthToAngle(e){return(e-1)*Math.PI/6}};var Pt=class{constructor(e){this.app=e}createContext(e){var a,s,i;let t=this.app.metadataCache.getFileCache(e),n=[];if((a=t==null?void 0:t.frontmatter)!=null&&a.tags){let o=t.frontmatter.tags;Array.isArray(o)?n.push(...o.map(c=>this.normalizeTag(c))):typeof o=="string"&&n.push(this.normalizeTag(o))}if(t!=null&&t.tags)for(let o of t.tags)n.push(this.normalizeTag(o.tag));let r=[];if(t!=null&&t.links)for(let o of t.links)r.push(o.link);if(t!=null&&t.frontmatterLinks)for(let o of t.frontmatterLinks)r.push(o.link);return{file:e,metadata:t,tags:[...new Set(n)],folder:(i=(s=e.parent)==null?void 0:s.path)!=null?i:"",links:[...new Set(r)]}}normalizeTag(e){return e.replace(/^#/,"").toLowerCase()}evaluate(e,t){return typeof e=="string"?this.evaluateString(e,t):this.evaluateYaml(e,t)}evaluateYaml(e,t){return e.and?e.and.every(n=>this.evaluate(n,t)):e.or?e.or.some(n=>this.evaluate(n,t)):e.not?e.not.every(n=>!this.evaluate(n,t)):!0}evaluateString(e,t){let n=e.trim();if(!n)return!0;if(n.startsWith("(")&&n.endsWith(")"))return this.evaluateString(n.slice(1,-1),t);let r=this.splitByOperator(n,"||");if(r.length>1)return r.some(s=>this.evaluateString(s,t));let a=this.splitByOperator(n,"&&");return a.length>1?a.every(s=>this.evaluateString(s,t)):n.startsWith("!")?!this.evaluateString(n.slice(1),t):this.evaluateFunction(n,t)}splitByOperator(e,t){let n=[],r="",a=0,s=0;for(;s<e.length;){let i=e[s];if(i==="(")a++,r+=i;else if(i===")")a--,r+=i;else if(a===0&&e.slice(s,s+t.length)===t){n.push(r.trim()),r="",s+=t.length;continue}else r+=i;s++}return r.trim()&&n.push(r.trim()),n}evaluateFunction(e,t){let n=e.match(/^file\.hasTag\s*\(\s*["']([^"']+)["']\s*\)$/);if(n){let s=this.normalizeTag(n[1]);return t.tags.some(i=>i===s||i.startsWith(s+"/"))}let r=e.match(/^file\.inFolder\s*\(\s*["']([^"']+)["']\s*\)$/);if(r){let s=r[1].replace(/^\/|\/$/g,""),i=t.folder.replace(/^\/|\/$/g,"");return i===s||i.startsWith(s+"/")}let a=e.match(/^file\.hasLink\s*\(\s*["']([^"']+)["']\s*\)$/);if(a){let s=a[1].toLowerCase();return t.links.some(i=>i.toLowerCase()===s||i.toLowerCase().endsWith("/"+s))}return console.warn(`Radcal: Unknown filter function: ${e}`),!0}};var ee=class extends Q.MarkdownRenderChild{constructor(t,n,r,a,s){super(t);this.app=n;this.service=r;this.config=a;this.openFile=s;this.unsubscribe=null;this.filterEngine=new Pt(n)}onload(){this.render(),this.unsubscribe=this.service.subscribeToUpdates(()=>{this.render()})}onunload(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}render(){var o;this.containerEl.empty();let t=(o=this.config.year)!=null?o:this.service.getCurrentYear(),n=this.loadFilteredEntries(t),a=new Tt().render(this.config,n,t,(c,d,h)=>this.handleDayClick(c,d,h)),s=this.containerEl.createDiv({cls:"radcal-tooltip"});this.containerEl.createDiv({cls:"radcal-block-content"}).appendChild(a),this.setupTooltips(a,s,t)}loadFilteredEntries(t){let n=new Map;if(this.config.dateProperty)return this.loadEntriesByProperty(t);for(let r=1;r<=12;r++){let a=w(t,r);for(let s=1;s<=a;s++){let i=M(t,r,s),o=`${t}-${String(r).padStart(2,"0")}-${String(s).padStart(2,"0")}`,c=[...this.service.getEntriesForDate(i)];if(this.config.filter&&(c=c.filter(d=>{let h=this.app.vault.getAbstractFileByPath(d.filePath);if(!(h instanceof Q.TFile))return!1;let g=this.filterEngine.createContext(h);return this.filterEngine.evaluate(this.config.filter,g)})),!this.config.filter&&this.config.folder){let d=this.config.folder;c=c.filter(h=>h.metadata.folder===d||h.metadata.folder.startsWith(d+"/"))}if(!this.config.filter&&this.config.folders&&this.config.folders.length>0){let d=this.config.folders;c=c.filter(h=>d.some(g=>h.metadata.folder===g||h.metadata.folder.startsWith(g+"/")))}c.length>0&&n.set(o,c)}}return n}loadEntriesByProperty(t){var s,i;let n=new Map,r=this.config.dateProperty,a=this.app.vault.getMarkdownFiles();for(let o of a){if(this.config.filter){let m=this.filterEngine.createContext(o);if(!this.filterEngine.evaluate(this.config.filter,m))continue}let c=this.app.metadataCache.getFileCache(o),d=c==null?void 0:c.frontmatter;if(!d)continue;let h=d[r];if(!h)continue;let g=this.parseDate(h);if(!g||g.year!==t)continue;let u=`${g.year}-${String(g.month).padStart(2,"0")}-${String(g.day).padStart(2,"0")}`,p={id:o.path,filePath:o.path,fileName:o.name,displayName:o.basename,startDate:g,endDate:null,isMultiDay:!1,isAnniversary:!1,metadata:{tags:[],folder:(i=(s=o.parent)==null?void 0:s.path)!=null?i:"",properties:{}}};n.has(u)||n.set(u,[]),n.get(u).push(p)}return n}parseDate(t){if(!t)return null;if(t instanceof Date)return M(t.getFullYear(),t.getMonth()+1,t.getDate());if(typeof t=="string"){let n=t.match(/(\d{4})-(\d{2})-(\d{2})/);if(n)return M(parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10))}return null}handleDayClick(t,n,r){r.length===1?this.openFile(r[0].filePath):r.length>1&&this.showEntryMenu(t,n,r)}showEntryMenu(t,n,r){let a=new Q.Menu,s=`${n.day}.${n.month}.${n.year}`;a.addItem(i=>{i.setTitle(s).setIcon("calendar").setDisabled(!0)}),a.addSeparator();for(let i of r.slice(0,15))a.addItem(o=>{o.setTitle(i.displayName).setIcon("file-text").onClick(()=>{this.openFile(i.filePath)})});r.length>15&&a.addItem(i=>{i.setTitle(`+${r.length-15} more...`).setDisabled(!0)}),a.showAtMouseEvent(t)}setupTooltips(t,n,r){t.querySelectorAll(".rc-day-arc[data-date]").forEach(s=>{s.addEventListener("mouseenter",i=>{var v;let o=i,c=i.target,d=c.getAttribute("data-date")||"",h=c.getAttribute("data-count")||"0",g=((v=c.getAttribute("data-names"))==null?void 0:v.split("|"))||[],[u,p,m]=d.split("-").map(Number),f=`<div class="radcal-tooltip-date">${`${m}.${p}.${u}`}</div>`;if(g.length>0){f+='<div class="radcal-tooltip-entries">';for(let S of g.slice(0,5))f+=`<div class="radcal-tooltip-entry">${S}</div>`;g.length>5&&(f+=`<div class="radcal-tooltip-more">+${g.length-5} more</div>`),f+="</div>"}n.innerHTML=f,n.style.display="block";let D=this.containerEl.getBoundingClientRect();n.style.left=`${o.clientX-D.left+15}px`,n.style.top=`${o.clientY-D.top+15}px`}),s.addEventListener("mouseleave",()=>{n.style.display="none"})})}},Nt=class{constructor(e,t,n){this.app=e;this.service=t;this.openFile=n}process(e,t,n){try{let r=ke(e),a=t.createDiv({cls:"radcal-block"}),s=new ee(a,this.app,this.service,r,this.openFile);n.addChild(s)}catch(r){t.createDiv({cls:"radcal-error",text:`Radcal Error: ${r instanceof Error?r.message:String(r)}`})}}};var A=require("obsidian");j();var It=require("obsidian"),B=class extends It.AbstractInputSuggest{constructor(e,t){super(e,t),this.textInputEl=t}getSuggestions(e){let t=this.getAllFolders(),n=e.toLowerCase().trim();return n===""?t:t.filter(r=>r.path.toLowerCase().includes(n))}renderSuggestion(e,t){t.addClass("folder-suggest-item");let n=t.createSpan({cls:"folder-suggest-icon"});n.innerHTML=this.getFolderIcon(),t.createSpan({cls:"folder-suggest-text"}).setText(e.path||"/")}selectSuggestion(e,t){this.textInputEl.value=e.path,this.textInputEl.trigger("input"),this.close()}getAllFolders(){let e=[],t=r=>{e.push(r);for(let a of r.children)a instanceof It.TFolder&&t(a)},n=this.app.vault.getRoot();return t(n),e.sort((r,a)=>r.isRoot()?-1:a.isRoot()?1:r.path.localeCompare(a.path))}getFolderIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>'}};var kt=class extends A.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),this.createViewModeSection(e),this.plugin.settings.currentView==="life"&&this.createLifeViewSection(e),this.createDailyNotesSection(e),this.createRingConfigSection(e),this.createOuterSegmentsSection(e),this.createTemplateSection(e),this.createCenterDisplaySection(e)}createViewModeSection(e){new A.Setting(e).setName("View Mode").setDesc("Switch between Annual and Life view").addDropdown(t=>{t.addOption("annual","Annual View").addOption("life","Life View").setValue(this.plugin.settings.currentView).onChange(async n=>{this.plugin.settings.currentView=n,await this.plugin.saveSettings(),this.display()})})}createLifeViewSection(e){e.createEl("h3",{text:"Life View Settings"}),new A.Setting(e).setName("Birth Date").setDesc("Your birth date (YYYY-MM-DD) for precise calculation").addText(n=>{n.setPlaceholder("e.g. 1977-03-27").setValue(this.plugin.settings.birthDate||"").onChange(async r=>{let a=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(a){let s=parseInt(a[1],10),i=parseInt(a[2],10),o=parseInt(a[3],10);s>1900&&s<=new Date().getFullYear()&&i>=1&&i<=12&&o>=1&&o<=31&&(this.plugin.settings.birthDate=r,this.plugin.settings.birthYear=s,await this.plugin.saveSettings())}else r===""&&(this.plugin.settings.birthDate=void 0,await this.plugin.saveSettings())})}),new A.Setting(e).setName("Birth Year (Fallback)").setDesc("Used when no full date is provided").addText(n=>{n.setPlaceholder("e.g. 1990").setValue(String(this.plugin.settings.birthYear)).onChange(async r=>{let a=parseInt(r,10);!isNaN(a)&&a>1900&&a<=new Date().getFullYear()&&(this.plugin.settings.birthYear=a,await this.plugin.saveSettings())})}),new A.Setting(e).setName("Expected Lifespan").setDesc("Expected lifespan in years").addText(n=>{n.setPlaceholder("e.g. 85").setValue(String(this.plugin.settings.expectedLifespan)).onChange(async r=>{let a=parseInt(r,10);!isNaN(a)&&a>0&&a<=150&&(this.plugin.settings.expectedLifespan=a,await this.plugin.saveSettings())})}),e.createEl("h4",{text:"Life Phases"}),new A.Setting(e).setName("Life Phases Folder").setDesc("Folder with life phase notes (YAML: phase-start, phase-end, phase-color, phase-label)").addText(n=>{n.setPlaceholder("e.g. Life/Phases").setValue(this.plugin.settings.lifePhasesFolder).onChange(async r=>{this.plugin.settings.lifePhasesFolder=r,await this.plugin.saveSettings()}),new B(this.app,n.inputEl)});let t=e.createDiv({cls:"setting-item-description"});t.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Example YAML for a life phase:</strong><br>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
phase-start: 1983-09-01<br>
phase-end: 1987-07-15<br>
phase-color: blue<br>
phase-label: Elementary School<br>
---
        </code>
        <br>
        <em>Leave end empty for "ongoing" phases (shows faded arc until life expectancy)</em>
      </p>
    `}createDailyNotesSection(e){e.createEl("h3",{text:"Daily Notes"}),new A.Setting(e).setName("Notes Folder").setDesc("Folder where new notes are created (empty = vault root)").addText(n=>{n.setPlaceholder("e.g. Daily Notes").setValue(this.plugin.settings.dailyNoteFolder).onChange(async r=>{this.plugin.settings.dailyNoteFolder=r,await this.plugin.saveSettings()}),new B(this.app,n.inputEl)}),new A.Setting(e).setName("Filter Folder").setDesc("Only show notes from this folder (empty = all)").addText(n=>{n.setPlaceholder("e.g. Journal").setValue(this.plugin.settings.calendarFilterFolder).onChange(async r=>{this.plugin.settings.calendarFilterFolder=r,await this.plugin.saveSettings()}),new B(this.app,n.inputEl)}),new A.Setting(e).setName("Filename Format").setDesc("Format for new notes (YYYY-MM-DD)").addText(n=>{n.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.periodicNotesFormat.daily).onChange(async r=>{this.plugin.settings.periodicNotesFormat={...this.plugin.settings.periodicNotesFormat,daily:r||"YYYY-MM-DD"},await this.plugin.saveSettings()})}),new A.Setting(e).setName("Annual Recurring").setDesc("Folder for birthdays, anniversaries (use XXXX-MM-DD format, shown every year on that date)").addText(n=>{n.setPlaceholder("e.g. Birthdays").setValue(this.plugin.settings.annualRecurringFolder).onChange(async r=>{this.plugin.settings.annualRecurringFolder=r,await this.plugin.saveSettings()}),new B(this.app,n.inputEl)}),e.createEl("h4",{text:"Anniversary Properties"}),new A.Setting(e).setName("Additional Date Properties").setDesc("Comma-separated list of YAML properties to use for anniversary dates (in addition to radcal-start/radcal-end)").addText(n=>{var r;n.setPlaceholder("e.g. Birthday, Todestag, Hochzeitstag").setValue(((r=this.plugin.settings.anniversaryDateProperties)==null?void 0:r.join(", "))||"").onChange(async a=>{let s=a.split(",").map(i=>i.trim()).filter(i=>i.length>0);this.plugin.settings.anniversaryDateProperties=s,await this.plugin.saveSettings()})});let t=e.createDiv({cls:"setting-item-description"});t.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Anniversary Properties:</strong><br>
        Use <code>radcal-annual: true</code> to mark a note as anniversary.<br><br>
        <strong>Date sources (checked in order):</strong><br>
        1. <code>radcal-annual-fix</code> - Single fixed date (overrides all)<br>
        2. <code>radcal-start</code> / <code>radcal-end</code> - Birth + death dates<br>
        3. Properties from list above (e.g., <code>Birthday</code>)<br><br>
        <strong>Example:</strong>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
radcal-annual: true<br>
Birthday: 1982-09-24<br>
---
        </code>
      </p>
    `}createRingConfigSection(e){e.createEl("h3",{text:"Configure Rings"});let t=this.plugin.settings.rings;t.forEach((n,r)=>{this.createRingSettings(e,n,r)}),new A.Setting(e).addButton(n=>{n.setButtonText("Add Ring").setCta().onClick(async()=>{let r=_t(t.length);this.plugin.settings.rings=[...t,r],await this.plugin.saveSettings(),this.display()})})}createRingSettings(e,t,n){let r=e.createDiv({cls:"radial-calendar-ring-config"}),a=new A.Setting(r).setName(`Ring ${n+1}`).setClass("radial-calendar-ring-header");new A.Setting(r).setName("Name").addText(s=>{s.setPlaceholder("Ring Name").setValue(t.name).onChange(async i=>{this.updateRing(n,{name:i})})}),new A.Setting(r).setName("Folder").setDesc("Folder path in vault").addText(s=>{s.setPlaceholder("e.g. Projects/2024").setValue(t.folder).onChange(async i=>{this.updateRing(n,{folder:i})}),new B(this.app,s.inputEl)}),new A.Setting(r).setName("Color").addDropdown(s=>{Object.keys(T).forEach(i=>{s.addOption(i,this.formatColorName(i))}),s.setValue(t.color).onChange(async i=>{this.updateRing(n,{color:i})})}),new A.Setting(r).setName("Spanning Arcs").setDesc("Show multi-day events as continuous arcs").addToggle(s=>{var i;s.setValue((i=t.showSpanningArcs)!=null?i:!1).onChange(async o=>{await this.updateRing(n,{showSpanningArcs:o}),this.display()})}),t.showSpanningArcs&&this.createSpanningArcsPropertySettings(r,t,n),new A.Setting(r).addButton(s=>{s.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.rings=this.plugin.settings.rings.filter((i,o)=>o!==n),this.plugin.settings.rings=this.plugin.settings.rings.map((i,o)=>({...i,order:o})),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateRing(e,t){let n=[...this.plugin.settings.rings];n[e]={...n[e],...t},this.plugin.settings.rings=n,await this.plugin.saveSettings()}createSpanningArcsPropertySettings(e,t,n){let r=e.createDiv({cls:"radial-calendar-segment-config"});new A.Setting(r).setName("Start Date Property").setDesc("YAML frontmatter field for start date").addText(a=>{a.setPlaceholder("radcal-start").setValue(t.startDateField||"radcal-start").onChange(async s=>{this.updateRing(n,{startDateField:s||"radcal-start"})})}),new A.Setting(r).setName("End Date Property").setDesc("YAML frontmatter field for end date").addText(a=>{a.setPlaceholder("radcal-end").setValue(t.endDateField||"radcal-end").onChange(async s=>{this.updateRing(n,{endDateField:s||"radcal-end"})})}),new A.Setting(r).setName("Color Property").setDesc("YAML frontmatter field for color").addText(a=>{a.setPlaceholder("radcal-color").setValue(t.colorField||"radcal-color").onChange(async s=>{this.updateRing(n,{colorField:s||"radcal-color"})})}),new A.Setting(r).setName("Label Property").setDesc("YAML frontmatter field for label").addText(a=>{a.setPlaceholder("radcal-label").setValue(t.labelField||"radcal-label").onChange(async s=>{this.updateRing(n,{labelField:s||"radcal-label"})})})}formatColorName(e){return e.charAt(0).toUpperCase()+e.slice(1)}createOuterSegmentsSection(e){e.createEl("h3",{text:"Outer Segments"}),new A.Setting(e).setName("Segment Type").setDesc("Markers on the outer edge of the calendar").addDropdown(t=>{t.addOption("none","None").addOption("seasons","Seasons (4)").addOption("quarters","Quarters (4)").addOption("semester","Semesters (2)").addOption("ten-days","10-Day Phases (36)").addOption("weeks","Weeks (52)").addOption("custom","Custom").setValue(this.plugin.settings.annualSegmentType).onChange(async n=>{this.plugin.settings.annualSegmentType=n,await this.plugin.saveSettings(),this.display()})}),new A.Setting(e).setName("Show Labels").setDesc("Display segment labels").addToggle(t=>{t.setValue(this.plugin.settings.showSegmentLabels).onChange(async n=>{this.plugin.settings.showSegmentLabels=n,await this.plugin.saveSettings()})}),this.plugin.settings.annualSegmentType==="custom"&&this.createCustomSegmentsEditor(e),this.plugin.settings.currentView==="life"&&this.createLifeActsEditor(e)}createCustomSegmentsEditor(e){e.createEl("h4",{text:"Custom Segments"});let t=this.plugin.settings.customSegments;t.forEach((n,r)=>{this.createSegmentSettings(e,n,r)}),new A.Setting(e).addButton(n=>{n.setButtonText("Add Segment").onClick(async()=>{let r={id:`seg-${Date.now()}`,label:`Segment ${t.length+1}`,startDay:1,endDay:30};this.plugin.settings.customSegments=[...t,r],await this.plugin.saveSettings(),this.display()})})}createSegmentSettings(e,t,n){let r=e.createDiv({cls:"radial-calendar-segment-config"});new A.Setting(r).setName("Label").addText(a=>{a.setValue(t.label).onChange(async s=>{this.updateSegment(n,{label:s})})}),new A.Setting(r).setName("Start Day").setDesc("Day of year (1-365)").addText(a=>{a.setValue(String(t.startDay)).onChange(async s=>{let i=parseInt(s,10);!isNaN(i)&&i>=1&&i<=365&&this.updateSegment(n,{startDay:i})})}),new A.Setting(r).setName("End Day").setDesc("Day of year (1-365)").addText(a=>{a.setValue(String(t.endDay)).onChange(async s=>{let i=parseInt(s,10);!isNaN(i)&&i>=1&&i<=365&&this.updateSegment(n,{endDay:i})})}),new A.Setting(r).addButton(a=>{a.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.customSegments=this.plugin.settings.customSegments.filter((s,i)=>i!==n),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateSegment(e,t){let n=[...this.plugin.settings.customSegments];n[e]={...n[e],...t},this.plugin.settings.customSegments=n,await this.plugin.saveSettings()}createLifeActsEditor(e){e.createEl("h4",{text:"Life Acts"});let t=this.plugin.settings.lifeActs;t.forEach((n,r)=>{this.createLifeActSettings(e,n,r)}),new A.Setting(e).addButton(n=>{n.setButtonText("Add Life Act").onClick(async()=>{let r={id:`act-${Date.now()}`,label:`Act ${t.length+1}`,startAge:0,endAge:10};this.plugin.settings.lifeActs=[...t,r],await this.plugin.saveSettings(),this.display()})})}createLifeActSettings(e,t,n){let r=e.createDiv({cls:"radial-calendar-life-act-config"});new A.Setting(r).setName("Label").addText(a=>{a.setPlaceholder("e.g. Childhood").setValue(t.label).onChange(async s=>{this.updateLifeAct(n,{label:s})})}),new A.Setting(r).setName("Start Age").addText(a=>{a.setValue(String(t.startAge)).onChange(async s=>{let i=parseInt(s,10);!isNaN(i)&&i>=0&&this.updateLifeAct(n,{startAge:i})})}),new A.Setting(r).setName("End Age").addText(a=>{a.setValue(String(t.endAge)).onChange(async s=>{let i=parseInt(s,10);!isNaN(i)&&i>=0&&this.updateLifeAct(n,{endAge:i})})}),new A.Setting(r).setName("Color").addDropdown(a=>{a.addOption("","(Default)"),Object.keys(T).forEach(s=>{a.addOption(s,this.formatColorName(s))}),a.setValue(t.color||"").onChange(async s=>{this.updateLifeAct(n,{color:s||void 0})})}),new A.Setting(r).addButton(a=>{a.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.lifeActs=this.plugin.settings.lifeActs.filter((s,i)=>i!==n),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateLifeAct(e,t){let n=[...this.plugin.settings.lifeActs];n[e]={...n[e],...t},this.plugin.settings.lifeActs=n,await this.plugin.saveSettings()}createTemplateSection(e){e.createEl("h3",{text:"Template"}),new A.Setting(e).setName("Create Template").setDesc("Creates a template file for ring segments in your vault").addButton(t=>{t.setButtonText("Create Template").onClick(async()=>{await this.createTemplateFile()})})}async createTemplateFile(){let e=this.plugin.settings.templateFolder||"Templates",t=`${e}/Radial Calendar Segment.md`;try{if(this.app.vault.getAbstractFileByPath(e)||await this.app.vault.createFolder(e),this.app.vault.getAbstractFileByPath(t)){new A.Notice(`Template already exists: ${t}`);return}await this.app.vault.create(t,Xt),new A.Notice(`Template created: ${t}`)}catch(n){console.error("Failed to create template file:",n),new A.Notice("Error creating template")}}createCenterDisplaySection(e){e.createEl("h3",{text:"Center Display"}),new A.Setting(e).setName("Display Mode").setDesc("What is shown in the center of the calendar").addDropdown(t=>{t.addOption("countdown","Countdown").addOption("stats","Statistics").addOption("navigation","Navigation").setValue(this.plugin.settings.centerDisplay).onChange(async n=>{this.plugin.settings.centerDisplay=n,await this.plugin.saveSettings()})})}};j();var $t=class extends Z.Plugin{constructor(){super(...arguments);this.service=null;this.settings={...At}}async onload(){await this.loadSettings();let t={calendarWidth:"fit",dateProperties:["date","created","due"],endDateProperties:["endDate","end","until"],datePriority:"filename",dailyNoteFormat:this.settings.periodicNotesFormat.daily,dailyNoteFolder:this.settings.dailyNoteFolder,showMultiDayBars:!0,showWeekendHighlight:!0,anniversaryDateProperties:this.settings.anniversaryDateProperties||[]};this.service=new Et(this.app,t),await this.service.initialize(),this.registerView(it,r=>{let a=new Mt(r);return a.initialize({service:this.service,openFile:async s=>{let i=this.app.vault.getAbstractFileByPath(s);i instanceof Z.TFile&&await this.app.workspace.getLeaf().openFile(i)},settings:this.settings,onSettingsChange:async s=>{this.settings=s,await this.saveSettings()}}),a}),this.registerView(lt,r=>{let a=new xt(r);return a.initialize({service:this.service,settings:this.settings,getActiveFileDate:()=>this.getActiveFileDate(),openFile:async s=>{let i=this.app.vault.getAbstractFileByPath(s);i instanceof Z.TFile&&await this.app.workspace.getLeaf().openFile(i)}}),a});let n=new Nt(this.app,this.service,async r=>{let a=this.app.vault.getAbstractFileByPath(r);a instanceof Z.TFile&&await this.app.workspace.getLeaf().openFile(a)});this.registerMarkdownCodeBlockProcessor("radcal",(r,a,s)=>n.process(r,a,s)),this.addSettingTab(new kt(this.app,this)),this.addRibbonIcon("circle","Open Radial Calendar",()=>{this.activateView()}),this.addRibbonIcon("clock","Open Local Calendar",()=>{this.activateLocalCalendarView()}),this.addCommand({id:"open-radial-calendar",name:"Open Radial Calendar",callback:()=>{this.activateView()}}),this.addCommand({id:"open-local-calendar",name:"Open Local Calendar (Sidebar)",callback:()=>{this.activateLocalCalendarView()}})}async onunload(){var t;(t=this.service)==null||t.destroy(),this.service=null}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},At,t)}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:t}=this.app,n=null,r=t.getLeavesOfType(it);r.length>0?n=r[0]:(n=t.getLeaf("tab"),n&&await n.setViewState({type:it,active:!0})),n&&t.revealLeaf(n)}getActiveFileDate(){let t=this.app.workspace.getActiveFile();if(!t)return null;let n=t.basename.match(/(\d{4})-(\d{2})-(\d{2})/);return n?M(parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)):null}async activateLocalCalendarView(){var r;let{workspace:t}=this.app,n=(r=t.getLeavesOfType(lt)[0])!=null?r:null;n||(n=t.getRightLeaf(!1),n&&await n.setViewState({type:lt,active:!0})),n&&t.revealLeaf(n)}};
