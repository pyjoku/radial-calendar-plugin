/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Se=Object.defineProperty;var Yn=Object.getOwnPropertyDescriptor;var _n=Object.getOwnPropertyNames;var Gn=Object.prototype.hasOwnProperty;var At=(d,a)=>()=>(d&&(a=d(d=0)),a);var we=(d,a)=>{for(var t in a)Se(d,t,{get:a[t],enumerable:!0})},Wn=(d,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of _n(a))!Gn.call(d,n)&&n!==t&&Se(d,n,{get:()=>a[n],enumerable:!(e=Yn(a,n))||e.enumerable});return d};var Ae=d=>Wn(Se({},"__esModule",{value:!0}),d);function x(d,a,t){let e={year:d,month:a,day:t};if(!Ft(e))throw new Error(`Invalid date: ${d}-${a}-${t}`);return Object.freeze(e)}function tt(d){let a=d.month.toString().padStart(2,"0"),t=d.day.toString().padStart(2,"0");return`${d.year}-${a}-${t}`}function qe(d){let a=d.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!a)return null;let t=parseInt(a[1],10),e=parseInt(a[2],10),n=parseInt(a[3],10),r={year:t,month:e,day:n};return Ft(r)?Object.freeze(r):null}function L(d,a){return d.year!==a.year?d.year-a.year:d.month!==a.month?d.month-a.month:d.day-a.day}function ht(d,a){return d.year===a.year&&d.month===a.month&&d.day===a.day}function Ft(d){let{year:a,month:t,day:e}=d;if(!Number.isInteger(a)||a<1||!Number.isInteger(t)||t<1||t>12||!Number.isInteger(e)||e<1)return!1;let n=M(a,t);return e<=n}function M(d,a){let t=[31,28,31,30,31,30,31,31,30,31,30,31];return a===2&&It(d)?29:t[a-1]}function It(d){return d%4===0&&d%100!==0||d%400===0}function Y(d){let a=d.year,t=d.month,e=d.day;t<3&&(t+=12,a-=1);let n=e,r=t,i=a%100,s=Math.floor(a/100),o=(n+Math.floor(13*(r+1)/5)+i+Math.floor(i/4)+Math.floor(s/4)-2*s)%7;return o=(o%7+7)%7,(o+6)%7}function nt(d,a){let t=d.year,e=d.month,n=d.day+a;for(;n>M(t,e);)n-=M(t,e),e+=1,e>12&&(e=1,t+=1);for(;n<1;)e-=1,e<1&&(e=12,t-=1),n+=M(t,e);return Object.freeze({year:t,month:e,day:n})}function Ke(d,a){return nt(d,-a)}function I(){let d=new Date;return Object.freeze({year:d.getFullYear(),month:d.getMonth()+1,day:d.getDate()})}function kt(d,a){let t=Ue(d);return Ue(a)-t}function $t(d,a){return L(d,a)<0}function Ot(d,a){return L(d,a)>0}function Xe(d,a,t){return L(d,a)>=0&&L(d,t)<=0}function Je(d){return Object.freeze({year:d.year,month:d.month,day:1})}function Qe(d){let a=M(d.year,d.month);return Object.freeze({year:d.year,month:d.month,day:a})}function Ue(d){let{year:a,month:t,day:e}=d,n=a*365+Math.floor(a/4)-Math.floor(a/100)+Math.floor(a/400);return n+=[0,31,59,90,120,151,181,212,243,273,304,334][t-1],t>2&&It(a)&&(n+=1),n+=e,n}var _=At(()=>{"use strict"});function X(d){var e;let a=d.endDate!==null&&(d.startDate.year!==d.endDate.year||d.startDate.month!==d.endDate.month||d.startDate.day!==d.endDate.day),t=(e=d.isAnniversary)!=null?e:d.startDate.year===0;return Object.freeze({id:d.id,filePath:d.filePath,fileName:d.fileName,displayName:d.displayName,startDate:d.startDate,endDate:d.endDate,isMultiDay:a,isAnniversary:t,metadata:Object.freeze({tags:Object.freeze([...d.metadata.tags]),folder:d.metadata.folder,properties:Object.freeze({...d.metadata.properties})})})}function tn(){return Object.freeze({tags:Object.freeze([]),folder:"",properties:Object.freeze({})})}function en(d){if(typeof d!="object"||d===null)return!1;let a=d;return typeof a.id=="string"&&typeof a.filePath=="string"&&typeof a.fileName=="string"&&typeof a.displayName=="string"&&Ze(a.startDate)&&(a.endDate===null||Ze(a.endDate))&&typeof a.isMultiDay=="boolean"&&typeof a.isAnniversary=="boolean"&&jn(a.metadata)}function Ze(d){if(typeof d!="object"||d===null)return!1;let a=d;return typeof a.year=="number"&&typeof a.month=="number"&&typeof a.day=="number"}function jn(d){if(typeof d!="object"||d===null)return!1;let a=d;return Array.isArray(a.tags)&&typeof a.folder=="string"&&typeof a.properties=="object"&&a.properties!==null}var De=At(()=>{"use strict"});function nn(d,a){if(L(d,a)>0)throw new Error("Start date must be before or equal to end date");return Object.freeze({start:d,end:a})}function an(d){return Object.freeze({start:d,end:d})}function Ce(d,a){return L(d.start,a.end)<=0&&L(a.start,d.end)<=0}function rn(d,a){return L(d,a.start)>=0&&L(d,a.end)<=0}function sn(d,a){return L(d.start,a.start)<=0&&L(d.end,a.end)>=0}function on(d,a){if(!Ce(d,a))return null;let t=L(d.start,a.start)>=0?d.start:a.start,e=L(d.end,a.end)<=0?d.end:a.end;return Object.freeze({start:t,end:e})}function ln(d){if(d.start.year===d.end.year&&d.start.month===d.end.month)return d.end.day-d.start.day+1;let a=0,t=d.start;for(;L(t,d.end)<=0;)a++,t=nt(t,1);return a}function cn(d,a){let t=[],e=d.start.year,n=d.start.month,r=d.start.day;for(;e<d.end.year||e===d.end.year&&n<=d.end.month;){let i=M(e,n),s;e===d.end.year&&n===d.end.month?s=d.end.day:s=i,t.push(Object.freeze({year:e,month:n,startDay:r,endDay:s,entryId:a})),n++,n>12&&(n=1,e++),r=1}return Object.freeze(t)}function dn(d,a,t,e){let n={year:a,month:t,day:1},r={year:a,month:t,day:M(a,t)};if(Ot(d.start,r)||$t(d.end,n))return null;let i=d.start.year===a&&d.start.month===t?d.start.day:1,s=d.end.year===a&&d.end.month===t?d.end.day:M(a,t);return Object.freeze({year:a,month:t,startDay:i,endDay:s,entryId:e})}function un(d,a){return Object.freeze({start:{year:d,month:a,day:1},end:{year:d,month:a,day:M(d,a)}})}function pn(d){return ht(d.start,d.end)}function hn(d,a,t){return Object.freeze({start:nt(d.start,-a),end:nt(d.end,t)})}var gn=At(()=>{"use strict";_()});var Fe={};we(Fe,{ANNIVERSARY_TEMPLATE:()=>qt,COLOR_LIST_COMMENT:()=>Zn,DEFAULT_DATE_EXTRACTION_CONFIG:()=>_t,DEFAULT_DISPLAY_CONFIG:()=>Wt,DEFAULT_FOLDER_FILTER_CONFIG:()=>Gt,DEFAULT_PLUGIN_SETTINGS:()=>Ee,DEFAULT_PRESETS:()=>Ht,DEFAULT_RADIAL_SETTINGS:()=>zt,DEFAULT_SETTINGS:()=>qn,LIFE_PHASE_TEMPLATE:()=>jt,PATTERN_NAMES:()=>z,PREDEFINED_QUARTERS:()=>Le,PREDEFINED_SEASONS:()=>Pe,PREDEFINED_SEMESTERS:()=>Re,RING_COLORS:()=>P,SPANNING_ARC_TEMPLATE:()=>Ut,SVG_PATTERN_BUILDERS:()=>Me,addDays:()=>nt,assignTracks:()=>gt,compareLocalDates:()=>L,computeSubRingRadii:()=>at,createCalendarEntry:()=>X,createCurrentViewState:()=>Kn,createDateRange:()=>nn,createDefaultRing:()=>xe,createEmptyMetadata:()=>tn,createEventsRing:()=>Qn,createLifePhasesRing:()=>Jn,createLocalDate:()=>x,createMonthRange:()=>un,createPluginSettings:()=>Un,createSingleDayRange:()=>an,createViewState:()=>Xn,daysBetween:()=>kt,extendRange:()=>hn,generate10DayPhases:()=>Te,generateWeekSegments:()=>Ne,getDaysInMonth:()=>M,getFirstDayOfMonth:()=>Je,getLastDayOfMonth:()=>Qe,getMaxTrackCount:()=>yt,getMonthSegment:()=>dn,getRangeDays:()=>ln,getToday:()=>I,getWeekday:()=>Y,intersectRanges:()=>on,isAfter:()=>Ot,isBefore:()=>$t,isCalendarEntry:()=>en,isDateInRange:()=>rn,isLeapYear:()=>It,isSingleDay:()=>pn,isValidLocalDate:()=>Ft,isWithinRange:()=>Xe,keyToLocalDate:()=>qe,localDateToKey:()=>tt,localDatesEqual:()=>ht,rangeContains:()=>sn,rangesOverlap:()=>Ce,splitRangeByMonth:()=>cn,subtractDays:()=>Ke});function Un(d){var a,t;return Object.freeze({dateExtraction:d.dateExtraction?Object.freeze({..._t,...d.dateExtraction}):_t,folderFilter:d.folderFilter?Object.freeze({...Gt,...d.folderFilter}):Gt,display:d.display?Object.freeze({...Wt,...d.display}):Wt,locale:(a=d.locale)!=null?a:Ee.locale,debugMode:(t=d.debugMode)!=null?t:Ee.debugMode})}function Kn(){let d=new Date;return Object.freeze({year:d.getFullYear(),month:d.getMonth()+1,selectedDate:null,focusedEntryId:null})}function Xn(d,a){return Object.freeze({year:d,month:a,selectedDate:null,focusedEntryId:null})}function xe(d){return{id:`ring-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Ring ${d+1}`,folder:"",color:"blue",segmentType:"monthly",enabled:!0,order:d,ringType:"year-days",segmentStyle:"fixed",folderPattern:"fixed",recursive:!1,showGaps:!1,showLabels:!1}}function Jn(d,a=0){return{id:`life-phases-${Date.now()}`,name:"Life Phases",folder:d,color:"blue",segmentType:"custom",enabled:!0,order:a,ringType:"life-phases",segmentStyle:"from-yaml",folderPattern:"fixed",recursive:!1,startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",showGaps:!0,showLabels:!0}}function Qn(d,a=1){return{id:`events-${Date.now()}`,name:"Events",folder:d,color:"teal",segmentType:"custom",enabled:!0,order:a,ringType:"events",segmentStyle:"from-yaml",folderPattern:"year-substitution",recursive:!1,startDateField:"event-start",endDateField:"event-end",colorField:"event-color",labelField:"event-label",showGaps:!0,showLabels:!0}}function gt(d){let a=[...d].sort((e,n)=>e.startAngle-n.startAngle),t=[];return a.map(e=>{let n=t.findIndex(r=>r.endAngle<=e.startAngle);return n===-1?(n=t.length,t.push({endAngle:e.endAngle})):t[n].endAngle=e.endAngle,{...e,track:n}})}function at(d,a,t,e){let n=(d-a)/t;return{outer:d-e*n,inner:d-(e+1)*n}}function yt(d){return d.length===0?1:Math.max(...d.map(a=>a.track))+1}function Te(){let d=[],a=1,t=1;for(;a<=365;){let e=Math.min(a+9,365);d.push({id:`10d-${t}`,label:`P${t}`,startDay:a,endDay:e}),a=e+1,t++}return d}function Ne(){let d=[];for(let a=1;a<=52;a++){let t=(a-1)*7+1,e=Math.min(a*7,365);d.push({id:`w-${a}`,label:`W${a}`,startDay:t,endDay:e})}return d}var _t,Gt,Wt,Ee,qn,Ht,P,Me,z,Pe,Le,Re,zt,Zn,jt,Ut,qt,W=At(()=>{"use strict";_();De();gn();_t=Object.freeze({fromFilename:!0,fromFrontmatter:!0,frontmatterField:"date",endDateField:"endDate",filenamePatterns:Object.freeze(["^(\\d{4}-\\d{2}-\\d{2})","(\\d{4}-\\d{2}-\\d{2})$","^(\\d{4}-\\d{2}-\\d{2})[-_\\s]","[-_\\s](\\d{4}-\\d{2}-\\d{2})\\.md$"]),useCreationDateFallback:!1}),Gt=Object.freeze({includeFolders:Object.freeze([]),excludeFolders:Object.freeze([])}),Wt=Object.freeze({firstDayOfWeek:1,showWeekNumbers:!1,highlightToday:!0,showAdjacentMonths:!0,maxEntriesPerDay:3,showMultiDayBars:!0}),Ee=Object.freeze({dateExtraction:_t,folderFilter:Gt,display:Wt,locale:"en-US",debugMode:!1});qn={calendarWidth:"fit",dateProperties:["date","startDate","created"],endDateProperties:["endDate","due","deadline"],datePriority:"property",dailyNoteFolder:"",dailyNoteFormat:"YYYY-MM-DD",showMultiDayBars:!0,showWeekendHighlight:!0,anniversaryDateProperties:[]};Ht=[{name:"family",label:"Family",color:"pink",icon:"\u2764\uFE0F"},{name:"work",label:"Work",color:"blue",icon:"\u{1F4BC}"},{name:"education",label:"Education",color:"indigo",icon:"\u{1F393}"},{name:"health",label:"Health",color:"green",icon:"\u{1F3E5}"},{name:"travel",label:"Travel",color:"cyan",icon:"\u2708\uFE0F"},{name:"project",label:"Project",color:"amber",icon:"\u{1F4CB}"},{name:"completed",label:"Completed",color:"green",opacity:60,icon:"\u2705"},{name:"cancelled",label:"Cancelled",color:"gray",pattern:"striped",opacity:50,icon:"\u274C"}],P={red:"#ef4444",orange:"#f97316",yellow:"#eab308",green:"#22c55e",blue:"#3b82f6",purple:"#a855f7",pink:"#ec4899",teal:"#14b8a6",cyan:"#06b6d4",magenta:"#d946ef",lime:"#84cc16",amber:"#f59e0b",indigo:"#6366f1",violet:"#8b5cf6",rose:"#f43f5e",gray:"#6b7280",slate:"#64748b",stone:"#78716c"},Me={solid:(d,a)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",a),d.appendChild(t)},striped:(d,a)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",a),t.setAttribute("fill-opacity","0.3"),d.appendChild(t);for(let[e,n,r,i]of[[0,0,10,10],[-10,0,0,10],[10,0,20,10]]){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(e)),s.setAttribute("y1",String(n)),s.setAttribute("x2",String(r)),s.setAttribute("y2",String(i)),s.setAttribute("stroke",a),s.setAttribute("stroke-width","2"),d.appendChild(s)}},horizontal:(d,a)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",a),t.setAttribute("fill-opacity","0.2"),d.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1","0"),e.setAttribute("y1","5"),e.setAttribute("x2","10"),e.setAttribute("y2","5"),e.setAttribute("stroke",a),e.setAttribute("stroke-width","2"),d.appendChild(e)},vertical:(d,a)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",a),t.setAttribute("fill-opacity","0.2"),d.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1","5"),e.setAttribute("y1","0"),e.setAttribute("x2","5"),e.setAttribute("y2","10"),e.setAttribute("stroke",a),e.setAttribute("stroke-width","2"),d.appendChild(e)},dotted:(d,a)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",a),t.setAttribute("fill-opacity","0.2"),d.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx","5"),e.setAttribute("cy","5"),e.setAttribute("r","2"),e.setAttribute("fill",a),d.appendChild(e)},crosshatch:(d,a)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",a),t.setAttribute("fill-opacity","0.2"),d.appendChild(t);for(let[e,n,r,i]of[[0,0,10,10],[10,0,0,10]]){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(e)),s.setAttribute("y1",String(n)),s.setAttribute("x2",String(r)),s.setAttribute("y2",String(i)),s.setAttribute("stroke",a),s.setAttribute("stroke-width","1.5"),d.appendChild(s)}},grid:(d,a)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",a),t.setAttribute("fill-opacity","0.2"),d.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1","5"),e.setAttribute("y1","0"),e.setAttribute("x2","5"),e.setAttribute("y2","10"),e.setAttribute("stroke",a),e.setAttribute("stroke-width","1"),d.appendChild(e);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","0"),n.setAttribute("y1","5"),n.setAttribute("x2","10"),n.setAttribute("y2","5"),n.setAttribute("stroke",a),n.setAttribute("stroke-width","1"),d.appendChild(n)},wavy:(d,a)=>{let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("fill",a),t.setAttribute("fill-opacity","0.2"),d.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M0,5 Q2.5,0 5,5 T10,5"),e.setAttribute("fill","none"),e.setAttribute("stroke",a),e.setAttribute("stroke-width","1.5"),d.appendChild(e)}},z=["solid","striped","horizontal","vertical","dotted","crosshatch","grid","wavy"];Pe=[{id:"spring",label:"Spring",startDay:60,endDay:152},{id:"summer",label:"Summer",startDay:152,endDay:244},{id:"autumn",label:"Autumn",startDay:244,endDay:335},{id:"winter",label:"Winter",startDay:335,endDay:60}],Le=[{id:"q1",label:"Q1",startDay:1,endDay:90},{id:"q2",label:"Q2",startDay:91,endDay:181},{id:"q3",label:"Q3",startDay:182,endDay:273},{id:"q4",label:"Q4",startDay:274,endDay:365}],Re=[{id:"s1",label:"H1",startDay:1,endDay:181},{id:"s2",label:"H2",startDay:182,endDay:365}];zt={currentView:"annual",birthYear:1990,expectedLifespan:85,currentYear:new Date().getFullYear(),rings:[],centerDisplay:"countdown",periodicNotesFormat:{yearly:"YYYY",monthly:"YYYY-MM",daily:"YYYY-MM-DD"},templateFolder:"Templates",dailyNoteFolder:"",calendarFilterFolder:"",annualRecurringFolder:"",lifePhasesFolder:"",annualSegmentType:"none",customSegments:[],lifeActs:[],showSegmentLabels:!0,anniversaryDateProperties:[],calendarSources:[],presets:[...Ht]},Zn=`# Farben: red, orange, yellow, green, blue, purple, pink, teal,
#         cyan, magenta, lime, amber, indigo, violet, rose, gray, slate, stone
# Patterns: solid, striped, horizontal, vertical, dotted, crosshatch, grid, wavy`,jt=`---
# Farben: red, orange, yellow, green, blue, purple, pink, teal,
#         cyan, magenta, lime, amber, indigo, violet, rose, gray, slate, stone
# Patterns: solid, striped, horizontal, vertical, dotted, crosshatch, grid, wavy
radcal-start: {{date}}
radcal-end:
radcal-color: blue
radcal-label:
radcal-showInLife: true
radcal-ring:
radcal-pattern:
radcal-opacity:
radcal-fade:
---

# {{title}}

Beschreibung der Lebensphase...
`,Ut=`---
# Farben: red, orange, yellow, green, blue, purple, pink, teal,
#         cyan, magenta, lime, amber, indigo, violet, rose, gray, slate, stone
# Patterns: solid, striped, horizontal, vertical, dotted, crosshatch, grid, wavy
radcal-start: {{date}}
radcal-end:
radcal-color: blue
radcal-label:
radcal-pattern:
radcal-opacity:
radcal-fade:
---

# {{title}}

Beschreibung des Zeitraums...
`,qt=`---
# Farben: red, orange, yellow, green, blue, purple, pink, teal,
#         cyan, magenta, lime, amber, indigo, violet, rose, gray, slate, stone
# Patterns: solid, striped, horizontal, vertical, dotted, crosshatch, grid, wavy
radcal-annual: true
radcal-start:
radcal-end:
radcal-color: pink
radcal-label:
radcal-showInLife: true
radcal-ring:
radcal-pattern:
radcal-opacity:
radcal-fade:
---

# {{title}}

Person oder j\xE4hrliches Event...
`});var yn={};we(yn,{AppearanceModal:()=>Ie});var rt,Ie,mn=At(()=>{"use strict";rt=require("obsidian");W();Ie=class extends rt.Modal{constructor(a,t,e){super(a),this.file=t,this.onSave=e;let n=a.metadataCache.getFileCache(t),r=(n==null?void 0:n.frontmatter)||{};this.selectedColor=this.isValidColor(r["radcal-color"])?r["radcal-color"]:void 0,this.selectedPattern=this.isValidPattern(r["radcal-pattern"])?r["radcal-pattern"]:void 0,this.selectedOpacity=typeof r["radcal-opacity"]=="number"?r["radcal-opacity"]:100}onOpen(){let{contentEl:a}=this;a.empty(),a.addClass("radcal-appearance-modal"),a.createEl("h2",{text:"Set Appearance"}),this.renderColorSection(a),this.renderPatternSection(a),this.renderOpacitySection(a),new rt.Setting(a).addButton(t=>{t.setButtonText("Cancel").onClick(()=>this.close())}).addButton(t=>{t.setButtonText("Apply").setCta().onClick(()=>this.applyChanges())})}onClose(){let{contentEl:a}=this;a.empty()}renderColorSection(a){a.createEl("h3",{text:"Color"});let t=a.createDiv({cls:"radcal-color-grid radcal-color-grid--compact"});for(let[e,n]of Object.entries(P)){let r=t.createDiv({cls:`radcal-color-swatch ${this.selectedColor===e?"is-selected":""}`});r.style.backgroundColor=n,r.setAttribute("title",e),r.addEventListener("click",()=>{t.querySelectorAll(".radcal-color-swatch").forEach(i=>i.removeClass("is-selected")),r.addClass("is-selected"),this.selectedColor=e})}}renderPatternSection(a){a.createEl("h3",{text:"Pattern"});let t=a.createDiv({cls:"radcal-pattern-grid radcal-pattern-grid--compact"});for(let e of z){let n=t.createDiv({cls:`radcal-pattern-option ${this.selectedPattern===e?"is-selected":""}`}),r=n.createDiv({cls:"radcal-pattern-label"});r.textContent=e,n.addEventListener("click",()=>{t.querySelectorAll(".radcal-pattern-option").forEach(i=>i.removeClass("is-selected")),n.addClass("is-selected"),this.selectedPattern=e})}}renderOpacitySection(a){a.createEl("h3",{text:"Opacity"});let t=a.createDiv({cls:"radcal-opacity-section"}),e=t.createDiv({cls:"radcal-opacity-value"});e.textContent=`${this.selectedOpacity}%`;let n=t.createEl("input",{type:"range",cls:"radcal-opacity-slider"});n.setAttribute("min","0"),n.setAttribute("max","100"),n.setAttribute("step","5"),n.value=String(this.selectedOpacity),n.addEventListener("input",()=>{this.selectedOpacity=parseInt(n.value,10),e.textContent=`${this.selectedOpacity}%`});let r=t.createDiv({cls:"radcal-opacity-presets"});for(let i of[25,50,75,100]){let s=r.createEl("button",{text:`${i}%`,cls:`radcal-opacity-preset ${this.selectedOpacity===i?"is-selected":""}`});s.addEventListener("click",()=>{this.selectedOpacity=i,n.value=String(i),e.textContent=`${i}%`,r.querySelectorAll(".radcal-opacity-preset").forEach(o=>o.removeClass("is-selected")),s.addClass("is-selected")})}}async applyChanges(){try{await this.app.fileManager.processFrontMatter(this.file,a=>{this.selectedColor&&(a["radcal-color"]=this.selectedColor),this.selectedPattern&&(a["radcal-pattern"]=this.selectedPattern),this.selectedOpacity!==100?a["radcal-opacity"]=this.selectedOpacity:delete a["radcal-opacity"]}),new rt.Notice("Appearance updated"),this.onSave(),this.close()}catch(a){console.error("Failed to update appearance:",a),new rt.Notice("Failed to update appearance")}}isValidColor(a){return typeof a=="string"&&a in P}isValidPattern(a){return typeof a=="string"&&z.includes(a)}}});var da={};we(da,{default:()=>ge});module.exports=Ae(da);var O=require("obsidian");var Tt=class{constructor(a){this.app=a}getAllMarkdownFiles(){return this.app.vault.getMarkdownFiles().map(t=>this.toFileInfo(t))}getMarkdownFilesInFolder(a){return this.getAllMarkdownFiles().filter(t=>t.folderPath?t.folderPath===a||t.folderPath.startsWith(a+"/"):!1)}getFileByPath(a){let t=this.app.vault.getAbstractFileByPath(a);return t instanceof this.getTFileClass()?t:null}async readFile(a){let t=this.getFileByPath(a);if(!t)return null;try{return await this.app.vault.read(t)}catch(e){return null}}async createOrOpenDailyNote(a,t=""){let e=this.getFileByPath(a);if(!e){let n=a.substring(0,a.lastIndexOf("/"));n&&await this.ensureFolderExists(n),e=await this.app.vault.create(a,t)}return e}async ensureFolderExists(a){this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a)}fileExists(a){return this.getFileByPath(a)!==null}getRoot(){return this.app.vault.getRoot()}toFileInfo(a){var t,e;return Object.freeze({path:a.path,basename:a.basename,name:a.name,extension:a.extension,folderPath:(e=(t=a.parent)==null?void 0:t.path)!=null?e:null})}getTFileClass(){let a=this.app.vault.getMarkdownFiles();return a.length>0?a[0].constructor:class{}}};var Nt=class{constructor(a){this.app=a}getMetadata(a){let t=this.app.metadataCache.getFileCache(a);return this.extractMetadata(t)}getMetadataByPath(a){let t=this.app.vault.getAbstractFileByPath(a);return!t||!this.isMarkdownFile(t)?null:this.getMetadata(t)}getProperty(a,t){var n;return(n=this.getMetadata(a).frontmatter)==null?void 0:n[t]}getStringProperty(a,t){let e=this.getProperty(a,t);return typeof e=="string"?e:e instanceof Date?this.formatDate(e):typeof e=="number"?String(e):null}getDateProperty(a,t){let e=this.getProperty(a,t);if(!e)return null;if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;let n=e.match(/^(\d{4}-\d{2}-\d{2})/);return n?n[1]:null}return e instanceof Date&&!isNaN(e.getTime())?this.formatDate(e):this.isLocalDateLike(e)?this.formatLocalDate(e):null}getTags(a){return this.getMetadata(a).tags}hasTag(a,t){let e=t.startsWith("#")?t:`#${t}`;return this.getTags(a).some(r=>r.tag.toLowerCase()===e.toLowerCase())}onMetadataChange(a){let t=e=>a(e);return this.app.metadataCache.on("changed",t),()=>this.app.metadataCache.off("changed",t)}extractMetadata(a){var n;let t=(n=a==null?void 0:a.frontmatter)!=null?n:null,e=[];if(t!=null&&t.tags){let r=Array.isArray(t.tags)?t.tags:[t.tags];for(let i of r)if(typeof i=="string"){let s=i.startsWith("#")?i:`#${i}`;e.push({tag:s,name:s.substring(1)})}}if(a!=null&&a.tags)for(let r of a.tags)e.find(s=>s.tag.toLowerCase()===r.tag.toLowerCase())||e.push({tag:r.tag,name:r.tag.substring(1)});return Object.freeze({frontmatter:t,tags:Object.freeze(e)})}formatDate(a){let t=a.getFullYear(),e=String(a.getMonth()+1).padStart(2,"0"),n=String(a.getDate()).padStart(2,"0");return`${t}-${e}-${n}`}formatLocalDate(a){let t=a.year,e=String(a.month).padStart(2,"0"),n=String(a.day).padStart(2,"0");return`${t}-${e}-${n}`}isLocalDateLike(a){return typeof a=="object"&&a!==null&&"year"in a&&"month"in a&&"day"in a&&typeof a.year=="number"&&typeof a.month=="number"&&typeof a.day=="number"}isMarkdownFile(a){return typeof a=="object"&&a!==null&&"extension"in a&&a.extension==="md"}};_();var Vt=class{constructor(a={}){var t,e;this.entriesByPath=new Map,this.entriesByDate=new Map,this.multiDayEntriesByDate=new Map,this.anniversaryEntriesByMonthDay=new Map,this.stats={hits:0,misses:0,lastRebuild:0},this.config={maxEntries:(t=a.maxEntries)!=null?t:1e4,debug:(e=a.debug)!=null?e:!1}}addEntry(a){if(this.removeEntry(a.id),this.entriesByPath.set(a.id,a),a.isAnniversary){let e=this.monthDayKey(a.startDate.month,a.startDate.day);this.addToDateIndex(e,a,this.anniversaryEntriesByMonthDay),this.log(`Added anniversary entry: ${a.filePath}`);return}let t=tt(a.startDate);this.addToDateIndex(t,a,this.entriesByDate),a.isMultiDay&&a.endDate&&this.indexMultiDayEntry(a),this.log(`Added entry: ${a.filePath}`)}monthDayKey(a,t){return`${String(a).padStart(2,"0")}-${String(t).padStart(2,"0")}`}removeEntry(a){let t=this.entriesByPath.get(a);if(!t)return;if(this.entriesByPath.delete(a),t.isAnniversary){let n=this.monthDayKey(t.startDate.month,t.startDate.day);this.removeFromDateIndex(n,t.id,this.anniversaryEntriesByMonthDay),this.log(`Removed anniversary entry: ${a}`);return}let e=tt(t.startDate);this.removeFromDateIndex(e,t.id,this.entriesByDate),t.isMultiDay&&t.endDate&&this.removeMultiDayEntry(t),this.log(`Removed entry: ${a}`)}getEntriesForDate(a){var o,l,c;let t=tt(a),e=this.monthDayKey(a.month,a.day),n=(o=this.entriesByDate.get(t))!=null?o:[],r=(l=this.multiDayEntriesByDate.get(t))!=null?l:[],i=(c=this.anniversaryEntriesByMonthDay.get(e))!=null?c:[];n.length>0||r.length>0||i.length>0?this.stats.hits++:this.stats.misses++;let s=new Map;for(let u of n)s.set(u.id,u);for(let u of r)s.set(u.id,u);for(let u of i)s.set(u.id,u);return Array.from(s.values())}getEntriesInRange(a,t){var n;let e=new Map;for(let r of this.entriesByPath.values()){let i=(n=r.endDate)!=null?n:r.startDate;L(r.startDate,t)<=0&&L(i,a)>=0&&e.set(r.id,r)}return Array.from(e.values())}getMultiDayEntries(){return Array.from(this.entriesByPath.values()).filter(a=>a.isMultiDay)}getAnniversaryEntriesForDate(a){var e;let t=this.monthDayKey(a.month,a.day);return(e=this.anniversaryEntriesByMonthDay.get(t))!=null?e:[]}getAllAnniversaryEntries(){let a=[];for(let t of this.anniversaryEntriesByMonthDay.values())a.push(...t);return a}getEntryByPath(a){return this.entriesByPath.get(a)}hasEntry(a){return this.entriesByPath.has(a)}getAllEntries(){return Array.from(this.entriesByPath.values())}clear(){this.entriesByPath.clear(),this.entriesByDate.clear(),this.multiDayEntriesByDate.clear(),this.stats={hits:0,misses:0,lastRebuild:Date.now()},this.log("Cache cleared")}rebuild(a){this.clear(),this.stats.lastRebuild=Date.now();for(let t of a)this.addEntry(t);this.log(`Cache rebuilt with ${a.length} entries`)}getStats(){return Object.freeze({entryCount:this.entriesByPath.size,dateCount:this.entriesByDate.size+this.multiDayEntriesByDate.size,hits:this.stats.hits,misses:this.stats.misses,lastRebuild:this.stats.lastRebuild})}indexMultiDayEntry(a){if(!a.endDate)return;let t=a.startDate,e=a.endDate;for(;L(t,e)<0;)if(t=this.addOneDay(t),L(t,e)<=0){let n=tt(t);this.addToDateIndex(n,a,this.multiDayEntriesByDate)}}removeMultiDayEntry(a){if(!a.endDate)return;let t=a.startDate,e=a.endDate;for(;L(t,e)<0;)if(t=this.addOneDay(t),L(t,e)<=0){let n=tt(t);this.removeFromDateIndex(n,a.id,this.multiDayEntriesByDate)}}addToDateIndex(a,t,e){let n=e.get(a);n?n.push(t):e.set(a,[t])}removeFromDateIndex(a,t,e){let n=e.get(a);if(!n)return;let r=n.filter(i=>i.id!==t);r.length===0?e.delete(a):e.set(a,r)}addOneDay(a){let t=a.day+1,e=a.month,n=a.year,r=this.getDaysInMonth(n,e);return t>r&&(t=1,e+=1,e>12&&(e=1,n+=1)),{year:n,month:e,day:t}}getDaysInMonth(a,t){let e=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2?a%4===0&&a%100!==0||a%400===0?29:28:e[t-1]}log(a){this.config.debug&&console.log(`[EntryCache] ${a}`)}};var Bt=class Bt{parseDate(a){if(a==null)return null;if(typeof a=="string")return this.parseDateString(a);if(a instanceof Date)return isNaN(a.getTime())?null:{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()};if(typeof a=="object"&&a!==null){let t=a;if(typeof t.year=="number"&&typeof t.month=="number"&&typeof t.day=="number"&&this.isValidDate(t.year,t.month,t.day))return{year:t.year,month:t.month,day:t.day}}return null}parseDateString(a){let t=a.trim(),e=t.match(/^XXXX-(\d{2})-(\d{2})$/i);if(e){let o=parseInt(e[1],10),l=parseInt(e[2],10);return this.isValidDate(2e3,o,l)?{year:0,month:o,day:l}:null}let n=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!n)return null;let r=parseInt(n[1],10),i=parseInt(n[2],10),s=parseInt(n[3],10);return this.isValidDate(r,i,s)?{year:r,month:i,day:s}:null}isValidDate(a,t,e){if(a<1900||a>2100||t<1||t>12||e<1||e>31)return!1;let n=this.getDaysInMonth(a,t);return!(e>n)}getDaysInMonth(a,t){let e=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2&&this.isLeapYear(a)?29:e[t-1]}isLeapYear(a){return a%4===0&&a%100!==0||a%400===0}extractFromFilename(a){let t={start:null,end:null};if(!a||typeof a!="string")return t;let e=a.match(Bt.DATE_PATTERN);return!e||e.length===0||(t.start=this.parseDate(e[0]),e.length>=2&&(t.end=this.parseDate(e[1]))),t}extractFromProperties(a,t){if(!a||typeof a!="object"||!Array.isArray(t))return null;for(let e of t){if(typeof e!="string"||!e)continue;let n=a[e];if(n==null)continue;let r=this.parseDate(n);if(r!==null)return r}return null}extractDates(a,t,e){let n={start:null,end:null},r=this.extractFromFilename(a);for(let i of e.priorities)i==="filename"?(n.start===null&&r.start!==null&&(n.start=r.start),n.end===null&&r.end!==null&&(n.end=r.end)):i==="properties"&&(n.start===null&&(n.start=this.extractFromProperties(t,e.startSources)),n.end===null&&(n.end=this.extractFromProperties(t,e.endSources)));return n}};Bt.DATE_PATTERN=/(\d{4}-\d{2}-\d{2})/g;var Dt=Bt,ba=new Dt;_();var Hn=["January","February","March","April","May","June","July","August","September","October","November","December"],Yt=class{getDaysInMonth(a,t){return M(a,t)}getFirstDayOfWeek(a,t){let e=x(a,t,1);return Y(e)}isToday(a){let t=I();return ht(a,t)}generateGrid(a){let t=[];for(let e=1;e<=12;e++)t.push(this.generateMonth(a,e));return{year:a,months:t}}generateMonth(a,t){let e=this.getDaysInMonth(a,t),n=this.getFirstDayOfWeek(a,t),r=[];for(let i=0;i<n;i++)r.push({date:x(a,t,1),isToday:!1,isEmpty:!0});for(let i=1;i<=e;i++){let s=x(a,t,i);r.push({date:s,isToday:this.isToday(s),isEmpty:!1})}return{month:t,name:Hn[t-1],startDayOfWeek:n,daysInMonth:e,days:r}}};_();var zn=24,Ct=class{calculateMonthSegments(a,t,e){let n=[];if(L(a,t)>0)return n;let r=a.year,i=a.month,s=0;for(;s<zn;){let o=r===a.year&&i===a.month,l=r===t.year&&i===t.month,c=o?a.day:1,u=l?t.day:M(r,i);if(n.push({year:r,month:i,startDay:c,endDay:u,entryId:e}),l)break;i++,i>12&&(i=1,r++),s++}return n}calculateBarPositions(a,t){let e=new Map;if(a.length===0)return e;let n=[...a].sort((i,s)=>i.startDay!==s.startDay?i.startDay-s.startDay:s.endDay-s.startDay-(i.endDay-i.startDay)),r=[];for(let i=0;i<=31;i++)r.push(new Set);for(let i of n){let s=(t.startDayOfWeek+i.startDay-1)%7,o=(t.startDayOfWeek+i.endDay-1)%7,l=i.endDay-i.startDay+1,c=0,u=!1;for(;!u;){let p=!0;for(let h=i.startDay;h<=i.endDay;h++)if(r[h].has(c)){p=!1;break}if(p){u=!0;for(let h=i.startDay;h<=i.endDay;h++)r[h].add(c)}else c++;if(c>100)break}e.set(i.entryId,{rowIndex:c,startColumn:s,endColumn:o,span:l})}return e}},Ca=new Ct;De();_();W();_();var Kt=class{constructor(a,t){this.unregisterMetadataListener=null;this.eventListeners=null;this.updateSubscribers=new Set;this.vaultRepository=new Tt(a),this.metadataRepository=new Nt(a),this.entryCache=new Vt({debug:!1}),this.dateEngine=new Dt,this.calendarEngine=new Yt,this.multiDayEngine=new Ct,this.settings=t,this.currentYear=I().year}async initialize(){await this.rebuildCache(),this.setupMetadataListener()}destroy(){this.unregisterMetadataListener&&(this.unregisterMetadataListener(),this.unregisterMetadataListener=null),this.eventListeners=null}setEventListeners(a){this.eventListeners=a}subscribeToUpdates(a){return this.updateSubscribers.add(a),()=>{this.updateSubscribers.delete(a)}}notifySubscribers(){for(let a of this.updateSubscribers)try{a()}catch(t){console.error("Radcal subscriber error:",t)}}async updateSettings(a){let t=this.settings.dateProperties.join(",")!==a.dateProperties.join(",")||this.settings.endDateProperties.join(",")!==a.endDateProperties.join(",")||this.settings.datePriority!==a.datePriority;this.settings=a,t&&await this.rebuildCache()}getCurrentYear(){return this.currentYear}setCurrentYear(a){var t;this.currentYear!==a&&(this.currentYear=a,(t=this.eventListeners)==null||t.onYearChanged(a))}setYear(a){this.setCurrentYear(a)}nextYear(){this.setCurrentYear(this.currentYear+1)}previousYear(){this.setCurrentYear(this.currentYear-1)}goToToday(){this.setCurrentYear(I().year)}generateCalendarGrid(){return this.calendarEngine.generateGrid(this.currentYear)}getEntriesForDate(a){return this.entryCache.getEntriesForDate(a)}getMultiDayEntries(){return this.entryCache.getMultiDayEntries().filter(a=>{var r;let t={year:this.currentYear,month:1,day:1},e={year:this.currentYear,month:12,day:31},n=(r=a.endDate)!=null?r:a.startDate;return a.startDate.year===this.currentYear||a.startDate.year<this.currentYear&&n.year>=this.currentYear})}getAnniversaryEntriesForDate(a){return this.entryCache.getAnniversaryEntriesForDate(a)}getAllAnniversaryEntries(){return this.entryCache.getAllAnniversaryEntries()}calculateBarPositions(a,t){return new Map}async openDailyNote(a){let t=this.settings.dailyNoteFormat,e=this.settings.dailyNoteFolder,n=this.formatDailyNoteFilename(a,t),r=e?`${e}/${n}.md`:`${n}.md`,i=await this.vaultRepository.createOrOpenDailyNote(r);console.log(`Opening daily note: ${i.path}`)}getCacheStats(){let a=this.entryCache.getStats();return{entryCount:a.entryCount,dateCount:a.dateCount}}loadLifePhases(a,t={startDateField:"phase-start",endDateField:"phase-end",colorField:"phase-color",labelField:"phase-label",categoryField:"phase-category"}){let e=this.vaultRepository.getAllMarkdownFiles(),n=[],r=new Set;if(a){let s=a.endsWith("/")?a:`${a}/`,o=e.filter(l=>l.path===`${a}.md`||l.path.startsWith(s));for(let l of o){let c=this.parseLifePhase(l,t);c&&(n.push(c),r.add(l.path))}}let i={startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label",categoryField:"radcal-category"};for(let s of e){if(r.has(s.path))continue;let o=this.metadataRepository.getMetadataByPath(s.path),l=o==null?void 0:o.frontmatter;if((l==null?void 0:l["radcal-showInLife"])===!0){let c=this.parseLifePhase(s,i);c&&n.push(c)}}return n.sort((s,o)=>s.startDate.year!==o.startDate.year?s.startDate.year-o.startDate.year:s.startDate.month!==o.startDate.month?s.startDate.month-o.startDate.month:s.startDate.day-o.startDate.day)}parseLifePhase(a,t){let e=this.metadataRepository.getMetadataByPath(a.path),n=e==null?void 0:e.frontmatter;if(!n)return null;let r=n[t.startDateField];if(!r||typeof r!="string")return null;let i=this.parseYAMLDate(r);if(!i)return null;let s=n[t.endDateField],o=null;s&&typeof s=="string"&&s.trim()!==""&&(o=this.parseYAMLDate(s));let l=n[t.colorField],c=this.isValidColor(l)?l:"blue",u=n[t.labelField]||a.basename,p=n[t.categoryField],h=n["radcal-ring"],g=n["radcal-pattern"],y=this.isValidPattern(g)?g:void 0,m=n["radcal-opacity"],f;if(typeof m=="number"&&m>=0&&m<=100)f=m;else if(typeof m=="string"){let N=parseInt(m,10);!isNaN(N)&&N>=0&&N<=100&&(f=N)}let b=n["radcal-fade"],w=b===!0||b==="true",A=n["radcal-icon"],D=typeof A=="string"&&A.trim()?A.trim():void 0,C=n["radcal-preset"],E=typeof C=="string"&&C.trim()?C.trim():void 0;return{filePath:a.path,label:String(u),startDate:i,endDate:o,color:c,category:p?String(p):void 0,ringName:h?String(h):void 0,pattern:y,opacity:f,fade:w,icon:D,preset:E}}isValidPattern(a){return typeof a=="string"&&z.includes(a)}loadLifePhasesByRing(a){let t=this.loadLifePhases(a),e=new Map;for(let n of t){let r=n.ringName||"__default__",i=e.get(r)||[];i.push(n),e.set(r,i)}return e}parseYAMLDate(a){let t=a.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return null;let e=parseInt(t[1],10),n=parseInt(t[2],10),r=parseInt(t[3],10);return n<1||n>12||r<1||r>31?null:x(e,n,r)}isValidColor(a){return typeof a=="string"&&["red","orange","yellow","green","blue","purple","pink","teal","cyan","magenta","lime","amber","indigo","violet","rose","gray","slate","stone"].includes(a)}computeLifePhaseSegments(a,t,e,n,r){let i=n?this.parseYAMLDate(n)||x(t,1,1):x(t,1,1),s=x(i.year+e,i.month,i.day),o=this.daysBetweenDates(i,s),l=I(),c=new Map;if(r)for(let u of r)c.set(u.name.toLowerCase(),u);return a.map(u=>{let h=this.daysBetweenDates(i,u.startDate)/o*2*Math.PI,g,y=!1;u.endDate?g=u.endDate:(y=!0,g=s);let f=this.daysBetweenDates(i,g)/o*2*Math.PI,b;y&&(b=this.daysBetweenDates(i,l)/o*2*Math.PI);let w=u.color,A=u.pattern,D=u.opacity,C=u.icon;if(u.preset){let k=c.get(u.preset.toLowerCase());k&&(u.color==="blue"&&k.color!=="blue"&&(w=k.color),A===void 0&&k.pattern!==void 0&&(A=k.pattern),D===void 0&&k.opacity!==void 0&&(D=k.opacity),C===void 0&&k.icon!==void 0&&(C=k.icon))}let{RING_COLORS:E}=(W(),Ae(Fe)),N=E[w]||E.blue;return{id:u.filePath,filePath:u.filePath,label:u.label,startAngle:h,endAngle:f,color:N,entries:[],isOngoing:y,todayAngle:b,category:u.category,pattern:A,opacity:D,fade:u.fade,icon:C}})}loadSpanningArcs(a,t,e={startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label"},n){if(!a)return[];let r=this.vaultRepository.getAllMarkdownFiles(),i=[],s=new Map;if(n)for(let p of n)s.set(p.name.toLowerCase(),p);let o=a.endsWith("/")?a:`${a}/`,l=r.filter(p=>p.path===`${a}.md`||p.path.startsWith(o)),c=x(t,1,1),u=x(t,12,31);for(let p of l){let h=this.metadataRepository.getMetadataByPath(p.path),g=h==null?void 0:h.frontmatter;if(!g)continue;let y=g[e.startDateField];if(!y||typeof y!="string")continue;let m=this.parseYAMLDate(y);if(!m)continue;let f=g[e.endDateField],b=null;if(f&&typeof f=="string"&&f.trim()!==""&&(b=this.parseYAMLDate(f)),b||(b=m),b.year<t||m.year>t)continue;let w=this.compareDates(m,c)<0,A=this.compareDates(b,u)>0,D=w?c:m,C=A?u:b,E=g[e.colorField],N=this.isValidColor(E)?E:void 0,k=g[e.labelField]||p.basename,dt=w?0:this.dateToYearAngle(D,t),G=A?2*Math.PI:this.dateToYearAngle(C,t),{RING_COLORS:B}=(W(),Ae(Fe)),K=kt(m,b)+1,St=g["radcal-pattern"],ut=this.isValidPattern(St)?St:void 0,Z=g["radcal-opacity"],pt;if(typeof Z=="number"&&Z>=0&&Z<=100)pt=Z;else if(typeof Z=="string"){let V=parseInt(Z,10);!isNaN(V)&&V>=0&&V<=100&&(pt=V)}let Lt=g["radcal-fade"],ye=Lt===!0||Lt==="true",wt=g["radcal-icon"],Vn=typeof wt=="string"&&wt.trim()?wt.trim():void 0,me=g["radcal-preset"],je=typeof me=="string"&&me.trim()?me.trim().toLowerCase():void 0,Rt=N,fe=ut,be=pt,ve=Vn;if(je){let V=s.get(je);V&&(Rt===void 0&&(Rt=V.color),fe===void 0&&V.pattern!==void 0&&(fe=V.pattern),be===void 0&&V.opacity!==void 0&&(be=V.opacity),ve===void 0&&V.icon!==void 0&&(ve=V.icon))}let Bn=Rt?B[Rt]:void 0;i.push({id:p.path,filePath:p.path,label:String(k),startAngle:dt,endAngle:G,color:Bn,entries:[],continuesFromPreviousYear:w,continuesIntoNextYear:A,startDate:{year:m.year,month:m.month,day:m.day},endDate:{year:b.year,month:b.month,day:b.day},durationDays:K,pattern:fe,opacity:be,fade:ye,icon:ve})}return i.sort((p,h)=>p.startAngle-h.startAngle)}dateToYearAngle(a,t){let e=this.isLeapYear(t)?366:365;return(this.getDayOfYear(a)-1)/e*2*Math.PI}compareDates(a,t){return a.year!==t.year?a.year-t.year:a.month!==t.month?a.month-t.month:a.day-t.day}daysBetweenDates(a,t){let e=new Date(a.year,a.month-1,a.day).getTime(),n=new Date(t.year,t.month-1,t.day).getTime();return Math.floor((n-e)/(1e3*60*60*24))}dateToYearFraction(a){let t=this.isLeapYear(a.year)?366:365;return(this.getDayOfYear(a)-1)/t}isLeapYear(a){return a%4===0&&a%100!==0||a%400===0}getDayOfYear(a){let t=[31,28,31,30,31,30,31,31,30,31,30,31];this.isLeapYear(a.year)&&(t[1]=29);let e=a.day;for(let n=0;n<a.month-1;n++)e+=t[n];return e}async rebuildCache(){var n;let a=this.vaultRepository.getAllMarkdownFiles(),t=[],e=this.getDateExtractionConfig();for(let r of a){let i=this.createEntriesFromFile(r,e);t.push(...i)}this.entryCache.rebuild(t),(n=this.eventListeners)==null||n.onEntriesUpdated(),this.notifySubscribers()}createEntriesFromFile(a,t){var c,u,p;let e=this.metadataRepository.getMetadataByPath(a.path),n=(c=e==null?void 0:e.frontmatter)!=null?c:null,{start:r,end:i}=this.dateEngine.extractDates(a.name,n,t),s=(n==null?void 0:n["radcal-annual"])===!0,o={};if(n)for(let[h,g]of Object.entries(n))(typeof g=="string"||typeof g=="number"||typeof g=="boolean")&&(o[h]=g);let l={tags:(u=e==null?void 0:e.tags.map(h=>h.name))!=null?u:[],folder:(p=a.folderPath)!=null?p:"",properties:o};if(s&&n){let h=[],g=this.parseFrontmatterDate(n["radcal-annual-fix"]);if(g)return h.push(X({id:`${a.path}#fix`,filePath:a.path,fileName:a.name,displayName:a.basename,startDate:g,endDate:null,metadata:l,isAnniversary:!0})),h;let y=this.parseFrontmatterDate(n["radcal-start"]),m=this.parseFrontmatterDate(n["radcal-end"]);y&&h.push(X({id:`${a.path}#start`,filePath:a.path,fileName:a.name,displayName:a.basename,startDate:y,endDate:null,metadata:l,isAnniversary:!0})),m&&h.push(X({id:`${a.path}#end`,filePath:a.path,fileName:a.name,displayName:a.basename,startDate:m,endDate:null,metadata:l,isAnniversary:!0}));let f=this.settings.anniversaryDateProperties||[];for(let b of f){let w=this.parseFrontmatterDate(n[b]);if(w){let A=b.toLowerCase().replace(/\s+/g,"-");h.push(X({id:`${a.path}#${A}`,filePath:a.path,fileName:a.name,displayName:a.basename,startDate:w,endDate:null,metadata:l,isAnniversary:!0}))}}return h.length===0&&r&&h.push(X({id:`${a.path}#fallback`,filePath:a.path,fileName:a.name,displayName:a.basename,startDate:r,endDate:null,metadata:l,isAnniversary:!0})),h}return r?[X({id:a.path,filePath:a.path,fileName:a.name,displayName:a.basename,startDate:r,endDate:i,metadata:l,isAnniversary:!1})]:[]}parseFrontmatterDate(a){return a?typeof a=="string"?this.parseYAMLDate(a):a instanceof Date?x(a.getFullYear(),a.getMonth()+1,a.getDate()):null:null}getDateExtractionConfig(){return{startSources:this.settings.dateProperties,endSources:this.settings.endDateProperties,priorities:this.settings.datePriority==="property"?["properties","filename"]:["filename","properties"]}}formatDailyNoteFilename(a,t){return t.replace("YYYY",String(a.year)).replace("MM",String(a.month).padStart(2,"0")).replace("DD",String(a.day).padStart(2,"0"))}setupMetadataListener(){this.unregisterMetadataListener=this.metadataRepository.onMetadataChange(a=>{this.handleFileChange(a.path)})}handleFileChange(a){var e;let t=this.vaultRepository.getAllMarkdownFiles().find(n=>n.path===a);if(t){this.entryCache.removeEntry(a),this.entryCache.removeEntry(`${a}#start`),this.entryCache.removeEntry(`${a}#end`),this.entryCache.removeEntry(`${a}#fix`),this.entryCache.removeEntry(`${a}#fallback`);let n=this.settings.anniversaryDateProperties||[];for(let s of n){let o=s.toLowerCase().replace(/\s+/g,"-");this.entryCache.removeEntry(`${a}#${o}`)}let r=this.getDateExtractionConfig(),i=this.createEntriesFromFile(t,r);for(let s of i)this.entryCache.addEntry(s)}else{this.entryCache.removeEntry(a),this.entryCache.removeEntry(`${a}#start`),this.entryCache.removeEntry(`${a}#end`),this.entryCache.removeEntry(`${a}#fix`),this.entryCache.removeEntry(`${a}#fallback`);let n=this.settings.anniversaryDateProperties||[];for(let r of n){let i=r.toLowerCase().replace(/\s+/g,"-");this.entryCache.removeEntry(`${a}#${i}`)}}(e=this.eventListeners)==null||e.onEntriesUpdated(),this.notifySubscribers()}};var J=require("obsidian");_();W();var Et="radial-calendar-plugin",fn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ke=["January","February","March","April","May","June","July","August","September","October","November","December"],Oe=800,v=Oe/2,it=v-20,ot={center:.35,yearRing:.12,gap1:.01,lifePhases:.38,gap2:.01,lifeRing:.1},Xt=it*ot.center,j=Xt+it*ot.gap1,U=j+it*ot.yearRing,Cn=U+it*ot.gap1,Jt=Cn+it*ot.lifePhases,Ve=Jt+it*ot.gap2,st=Ve+it*ot.lifeRing,$=380,Be=30,H=145,$e=H+Be,bn=H+Be*.65,tr=($-H)/31,vn=1,ta=20,Sn=$+2,wn=$+8,An=$+14,Dn=$+12,ea=4;function na(d){if(d>=365){let a=Math.floor(d/365),t=d%365;if(t>=30){let e=Math.floor(t/30);return`${a}y ${e}m`}return`${a}y`}if(d>=30){let a=Math.floor(d/30),t=d%30;return t>0?`${a}m ${t}d`:`${a}m`}return`${d}d`}var Qt=class extends J.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.tooltipEl=null;this.visibleRings=new Set;this.allRingNames=[]}getViewType(){return Et}getDisplayText(){return"Radial Calendar"}getIcon(){return"circle"}initialize(t){this.config=t,this.config.service.setEventListeners({onEntriesUpdated:()=>this.render(),onYearChanged:()=>this.render()})}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("radial-calendar-plugin"),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null,this.tooltipEl=null}render(){if(!this.containerEl_||!this.config)return;let e=this.config.service.getCurrentYear(),n=document.createElement("div");n.className="rc-container";let r=document.createElement("div");if(r.className="rc-header",this.buildHeader(r,e),n.appendChild(r),this.config.settings.currentView==="life"){let l=this.buildRingFilterBar();l&&n.appendChild(l)}let s=document.createElement("div");s.className="rc-wrapper",n.appendChild(s),this.renderRadialCalendar(s,e);let o=document.createElement("div");o.className="rc-tooltip",o.style.display="none",n.appendChild(o),this.tooltipEl=o,this.containerEl_.empty(),this.containerEl_.appendChild(n)}buildHeader(t,e){if(!this.config)return;let n=document.createElement("button");n.textContent="\u2190",n.className="rc-nav-btn",n.setAttribute("aria-label","Previous year"),n.addEventListener("click",()=>{var u;(u=this.config)==null||u.service.previousYear()}),t.appendChild(n);let r=document.createElement("span");r.textContent=String(e),r.className="rc-year-title",t.appendChild(r);let i=document.createElement("button");i.textContent="\u2192",i.className="rc-nav-btn",i.setAttribute("aria-label","Next year"),i.addEventListener("click",()=>{var u;(u=this.config)==null||u.service.nextYear()}),t.appendChild(i);let s=document.createElement("button");s.textContent="Today",s.className="rc-nav-btn rc-today-btn",s.setAttribute("aria-label","Go to today"),s.addEventListener("click",()=>{var u;(u=this.config)==null||u.service.goToToday()}),t.appendChild(s);let o=document.createElement("button");o.textContent="\u21BB",o.className="rc-nav-btn rc-refresh-btn",o.setAttribute("aria-label","Refresh view"),o.addEventListener("click",()=>{this.render()}),t.appendChild(o);let l=document.createElement("button"),c=this.config.settings.currentView==="life";l.textContent=c?"\u{1F4C5}":"\u23F3",l.className="rc-nav-btn rc-view-btn",l.setAttribute("aria-label",c?"Switch to Annual View":"Switch to Life View"),l.addEventListener("click",async()=>{if(!this.config)return;let u=this.config.settings.currentView==="life"?"annual":"life",p={...this.config.settings,currentView:u};this.config.settings=p,await this.config.onSettingsChange(p),this.render()}),t.appendChild(l)}buildRingFilterBar(){if(!this.config)return null;let t=this.config.settings.lifePhasesFolder,e=this.config.service.loadLifePhasesByRing(t);if(this.allRingNames=Array.from(e.keys()).sort((s,o)=>s==="__default__"?1:o==="__default__"?-1:s.localeCompare(o)),this.allRingNames.length<=1)return null;this.visibleRings.size===0&&this.allRingNames.forEach(s=>this.visibleRings.add(s));let n=document.createElement("div");n.className="rc-ring-filter-bar";let r=document.createElement("button");r.className="rc-ring-chip",r.textContent="Alle",this.visibleRings.size===this.allRingNames.length&&r.classList.add("rc-ring-chip-active"),r.addEventListener("click",()=>{this.visibleRings.size===this.allRingNames.length||(this.visibleRings.clear(),this.allRingNames.forEach(s=>this.visibleRings.add(s)),this.render())}),n.appendChild(r);for(let s of this.allRingNames){let o=s==="__default__"?"Standard":s,l=document.createElement("button");l.className="rc-ring-chip",l.textContent=o,this.visibleRings.has(s)&&l.classList.add("rc-ring-chip-active"),l.addEventListener("click",()=>{this.visibleRings.has(s)?this.visibleRings.size>1&&(this.visibleRings.delete(s),this.render()):(this.visibleRings.add(s),this.render())}),n.appendChild(l)}return n}renderRadialCalendar(t,e){if(!this.config)return;let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("viewBox",`0 0 ${Oe} ${Oe}`),n.setAttribute("class","rc-svg"),this.svgEl=n,this.config.settings.currentView==="life"?this.renderNestedClock(n,e):this.renderAnnualView(n,e),t.appendChild(n)}renderNestedClock(t,e){if(!this.config)return;let{birthYear:n,expectedLifespan:r}=this.config.settings,i=n+r,s=I(),o=s.year-n;this.renderBackgroundCircle(t),this.renderLifeRing(t,n,i,e),this.renderLifePhasesRing(t,n,r),this.renderYearRing(t,e),this.renderLifeActsOnRing(t,n,r),this.renderNestedCenter(t,e,o),this.renderLifePositionMarker(t,n,r,s.year,"today"),e!==s.year&&this.renderLifePositionMarker(t,n,r,e,"viewed"),e===s.year&&this.renderTodayMarkerOnYearRing(t),this.renderBirthdayMarkerOnYearRing(t,e)}renderLifeRing(t,e,n,r){let i=n-e,s=I();for(let o=e;o<n;o++){let l=o-e,c=l/i*2*Math.PI,u=(l+1)/i*2*Math.PI-.01,p=o<s.year,h=o===s.year,g=o===r,m=Math.floor(l/10)%2===0,f=this.createArcPath(Ve,st,c,u),b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d",f);let w="rc-life-year";p&&(w+=" rc-life-year--past"),h&&(w+=" rc-life-year--current"),g&&(w+=" rc-life-year--selected"),w+=m?" rc-life-year--decade-even":" rc-life-year--decade-odd",b.setAttribute("class",w),b.setAttribute("data-year",String(o)),b.addEventListener("click",()=>{var A;(A=this.config)==null||A.service.setYear(o)}),b.addEventListener("mouseenter",A=>{this.showLifeYearTooltip(A,o,o-e)}),b.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(b)}for(let o=e+10;o<n;o+=10){let c=(o-e)/i*2*Math.PI-Math.PI/2,u=st-2,p=st+4,h=v+u*Math.cos(c),g=v+u*Math.sin(c),y=v+p*Math.cos(c),m=v+p*Math.sin(c),f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",String(h)),f.setAttribute("y1",String(g)),f.setAttribute("x2",String(y)),f.setAttribute("y2",String(m)),f.setAttribute("class","rc-decade-tick"),t.appendChild(f)}}renderLifePhasesRing(t,e,n){if(!this.config)return;let r=this.config.settings.lifePhasesFolder,i=this.config.service.loadLifePhasesByRing(r);if(i.size===0)return;let s=Array.from(i.keys()).sort((g,y)=>g==="__default__"?1:y==="__default__"?-1:g.localeCompare(y));this.visibleRings.size>0&&this.visibleRings.size<s.length&&(s=s.filter(g=>this.visibleRings.has(g)));let o=s.length;if(o===0)return;let c=(Jt-Cn)/o,u=2,p=this.getOrCreateDefs(t),h=this.config.settings.birthDate;s.forEach((g,y)=>{let m=i.get(g)||[];if(m.length===0)return;let f=Jt-y*c-u,b=Jt-(y+1)*c+u,w=this.config.settings.presets||[],A=this.config.service.computeLifePhaseSegments(m,e,n,h,w),D=new Map,C=[];for(let B of A)if(B.category){let K=D.get(B.category)||[];K.push(B),D.set(B.category,K)}else C.push(B);let E=Array.from(D.keys()).sort(),N=E.length,k=gt(C),dt=C.length>0?yt(k):0,G=N+dt;if(G!==0){E.forEach((B,K)=>{let St=D.get(B)||[],ut=gt(St),Z=yt(ut);for(let pt of ut){let Lt=f-K/G*(f-b),ye=f-(K+1)/G*(f-b),wt=at(Lt,ye,Z,pt.track);this.renderLifePhaseArcWithRadii(t,p,pt,wt)}});for(let B of k){let K=f-N/G*(f-b),ut=at(K,b,dt,B.track);this.renderLifePhaseArcWithRadii(t,p,B,ut)}g!=="__default__"&&this.renderRingLabel(t,g,f,b)}})}renderRingLabel(t,e,n,r){let i=(n+r)/2,s=Math.PI,o=v+i*Math.cos(s),l=v+i*Math.sin(s),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(o-5)),c.setAttribute("y",String(l)),c.setAttribute("class","rc-ring-label"),c.setAttribute("text-anchor","end"),c.setAttribute("dominant-baseline","middle"),c.style.fontSize="10px",c.style.fill="var(--text-muted)",c.style.fontWeight="500",c.textContent=e,t.appendChild(c)}getOrCreateDefs(t){let e=t.querySelector("defs");return e||(e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(e,t.firstChild)),e}getOrCreatePattern(t,e,n){let r=`pattern-${e}-${n.replace("#","")}`;if(t.querySelector(`#${r}`))return`url(#${r})`;let i=document.createElementNS("http://www.w3.org/2000/svg","pattern");i.setAttribute("id",r),i.setAttribute("patternUnits","userSpaceOnUse"),i.setAttribute("width","10"),i.setAttribute("height","10");let s=Me[e];return s&&s(i,n),t.appendChild(i),`url(#${r})`}getOrCreateFadeGradient(t,e,n,r,i,s){if(t.querySelector(`#${e}`))return`url(#${e})`;let o=r-Math.PI/2,l=i-Math.PI/2,c=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");c.setAttribute("id",e),c.setAttribute("gradientUnits","userSpaceOnUse");let u=300,p=v+u*Math.cos(o),h=v+u*Math.sin(o),g=v+u*Math.cos(l),y=v+u*Math.sin(l);c.setAttribute("x1",String(p)),c.setAttribute("y1",String(h)),c.setAttribute("x2",String(g)),c.setAttribute("y2",String(y));let m;s===void 0||s<=0?m=0:s>=1?m=100:m=Math.round(s*100);let f=document.createElementNS("http://www.w3.org/2000/svg","stop");if(f.setAttribute("offset","0%"),f.setAttribute("stop-color",n),f.setAttribute("stop-opacity","1"),m>0&&m<100){let w=document.createElementNS("http://www.w3.org/2000/svg","stop");w.setAttribute("offset",`${m}%`),w.setAttribute("stop-color",n),w.setAttribute("stop-opacity","1"),c.appendChild(f),c.appendChild(w)}else c.appendChild(f);let b=document.createElementNS("http://www.w3.org/2000/svg","stop");return b.setAttribute("offset","100%"),b.setAttribute("stop-color",n),b.setAttribute("stop-opacity",m>=100?"1":"0.15"),c.appendChild(b),t.appendChild(c),`url(#${e})`}calculateTodayPosition(t,e){let n=new Date,r={year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate()},i=this.localDateToDays(t),s=this.localDateToDays(e),o=this.localDateToDays(r),l=s-i;return l<=0?0:(o-i)/l}localDateToDays(t){return new Date(t.year,t.month-1,t.day).getTime()/(1e3*60*60*24)}applyVisualOptions(t,e,n,r){let{pattern:i,opacity:s,fade:o,startAngle:l,endAngle:c,id:u,startDate:p,endDate:h}=r;if(i&&i!=="solid"){let g=this.getOrCreatePattern(e,i,n);t.style.fill=g}else if(o&&l!==void 0&&c!==void 0&&u){let g;p&&h&&(g=this.calculateTodayPosition(p,h));let y=`fade-${u.replace(/[^a-zA-Z0-9]/g,"-")}`,m=this.getOrCreateFadeGradient(e,y,n,l,c,g);t.style.fill=m}else t.style.fill=n;s!==void 0&&s!==100&&(t.style.fillOpacity=String(s/100))}renderLifePhaseArcWithRadii(t,e,n,r){let i=n.opacity!==void 0?n.opacity/100:1;if(n.isOngoing&&n.todayAngle!==void 0&&n.todayAngle>n.startAngle){let s=this.createArcPath(r.inner,r.outer,n.startAngle,n.todayAngle),o=document.createElementNS("http://www.w3.org/2000/svg","path");if(o.setAttribute("d",s),o.setAttribute("class","rc-life-phase"),n.pattern&&n.pattern!=="solid"){let h=this.getOrCreatePattern(e,n.pattern,n.color);o.style.fill=h}else o.style.fill=n.color;o.style.opacity=String(i);let l=this.createArcPath(r.inner,r.outer,n.todayAngle,n.endAngle),c=document.createElementNS("http://www.w3.org/2000/svg","path");if(c.setAttribute("d",l),c.setAttribute("class","rc-life-phase rc-life-phase-future"),n.pattern&&n.pattern!=="solid"){let h=this.getOrCreatePattern(e,n.pattern,n.color);c.style.fill=h}else c.style.fill=n.color;c.style.opacity=String(i*.35),n.filePath&&(o.style.cursor="pointer",c.style.cursor="pointer",o.addEventListener("click",h=>{var g;h.button===0&&!h.ctrlKey&&!h.metaKey&&((g=this.config)==null||g.openFile(n.filePath))}),c.addEventListener("click",h=>{var g;h.button===0&&!h.ctrlKey&&!h.metaKey&&((g=this.config)==null||g.openFile(n.filePath))}),o.addEventListener("contextmenu",h=>{h.preventDefault(),this.showArcContextMenu(h,n)}),c.addEventListener("contextmenu",h=>{h.preventDefault(),this.showArcContextMenu(h,n)}));let u=h=>this.showPhaseTooltip(h,n),p=()=>this.hideTooltip();o.addEventListener("mouseenter",u),o.addEventListener("mouseleave",p),c.addEventListener("mouseenter",u),c.addEventListener("mouseleave",p),t.appendChild(o),t.appendChild(c)}else{let s=this.createArcPath(r.inner,r.outer,n.startAngle,n.endAngle),o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",s),o.setAttribute("class","rc-life-phase"),this.applyVisualOptions(o,e,n.color,{pattern:n.pattern,opacity:n.opacity,fade:n.fade,startAngle:n.startAngle,endAngle:n.endAngle,id:n.id,startDate:n.startDate,endDate:n.endDate}),n.filePath&&(o.style.cursor="pointer",o.addEventListener("click",l=>{var c;l.button===0&&!l.ctrlKey&&!l.metaKey&&((c=this.config)==null||c.openFile(n.filePath))}),o.addEventListener("contextmenu",l=>{l.preventDefault(),this.showArcContextMenu(l,n)})),o.addEventListener("mouseenter",l=>{this.showPhaseTooltip(l,n)}),o.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(o)}n.label&&n.endAngle-n.startAngle>.15&&this.renderPhaseLabel(t,n,r),n.icon&&this.renderPhaseIcon(t,n,r)}renderPhaseIcon(t,e,n){let r=(n.outer+n.inner)/2,i=e.startAngle+.02,s=v+r*Math.sin(i),o=v-r*Math.cos(i),l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",String(s)),l.setAttribute("y",String(o)),l.setAttribute("class","rc-phase-icon"),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","middle"),l.textContent=e.icon,e.filePath&&(l.style.cursor="pointer",l.addEventListener("click",()=>{var c;(c=this.config)==null||c.openFile(e.filePath)})),t.appendChild(l)}showArcContextMenu(t,e){let n=new J.Menu;n.addItem(r=>{r.setTitle("Open Note").setIcon("file-text").onClick(()=>{var i;e.filePath&&((i=this.config)==null||i.openFile(e.filePath))})}),n.addSeparator(),n.addItem(r=>{r.setTitle("Create Following Phase").setIcon("plus").onClick(()=>{this.createFollowingPhase(e)})}),n.addSeparator(),n.addItem(r=>{r.setTitle("Set Appearance...").setIcon("palette").onClick(()=>{this.showAppearanceModal(e)})}),n.showAtMouseEvent(t)}async createFollowingPhase(t){if(!this.config||!t.filePath)return;let e=t.endDate;if(e){let n=this.addOneDayToDate(e);await this.createNewPhaseNote(t,n)}else{let n=I();await this.createNewPhaseNote(t,n)}}addOneDayToDate(t){let e=new Date(t.year,t.month-1,t.day+1);return{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()}}async createNewPhaseNote(t,e){var f;if(!this.config)return;let n=this.app,r=n.vault,i=n.workspace,s=r.getAbstractFileByPath(t.filePath);if(!s||!(s instanceof J.TFile))return;let o=n.metadataCache.getFileCache(s),l=(o==null?void 0:o.frontmatter)||{},c=`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`,u=["---",`radcal-start: ${c}`,"radcal-end: ",`radcal-color: ${l["radcal-color"]||"blue"}`,"radcal-label: ",`radcal-showInLife: ${l["radcal-showInLife"]||"true"}`];l["radcal-ring"]&&u.push(`radcal-ring: ${l["radcal-ring"]}`),l["radcal-category"]&&u.push(`radcal-category: ${l["radcal-category"]}`),l["radcal-pattern"]&&u.push(`radcal-pattern: ${l["radcal-pattern"]}`),u.push("---","","# New Phase","");let p=((f=s.parent)==null?void 0:f.path)||"",h=`Phase ${c}.md`,g=p?`${p}/${h}`:h,y=await r.create(g,u.join(`
`));await i.getLeaf(!1).openFile(y)}showAppearanceModal(t){if(!this.config||!t.filePath)return;let e=this.app,n=e.vault.getAbstractFileByPath(t.filePath);!n||!(n instanceof J.TFile)||Promise.resolve().then(()=>(mn(),yn)).then(({AppearanceModal:r})=>{new r(e,n,()=>{this.render()}).open()}).catch(()=>{let{Notice:r}=require("obsidian");new r("Appearance modal not available")})}createPhaseGradient(t,e,n){let r=n.endAngle-n.startAngle,i=(n.todayAngle-n.startAngle)/r,s=Math.max(0,Math.min(100,i*100)),o=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");o.setAttribute("id",e);let l=(n.startAngle+n.endAngle)/2-Math.PI/2,c=50+50*Math.cos(n.startAngle-Math.PI/2),u=50+50*Math.sin(n.startAngle-Math.PI/2),p=50+50*Math.cos(n.endAngle-Math.PI/2),h=50+50*Math.sin(n.endAngle-Math.PI/2);o.setAttribute("x1",`${c}%`),o.setAttribute("y1",`${u}%`),o.setAttribute("x2",`${p}%`),o.setAttribute("y2",`${h}%`);let g=document.createElementNS("http://www.w3.org/2000/svg","stop");g.setAttribute("offset","0%"),g.setAttribute("stop-color",n.color),g.setAttribute("stop-opacity","1"),o.appendChild(g);let y=document.createElementNS("http://www.w3.org/2000/svg","stop");y.setAttribute("offset",`${s}%`),y.setAttribute("stop-color",n.color),y.setAttribute("stop-opacity","1"),o.appendChild(y);let m=document.createElementNS("http://www.w3.org/2000/svg","stop");m.setAttribute("offset",`${s+1}%`),m.setAttribute("stop-color",n.color),m.setAttribute("stop-opacity","0.4"),o.appendChild(m);let f=document.createElementNS("http://www.w3.org/2000/svg","stop");f.setAttribute("offset","100%"),f.setAttribute("stop-color",n.color),f.setAttribute("stop-opacity","0.15"),o.appendChild(f),t.appendChild(o)}renderPhaseLabel(t,e,n){let r=(e.startAngle+e.endAngle)/2-Math.PI/2,i=(n.inner+n.outer)/2,s=v+i*Math.cos(r),o=v+i*Math.sin(r),l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",String(s)),l.setAttribute("y",String(o)),l.setAttribute("class","rc-phase-label"),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","central");let c=(r+Math.PI/2)*180/Math.PI,u=c>90&&c<270?c+180:c;l.setAttribute("transform",`rotate(${u}, ${s}, ${o})`),l.textContent=e.label,t.appendChild(l)}showPhaseTooltip(t,e){if(!this.tooltipEl)return;let n=`<div class="rc-tooltip-date">${e.label}</div>`;e.isOngoing&&(n+='<div class="rc-tooltip-note" style="color: var(--text-accent);">Active (ongoing)</div>'),this.tooltipEl.innerHTML=n,this.tooltipEl.style.display="block",this.centerTooltip()}renderYearRing(t,e){if(!this.config)return;let n=I();for(let s=1;s<=12;s++){let o=M(e,s),l=this.monthToAngle(s),u=Math.PI/6/o,p=n.year===e&&n.month===s;for(let h=1;h<=o;h++){let g=x(e,s,h),y=Y(g),m=p&&n.day===h,f=y===0||y===6,b=l+(h-1)*u,w=b+u-.002,A=this.config.service.getEntriesForDate(g),D=this.createArcPath(j,U,b,w),C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttribute("d",D);let E=["rc-day-arc"];m&&E.push("rc-day-arc--today"),f&&E.push("rc-day-arc--weekend"),A.length>0&&E.push("rc-day-arc--has-notes"),C.setAttribute("class",E.join(" ")),C.addEventListener("click",async()=>{var N;await((N=this.config)==null?void 0:N.service.openDailyNote(g))}),C.addEventListener("mouseenter",N=>{this.showTooltip(N,g,A)}),C.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(C)}}for(let s=1;s<=12;s++){let o=this.monthToAngle(s)-Math.PI/2,l=v+j*Math.cos(o),c=v+j*Math.sin(o),u=v+U*Math.cos(o),p=v+U*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(l)),h.setAttribute("y1",String(c)),h.setAttribute("x2",String(u)),h.setAttribute("y2",String(p)),h.setAttribute("class","rc-month-separator"),t.appendChild(h)}let i=(U-j)*.1;for(let s=0;s<12;s++){let o=this.monthToAngle(s+1)+Math.PI/12,l=o-Math.PI/2,c=Xt+(j-Xt)*.6,u=v+c*Math.cos(l),p=v+c*Math.sin(l),h=o*180/Math.PI;o>Math.PI/2&&o<3*Math.PI/2&&(h+=180);let y=document.createElementNS("http://www.w3.org/2000/svg","text");y.setAttribute("x",String(u)),y.setAttribute("y",String(p)),y.setAttribute("class","rc-month-label"),y.setAttribute("text-anchor","middle"),y.setAttribute("dominant-baseline","central"),y.setAttribute("transform",`rotate(${h}, ${u}, ${p})`),y.style.fontSize=`${i}px`,y.textContent=fn[s],t.appendChild(y)}}renderLifeActsOnRing(t,e,n){if(!this.config)return;let r=this.config.settings.lifeActs;if(r.length!==0)for(let i of r){let s=i.startAge/n*2*Math.PI,o=i.endAge/n*2*Math.PI-.01,l=this.createArcPath(st+2,st+8,s,o),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("class","rc-life-act"),i.color&&(c.style.fill=P[i.color]),t.appendChild(c);let u=(s+o)/2-Math.PI/2,p=st+18,h=v+p*Math.cos(u),g=v+p*Math.sin(u),y=document.createElementNS("http://www.w3.org/2000/svg","text");y.setAttribute("x",String(h)),y.setAttribute("y",String(g)),y.setAttribute("class","rc-life-act-label"),y.setAttribute("text-anchor","middle"),y.setAttribute("dominant-baseline","central");let m=(u+Math.PI/2)*180/Math.PI,f=m>90&&m<270?m+180:m;y.setAttribute("transform",`rotate(${f}, ${h}, ${g})`),i.color&&(y.style.fill=P[i.color]),y.textContent=i.label,t.appendChild(y)}}renderLifePositionMarker(t,e,n,r,i){let s=r-e;if(i==="today"){let m=I(),f=m.year%4===0&&m.year%100!==0||m.year%400===0,b=f?366:365,w=[0,31,28,31,30,31,30,31,31,30,31,30,31];f&&(w[2]=29);let A=m.day;for(let D=1;D<m.month;D++)A+=w[D];s+=A/b}let o=s/n*2*Math.PI-Math.PI/2,l=Ve-5,c=st+5,u=v+l*Math.cos(o),p=v+l*Math.sin(o),h=v+c*Math.cos(o),g=v+c*Math.sin(o),y=document.createElementNS("http://www.w3.org/2000/svg","line");y.setAttribute("x1",String(u)),y.setAttribute("y1",String(p)),y.setAttribute("x2",String(h)),y.setAttribute("y2",String(g)),y.setAttribute("class",i==="today"?"rc-life-marker--today":"rc-life-marker--viewed"),t.appendChild(y)}renderTodayMarkerOnYearRing(t){let e=I(),n=M(e.year,e.month),r=this.monthToAngle(e.month),s=Math.PI/6/n,o=r+(e.day-.5)*s-Math.PI/2,l=v+(j-5)*Math.cos(o),c=v+(j-5)*Math.sin(o),u=v+(U+5)*Math.cos(o),p=v+(U+5)*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(l)),h.setAttribute("y1",String(c)),h.setAttribute("x2",String(u)),h.setAttribute("y2",String(p)),h.setAttribute("class","rc-today-marker"),t.appendChild(h)}renderBirthdayMarkerOnYearRing(t,e){if(!this.config)return;let n=this.config.settings.birthDate;if(!n)return;let r=n.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!r)return;let i=parseInt(r[2],10),s=parseInt(r[3],10),o=M(e,i),l=this.monthToAngle(i),u=Math.PI/6/o,p=l+(s-.5)*u-Math.PI/2,h=v+(j-3)*Math.cos(p),g=v+(j-3)*Math.sin(p),y=v+(U+3)*Math.cos(p),m=v+(U+3)*Math.sin(p),f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",String(h)),f.setAttribute("y1",String(g)),f.setAttribute("x2",String(y)),f.setAttribute("y2",String(m)),f.setAttribute("class","rc-birthday-marker"),t.appendChild(f);let b=U+12,w=v+b*Math.cos(p),A=v+b*Math.sin(p),D=document.createElementNS("http://www.w3.org/2000/svg","text");D.setAttribute("x",String(w)),D.setAttribute("y",String(A)),D.setAttribute("class","rc-birthday-icon"),D.setAttribute("text-anchor","middle"),D.setAttribute("dominant-baseline","central"),D.textContent="\u{1F382}",t.appendChild(D)}renderNestedCenter(t,e,n){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(v)),r.setAttribute("cy",String(v)),r.setAttribute("r",String(Xt-10)),r.setAttribute("class","rc-center"),t.appendChild(r);let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",String(v)),i.setAttribute("y",String(v-20)),i.setAttribute("class","rc-center-year"),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","central"),i.textContent=String(e),t.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(v)),s.setAttribute("y",String(v+20)),s.setAttribute("class","rc-center-age"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=`${n} years`,t.appendChild(s)}showLifeYearTooltip(t,e,n){if(!this.tooltipEl)return;let r=`<div class="rc-tooltip-date">${e}</div>
      <div class="rc-tooltip-note">Age: ${n} years</div>`;this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block",this.centerTooltip()}renderAnnualView(t,e){this.renderBackgroundCircle(t);let n=this.getEnabledRingsSorted(),r=this.calculateRingRadii(n.length);for(let i of n){let s=r.get(i.order);s&&(this.renderRing(t,e,i,s),this.renderRingSeparator(t,s.innerRadius))}for(let i=1;i<=12;i++)this.renderMonthSeparator(t,this.monthToAngle(i));this.renderLabelRingSeparator(t),this.renderOuterSegments(t,e),this.renderCenter(t,e),this.renderMonthLabels(t),this.renderTodayMarker(t,e),this.renderYearBoundaryMarker(t)}renderYearBoundaryMarker(t){let e=-Math.PI/2,n=v+(H-5)*Math.cos(e),r=v+(H-5)*Math.sin(e),i=v+($+5)*Math.cos(e),s=v+($+5)*Math.sin(e),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(n)),o.setAttribute("y1",String(r)),o.setAttribute("x2",String(i)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-year-boundary-marker"),t.appendChild(o);let l=v-$-12,c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(v)),c.setAttribute("y",String(l)),c.setAttribute("class","rc-year-boundary-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central"),c.textContent="\u25BC",t.appendChild(c)}renderLabelRingSeparator(t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(v)),e.setAttribute("cy",String(v)),e.setAttribute("r",String($e)),e.setAttribute("class","rc-label-ring-separator"),t.appendChild(e)}renderRingSeparator(t,e){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(v)),n.setAttribute("cy",String(v)),n.setAttribute("r",String(e)),n.setAttribute("class","rc-ring-separator"),t.appendChild(n)}renderAnniversaryRing(t,e){var i;if(!this.config)return;let n=this.config.service.getAllAnniversaryEntries();if(n.length===0)return;let r=new Map;for(let s of n){let o=`${String(s.startDate.month).padStart(2,"0")}-${String(s.startDate.day).padStart(2,"0")}`,l=(i=r.get(o))!=null?i:[];l.push(s),r.set(o,l)}for(let[s,o]of r){let[l,c]=s.split("-"),u=parseInt(l,10),p=parseInt(c,10),h=M(e,u),g=this.monthToAngle(u),y=Math.PI/6,m=(p-.5)/h,f=g+m*y,b=v+Dn*Math.cos(f-Math.PI/2),w=v+Dn*Math.sin(f-Math.PI/2),A=document.createElementNS("http://www.w3.org/2000/svg","circle");A.setAttribute("cx",String(b)),A.setAttribute("cy",String(w)),A.setAttribute("r",String(ea)),A.setAttribute("class","rc-anniversary-dot");let D=o[0];A.addEventListener("mouseenter",C=>{this.showAnniversaryTooltip(C,o)}),A.addEventListener("mouseleave",()=>this.hideTooltip()),A.addEventListener("click",()=>{var C,E;o.length===1?(C=this.config)==null||C.openFile(D.filePath):(E=this.config)==null||E.openFile(D.filePath)}),t.appendChild(A)}}showAnniversaryTooltip(t,e){if(!this.tooltipEl||e.length===0)return;let n='<div class="rc-tooltip-date">\u{1F4C5}</div>';n+='<div class="rc-tooltip-notes">';for(let r of e.slice(0,5))n+=`<div class="rc-tooltip-note">${r.displayName}</div>`;e.length>5&&(n+=`<div class="rc-tooltip-more">+${e.length-5} more</div>`),n+="</div>",this.tooltipEl.innerHTML=n,this.tooltipEl.style.display="block",this.centerTooltip()}getEnabledRingsSorted(){if(!this.config)return[];let t=[],e=this.config.settings.dailyNoteFolder;t.push({id:"__daily_notes__",name:"Daily Notes",folder:(e==null?void 0:e.trim())||"",color:"blue",segmentType:"daily",enabled:!0,order:0});let n=this.config.settings.rings.filter(s=>s.enabled).sort((s,o)=>s.order-o.order).map((s,o)=>({...s,order:o+1}));t.push(...n);let i=(this.config.settings.calendarSources||[]).filter(s=>s.enabled&&s.showAsRing!==!1&&s.folder).map((s,o)=>({id:`__calendar_${s.id}__`,name:s.name,folder:s.folder,color:s.color,segmentType:"daily",enabled:!0,order:t.length+o,showSpanningArcs:s.showSpanningArcs!==!1,startDateField:"radcal-start",endDateField:"radcal-end",colorField:"radcal-color",labelField:"radcal-label"}));return t.push(...i),t}calculateRingRadii(t){let e=new Map;if(t===0)return e;let n=(t-1)*vn,r=$-$e-n,i=Math.max(ta,r/t);for(let s=0;s<t;s++){let o=$-s*(i+vn),l=Math.max($e,o-i);e.set(s,{outerRadius:o,innerRadius:l})}return e}renderRing(t,e,n,r){if(!this.config)return;let i=P[n.color]||P.blue,s=r.outerRadius-r.innerRadius;if(n.showSpanningArcs){let o=this.config.settings.presets||[],l=this.config.service.loadSpanningArcs(n.folder,e,{startDateField:n.startDateField||"radcal-start",endDateField:n.endDateField||"radcal-end",colorField:n.colorField||"radcal-color",labelField:n.labelField||"radcal-label"},o),c=l.length>0?gt(l):[],u=c.length>0?yt(c):0,p=u>0,h=this.ringHasDailyNotes(n,e);if(h&&!p)for(let g=1;g<=12;g++)this.renderRingMonthSegment(t,e,g,n,r,i);else if(p&&!h)for(let g of c){let y=at(r.outerRadius,r.innerRadius,u,g.track);this.renderSpanningArc(t,g,y,n,i)}else if(p&&h){let f=u*.15,b=Math.min(.6,f),w=Math.max(.4,1-b),A={innerRadius:r.innerRadius,outerRadius:r.innerRadius+s*w};for(let E=1;E<=12;E++)this.renderRingMonthSegment(t,e,E,n,A,i);let D=r.outerRadius,C=A.outerRadius;for(let E of c){let N=at(D,C,u,E.track);this.renderSpanningArc(t,E,N,n,i)}}else this.renderEmptyRingBackground(t,r)}else for(let o=1;o<=12;o++)this.renderRingMonthSegment(t,e,o,n,r,i)}ringHasDailyNotes(t,e){if(!this.config)return!1;for(let n=1;n<=12;n++){let r=x(e,n,1);if(this.getEntriesForRing(r,t).length>0)return!0;let s=x(e,n,15);if(this.getEntriesForRing(s,t).length>0)return!0}return!1}renderSpanningArcsRing(t,e,n,r,i){if(!this.config)return;let s=this.config.settings.presets||[],o=this.config.service.loadSpanningArcs(n.folder,e,{startDateField:n.startDateField||"radcal-start",endDateField:n.endDateField||"radcal-end",colorField:n.colorField||"radcal-color",labelField:n.labelField||"radcal-label"},s);if(o.length===0){this.renderEmptyRingBackground(t,r);return}let l=gt(o),c=yt(l);for(let u of l){let p=at(r.outerRadius,r.innerRadius,c,u.track);this.renderSpanningArc(t,u,p,n,i)}}renderEmptyRingBackground(t,e){let n=this.createArcPath(e.innerRadius,e.outerRadius,0,2*Math.PI-.001),r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",n),r.setAttribute("class","rc-ring-arc"),r.style.fill="var(--background-secondary)",r.style.fillOpacity="0.3",t.appendChild(r)}renderSpanningArc(t,e,n,r,i){if(!this.config)return;let s=this.getOrCreateDefs(t),o=this.createArcPath(n.inner,n.outer,e.startAngle,e.endAngle),l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",o),l.setAttribute("class","rc-ring-arc");let c=e.color||i;this.applyVisualOptions(l,s,c,{pattern:e.pattern,opacity:e.opacity,fade:e.fade,startAngle:e.startAngle,endAngle:e.endAngle,id:e.id,startDate:e.startDate,endDate:e.endDate}),e.filePath&&(l.style.cursor="pointer",l.addEventListener("click",()=>{var u;(u=this.config)==null||u.openFile(e.filePath)})),l.addEventListener("mouseenter",u=>{this.showSpanningArcTooltip(u,e,r)}),l.addEventListener("mouseleave",()=>this.hideTooltip()),t.appendChild(l),e.continuesFromPreviousYear&&this.renderCrossYearIndicator(t,n,0,c,"start"),e.continuesIntoNextYear&&this.renderCrossYearIndicator(t,n,2*Math.PI-.001,c,"end"),e.label&&e.endAngle-e.startAngle>.26&&this.renderSpanningArcLabel(t,e,n)}renderCrossYearIndicator(t,e,n,r,i){let s=n-Math.PI/2,l=(e.outer-e.inner)*.6,c=i==="end"?e.outer:e.inner,u=v+c*Math.cos(s),p=v+c*Math.sin(s),h=s+Math.PI/2,g=i==="end"?1:-1,y=i==="end"?-1:1,m=u+g*l*.6*Math.cos(h),f=p+g*l*.6*Math.sin(h),b=g*l*.3,w=u-b*Math.cos(h),A=p-b*Math.sin(h),D=l*.4,C=w+y*D*Math.cos(s),E=A+y*D*Math.sin(s),N=w-y*D*Math.cos(s),k=A-y*D*Math.sin(s),dt=`${m},${f} ${C},${E} ${N},${k}`,G=document.createElementNS("http://www.w3.org/2000/svg","polygon");G.setAttribute("points",dt),G.setAttribute("class","rc-cross-year-indicator"),G.style.fill=r,t.appendChild(G)}renderSpanningArcLabel(t,e,n){let r=(e.startAngle+e.endAngle)/2-Math.PI/2,i=(n.inner+n.outer)/2,s=v+i*Math.cos(r),o=v+i*Math.sin(r),l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",String(s)),l.setAttribute("y",String(o)),l.setAttribute("class","rc-phase-label"),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","central");let c=(r+Math.PI/2)*180/Math.PI,u=c>90&&c<270?c+180:c;l.setAttribute("transform",`rotate(${u}, ${s}, ${o})`),l.textContent=e.label,t.appendChild(l)}showSpanningArcTooltip(t,e,n){if(!this.tooltipEl)return;let r=`<div class="rc-tooltip-ring" style="color: ${e.color}">${n.name}</div>`;if(r+=`<div class="rc-tooltip-date">${e.label}</div>`,e.startDate&&e.endDate&&e.durationDays){let i=`${e.startDate.day}.${e.startDate.month}.${e.startDate.year}`,s=`${e.endDate.day}.${e.endDate.month}.${e.endDate.year}`,o=na(e.durationDays);r+=`<div class="rc-tooltip-duration">${i} \u2013 ${s}</div>`,r+=`<div class="rc-tooltip-duration-value">${o}</div>`}this.tooltipEl.innerHTML=r,this.tooltipEl.style.display="block",this.centerTooltip()}renderRingMonthSegment(t,e,n,r,i,s){if(!this.config)return;let o=M(e,n),l=this.monthToAngle(n),u=Math.PI/6/o,p=I(),h=p.year===e&&p.month===n,g=this.config.service.getEntriesForDate(x(e,n,1));for(let y=1;y<=o;y++){let m=x(e,n,y),f=Y(m),b=h&&p.day===y,w=f===0||f===6,A=l+(y-1)*u,D=A+u-.002,C=this.getEntriesForRing(m,r);this.renderRingDayArc(t,m,A,D,b,w,C,i,s,r)}}getEntriesForRing(t,e){if(!this.config)return[];let n=this.config.service.getEntriesForDate(t);if(!e.folder||e.folder.trim()==="")return n;let r=e.folder.replace(/^\/+|\/+$/g,"");return n.filter(i=>{let o=(i.metadata.folder||"").replace(/^\/+|\/+$/g,"");return o===r||o.startsWith(r+"/")})}renderRingDayArc(t,e,n,r,i,s,o,l,c,u){if(!this.config)return;let h=(l.outerRadius-l.innerRadius)*.1,g=l.outerRadius-h,y=this.config.service.getAnniversaryEntriesForDate(e),m=y.length>0,f=this.createArcPath(l.innerRadius,g,n,r),b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d",f);let w=["rc-day-arc",`rc-ring-${u.order}`];i&&w.push("rc-day-arc--today"),s&&w.push("rc-day-arc--weekend"),o.length>0&&w.push("rc-day-arc--has-notes"),o.length>3&&w.push("rc-day-arc--many-notes"),b.setAttribute("class",w.join(" ")),b.setAttribute("data-date",`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`),b.setAttribute("data-ring",u.id),o.length>0&&(b.style.fill=c,b.style.fillOpacity="0.6"),b.addEventListener("click",async A=>{var D;A.preventDefault(),o.length>0?this.showDayContextMenu(A,e,o):await((D=this.config)==null?void 0:D.service.openDailyNote(e))}),b.addEventListener("mouseenter",A=>{this.showRingTooltip(A,e,o,u)}),b.addEventListener("mouseleave",()=>{this.hideTooltip()}),b.addEventListener("contextmenu",A=>{A.preventDefault(),this.showDayContextMenu(A,e,o)}),t.appendChild(b),m&&this.renderAnniversaryIndicator(t,n,r,g,l.outerRadius,y,e)}renderAnniversaryIndicator(t,e,n,r,i,s,o){if(!this.config)return;let l=this.createArcPath(r,i,e,n),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("class","rc-anniversary-indicator"),c.addEventListener("click",u=>{var p;u.stopPropagation(),s.length===1?(p=this.config)==null||p.openFile(s[0].filePath):s.length>1&&this.showAnniversaryMenu(u,s)}),c.addEventListener("mouseenter",u=>{this.showAnniversaryTooltip(u,s)}),c.addEventListener("mouseleave",()=>{this.hideTooltip()}),t.appendChild(c)}showAnniversaryMenu(t,e){if(!this.config)return;let n=new J.Menu;for(let r of e.slice(0,15))n.addItem(i=>{i.setTitle(r.displayName).setIcon("cake").onClick(()=>{var s;(s=this.config)==null||s.openFile(r.filePath)})});e.length>15&&n.addItem(r=>{r.setTitle(`+${e.length-15} more...`).setDisabled(!0)}),n.showAtMouseEvent(t)}showRingTooltip(t,e,n,r){if(!this.tooltipEl)return;let o=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][Y(e)]}, ${ke[e.month-1]} ${e.day}, ${e.year}`}</div>`;if(o+=`<div class="rc-tooltip-ring" style="color: ${P[r.color]}">${r.name}</div>`,n.length>0){o+='<div class="rc-tooltip-notes">';for(let l of n.slice(0,5))o+=`<div class="rc-tooltip-note">${l.displayName}</div>`;n.length>5&&(o+=`<div class="rc-tooltip-more">+${n.length-5} more</div>`),o+="</div>"}this.tooltipEl.innerHTML=o,this.tooltipEl.style.display="block",this.centerTooltip()}renderBackgroundCircle(t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(v)),e.setAttribute("cy",String(v)),e.setAttribute("r",String($)),e.setAttribute("class","rc-background"),t.appendChild(e)}renderCenter(t,e){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(v)),n.setAttribute("cy",String(v)),n.setAttribute("r",String(H-10)),n.setAttribute("class","rc-center"),t.appendChild(n)}renderMonthLabels(t){let e=Be*.4;for(let n=0;n<12;n++){let r=this.monthToAngle(n+1)+Math.PI/12,i=v+bn*Math.cos(r-Math.PI/2),s=v+bn*Math.sin(r-Math.PI/2),o=r*180/Math.PI;r>Math.PI/2&&r<3*Math.PI/2&&(o+=180);let c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",String(i)),c.setAttribute("y",String(s)),c.setAttribute("class","rc-month-label"),c.setAttribute("text-anchor","middle"),c.setAttribute("dominant-baseline","central"),c.setAttribute("transform",`rotate(${o}, ${i}, ${s})`),c.style.fontSize=`${e}px`,c.textContent=fn[n],t.appendChild(c)}}renderMonthSegment(t,e,n){if(!this.config)return;let r=M(e,n),i=this.monthToAngle(n),o=Math.PI/6/r,l=I(),c=l.year===e&&l.month===n;for(let u=1;u<=r;u++){let p=x(e,n,u),h=Y(p),g=c&&l.day===u,y=h===0||h===6,m=i+(u-1)*o,f=m+o-.002,b=this.config.service.getEntriesForDate(p);this.renderDayArc(t,p,m,f,g,y,b)}this.renderMonthSeparator(t,i)}renderDayArc(t,e,n,r,i,s,o){if(!this.config)return;let l=H,c=$,u=this.createArcPath(l,c,n,r),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",u);let h=["rc-day-arc"];i&&h.push("rc-day-arc--today"),s&&h.push("rc-day-arc--weekend"),o.length>0&&h.push("rc-day-arc--has-notes"),o.length>3&&h.push("rc-day-arc--many-notes"),p.setAttribute("class",h.join(" ")),p.setAttribute("data-date",`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`),p.addEventListener("click",async g=>{var y;g.preventDefault(),await((y=this.config)==null?void 0:y.service.openDailyNote(e))}),p.addEventListener("mouseenter",g=>{this.showTooltip(g,e,o)}),p.addEventListener("mouseleave",()=>{this.hideTooltip()}),p.addEventListener("contextmenu",g=>{g.preventDefault(),o.length>0&&this.showDayContextMenu(g,e,o)}),t.appendChild(p),o.length>0&&this.renderNoteIndicators(t,n,r,o)}renderNoteIndicators(t,e,n,r){let i=$-15,s=$-5,o=Math.min(r.length,3),l=(n-e)/o;for(let c=0;c<o;c++){let u=e+c*l+.001,p=u+l-.002,h=this.createArcPath(i,s,u,p),g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d",h),g.setAttribute("class","rc-note-indicator"),t.appendChild(g)}}renderMonthSeparator(t,e){let n=v+H*Math.cos(e-Math.PI/2),r=v+H*Math.sin(e-Math.PI/2),i=v+$*Math.cos(e-Math.PI/2),s=v+$*Math.sin(e-Math.PI/2),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(n)),o.setAttribute("y1",String(r)),o.setAttribute("x2",String(i)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-month-separator"),t.appendChild(o)}renderTodayMarker(t,e){let n=I();if(n.year!==e)return;let r=M(e,n.month),i=this.monthToAngle(n.month),o=Math.PI/6/r,l=i+(n.day-.5)*o,c=v+(H-10)*Math.cos(l-Math.PI/2),u=v+(H-10)*Math.sin(l-Math.PI/2),p=v+($+5)*Math.cos(l-Math.PI/2),h=v+($+5)*Math.sin(l-Math.PI/2),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",String(c)),g.setAttribute("y1",String(u)),g.setAttribute("x2",String(p)),g.setAttribute("y2",String(h)),g.setAttribute("class","rc-today-marker"),t.appendChild(g)}createArcPath(t,e,n,r){let i=n-Math.PI/2,s=r-Math.PI/2,o=v+t*Math.cos(i),l=v+t*Math.sin(i),c=v+t*Math.cos(s),u=v+t*Math.sin(s),p=v+e*Math.cos(i),h=v+e*Math.sin(i),g=v+e*Math.cos(s),y=v+e*Math.sin(s),m=r-n>Math.PI?1:0;return`
      M ${o} ${l}
      L ${p} ${h}
      A ${e} ${e} 0 ${m} 1 ${g} ${y}
      L ${c} ${u}
      A ${t} ${t} 0 ${m} 0 ${o} ${l}
      Z
    `}monthToAngle(t){return(t-1)*Math.PI/6}showTooltip(t,e,n){if(!this.tooltipEl)return;let s=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][Y(e)]}, ${ke[e.month-1]} ${e.day}, ${e.year}`}</div>`;if(n.length>0){s+='<div class="rc-tooltip-notes">';for(let o of n.slice(0,5))s+=`<div class="rc-tooltip-note">${o.displayName}</div>`;n.length>5&&(s+=`<div class="rc-tooltip-more">+${n.length-5} more</div>`),s+="</div>"}this.tooltipEl.innerHTML=s,this.tooltipEl.style.display="block",this.centerTooltip()}hideTooltip(){this.tooltipEl&&(this.tooltipEl.style.display="none")}centerTooltip(){if(!this.tooltipEl||!this.containerEl_)return;let t=this.containerEl_.getBoundingClientRect();this.tooltipEl.style.left="50%",this.tooltipEl.style.top="50%",this.tooltipEl.style.transform="translate(-50%, -50%)"}showDayContextMenu(t,e,n){if(!this.config)return;let r=new J.Menu;r.addItem(i=>{i.setTitle(`Open ${ke[e.month-1]} ${e.day}`).setIcon("calendar").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(e))})}),r.addSeparator();for(let i of n.slice(0,10))r.addItem(s=>{s.setTitle(i.displayName).setIcon("file").onClick(()=>{var o;(o=this.config)==null||o.openFile(i.filePath)})});n.length>10&&r.addItem(i=>{i.setTitle(`+${n.length-10} more...`).setDisabled(!0)}),r.showAtMouseEvent(t)}renderOuterSegments(t,e){if(!this.config)return;let n=this.getSegmentsForCurrentView();if(n.length!==0)for(let r of n)this.renderSegmentTick(t,r,e)}getSegmentsForCurrentView(){if(!this.config)return[];let t=this.config.settings;if(t.currentView==="life")return this.lifeActsToSegments(t.lifeActs);switch(t.annualSegmentType){case"seasons":return Pe;case"quarters":return Le;case"semester":return Re;case"ten-days":return Te();case"weeks":return Ne();case"custom":return t.customSegments;case"none":default:return[]}}lifeActsToSegments(t){if(!this.config)return[];let{birthYear:e,expectedLifespan:n}=this.config.settings,r=n;return t.map(i=>{let s=Math.floor(i.startAge/r*365)+1,o=Math.floor(i.endAge/r*365);return{id:i.id,label:i.label,startDay:s,endDay:o,color:i.color}})}renderSegmentTick(t,e,n){if(!this.config)return;let r=this.config.settings.showSegmentLabels,i=this.dayOfYearToAngle(e.startDay),s=e.endDay>e.startDay?this.dayOfYearToAngle(e.endDay):this.dayOfYearToAngle(e.endDay)+2*Math.PI,o=i-Math.PI/2,l=v+Sn*Math.cos(o),c=v+Sn*Math.sin(o),u=v+wn*Math.cos(o),p=v+wn*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");if(h.setAttribute("x1",String(l)),h.setAttribute("y1",String(c)),h.setAttribute("x2",String(u)),h.setAttribute("y2",String(p)),h.setAttribute("class","rc-segment-tick"),e.color&&(h.style.stroke=P[e.color]),t.appendChild(h),r){let g;e.endDay>e.startDay?g=(i+s)/2:(g=(i+s)/2,g>2*Math.PI&&(g-=2*Math.PI));let y=g-Math.PI/2,m=v+An*Math.cos(y),f=v+An*Math.sin(y),b=document.createElementNS("http://www.w3.org/2000/svg","text");b.setAttribute("x",String(m)),b.setAttribute("y",String(f)),b.setAttribute("class","rc-segment-label"),b.setAttribute("text-anchor","middle"),b.setAttribute("dominant-baseline","central");let w=g*180/Math.PI,A=w>90&&w<270?w+180:w;b.setAttribute("transform",`rotate(${A}, ${m}, ${f})`),e.color&&(b.style.fill=P[e.color]),b.textContent=e.label,t.appendChild(b)}}dayOfYearToAngle(t){return(t-1)/365*2*Math.PI}};var ee=require("obsidian");_();var aa=["January","February","March","April","May","June","July","August","September","October","November","December"],Pt="local-calendar-view",Ye=300,R=Ye/2,Mt=140,Zt=115,xt=105,mt=40,ra=35,te=class extends ee.ItemView{constructor(t){super(t);this.config=null;this.containerEl_=null;this.svgEl=null;this.activeFileDate=null}getViewType(){return Pt}getDisplayText(){return"Local Calendar"}getIcon(){return"clock"}initialize(t){this.config=t,this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updateActiveFileDate(),this.render()})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.updateActiveFileDate(),this.render()}))}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("local-calendar-view"),this.updateActiveFileDate(),this.render()}async onClose(){var t;(t=this.containerEl_)==null||t.empty(),this.containerEl_=null,this.svgEl=null}updateActiveFileDate(){this.config&&(this.activeFileDate=this.config.getActiveFileDate())}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let t=this.containerEl_.createDiv({cls:"lc-container"}),e=t.createDiv({cls:"lc-title"});this.activeFileDate?e.textContent=`${this.activeFileDate.day}.${this.activeFileDate.month}.${this.activeFileDate.year}`:e.textContent="Keine Datums-Notiz";let n=t.createDiv({cls:"lc-wrapper"});this.renderNestedClock(n)}renderNestedClock(t){if(!this.config)return;let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox",`0 0 ${Ye} ${Ye}`),e.setAttribute("class","lc-svg"),this.svgEl=e;let{birthYear:n,expectedLifespan:r}=this.config.settings,i=n+r,s=I(),o=this.activeFileDate||s,l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttribute("cx",String(R)),l.setAttribute("cy",String(R)),l.setAttribute("r",String(Mt)),l.setAttribute("class","lc-background"),e.appendChild(l),this.renderLifeRing(e,n,i,o.year,s.year),this.renderYearRing(e,o,s),this.renderCenter(e,o),this.activeFileDate&&this.renderNoteMarkers(e,n,r,this.activeFileDate),(!this.activeFileDate||this.activeFileDate.year!==s.year||this.activeFileDate.month!==s.month||this.activeFileDate.day!==s.day)&&this.renderTodayMarkers(e,n,r,s),t.appendChild(e)}renderLifeRing(t,e,n,r,i){let s=n-e;for(let o=0;o<s;o+=10){let l=o/s*2*Math.PI,c=Math.min((o+10)/s*2*Math.PI,2*Math.PI)-.02,u=this.createArcPath(Zt,Mt,l,c),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",u);let h=e+o,g=h+10<=i,y=h<=i&&i<h+10,m="lc-life-decade";g&&(m+=" lc-life-decade--past"),y&&(m+=" lc-life-decade--current"),p.setAttribute("class",m),t.appendChild(p);let f=(o+5)/s*2*Math.PI-Math.PI/2,b=(Zt+Mt)/2,w=R+b*Math.cos(f),A=R+b*Math.sin(f),D=document.createElementNS("http://www.w3.org/2000/svg","text");D.setAttribute("x",String(w)),D.setAttribute("y",String(A)),D.setAttribute("class","lc-decade-label"),D.setAttribute("text-anchor","middle"),D.setAttribute("dominant-baseline","central"),D.textContent=String(e+o),t.appendChild(D)}}renderYearRing(t,e,n){if(!this.config)return;let r=e.year;for(let s=1;s<=12;s++){let o=M(r,s),l=this.monthToAngle(s),u=Math.PI/6/o;for(let p=1;p<=o;p++){let h=x(r,s,p),g=Y(h),y=n.year===r&&n.month===s&&n.day===p,m=e.month===s&&e.day===p,f=g===0||g===6,b=l+(p-1)*u,w=b+u-.002,A=this.config.service.getEntriesForDate(h),D=this.createArcPath(mt,xt,b,w),C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttribute("d",D);let E=["lc-day"];y&&E.push("lc-day--today"),m&&E.push("lc-day--note"),f&&E.push("lc-day--weekend"),A.length>0&&E.push("lc-day--has-notes"),A.length>2&&E.push("lc-day--many-notes"),C.setAttribute("class",E.join(" ")),C.style.cursor="pointer",C.addEventListener("click",N=>{var k;N.preventDefault(),N.stopPropagation(),A.length>0?this.showDayContextMenu(N,h,A):(k=this.config)==null||k.service.openDailyNote(h)}),t.appendChild(C)}}for(let s=1;s<=12;s++){let o=this.monthToAngle(s)-Math.PI/2,l=R+mt*Math.cos(o),c=R+mt*Math.sin(o),u=R+xt*Math.cos(o),p=R+xt*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(l)),h.setAttribute("y1",String(c)),h.setAttribute("x2",String(u)),h.setAttribute("y2",String(p)),h.setAttribute("class","lc-month-separator"),t.appendChild(h)}let i=["J","F","M","A","M","J","J","A","S","O","N","D"];for(let s=0;s<12;s++){let o=this.monthToAngle(s+1)+Math.PI/12-Math.PI/2,l=mt-8,c=R+l*Math.cos(o),u=R+l*Math.sin(o),p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x",String(c)),p.setAttribute("y",String(u)),p.setAttribute("class","lc-month-label"),p.setAttribute("text-anchor","middle"),p.setAttribute("dominant-baseline","central"),p.textContent=i[s],t.appendChild(p)}}monthToAngle(t){return(t-1)*Math.PI/6}renderCenter(t,e){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(R)),n.setAttribute("cy",String(R)),n.setAttribute("r",String(ra-5)),n.setAttribute("class","lc-center"),t.appendChild(n);let r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",String(R)),r.setAttribute("y",String(R)),r.setAttribute("class","lc-center-day"),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","central"),r.textContent=String(e.day),t.appendChild(r)}renderNoteMarkers(t,e,n,r){let s=(r.year-e)/n*2*Math.PI-Math.PI/2;this.drawMarker(t,s,Zt-3,Mt+3,"lc-marker--note");let o=this.dateToAngle(r);this.drawMarker(t,o,mt-3,xt+3,"lc-marker--note")}renderTodayMarkers(t,e,n,r){let s=(r.year-e)/n*2*Math.PI-Math.PI/2;this.drawMarker(t,s,Zt,Mt,"lc-marker--today");let o=this.dateToAngle(r);this.drawMarker(t,o,mt,xt,"lc-marker--today")}dateToAngle(t){let e=M(t.year,t.month),n=this.monthToAngle(t.month),i=Math.PI/6/e;return n+(t.day-.5)*i-Math.PI/2}drawMarker(t,e,n,r,i){let s=R+n*Math.cos(e),o=R+n*Math.sin(e),l=R+r*Math.cos(e),c=R+r*Math.sin(e),u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",String(s)),u.setAttribute("y1",String(o)),u.setAttribute("x2",String(l)),u.setAttribute("y2",String(c)),u.setAttribute("class",i),t.appendChild(u)}showDayContextMenu(t,e,n){if(!this.config)return;let r=new ee.Menu;if(r.addItem(i=>{i.setTitle(`${e.day}. ${aa[e.month-1]} ${e.year}`).setIcon("calendar").setDisabled(!0)}),r.addSeparator(),r.addItem(i=>{i.setTitle("Neue Notiz erstellen").setIcon("plus").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(e))})}),n.length>0){r.addSeparator();for(let i of n.slice(0,10))r.addItem(s=>{s.setTitle(i.displayName).setIcon("file").onClick(async()=>{var o;await((o=this.config)==null?void 0:o.openFile(i.filePath))})});n.length>10&&r.addItem(i=>{i.setTitle(`+${n.length-10} weitere...`).setDisabled(!0)})}r.showAtMouseEvent(t)}createArcPath(t,e,n,r){let i=n-Math.PI/2,s=r-Math.PI/2,o=R+t*Math.cos(i),l=R+t*Math.sin(i),c=R+t*Math.cos(s),u=R+t*Math.sin(s),p=R+e*Math.cos(i),h=R+e*Math.sin(i),g=R+e*Math.cos(s),y=R+e*Math.sin(s),m=r-n>Math.PI?1:0;return`
      M ${o} ${l}
      L ${p} ${h}
      A ${e} ${e} 0 ${m} 1 ${g} ${y}
      L ${c} ${u}
      A ${t} ${t} 0 ${m} 0 ${o} ${l}
      Z
    `}};var ft=require("obsidian");_();var En={style:"annual",showLabels:!0,showToday:!0,showAnniversaries:!1,segments:"none"};function Mn(d){let a={...En},t=d.trim().split(`
`),e=!1,n=!1,r=!1,i=0,s=[],o=[],l=[],c=null;for(let u of t){let p=u.trim();if(!p||p.startsWith("#"))continue;if(r)if(u.length-u.trimStart().length>i||p.startsWith("-")){s.push(u);continue}else r=!1,a.filter=ne(s);if(p.startsWith("- ")){if(e){c&&c.folder&&o.push({folder:c.folder,color:c.color||"blue",label:c.label});let f=p.match(/^-\s*folder:\s*["']?([^"'\n]+)["']?/);f?c={folder:f[1].trim()}:c={};continue}if(n){let f=p.slice(2).trim().replace(/["']/g,"");l.push(f);continue}}if(e&&c&&(u.startsWith("    ")||u.startsWith("	"))){let[f,...b]=p.split(":"),w=b.join(":").trim().replace(/["']/g,"");switch(f.trim()){case"folder":c.folder=w;break;case"color":c.color=w;break;case"label":c.label=w;break}continue}let h=p.indexOf(":");if(h===-1)continue;let g=p.slice(0,h).trim(),y=p.slice(h+1).trim();if(g==="rings"&&(!y||y==="")){c&&c.folder&&o.push({folder:c.folder,color:c.color||"blue",label:c.label}),e=!0,n=!1,c=null;continue}if(g==="folders"&&(!y||y==="")){n=!0,e=!1;continue}!u.startsWith(" ")&&!u.startsWith("	")&&!p.startsWith("-")&&(e&&c&&c.folder&&(o.push({folder:c.folder,color:c.color||"blue",label:c.label}),c=null),e=!1,n=!1);let m=y.replace(/["']/g,"");switch(g){case"year":a.year=parseInt(m,10);break;case"style":(m==="annual"||m==="life")&&(a.style=m);break;case"dateProperty":a.dateProperty=m;break;case"folder":a.folder=m;break;case"filter":case"filters":m?a.filter=m:(r=!0,i=u.indexOf(g));break;case"showLabels":a.showLabels=m==="true";break;case"showToday":a.showToday=m==="true";break;case"showAnniversaries":a.showAnniversaries=m==="true";break;case"segments":["none","seasons","quarters","weeks"].includes(m)&&(a.segments=m);break;case"birthYear":a.birthYear=parseInt(m,10);break;case"lifespan":a.lifespan=parseInt(m,10);break}}return c&&c.folder&&o.push({folder:c.folder,color:c.color||"blue",label:c.label}),r&&s.length>0&&(a.filter=ne(s)),o.length>0&&(a.rings=o),l.length>0&&(a.folders=l),a}function ne(d){let a={},t=null,e=[],n=[],r=-1;for(let i of d){let s=i.trim();if(!s)continue;let o=i.length-i.trimStart().length;if(r>=0)if(o>r){n.push(i);continue}else n.length>0&&(e.push(ne(n)),n=[]),r=-1;if(s==="and:"||s==="or:"||s==="not:"){t&&e.length>0&&(a[t]=[...e],e.length=0),t=s.slice(0,-1);continue}if(s.startsWith("- ")){let l=s.slice(2).trim();l==="and:"||l==="or:"||l==="not:"?(r=o,n=[i]):e.push(l)}}return n.length>0&&e.push(ne(n)),t&&e.length>0&&(a[t]=e),a}_();W();var _e=800,F=_e/2,lt=380,Pn=30,ct=145,sa=ct+Pn,xn=4,ia=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ae=class{render(a,t,e,n){var o;let r=this.createSVG();this.renderBackground(r);let i=((o=a.rings)==null?void 0:o.length)||1,s=this.calculateRingRadii(i);if(a.rings&&a.rings.length>0)a.rings.forEach((l,c)=>{let u=s.get(c);if(u){let p=P[l.color]||P.blue;this.renderDataRing(r,e,t,u,p,l.folder,n)}});else{let l=s.get(0);if(l){let c=P.blue;this.renderDataRing(r,e,t,l,c,a.folder,n)}}return this.renderMonthSeparators(r),a.showLabels&&this.renderMonthLabels(r),a.showToday&&this.renderTodayMarker(r,e),this.renderCenter(r,e),r}createSVG(){let a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("viewBox",`0 0 ${_e} ${_e}`),a.setAttribute("class","radcal-svg"),a.style.width="100%",a.style.height="auto",a.style.maxWidth="800px",a}renderBackground(a){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",String(F)),t.setAttribute("cy",String(F)),t.setAttribute("r",String(lt)),t.setAttribute("class","rc-background"),a.appendChild(t)}calculateRingRadii(a){let t=new Map,e=lt-sa,n=(a-1)*xn,r=(e-n)/a;for(let i=0;i<a;i++){let s=lt-i*(r+xn),o=s-r;t.set(i,{innerRadius:o,outerRadius:s})}return t}renderDataRing(a,t,e,n,r,i,s){for(let o=1;o<=12;o++){let l=M(t,o),c=this.monthToAngle(o),p=Math.PI/6/l;for(let h=1;h<=l;h++){let g=x(t,o,h),y=`${t}-${String(o).padStart(2,"0")}-${String(h).padStart(2,"0")}`,m=e.get(y)||[];i&&(m=m.filter(D=>D.metadata.folder.startsWith(i)));let f=c+(h-1)*p,b=f+p,w=document.createElementNS("http://www.w3.org/2000/svg","path"),A=this.createArcPath(n.innerRadius,n.outerRadius,f,b);if(w.setAttribute("d",A),w.setAttribute("class","rc-day-arc"),m.length>0&&(w.style.fill=r,w.style.opacity=String(Math.min(.3+m.length*.15,1)),w.style.cursor="pointer",w.setAttribute("data-date",y),w.setAttribute("data-count",String(m.length)),w.setAttribute("data-names",m.map(D=>D.displayName).join("|")),s)){let D=g,C=m;w.addEventListener("click",E=>s(E,D,C))}a.appendChild(w)}}}renderMonthSeparators(a){for(let t=1;t<=12;t++){let e=this.monthToAngle(t)-Math.PI/2,n=F+ct*Math.cos(e),r=F+ct*Math.sin(e),i=F+lt*Math.cos(e),s=F+lt*Math.sin(e),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(n)),o.setAttribute("y1",String(r)),o.setAttribute("x2",String(i)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-month-separator"),a.appendChild(o)}}renderMonthLabels(a){let t=ct+Pn/2;for(let e=1;e<=12;e++){let n=this.monthToAngle(e)+Math.PI/12-Math.PI/2,r=F+t*Math.cos(n),i=F+t*Math.sin(n),s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(r)),s.setAttribute("y",String(i)),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.setAttribute("class","rc-month-label"),s.textContent=ia[e-1],a.appendChild(s)}}renderTodayMarker(a,t){let e=I();if(e.year!==t)return;let n=M(t,e.month),r=this.monthToAngle(e.month),i=Math.PI/6/n,o=r+(e.day-.5)*i-Math.PI/2,l=F+ct*Math.cos(o),c=F+ct*Math.sin(o),u=F+lt*Math.cos(o),p=F+lt*Math.sin(o),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(l)),h.setAttribute("y1",String(c)),h.setAttribute("x2",String(u)),h.setAttribute("y2",String(p)),h.setAttribute("class","rc-today-marker"),a.appendChild(h)}renderCenter(a,t){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",String(F)),e.setAttribute("cy",String(F)),e.setAttribute("r",String(ct-5)),e.setAttribute("class","rc-center"),a.appendChild(e);let n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",String(F)),n.setAttribute("y",String(F)),n.setAttribute("text-anchor","middle"),n.setAttribute("dominant-baseline","central"),n.setAttribute("class","rc-center-text"),n.textContent=String(t),a.appendChild(n)}createArcPath(a,t,e,n){let r=e-Math.PI/2,i=n-Math.PI/2,s=F+a*Math.cos(r),o=F+a*Math.sin(r),l=F+a*Math.cos(i),c=F+a*Math.sin(i),u=F+t*Math.cos(r),p=F+t*Math.sin(r),h=F+t*Math.cos(i),g=F+t*Math.sin(i),y=n-e>Math.PI?1:0;return`
      M ${s} ${o}
      L ${u} ${p}
      A ${t} ${t} 0 ${y} 1 ${h} ${g}
      L ${l} ${c}
      A ${a} ${a} 0 ${y} 0 ${s} ${o}
      Z
    `}monthToAngle(a){return(a-1)*Math.PI/6}};var re=class{constructor(a){this.app=a}createContext(a){var i,s,o;let t=this.app.metadataCache.getFileCache(a),e=[];if((i=t==null?void 0:t.frontmatter)!=null&&i.tags){let l=t.frontmatter.tags;Array.isArray(l)?e.push(...l.map(c=>this.normalizeTag(c))):typeof l=="string"&&e.push(this.normalizeTag(l))}if(t!=null&&t.tags)for(let l of t.tags)e.push(this.normalizeTag(l.tag));let n=[];if(t!=null&&t.links)for(let l of t.links)n.push(l.link);if(t!=null&&t.frontmatterLinks)for(let l of t.frontmatterLinks)n.push(l.link);let r={};if(t!=null&&t.frontmatter)for(let[l,c]of Object.entries(t.frontmatter))l!=="position"&&(r[l.toLowerCase()]=c);return{file:a,metadata:t,tags:[...new Set(e)],folder:(o=(s=a.parent)==null?void 0:s.path)!=null?o:"",links:[...new Set(n)],properties:r}}normalizeTag(a){return a.replace(/^#/,"").toLowerCase()}evaluate(a,t){return typeof a=="string"?this.evaluateString(a,t):Array.isArray(a)?a.every(e=>this.evaluate(e,t)):this.evaluateYaml(a,t)}evaluateYaml(a,t){return a.and?a.and.every(e=>this.evaluate(e,t)):a.or?a.or.some(e=>this.evaluate(e,t)):a.not?a.not.every(e=>!this.evaluate(e,t)):!0}evaluateString(a,t){let e=a.trim();if(!e)return!0;if(e.startsWith("(")&&e.endsWith(")"))return this.evaluateString(e.slice(1,-1),t);let n=this.splitByOperator(e,"||");if(n.length>1)return n.some(i=>this.evaluateString(i,t));let r=this.splitByOperator(e,"&&");return r.length>1?r.every(i=>this.evaluateString(i,t)):e.startsWith("!")?!this.evaluateString(e.slice(1),t):this.evaluateFunction(e,t)}splitByOperator(a,t){let e=[],n="",r=0,i=0;for(;i<a.length;){let s=a[i];if(s==="(")r++,n+=s;else if(s===")")r--,n+=s;else if(r===0&&a.slice(i,i+t.length)===t){e.push(n.trim()),n="",i+=t.length;continue}else n+=s;i++}return n.trim()&&e.push(n.trim()),e}evaluateFunction(a,t){let e=a.match(/^file\.hasTag\s*\(\s*["']([^"']+)["']\s*\)$/);if(e){let u=this.normalizeTag(e[1]);return t.tags.some(p=>p===u||p.startsWith(u+"/"))}let n=a.match(/^file\.tagContains\s*\(\s*["']([^"']+)["']\s*\)$/);if(n){let u=n[1].toLowerCase();return t.tags.some(p=>p.includes(u))}let r=a.match(/^file\.inFolder\s*\(\s*["']([^"']+)["']\s*\)$/);if(r){let u=r[1].replace(/^\/|\/$/g,""),p=t.folder.replace(/^\/|\/$/g,"");return p===u||p.startsWith(u+"/")}let i=a.match(/^file\.hasLink\s*\(\s*["']([^"']+)["']\s*\)$/);if(i){let u=i[1].toLowerCase();return t.links.some(p=>p.toLowerCase()===u||p.toLowerCase().endsWith("/"+u))}let s=a.match(/^file\.name\s*\(\s*["']([^"']+)["']\s*\)$/);if(s){let u=s[1].toLowerCase();return t.file.basename.toLowerCase()===u}let o=a.match(/^file\.nameContains\s*\(\s*["']([^"']+)["']\s*\)$/);if(o){let u=o[1].toLowerCase();return t.file.basename.toLowerCase().includes(u)}let l=a.match(/^file\.property\s*\(\s*["']([^"']+)["']\s*,\s*["']([^"']+)["']\s*\)$/);if(l){let u=l[1].toLowerCase(),p=l[2].toLowerCase(),h=t.properties[u];return h==null?!1:String(h).toLowerCase()===p}let c=a.match(/^file\.hasProperty\s*\(\s*["']([^"']+)["']\s*\)$/);if(c){let u=c[1].toLowerCase(),p=t.properties[u];return p!=null&&p!==""}throw new Error(`Unknown filter function: ${a}`)}};var Ge=class extends ft.MarkdownRenderChild{constructor(t,e,n,r,i){super(t);this.app=e;this.service=n;this.config=r;this.openFile=i;this.unsubscribe=null;this.filterEngine=new re(e)}onload(){this.render(),this.unsubscribe=this.service.subscribeToUpdates(()=>{this.render()})}onunload(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}render(){var u;this.containerEl.empty();let t=(u=this.config.year)!=null?u:this.service.getCurrentYear(),e=this.loadFilteredEntries(t),r=new ae().render(this.config,e,t,(p,h,g)=>this.handleDayClick(p,h,g)),s=this.containerEl.createDiv({cls:"radcal-block-header"}).createEl("button",{cls:"radcal-edit-btn",attr:{"aria-label":"Edit source"}});s.innerHTML="&lt;/&gt;";let o=()=>{this.app.commands.executeCommandById("markdown:toggle-preview")};s.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),o()}),this.containerEl.addEventListener("dblclick",p=>{let h=p.target;(h.classList.contains("radcal-block")||h.classList.contains("radcal-block-content")||h.tagName==="svg")&&(p.preventDefault(),p.stopPropagation(),o())});let l=this.containerEl.createDiv({cls:"radcal-tooltip"});this.containerEl.createDiv({cls:"radcal-block-content"}).appendChild(r),this.setupTooltips(r,l,t)}loadFilteredEntries(t){let e=new Map;if(this.config.dateProperty)return this.loadEntriesByProperty(t);for(let n=1;n<=12;n++){let r=M(t,n);for(let i=1;i<=r;i++){let s=x(t,n,i),o=`${t}-${String(n).padStart(2,"0")}-${String(i).padStart(2,"0")}`,l=[...this.service.getEntriesForDate(s)];if(this.config.filter&&(l=l.filter(c=>{let u=this.app.vault.getAbstractFileByPath(c.filePath);if(!(u instanceof ft.TFile))return!1;let p=this.filterEngine.createContext(u);return this.filterEngine.evaluate(this.config.filter,p)})),!this.config.filter&&this.config.folder){let c=this.config.folder;l=l.filter(u=>u.metadata.folder===c||u.metadata.folder.startsWith(c+"/"))}if(!this.config.filter&&this.config.folders&&this.config.folders.length>0){let c=this.config.folders;l=l.filter(u=>c.some(p=>u.metadata.folder===p||u.metadata.folder.startsWith(p+"/")))}l.length>0&&e.set(o,l)}}return e}loadEntriesByProperty(t){var i,s;let e=new Map,n=this.config.dateProperty,r=this.app.vault.getMarkdownFiles();for(let o of r){if(this.config.filter){let y=this.filterEngine.createContext(o);if(!this.filterEngine.evaluate(this.config.filter,y))continue}let l=this.app.metadataCache.getFileCache(o),c=l==null?void 0:l.frontmatter;if(!c)continue;let u=c[n];if(!u)continue;let p=this.parseDate(u);if(!p||p.year!==t)continue;let h=`${p.year}-${String(p.month).padStart(2,"0")}-${String(p.day).padStart(2,"0")}`,g={id:o.path,filePath:o.path,fileName:o.name,displayName:o.basename,startDate:p,endDate:null,isMultiDay:!1,isAnniversary:!1,metadata:{tags:[],folder:(s=(i=o.parent)==null?void 0:i.path)!=null?s:"",properties:{}}};e.has(h)||e.set(h,[]),e.get(h).push(g)}return e}parseDate(t){if(!t)return null;if(t instanceof Date)return x(t.getFullYear(),t.getMonth()+1,t.getDate());if(typeof t=="string"){let e=t.match(/(\d{4})-(\d{2})-(\d{2})/);if(e)return x(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10))}return null}handleDayClick(t,e,n){n.length===1?this.openFile(n[0].filePath):n.length>1&&this.showEntryMenu(t,e,n)}showEntryMenu(t,e,n){let r=new ft.Menu,i=`${e.day}.${e.month}.${e.year}`;r.addItem(s=>{s.setTitle(i).setIcon("calendar").setDisabled(!0)}),r.addSeparator();for(let s of n.slice(0,15))r.addItem(o=>{o.setTitle(s.displayName).setIcon("file-text").onClick(()=>{this.openFile(s.filePath)})});n.length>15&&r.addItem(s=>{s.setTitle(`+${n.length-15} more...`).setDisabled(!0)}),r.showAtMouseEvent(t)}setupTooltips(t,e,n){t.querySelectorAll(".rc-day-arc[data-date]").forEach(i=>{i.addEventListener("mouseenter",s=>{var w;let o=s,l=s.target,c=l.getAttribute("data-date")||"",u=l.getAttribute("data-count")||"0",p=((w=l.getAttribute("data-names"))==null?void 0:w.split("|"))||[],[h,g,y]=c.split("-").map(Number),f=`<div class="radcal-tooltip-date">${`${y}.${g}.${h}`}</div>`;if(p.length>0){f+='<div class="radcal-tooltip-entries">';for(let A of p.slice(0,5))f+=`<div class="radcal-tooltip-entry">${A}</div>`;p.length>5&&(f+=`<div class="radcal-tooltip-more">+${p.length-5} more</div>`),f+="</div>"}e.innerHTML=f,e.style.display="block";let b=this.containerEl.getBoundingClientRect();e.style.left=`${o.clientX-b.left+15}px`,e.style.top=`${o.clientY-b.top+15}px`}),i.addEventListener("mouseleave",()=>{e.style.display="none"})})}},se=class{constructor(a,t,e){this.app=a;this.service=t;this.openFile=e}process(a,t,e){try{let n=Mn(a),r=t.createDiv({cls:"radcal-block"}),i=new Ge(r,this.app,this.service,n,this.openFile);e.addChild(i)}catch(n){t.createDiv({cls:"radcal-error",text:`Radcal Error: ${n instanceof Error?n.message:String(n)}`})}}};var S=require("obsidian");W();var ie=require("obsidian"),q=class extends ie.AbstractInputSuggest{constructor(a,t){super(a,t),this.textInputEl=t}getSuggestions(a){let t=this.getAllFolders(),e=a.toLowerCase().trim();return e===""?t:t.filter(n=>n.path.toLowerCase().includes(e))}renderSuggestion(a,t){t.addClass("folder-suggest-item");let e=t.createSpan({cls:"folder-suggest-icon"});e.innerHTML=this.getFolderIcon(),t.createSpan({cls:"folder-suggest-text"}).setText(a.path||"/")}selectSuggestion(a,t){this.textInputEl.value=a.path,this.textInputEl.trigger("input"),this.close()}getAllFolders(){let a=[],t=n=>{a.push(n);for(let r of n.children)r instanceof ie.TFolder&&t(r)},e=this.app.vault.getRoot();return t(e),a.sort((n,r)=>n.isRoot()?-1:r.isRoot()?1:n.path.localeCompare(r.path))}getFolderIcon(){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>'}};var oe=class extends S.PluginSettingTab{constructor(t,e){super(t,e);this.activeTab="general";this.plugin=e}display(){let{containerEl:t}=this;t.empty(),this.createVersionHeader(t),this.createTabNavigation(t);let e=t.createDiv({cls:"radcal-settings-content"});this.renderActiveTab(e)}createTabNavigation(t){let e=[{id:"general",label:"Allgemein"},{id:"lifeview",label:"Life View"},{id:"rings",label:"Ringe"},{id:"sync",label:"Sync"},{id:"advanced",label:"Erweitert"},{id:"help",label:"Hilfe"}],n=t.createDiv({cls:"radcal-settings-tabs"});for(let r of e)n.createEl("button",{text:r.label,cls:`radcal-settings-tab ${this.activeTab===r.id?"is-active":""}`}).addEventListener("click",()=>{this.activeTab=r.id,this.display()})}renderActiveTab(t){switch(this.activeTab){case"general":this.renderGeneralTab(t);break;case"lifeview":this.renderLifeViewTab(t);break;case"rings":this.renderRingsTab(t);break;case"sync":this.renderSyncTab(t);break;case"advanced":this.renderAdvancedTab(t);break;case"help":this.renderHelpTab(t);break}}renderSyncTab(t){this.createCalendarSyncSection(t)}renderGeneralTab(t){this.createViewModeSection(t),this.createDailyNotesSection(t),this.createTemplateSection(t)}renderLifeViewTab(t){this.createLifeViewSection(t)}renderRingsTab(t){this.createRingConfigSection(t)}renderAdvancedTab(t){this.createPresetsSection(t),this.createOuterSegmentsSection(t),this.createCenterDisplaySection(t),this.createMigrationSection(t)}createVersionHeader(t){var i;let n=t.createDiv({cls:"radcal-settings-header"}).createEl("div",{cls:"radcal-settings-title"});n.createEl("span",{text:"Radial Calendar",cls:"radcal-settings-name"});let r=((i=this.plugin.manifest)==null?void 0:i.version)||"unknown";n.createEl("span",{text:`v${r}`,cls:"radcal-settings-version"}),t.createEl("hr",{cls:"radcal-settings-separator"})}createViewModeSection(t){new S.Setting(t).setName("View Mode").setDesc("Switch between Annual and Life view").addDropdown(e=>{e.addOption("annual","Annual View").addOption("life","Life View").setValue(this.plugin.settings.currentView).onChange(async n=>{this.plugin.settings.currentView=n,await this.plugin.saveSettings(),this.display()})})}createLifeViewSection(t){t.createEl("h3",{text:"Life View Settings"}),new S.Setting(t).setName("Birth Date").setDesc("Your birth date (YYYY-MM-DD) for precise calculation").addText(n=>{n.setPlaceholder("e.g. 1977-03-27").setValue(this.plugin.settings.birthDate||"").onChange(async r=>{let i=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(i){let s=parseInt(i[1],10),o=parseInt(i[2],10),l=parseInt(i[3],10);s>1900&&s<=new Date().getFullYear()&&o>=1&&o<=12&&l>=1&&l<=31&&(this.plugin.settings.birthDate=r,this.plugin.settings.birthYear=s,await this.plugin.saveSettings())}else r===""&&(this.plugin.settings.birthDate=void 0,await this.plugin.saveSettings())})}),new S.Setting(t).setName("Birth Year (Fallback)").setDesc("Used when no full date is provided").addText(n=>{n.setPlaceholder("e.g. 1990").setValue(String(this.plugin.settings.birthYear)).onChange(async r=>{let i=parseInt(r,10);!isNaN(i)&&i>1900&&i<=new Date().getFullYear()&&(this.plugin.settings.birthYear=i,await this.plugin.saveSettings())})}),new S.Setting(t).setName("Expected Lifespan").setDesc("Expected lifespan in years").addText(n=>{n.setPlaceholder("e.g. 85").setValue(String(this.plugin.settings.expectedLifespan)).onChange(async r=>{let i=parseInt(r,10);!isNaN(i)&&i>0&&i<=150&&(this.plugin.settings.expectedLifespan=i,await this.plugin.saveSettings())})}),t.createEl("h4",{text:"Life Phases"}),new S.Setting(t).setName("Life Phases Folder (Legacy)").setDesc("Folder for phase-* properties. Or use radcal-showInLife: true anywhere.").addText(n=>{n.setPlaceholder("e.g. Life/Phases").setValue(this.plugin.settings.lifePhasesFolder).onChange(async r=>{this.plugin.settings.lifePhasesFolder=r,await this.plugin.saveSettings()}),new q(this.app,n.inputEl)});let e=t.createDiv({cls:"setting-item-description"});e.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Option 1: Unified Properties (recommended)</strong><br>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
radcal-start: 1983-09-01<br>
radcal-end: 1987-07-15<br>
radcal-color: blue<br>
radcal-label: Elementary School<br>
radcal-showInLife: true<br>
---
        </code>
        <br>
        <strong>Option 2: Legacy (folder-based)</strong><br>
        Files in the folder above with <code>phase-start</code>, <code>phase-end</code>, etc.<br><br>
        <em>Leave end empty for "ongoing" phases (shows faded arc until life expectancy)</em>
      </p>
    `}createDailyNotesSection(t){t.createEl("h3",{text:"Daily Notes"}),new S.Setting(t).setName("Notes Folder").setDesc("Folder where new notes are created (empty = vault root)").addText(n=>{n.setPlaceholder("e.g. Daily Notes").setValue(this.plugin.settings.dailyNoteFolder).onChange(async r=>{this.plugin.settings.dailyNoteFolder=r,await this.plugin.saveSettings()}),new q(this.app,n.inputEl)}),new S.Setting(t).setName("Filter Folder").setDesc("Only show notes from this folder (empty = all)").addText(n=>{n.setPlaceholder("e.g. Journal").setValue(this.plugin.settings.calendarFilterFolder).onChange(async r=>{this.plugin.settings.calendarFilterFolder=r,await this.plugin.saveSettings()}),new q(this.app,n.inputEl)}),new S.Setting(t).setName("Filename Format").setDesc("Format for new notes (YYYY-MM-DD)").addText(n=>{n.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.periodicNotesFormat.daily).onChange(async r=>{this.plugin.settings.periodicNotesFormat={...this.plugin.settings.periodicNotesFormat,daily:r||"YYYY-MM-DD"},await this.plugin.saveSettings()})}),new S.Setting(t).setName("Annual Recurring").setDesc("Folder for birthdays, anniversaries (use XXXX-MM-DD format, shown every year on that date)").addText(n=>{n.setPlaceholder("e.g. Birthdays").setValue(this.plugin.settings.annualRecurringFolder).onChange(async r=>{this.plugin.settings.annualRecurringFolder=r,await this.plugin.saveSettings()}),new q(this.app,n.inputEl)}),t.createEl("h4",{text:"Anniversary Properties"}),new S.Setting(t).setName("Additional Date Properties").setDesc("Comma-separated list of YAML properties to use for anniversary dates (in addition to radcal-start/radcal-end)").addText(n=>{var r;n.setPlaceholder("e.g. Birthday, Todestag, Hochzeitstag").setValue(((r=this.plugin.settings.anniversaryDateProperties)==null?void 0:r.join(", "))||"").onChange(async i=>{let s=i.split(",").map(o=>o.trim()).filter(o=>o.length>0);this.plugin.settings.anniversaryDateProperties=s,await this.plugin.saveSettings()})});let e=t.createDiv({cls:"setting-item-description"});e.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>Anniversary Properties:</strong><br>
        Use <code>radcal-annual: true</code> to mark a note as anniversary.<br><br>
        <strong>Date sources (checked in order):</strong><br>
        1. <code>radcal-annual-fix</code> - Single fixed date (overrides all)<br>
        2. <code>radcal-start</code> / <code>radcal-end</code> - Birth + death dates<br>
        3. Properties from list above (e.g., <code>Birthday</code>)<br><br>
        <strong>Example:</strong>
        <code style="display: block; padding: 8px; background: var(--background-secondary); border-radius: 4px; margin-top: 4px;">
---<br>
radcal-annual: true<br>
Birthday: 1982-09-24<br>
---
        </code>
      </p>
    `}createCalendarSyncSection(t){t.createEl("h3",{text:"Calendar Sync (Google Calendar)"}),(this.plugin.settings.calendarSources||[]).forEach((r,i)=>{this.createCalendarSourceSettings(t,r,i)}),new S.Setting(t).setName("Add Calendar Source").setDesc("Add a new Google Calendar or iCal source").addButton(r=>{r.setButtonText("+ Add Calendar").setCta().onClick(async()=>{let i={id:`gcal_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:"New Calendar",url:"",folder:"Calendar/Google",color:"blue",syncOnStart:!0,syncIntervalMinutes:0,enabled:!0,showAsRing:!0,showSpanningArcs:!0};this.plugin.settings.calendarSources||(this.plugin.settings.calendarSources=[]),this.plugin.settings.calendarSources.push(i),await this.plugin.saveSettings(),this.display()})});let n=t.createDiv({cls:"setting-item-description"});n.innerHTML=`
      <p style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
        <strong>How to get your Google Calendar URL:</strong><br>
        1. Open Google Calendar \u2192 Settings \u2192 Calendar Settings<br>
        2. Select your calendar \u2192 Integrate calendar<br>
        3. Copy "Secret address in iCal format"<br><br>
        <em>Note: This URL is private and contains a secret key. Never share it publicly.</em>
      </p>
    `}createCalendarSourceSettings(t,e,n){let r=t.createDiv({cls:"radial-calendar-source-config"});if(new S.Setting(r).setName(`Calendar ${n+1}: ${e.name}`).setHeading().addButton(i=>{i.setIcon("trash").setWarning().setTooltip("Delete this calendar source").onClick(async()=>{this.plugin.settings.calendarSources.splice(n,1),await this.plugin.saveSettings(),this.display()})}),new S.Setting(r).setName("Name").setDesc("Display name for this calendar").addText(i=>{i.setPlaceholder("e.g. Work Calendar").setValue(e.name).onChange(async s=>{e.name=s,await this.plugin.saveSettings()})}),new S.Setting(r).setName("iCal URL").setDesc("Private iCal/ICS URL (from Google Calendar settings)").addText(i=>{i.setPlaceholder("https://calendar.google.com/calendar/ical/...").setValue(e.url).onChange(async s=>{e.url=s,await this.plugin.saveSettings()}),i.inputEl.style.width="100%",i.inputEl.type="password"}),new S.Setting(r).setName("Target Folder").setDesc("Where synced events will be saved").addText(i=>{i.setPlaceholder("e.g. Calendar/Google/Work").setValue(e.folder).onChange(async s=>{e.folder=s,await this.plugin.saveSettings()}),new q(this.app,i.inputEl)}),new S.Setting(r).setName("Color").setDesc("Color for this calendar in the radial view").addDropdown(i=>{Object.keys(P).forEach(s=>{i.addOption(s,s.charAt(0).toUpperCase()+s.slice(1))}),i.setValue(e.color).onChange(async s=>{e.color=s,await this.plugin.saveSettings()})}),new S.Setting(r).setName("Sync on Start").setDesc("Automatically sync when Obsidian starts").addToggle(i=>{i.setValue(e.syncOnStart).onChange(async s=>{e.syncOnStart=s,await this.plugin.saveSettings()})}),new S.Setting(r).setName("Auto-sync Interval").setDesc("How often to sync (0 = manual only)").addDropdown(i=>{i.addOption("0","Manual only").addOption("15","Every 15 minutes").addOption("30","Every 30 minutes").addOption("60","Every hour").addOption("360","Every 6 hours").addOption("1440","Daily").setValue(String(e.syncIntervalMinutes)).onChange(async s=>{e.syncIntervalMinutes=parseInt(s,10),await this.plugin.saveSettings()})}),new S.Setting(r).setName("Enabled").setDesc("Enable or disable this calendar source").addToggle(i=>{i.setValue(e.enabled).onChange(async s=>{e.enabled=s,await this.plugin.saveSettings()})}),new S.Setting(r).setName("Show as Ring").setDesc("Display this calendar as a ring in the annual view").addToggle(i=>{var s;i.setValue((s=e.showAsRing)!=null?s:!0).onChange(async o=>{e.showAsRing=o,await this.plugin.saveSettings()})}),new S.Setting(r).setName("Spanning Arcs").setDesc("Show multi-day events as continuous arcs").addToggle(i=>{var s;i.setValue((s=e.showSpanningArcs)!=null?s:!0).onChange(async o=>{e.showSpanningArcs=o,await this.plugin.saveSettings()})}),e.lastSync){let s=new Date(e.lastSync).toLocaleString();r.createDiv({cls:"setting-item-description",text:`Last synced: ${s}`})}r.createEl("hr")}createRingConfigSection(t){t.createEl("h3",{text:"Configure Rings"});let e=this.plugin.settings.rings;e.forEach((n,r)=>{this.createRingSettings(t,n,r)}),new S.Setting(t).addButton(n=>{n.setButtonText("Add Ring").setCta().onClick(async()=>{let r=xe(e.length);this.plugin.settings.rings=[...e,r],await this.plugin.saveSettings(),this.display()})})}createRingSettings(t,e,n){let r=t.createEl("details",{cls:"radcal-ring-details"}),i=r.createEl("summary",{cls:"radcal-ring-summary"}),s=i.createSpan({cls:"radcal-ring-swatch"});s.style.backgroundColor=P[e.color],i.createSpan({text:e.name||`Ring ${n+1}`,cls:"radcal-ring-title"}),e.folder&&i.createSpan({text:` \u2014 ${e.folder}`,cls:"radcal-ring-folder"});let o=r.createDiv({cls:"radcal-ring-content"});new S.Setting(o).setName("Name").addText(l=>{l.setPlaceholder("Ring Name").setValue(e.name).onChange(async c=>{await this.updateRing(n,{name:c});let u=i.querySelector(".radcal-ring-title");u&&(u.textContent=c||`Ring ${n+1}`)})}),new S.Setting(o).setName("Folder").setDesc("Folder path in vault").addText(l=>{l.setPlaceholder("e.g. Projects/2024").setValue(e.folder).onChange(async c=>{await this.updateRing(n,{folder:c});let u=i.querySelector(".radcal-ring-folder");u&&(u.textContent=c?` \u2014 ${c}`:"")}),new q(this.app,l.inputEl)}),new S.Setting(o).setName("Color").addDropdown(l=>{Object.keys(P).forEach(c=>{l.addOption(c,this.formatColorName(c))}),l.setValue(e.color).onChange(async c=>{await this.updateRing(n,{color:c}),s.style.backgroundColor=P[c]})}),new S.Setting(o).setName("Spanning Arcs").setDesc("Show multi-day events as continuous arcs").addToggle(l=>{var c;l.setValue((c=e.showSpanningArcs)!=null?c:!1).onChange(async u=>{await this.updateRing(n,{showSpanningArcs:u}),this.display()})}),e.showSpanningArcs&&this.createSpanningArcsPropertySettings(o,e,n),new S.Setting(o).addButton(l=>{l.setButtonText("Delete Ring").setWarning().onClick(async()=>{this.plugin.settings.rings=this.plugin.settings.rings.filter((c,u)=>u!==n),this.plugin.settings.rings=this.plugin.settings.rings.map((c,u)=>({...c,order:u})),await this.plugin.saveSettings(),this.display()})})}async updateRing(t,e){let n=[...this.plugin.settings.rings];n[t]={...n[t],...e},this.plugin.settings.rings=n,await this.plugin.saveSettings()}createSpanningArcsPropertySettings(t,e,n){let r=t.createDiv({cls:"radial-calendar-segment-config"});new S.Setting(r).setName("Start Date Property").setDesc("YAML frontmatter field for start date").addText(i=>{i.setPlaceholder("radcal-start").setValue(e.startDateField||"radcal-start").onChange(async s=>{this.updateRing(n,{startDateField:s||"radcal-start"})})}),new S.Setting(r).setName("End Date Property").setDesc("YAML frontmatter field for end date").addText(i=>{i.setPlaceholder("radcal-end").setValue(e.endDateField||"radcal-end").onChange(async s=>{this.updateRing(n,{endDateField:s||"radcal-end"})})}),new S.Setting(r).setName("Color Property").setDesc("YAML frontmatter field for color").addText(i=>{i.setPlaceholder("radcal-color").setValue(e.colorField||"radcal-color").onChange(async s=>{this.updateRing(n,{colorField:s||"radcal-color"})})}),new S.Setting(r).setName("Label Property").setDesc("YAML frontmatter field for label").addText(i=>{i.setPlaceholder("radcal-label").setValue(e.labelField||"radcal-label").onChange(async s=>{this.updateRing(n,{labelField:s||"radcal-label"})})})}formatColorName(t){return t.charAt(0).toUpperCase()+t.slice(1)}createOuterSegmentsSection(t){t.createEl("h3",{text:"Outer Segments"}),new S.Setting(t).setName("Segment Type").setDesc("Markers on the outer edge of the calendar").addDropdown(e=>{e.addOption("none","None").addOption("seasons","Seasons (4)").addOption("quarters","Quarters (4)").addOption("semester","Semesters (2)").addOption("ten-days","10-Day Phases (36)").addOption("weeks","Weeks (52)").addOption("custom","Custom").setValue(this.plugin.settings.annualSegmentType).onChange(async n=>{this.plugin.settings.annualSegmentType=n,await this.plugin.saveSettings(),this.display()})}),new S.Setting(t).setName("Show Labels").setDesc("Display segment labels").addToggle(e=>{e.setValue(this.plugin.settings.showSegmentLabels).onChange(async n=>{this.plugin.settings.showSegmentLabels=n,await this.plugin.saveSettings()})}),this.plugin.settings.annualSegmentType==="custom"&&this.createCustomSegmentsEditor(t),this.plugin.settings.currentView==="life"&&this.createLifeActsEditor(t)}createCustomSegmentsEditor(t){t.createEl("h4",{text:"Custom Segments"});let e=this.plugin.settings.customSegments;e.forEach((n,r)=>{this.createSegmentSettings(t,n,r)}),new S.Setting(t).addButton(n=>{n.setButtonText("Add Segment").onClick(async()=>{let r={id:`seg-${Date.now()}`,label:`Segment ${e.length+1}`,startDay:1,endDay:30};this.plugin.settings.customSegments=[...e,r],await this.plugin.saveSettings(),this.display()})})}createSegmentSettings(t,e,n){let r=t.createDiv({cls:"radial-calendar-segment-config"});new S.Setting(r).setName("Label").addText(i=>{i.setValue(e.label).onChange(async s=>{this.updateSegment(n,{label:s})})}),new S.Setting(r).setName("Start Day").setDesc("Day of year (1-365)").addText(i=>{i.setValue(String(e.startDay)).onChange(async s=>{let o=parseInt(s,10);!isNaN(o)&&o>=1&&o<=365&&this.updateSegment(n,{startDay:o})})}),new S.Setting(r).setName("End Day").setDesc("Day of year (1-365)").addText(i=>{i.setValue(String(e.endDay)).onChange(async s=>{let o=parseInt(s,10);!isNaN(o)&&o>=1&&o<=365&&this.updateSegment(n,{endDay:o})})}),new S.Setting(r).addButton(i=>{i.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.customSegments=this.plugin.settings.customSegments.filter((s,o)=>o!==n),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateSegment(t,e){let n=[...this.plugin.settings.customSegments];n[t]={...n[t],...e},this.plugin.settings.customSegments=n,await this.plugin.saveSettings()}createLifeActsEditor(t){t.createEl("h4",{text:"Life Acts"});let e=this.plugin.settings.lifeActs;e.forEach((n,r)=>{this.createLifeActSettings(t,n,r)}),new S.Setting(t).addButton(n=>{n.setButtonText("Add Life Act").onClick(async()=>{let r={id:`act-${Date.now()}`,label:`Act ${e.length+1}`,startAge:0,endAge:10};this.plugin.settings.lifeActs=[...e,r],await this.plugin.saveSettings(),this.display()})})}createLifeActSettings(t,e,n){let r=t.createDiv({cls:"radial-calendar-life-act-config"});new S.Setting(r).setName("Label").addText(i=>{i.setPlaceholder("e.g. Childhood").setValue(e.label).onChange(async s=>{this.updateLifeAct(n,{label:s})})}),new S.Setting(r).setName("Start Age").addText(i=>{i.setValue(String(e.startAge)).onChange(async s=>{let o=parseInt(s,10);!isNaN(o)&&o>=0&&this.updateLifeAct(n,{startAge:o})})}),new S.Setting(r).setName("End Age").addText(i=>{i.setValue(String(e.endAge)).onChange(async s=>{let o=parseInt(s,10);!isNaN(o)&&o>=0&&this.updateLifeAct(n,{endAge:o})})}),new S.Setting(r).setName("Color").addDropdown(i=>{i.addOption("","(Default)"),Object.keys(P).forEach(s=>{i.addOption(s,this.formatColorName(s))}),i.setValue(e.color||"").onChange(async s=>{this.updateLifeAct(n,{color:s||void 0})})}),new S.Setting(r).addButton(i=>{i.setButtonText("Delete").setWarning().onClick(async()=>{this.plugin.settings.lifeActs=this.plugin.settings.lifeActs.filter((s,o)=>o!==n),await this.plugin.saveSettings(),this.display()})}),r.createEl("hr")}async updateLifeAct(t,e){let n=[...this.plugin.settings.lifeActs];n[t]={...n[t],...e},this.plugin.settings.lifeActs=n,await this.plugin.saveSettings()}createTemplateSection(t){t.createEl("h3",{text:"Templates"}),new S.Setting(t).setName("Template Folder").setDesc("Folder where templates are created").addText(e=>{e.setPlaceholder("e.g. Templates").setValue(this.plugin.settings.templateFolder||"Templates").onChange(async n=>{this.plugin.settings.templateFolder=n||"Templates",await this.plugin.saveSettings()}),new q(this.app,e.inputEl)}),new S.Setting(t).setName("Life Phase Template").setDesc("For life timeline phases (birth to death)").addButton(e=>{e.setButtonText("Create").onClick(async()=>{await this.createTemplate("Radial Calendar - Life Phase.md",jt)})}),new S.Setting(t).setName("Spanning Arc Template").setDesc("For date ranges (projects, events)").addButton(e=>{e.setButtonText("Create").onClick(async()=>{await this.createTemplate("Radial Calendar - Spanning Arc.md",Ut)})}),new S.Setting(t).setName("Anniversary Template").setDesc("For yearly recurring events (birthdays, etc.)").addButton(e=>{e.setButtonText("Create").onClick(async()=>{await this.createTemplate("Radial Calendar - Anniversary.md",qt)})}),new S.Setting(t).setName("Create All Templates").setDesc("Creates all templates at once").addButton(e=>{e.setButtonText("Create All").setCta().onClick(async()=>{await this.createAllTemplates()})})}async createTemplate(t,e){let n=this.plugin.settings.templateFolder||"Templates",r=`${n}/${t}`;try{return this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n),this.app.vault.getAbstractFileByPath(r)?(new S.Notice(`Template already exists: ${r}`),!1):(await this.app.vault.create(r,e),new S.Notice(`Template created: ${r}`),!0)}catch(i){return console.error("Failed to create template file:",i),new S.Notice(`Error creating template: ${t}`),!1}}async createAllTemplates(){let t=[{filename:"Radial Calendar - Life Phase.md",content:jt},{filename:"Radial Calendar - Spanning Arc.md",content:Ut},{filename:"Radial Calendar - Anniversary.md",content:qt}],e=0;for(let n of t)await this.createTemplate(n.filename,n.content)&&e++;e>0&&new S.Notice(`Created ${e} template(s)`)}createCenterDisplaySection(t){t.createEl("h3",{text:"Center Display"}),new S.Setting(t).setName("Display Mode").setDesc("What is shown in the center of the calendar").addDropdown(e=>{e.addOption("countdown","Countdown").addOption("stats","Statistics").addOption("navigation","Navigation").setValue(this.plugin.settings.centerDisplay).onChange(async n=>{this.plugin.settings.centerDisplay=n,await this.plugin.saveSettings()})})}createMigrationSection(t){t.createEl("h3",{text:"Migration"}),new S.Setting(t).setName("Migrate Legacy Properties").setDesc("Converts phase-* properties to radcal-* properties in all notes").addButton(e=>{e.setButtonText("Scan for Legacy Properties").onClick(async()=>{let n=await this.scanLegacyProperties();n.count===0?new S.Notice("No legacy properties found"):(new S.Notice(`Found ${n.count} files with legacy properties`),this.showMigrationConfirmation(t,n))})})}async scanLegacyProperties(){let t=this.app.vault.getMarkdownFiles(),e=[],n=["phase-start","phase-end","phase-color","phase-label","phase-category"];for(let r of t){let i=this.app.metadataCache.getFileCache(r),s=i==null?void 0:i.frontmatter;s&&n.some(l=>l in s)&&e.push(r.path)}return{count:e.length,files:e}}showMigrationConfirmation(t,e){let n=t.querySelector(".radcal-migration-confirm");n&&n.remove();let r=t.createDiv({cls:"radcal-migration-confirm"});r.createEl("p",{text:`Files to migrate (${e.count}):`});let i=r.createEl("ul",{cls:"radcal-migration-list"});for(let s of e.files.slice(0,10))i.createEl("li",{text:s});e.files.length>10&&i.createEl("li",{text:`... and ${e.files.length-10} more`}),new S.Setting(r).addButton(s=>{s.setButtonText("Migrate All").setCta().onClick(async()=>{let o=await this.migrateAllFiles(e.files);new S.Notice(`Migrated ${o} files`),r.remove()})}).addButton(s=>{s.setButtonText("Cancel").onClick(()=>{r.remove()})})}async migrateAllFiles(t){let e=0,n={"phase-start":"radcal-start","phase-end":"radcal-end","phase-color":"radcal-color","phase-label":"radcal-label","phase-category":"radcal-category"};for(let r of t){let i=this.app.vault.getFileByPath(r);if(i)try{let s=await this.app.vault.read(i),o=!1;for(let[l,c]of Object.entries(n)){let u=new RegExp(`^${l}:`,"gm");s.match(u)&&(s=s.replace(u,`${c}:`),o=!0)}o&&s.includes("radcal-start:")&&!s.includes("radcal-showInLife:")&&(s=s.replace(/(radcal-start:[^\n]*\n)/,`$1radcal-showInLife: true
`)),o&&(await this.app.vault.modify(i,s),e++)}catch(s){console.error(`Failed to migrate ${r}:`,s)}}return e}createPresetsSection(t){t.createEl("h3",{text:"Appearance Presets"});let e=t.createEl("p",{cls:"setting-item-description"});e.innerHTML=`
      Presets let you define reusable appearance combinations.
      Use <code>radcal-preset: name</code> in your notes to apply a preset.
      Explicit properties (radcal-color, etc.) override preset values.
    `,(this.plugin.settings.presets||[]).forEach((r,i)=>{this.createPresetSettings(t,r,i)}),new S.Setting(t).setName("Add Preset").setDesc("Create a new appearance preset").addButton(r=>{r.setButtonText("+ Add Preset").setCta().onClick(async()=>{let i={name:`preset-${Date.now().toString(36)}`,label:"New Preset",color:"blue"};this.plugin.settings.presets||(this.plugin.settings.presets=[]),this.plugin.settings.presets.push(i),await this.plugin.saveSettings(),this.display()})})}createPresetSettings(t,e,n){let r=t.createDiv({cls:"radcal-preset-config"}),i=new S.Setting(r).setName(`Preset: ${e.label||e.name}`).setHeading(),s=i.nameEl.createSpan({cls:"radcal-preset-preview"});s.style.backgroundColor=P[e.color],s.style.width="16px",s.style.height="16px",s.style.borderRadius="3px",s.style.display="inline-block",s.style.marginLeft="8px",s.style.verticalAlign="middle",e.icon&&(s.textContent=e.icon,s.style.fontSize="12px",s.style.textAlign="center",s.style.lineHeight="16px"),i.addButton(o=>{o.setIcon("trash").setWarning().setTooltip("Delete this preset").onClick(async()=>{this.plugin.settings.presets.splice(n,1),await this.plugin.saveSettings(),this.display()})}),new S.Setting(r).setName("Name").setDesc("Unique identifier (used in radcal-preset property)").addText(o=>{o.setPlaceholder("e.g. family").setValue(e.name).onChange(async l=>{let c=l.toLowerCase().replace(/\s+/g,"-");e.name=c,await this.plugin.saveSettings()})}),new S.Setting(r).setName("Label").setDesc("Display name for this preset").addText(o=>{o.setPlaceholder("e.g. Family").setValue(e.label||"").onChange(async l=>{e.label=l||void 0,await this.plugin.saveSettings()})}),new S.Setting(r).setName("Color").addDropdown(o=>{Object.keys(P).forEach(l=>{o.addOption(l,this.formatColorName(l))}),o.setValue(e.color).onChange(async l=>{e.color=l,await this.plugin.saveSettings(),s.style.backgroundColor=P[l]})}),new S.Setting(r).setName("Pattern").setDesc("Fill pattern (optional)").addDropdown(o=>{o.addOption("","(None)"),z.forEach(l=>{o.addOption(l,this.formatColorName(l))}),o.setValue(e.pattern||"").onChange(async l=>{e.pattern=l||void 0,await this.plugin.saveSettings()})}),new S.Setting(r).setName("Opacity").setDesc("Opacity 0-100 (leave empty for default 100)").addText(o=>{o.setPlaceholder("100").setValue(e.opacity!==void 0?String(e.opacity):"").onChange(async l=>{if(l==="")e.opacity=void 0;else{let c=parseInt(l,10);!isNaN(c)&&c>=0&&c<=100&&(e.opacity=c)}await this.plugin.saveSettings()})}),new S.Setting(r).setName("Icon").setDesc("Emoji or symbol to display (optional)").addText(o=>{o.setPlaceholder("e.g. \u{1F382}").setValue(e.icon||"").onChange(async l=>{e.icon=l.trim()||void 0,await this.plugin.saveSettings(),e.icon?s.textContent=e.icon:s.textContent=""})}),r.createEl("hr")}renderHelpTab(t){t.createEl("h3",{text:"YAML Property Reference"});let e=`---
# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
# RADIAL CALENDAR - Complete YAML Reference
# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# BASIC PROPERTIES (required for spanning arcs)
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
radcal-start: 2025-01-15        # Start date (YYYY-MM-DD)
radcal-end: 2025-06-30          # End date (YYYY-MM-DD, optional for ongoing)
radcal-label: My Event          # Display label (optional, defaults to filename)

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# APPEARANCE
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
radcal-color: blue              # Color name (see list below)
radcal-pattern: solid           # Pattern: solid, striped, dotted, crosshatch, grid
radcal-opacity: 80              # Opacity 0-100 (default: 100)
radcal-fade: true               # Fade from today to end (default: false)
radcal-icon: \u{1F382}                 # Emoji/icon at arc start (optional)
radcal-preset: family           # Apply preset (color, pattern, opacity, icon)

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# ORGANIZATION
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
radcal-ring: Wohnorte           # Ring name for grouping in Life View
radcal-category: Deutschland    # Category within a ring (for sub-grouping)
radcal-showInLife: true         # Show in Life View (required for files outside lifePhasesFolder)

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# ANNIVERSARIES (yearly recurring)
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
radcal-annual: true             # Mark as annual event
radcal-annual-fix: 2000-03-15   # Fixed date (uses month-day each year)

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# AVAILABLE COLORS
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# red, orange, yellow, green, blue, purple, pink,
# teal, cyan, magenta, lime, amber, indigo, violet,
# rose, gray, slate, stone

# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# AVAILABLE PATTERNS
# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
# solid      - Solid fill (default)
# striped    - Diagonal stripes
# horizontal - Horizontal lines
# vertical   - Vertical lines
# dotted     - Dot pattern
# crosshatch - Crossed diagonal lines
# grid       - Grid pattern
# wavy       - Wavy lines

---`,i=t.createDiv({cls:"radcal-yaml-reference"}).createEl("pre").createEl("code");i.textContent=e,new S.Setting(t).addButton(o=>{o.setButtonText("Copy to Clipboard").setCta().onClick(async()=>{await navigator.clipboard.writeText(e),new S.Notice("YAML reference copied to clipboard")})}),t.createEl("h3",{text:"Quick Examples"});let s=[{title:"Life Phase (e.g., Job, Living Place)",yaml:`---
radcal-start: 2020-01-01
radcal-end: 2023-12-31
radcal-label: Software Developer
radcal-color: blue
radcal-ring: Karriere
radcal-showInLife: true
---`},{title:"Ongoing Phase (no end date)",yaml:`---
radcal-start: 2024-01-01
radcal-label: Current Project
radcal-color: green
radcal-fade: true
radcal-showInLife: true
---`},{title:"Anniversary with fixed date",yaml:`---
radcal-annual: true
radcal-annual-fix: 1990-05-20
radcal-label: Birthday
radcal-color: pink
radcal-icon: \u{1F382}
---`,desc:"Uses month-day from radcal-annual-fix each year"},{title:"Anniversary with date range",yaml:`---
radcal-annual: true
radcal-start: 1932-03-15
radcal-end: 2005-11-28
radcal-label: Opa Hans
radcal-color: gray
---`,desc:"Shows BOTH dates annually (birth + death)"},{title:"Using a Preset",yaml:`---
radcal-start: 2024-01-01
radcal-end: 2024-12-31
radcal-label: Family Vacation
radcal-preset: family
radcal-showInLife: true
---`,desc:"Applies preset appearance (color, pattern, icon). Define presets in Settings \u2192 Advanced."}];for(let o of s){let l=t.createDiv({cls:"radcal-example"});l.createEl("h4",{text:o.title}),o.desc&&l.createEl("p",{text:o.desc,cls:"radcal-example-desc"});let c=l.createDiv({cls:"radcal-code-wrapper"}),u=c.createEl("button",{cls:"radcal-copy-btn",attr:{"aria-label":"Copy to clipboard"}});u.textContent="\u{1F4CB}",u.addEventListener("click",async()=>{await navigator.clipboard.writeText(o.yaml),u.textContent="\u2713",u.classList.add("radcal-copy-btn--success"),setTimeout(()=>{u.textContent="\u{1F4CB}",u.classList.remove("radcal-copy-btn--success")},1500)});let h=c.createEl("pre").createEl("code");h.textContent=o.yaml}t.createEl("h3",{text:"Reset"}),new S.Setting(t).setName("Reset Presets to Defaults").setDesc("Restore the default presets (family, work, education, health, travel, project, completed, cancelled)").addButton(o=>{o.setButtonText("Reset Presets").setWarning().onClick(async()=>{this.plugin.settings.presets=[...Ht],await this.plugin.saveSettings(),new S.Notice("Presets reset to defaults")})})}};var bt=require("obsidian");async function Rn(d){let a=[],e=oa(d).split(`
`),n=null;for(let r=0;r<e.length;r++){r>0&&r%200===0&&await new Promise(h=>setTimeout(h,0));let i=e[r].trim();if(i==="BEGIN:VEVENT"){n={};continue}if(i==="END:VEVENT"){n&&n.uid&&n.summary&&n.startDate&&a.push(n),n=null;continue}if(!n)continue;let s=i.indexOf(":");if(s===-1)continue;let o=i.substring(0,s),l=i.substring(s+1),c=o.indexOf(";"),u=c===-1?o:o.substring(0,c),p=c===-1?"":o.substring(c+1);switch(u){case"UID":n.uid=l;break;case"SUMMARY":n.summary=We(l);break;case"DESCRIPTION":n.description=We(l);break;case"LOCATION":n.location=We(l);break;case"DTSTART":let h=Ln(l,p);n.startDate=h.date,n.isAllDay=h.isAllDay;break;case"DTEND":let g=Ln(l,p);n.endDate=g.date;break;case"RRULE":n.isRecurring=!0,n.recurrenceRule=l;break}}return a}function oa(d){return d.replace(/\r\n[ \t]/g,"").replace(/\n[ \t]/g,"")}function We(d){return d.replace(/\\n/g,`
`).replace(/\\,/g,",").replace(/\\;/g,";").replace(/\\\\/g,"\\")}function Ln(d,a){if(a.includes("VALUE=DATE")&&!a.includes("VALUE=DATE-TIME")){let i=parseInt(d.substring(0,4),10),s=parseInt(d.substring(4,6),10)-1,o=parseInt(d.substring(6,8),10);return{date:new Date(i,s,o),isAllDay:!0}}let e=parseInt(d.substring(0,4),10),n=parseInt(d.substring(4,6),10)-1,r=parseInt(d.substring(6,8),10);if(d.length>=15){let i=parseInt(d.substring(9,11),10),s=parseInt(d.substring(11,13),10),o=parseInt(d.substring(13,15),10);return d.endsWith("Z")?{date:new Date(Date.UTC(e,n,r,i,s,o)),isAllDay:!1}:{date:new Date(e,n,r,i,s,o),isAllDay:!1}}return{date:new Date(e,n,r),isAllDay:!0}}function Tn(d){return d.isRecurring&&d.recurrenceRule!==void 0&&d.recurrenceRule.includes("FREQ=YEARLY")}function le(d){let a=d.getFullYear(),t=String(d.getMonth()+1).padStart(2,"0"),e=String(d.getDate()).padStart(2,"0");return`${a}-${t}-${e}`}function He(d){let a=String(d.getHours()).padStart(2,"0"),t=String(d.getMinutes()).padStart(2,"0");return`${a}:${t}`}function Nn(d){return d.replace(/[<>:"/\\|?*]/g,"-").replace(/\s+/g," ").trim().substring(0,100)}var ce=class{constructor(a){this.app=a;this.syncIntervals=new Map}async syncCalendar(a){let t={success:!1,calendarId:a.id,calendarName:a.name,eventsCreated:0,eventsUpdated:0,eventsSkipped:0,errors:[]};try{let e=await this.fetchICS(a.url);if(!e)return t.errors.push("Failed to fetch calendar data"),t;let n=await Rn(e);await this.ensureFolder(a.folder);for(let r of n)try{let i=await this.processEvent(r,a);i==="created"?t.eventsCreated++:i==="updated"?t.eventsUpdated++:t.eventsSkipped++}catch(i){t.errors.push(`Event "${r.summary}": ${i instanceof Error?i.message:String(i)}`)}t.success=!0}catch(e){t.errors.push(e instanceof Error?e.message:String(e))}return t}async syncAllCalendars(a){let t=[];for(let e of a)if(e.enabled){let n=await this.syncCalendar(e);t.push(n)}return t}startAutoSync(a,t){this.stopAutoSync();for(let e of a)if(e.enabled&&e.syncIntervalMinutes>0){let n=e.syncIntervalMinutes*60*1e3,r=window.setInterval(async()=>{let i=await this.syncCalendar(e);t(i)},n);this.syncIntervals.set(e.id,r)}}stopAutoSync(){for(let a of this.syncIntervals.values())window.clearInterval(a);this.syncIntervals.clear()}async fetchICS(a){try{let t=await(0,bt.requestUrl)({url:a,method:"GET"});return t.status===200?t.text:null}catch(t){return console.error("Failed to fetch ICS:",t),null}}async ensureFolder(a){if(this.app.vault.getAbstractFileByPath(a)instanceof bt.TFolder)return;let e=a.split("/"),n="";for(let r of e)n=n?`${n}/${r}`:r,this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n)}async processEvent(a,t){let e=this.generateFilename(a),n=`${t.folder}/${e}.md`,r=this.app.vault.getAbstractFileByPath(n),i=this.generateFileContent(a,t);if(r instanceof bt.TFile){if((await this.app.vault.read(r)).includes(`gcal-uid: "${a.uid}"`)){let o=r.stat.mtime;if(Date.now()-o<60*60*1e3)return"skipped"}return await this.app.vault.modify(r,i),"updated"}return await this.app.vault.create(n,i),"created"}generateFilename(a){let t=le(a.startDate),e=Nn(a.summary);return`${t} ${e}`}generateFileContent(a,t){let e=["---"];if(e.push(`radcal-start: ${le(a.startDate)}`),a.endDate&&e.push(`radcal-end: ${le(a.endDate)}`),e.push(`radcal-color: ${t.color}`),e.push(`radcal-label: "${a.summary.replace(/"/g,'\\"')}"`),e.push(`gcal-uid: "${a.uid}"`),e.push(`gcal-source: "${t.name}"`),a.isRecurring&&(e.push("gcal-recurring: true"),Tn(a)&&e.push("anniversary: true")),a.location&&e.push(`location: "${a.location.replace(/"/g,'\\"')}"`),e.push("---"),e.push(""),e.push(`# ${a.summary}`),e.push(""),!a.isAllDay){let n=He(a.startDate);if(a.endDate){let r=He(a.endDate);e.push(`**Zeit:** ${n} - ${r}`)}else e.push(`**Zeit:** ${n}`);e.push("")}return a.location&&(e.push(`**Ort:** ${a.location}`),e.push("")),a.description&&(e.push("## Beschreibung"),e.push(""),e.push(la(a.description)),e.push("")),e.join(`
`)}};function la(d){return d.replace(/<br\s*\/?>/gi,`
`).replace(/<\/p>/gi,`

`).replace(/<\/li>/gi,`
`).replace(/<li>/gi,"- ").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\n{3,}/g,`

`).trim()}var kn=require("obsidian"),ue=600,T=ue/2,et=ue/2-30,vt=et-40,Fn=et+15,In={blue:"#4a90d9",green:"#50c878",red:"#e74c3c",purple:"#9b59b6",orange:"#e67e22",teal:"#1abc9c",pink:"#e91e63",yellow:"#f1c40f",cyan:"#00bcd4",indigo:"#3f51b5"},de=["blue","green","red","purple","orange","teal","pink","yellow"],ca=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ze=class extends kn.BasesView{constructor(t,e){super(t);this.type="radial-calendar";this.svgEl=null;this.dateProperty="date";this.color="blue";this.containerEl=e,this.currentYear=new Date().getFullYear()}getConfigString(t,e){let n=this.config.get(t);if(n==null)return e;if(typeof n=="string"){if(/^\d+$/.test(n)&&t==="color"){let r=parseInt(n,10);if(r>=0&&r<de.length)return de[r]}return n}return typeof n=="number"?t==="color"&&n>=0&&n<de.length?de[n]:e:typeof n=="object"&&"value"in n?String(n.value):typeof n=="object"&&"label"in n?String(n.label).toLowerCase():e}onDataUpdated(){var n,r,i;console.log("Radial Calendar Bases: onDataUpdated called"),console.log("Radial Calendar Bases: raw config color =",this.config.get("color")),console.log("Radial Calendar Bases: raw config dateProperty =",this.config.get("dateProperty")),this.dateProperty=this.getConfigString("dateProperty","date"),this.color=this.getConfigString("color","blue");let t=this.config.get("year");t&&typeof t=="number"&&(this.currentYear=t),console.log("Radial Calendar Bases: parsed dateProperty =",this.dateProperty),console.log("Radial Calendar Bases: parsed color =",this.color),console.log("Radial Calendar Bases: year =",this.currentYear),console.log("Radial Calendar Bases: entries count =",(i=(r=(n=this.data)==null?void 0:n.data)==null?void 0:r.length)!=null?i:0),this.containerEl.empty(),this.containerEl.addClass("radial-calendar-bases-view"),this.renderHeader();let e=this.containerEl.createDiv({cls:"rc-bases-svg-container"});this.svgEl=this.createSVG(),e.appendChild(this.svgEl),this.renderCalendar()}createSVG(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox",`0 0 ${ue} ${ue}`),t.setAttribute("class","rc-bases-calendar"),t}renderHeader(){let t=this.containerEl.createDiv({cls:"rc-bases-header"});t.createEl("button",{cls:"rc-bases-nav-btn",text:"\u2190"}).addEventListener("click",()=>{this.currentYear--,this.onDataUpdated()}),t.createSpan({cls:"rc-bases-year",text:String(this.currentYear)}),t.createEl("button",{cls:"rc-bases-nav-btn",text:"\u2192"}).addEventListener("click",()=>{this.currentYear++,this.onDataUpdated()}),t.createEl("button",{cls:"rc-bases-today-btn",text:"Today"}).addEventListener("click",()=>{this.currentYear=new Date().getFullYear(),this.onDataUpdated()})}renderCalendar(){this.svgEl&&(this.svgEl.innerHTML="",this.renderBackgroundCircle(),this.renderMonthSegments(),this.renderEntryIndicators(),this.renderMonthLabels(),this.renderTodayMarker(),this.renderCenter())}renderBackgroundCircle(){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",String(T)),t.setAttribute("cy",String(T)),t.setAttribute("r",String(et)),t.setAttribute("class","rc-bases-background"),this.svgEl.appendChild(t)}renderMonthSegments(){for(let t=0;t<12;t++){let e=this.monthToAngle(t)-Math.PI/2,n=T+vt*Math.cos(e),r=T+vt*Math.sin(e),i=T+et*Math.cos(e),s=T+et*Math.sin(e),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(n)),o.setAttribute("y1",String(r)),o.setAttribute("x2",String(i)),o.setAttribute("y2",String(s)),o.setAttribute("class","rc-bases-month-separator"),this.svgEl.appendChild(o)}}renderEntryIndicators(){var o;let t=this.data.data,e=new Map;if(t.length>0){let l=t[0];console.log("Radial Calendar Bases: Sample entry file:",(o=l.file)==null?void 0:o.basename),console.log('Radial Calendar Bases: Sample getValue("'+this.dateProperty+'"):',l.getValue(this.dateProperty))}let n=0,r=0,i=new Map;for(let l of t){let c=this.getEntryDate(l);if(!c){n++;continue}let u=c.getFullYear();if(i.set(u,(i.get(u)||0)+1),u!==this.currentYear){r++;continue}let p=this.getDayOfYear(c);e.has(p)||e.set(p,[]),e.get(p).push(l)}console.log("Radial Calendar Bases: No date:",n,"Wrong year:",r),console.log("Radial Calendar Bases: Entries by year:",Object.fromEntries(i)),console.log("Radial Calendar Bases: Days with entries in",this.currentYear+":",e.size);let s=In[this.color]||In.blue;console.log("Radial Calendar Bases: Using color:",this.color,"\u2192",s);for(let[l,c]of e)this.renderDayIndicator(l,c.length,s,c)}getEntryDate(t){var n,r,i;let e=t.getValue(this.dateProperty);if(e){let s=this.parseDate(e);if(s)return s}for(let s of["date","Date","created","birthday","Birthday","due","Due"]){let o=t.getValue(s);if(o){let l=this.parseDate(o);if(l)return l}}if((n=t.file)!=null&&n.basename){let s=t.file.basename.match(/^(\d{4})-(\d{2})-(\d{2})/);if(s)return new Date(parseInt(s[1]),parseInt(s[2])-1,parseInt(s[3]))}return(i=(r=t.file)==null?void 0:r.stat)!=null&&i.ctime?new Date(t.file.stat.ctime):null}parseDate(t){if(!t)return null;if(t instanceof Date)return t;if(typeof t=="object"&&t!==null){let e=t;if(typeof e.toJSDate=="function")return e.toJSDate();if(typeof e.ts=="number")return new Date(e.ts);if("value"in e)return this.parseDate(e.value);if("path"in e)return null}if(typeof t=="string"){let e=t.match(/^(\d{4})-(\d{2})-(\d{2})/);if(e)return new Date(parseInt(e[1]),parseInt(e[2])-1,parseInt(e[3]));let n=new Date(t);if(!isNaN(n.getTime()))return n}return typeof t=="number"?new Date(t):null}renderDayIndicator(t,e,n,r){let i=this.isLeapYear(this.currentYear)?366:365,s=(t-1)/i*2*Math.PI-Math.PI/2,o=t/i*2*Math.PI-Math.PI/2,l=this.createArcPath(vt,et,s,o),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("class","rc-bases-entry-indicator"),c.style.fill=n,c.style.opacity=Math.min(.3+e*.2,1).toString();let u=document.createElementNS("http://www.w3.org/2000/svg","title"),p=r.map(h=>{var g;return((g=h.file)==null?void 0:g.basename)||"Unknown"}).join(`
`);u.textContent=`${e} ${e===1?"entry":"entries"}:
${p}`,c.appendChild(u),c.addEventListener("click",()=>{r.length>0&&r[0].file&&this.app.workspace.getLeaf().openFile(r[0].file)}),c.style.cursor="pointer",this.svgEl.appendChild(c)}renderMonthLabels(){for(let t=0;t<12;t++){let e=this.monthToAngle(t)+Math.PI/12-Math.PI/2,n=T+Fn*Math.cos(e),r=T+Fn*Math.sin(e),i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",String(n)),i.setAttribute("y",String(r)),i.setAttribute("class","rc-bases-month-label"),i.textContent=ca[t],this.svgEl.appendChild(i)}}renderTodayMarker(){let t=new Date;if(t.getFullYear()!==this.currentYear)return;let e=this.getDayOfYear(t),n=this.isLeapYear(this.currentYear)?366:365,r=(e-.5)/n*2*Math.PI-Math.PI/2,i=T+(vt-5)*Math.cos(r),s=T+(vt-5)*Math.sin(r),o=T+(et+5)*Math.cos(r),l=T+(et+5)*Math.sin(r),c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("x1",String(i)),c.setAttribute("y1",String(s)),c.setAttribute("x2",String(o)),c.setAttribute("y2",String(l)),c.setAttribute("class","rc-bases-today-marker"),this.svgEl.appendChild(c)}renderCenter(){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",String(T)),t.setAttribute("cy",String(T)),t.setAttribute("r",String(vt-10)),t.setAttribute("class","rc-bases-center"),this.svgEl.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x",String(T)),e.setAttribute("y",String(T)),e.setAttribute("class","rc-bases-center-text"),e.textContent=String(this.currentYear),this.svgEl.appendChild(e);let n=this.data.data.filter(i=>{let s=this.getEntryDate(i);return s&&s.getFullYear()===this.currentYear}).length,r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",String(T)),r.setAttribute("y",String(T+25)),r.setAttribute("class","rc-bases-entry-count"),r.textContent=`${n} entries`,this.svgEl.appendChild(r)}createArcPath(t,e,n,r){let i=T+t*Math.cos(n),s=T+t*Math.sin(n),o=T+e*Math.cos(n),l=T+e*Math.sin(n),c=T+e*Math.cos(r),u=T+e*Math.sin(r),p=T+t*Math.cos(r),h=T+t*Math.sin(r),g=r-n>Math.PI?1:0;return[`M ${i} ${s}`,`L ${o} ${l}`,`A ${e} ${e} 0 ${g} 1 ${c} ${u}`,`L ${p} ${h}`,`A ${t} ${t} 0 ${g} 0 ${i} ${s}`,"Z"].join(" ")}monthToAngle(t){return t/12*2*Math.PI}getDayOfYear(t){let e=new Date(t.getFullYear(),0,0),n=t.getTime()-e.getTime(),r=1e3*60*60*24;return Math.floor(n/r)}isLeapYear(t){return t%4===0&&t%100!==0||t%400===0}};function $n(d,a){return new ze(d,a)}var On=require("obsidian");W();var pe=class extends On.FuzzySuggestModal{constructor(a,t){super(a),this.onSelect=t,this.setPlaceholder("Search for a color...")}getItems(){return Object.entries(P).map(([a,t])=>({name:a,hex:t}))}getItemText(a){return a.name}renderSuggestion(a,t){t.addClass("radial-calendar-color-suggestion");let e=t.createSpan({cls:"radial-calendar-color-preview"});e.style.backgroundColor=a.hex,e.style.width="16px",e.style.height="16px",e.style.borderRadius="50%",e.style.display="inline-block",e.style.marginRight="8px",e.style.verticalAlign="middle";let n=t.createSpan({cls:"radial-calendar-color-name"});n.setText(a.name.charAt(0).toUpperCase()+a.name.slice(1)),n.style.verticalAlign="middle";let r=t.createSpan({cls:"radial-calendar-color-hex"});r.setText(` (${a.hex})`),r.style.color="var(--text-muted)",r.style.fontSize="12px",r.style.verticalAlign="middle"}onChooseItem(a,t){this.onSelect(a.name)}};var he=require("obsidian");W();var Q=class extends he.Modal{constructor(a,t,e,n){super(a),this.propertyType=t,this.onSubmit=e,this.currentValue=n}onOpen(){let{contentEl:a}=this;a.empty(),a.addClass("radcal-property-modal");let t={color:"Select Color",pattern:"Select Pattern",opacity:"Set Opacity"}[this.propertyType];switch(a.createEl("h2",{text:t}),this.propertyType){case"color":this.renderColorPicker(a);break;case"pattern":this.renderPatternPicker(a);break;case"opacity":this.renderOpacitySlider(a);break}}onClose(){let{contentEl:a}=this;a.empty()}renderColorPicker(a){let t=a.createDiv({cls:"radcal-color-grid"});for(let[e,n]of Object.entries(P)){let r=t.createDiv({cls:`radcal-color-swatch ${this.currentValue===e?"is-selected":""}`});r.style.backgroundColor=n,r.setAttribute("data-color",e),r.setAttribute("title",e);let i=r.createDiv({cls:"radcal-color-label"});i.textContent=e,r.addEventListener("click",()=>{this.onSubmit(e),this.close()})}}renderPatternPicker(a){let t=a.createDiv({cls:"radcal-pattern-grid"}),e={solid:"Solid fill",striped:"Diagonal stripes",horizontal:"Horizontal lines",vertical:"Vertical lines",dotted:"Dot pattern",crosshatch:"Crossed diagonals",grid:"Grid pattern",wavy:"Wavy lines"};for(let n of z){let r=t.createDiv({cls:`radcal-pattern-option ${this.currentValue===n?"is-selected":""}`}),i=this.createPatternPreview(n);r.appendChild(i);let s=r.createDiv({cls:"radcal-pattern-label"});s.textContent=n,r.setAttribute("title",e[n]),r.addEventListener("click",()=>{this.onSubmit(n),this.close()})}}createPatternPreview(a){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","40"),t.setAttribute("height","40"),t.setAttribute("viewBox","0 0 40 40"),t.classList.add("radcal-pattern-preview");let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("width","40"),e.setAttribute("height","40"),e.setAttribute("fill","var(--interactive-accent)"),t.appendChild(e);let n=document.createElementNS("http://www.w3.org/2000/svg","g");switch(n.setAttribute("stroke","var(--text-on-accent)"),n.setAttribute("stroke-width","2"),n.setAttribute("fill","none"),a){case"striped":for(let i=-40;i<80;i+=8){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(i)),s.setAttribute("y1","0"),s.setAttribute("x2",String(i+40)),s.setAttribute("y2","40"),n.appendChild(s)}break;case"horizontal":for(let i=5;i<40;i+=10){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","0"),s.setAttribute("y1",String(i)),s.setAttribute("x2","40"),s.setAttribute("y2",String(i)),n.appendChild(s)}break;case"vertical":for(let i=5;i<40;i+=10){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(i)),s.setAttribute("y1","0"),s.setAttribute("x2",String(i)),s.setAttribute("y2","40"),n.appendChild(s)}break;case"dotted":n.setAttribute("fill","var(--text-on-accent)");for(let i=10;i<40;i+=15)for(let s=10;s<40;s+=15){let o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx",String(i)),o.setAttribute("cy",String(s)),o.setAttribute("r","3"),n.appendChild(o)}break;case"crosshatch":for(let i=-40;i<80;i+=10){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(i)),s.setAttribute("y1","0"),s.setAttribute("x2",String(i+40)),s.setAttribute("y2","40"),n.appendChild(s);let o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(i+40)),o.setAttribute("y1","0"),o.setAttribute("x2",String(i)),o.setAttribute("y2","40"),n.appendChild(o)}break;case"grid":for(let i=10;i<40;i+=10){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",String(i)),s.setAttribute("y1","0"),s.setAttribute("x2",String(i)),s.setAttribute("y2","40"),n.appendChild(s)}for(let i=10;i<40;i+=10){let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","0"),s.setAttribute("y1",String(i)),s.setAttribute("x2","40"),s.setAttribute("y2",String(i)),n.appendChild(s)}break;case"wavy":let r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","M0,10 Q10,5 20,10 T40,10 M0,25 Q10,20 20,25 T40,25"),n.appendChild(r);break;case"solid":default:break}return t.appendChild(n),t}renderOpacitySlider(a){let t=typeof this.currentValue=="number"?this.currentValue:100,e=a.createDiv({cls:"radcal-opacity-container"}),n=e.createDiv({cls:"radcal-opacity-value"});n.textContent=`${t}%`;let r=e.createEl("input",{type:"range",cls:"radcal-opacity-slider"});r.setAttribute("min","0"),r.setAttribute("max","100"),r.setAttribute("step","5"),r.value=String(t),r.addEventListener("input",()=>{n.textContent=`${r.value}%`});let i=e.createDiv({cls:"radcal-opacity-presets"});for(let s of[25,50,75,100])i.createEl("button",{text:`${s}%`,cls:`radcal-opacity-preset ${t===s?"is-selected":""}`}).addEventListener("click",()=>{this.onSubmit(s),this.close()});new he.Setting(e).addButton(s=>{s.setButtonText("Apply").setCta().onClick(()=>{this.onSubmit(parseInt(r.value,10)),this.close()})}).addButton(s=>{s.setButtonText("Cancel").onClick(()=>{this.close()})})}};W();var ge=class extends O.Plugin{constructor(){super(...arguments);this.service=null;this.calendarSync=null;this.settings={...zt}}async onload(){await this.loadSettings();let t={calendarWidth:"fit",dateProperties:["date","created","due"],endDateProperties:["endDate","end","until"],datePriority:"filename",dailyNoteFormat:this.settings.periodicNotesFormat.daily,dailyNoteFolder:this.settings.dailyNoteFolder,showMultiDayBars:!0,showWeekendHighlight:!0,anniversaryDateProperties:this.settings.anniversaryDateProperties||[]};this.service=new Kt(this.app,t),await this.service.initialize(),this.registerView(Et,n=>{let r=new Qt(n);return r.initialize({service:this.service,openFile:async i=>{let s=this.app.vault.getAbstractFileByPath(i);s instanceof O.TFile&&await this.app.workspace.getLeaf().openFile(s)},settings:this.settings,onSettingsChange:async i=>{this.settings=i,await this.saveSettings()}}),r}),this.registerView(Pt,n=>{let r=new te(n);return r.initialize({service:this.service,settings:this.settings,getActiveFileDate:()=>this.getActiveFileDate(),openFile:async i=>{let s=this.app.vault.getAbstractFileByPath(i);s instanceof O.TFile&&await this.app.workspace.getLeaf().openFile(s)}}),r});let e=new se(this.app,this.service,async n=>{let r=this.app.vault.getAbstractFileByPath(n);r instanceof O.TFile&&await this.app.workspace.getLeaf().openFile(r)});this.registerMarkdownCodeBlockProcessor("radcal",(n,r,i)=>e.process(n,r,i)),this.registerBasesViewIfAvailable(),this.addSettingTab(new oe(this.app,this)),this.addRibbonIcon("circle","Open Radial Calendar",()=>{this.activateView()}),this.addRibbonIcon("clock","Open Local Calendar",()=>{this.activateLocalCalendarView()}),this.addCommand({id:"open-radial-calendar",name:"Open Radial Calendar",callback:()=>{this.activateView()}}),this.addCommand({id:"open-local-calendar",name:"Open Local Calendar (Sidebar)",callback:()=>{this.activateLocalCalendarView()}}),this.calendarSync=new ce(this.app),this.addCommand({id:"sync-google-calendars",name:"Sync Google Calendars",callback:()=>{this.syncAllCalendars()}}),this.addCommand({id:"insert-color",name:"Insert Color",editorCallback:n=>{new pe(this.app,r=>{n.replaceSelection(r)}).open()}}),this.addCommand({id:"set-color",name:"Set Color",checkCallback:n=>{let r=this.app.workspace.getActiveFile();if(!r||r.extension!=="md")return!1;if(n)return!0;let i=this.getCurrentProperty(r,"radcal-color");new Q(this.app,"color",s=>{this.updateFrontmatter(r,"radcal-color",s)},i).open()}}),this.addCommand({id:"set-pattern",name:"Set Pattern",checkCallback:n=>{let r=this.app.workspace.getActiveFile();if(!r||r.extension!=="md")return!1;if(n)return!0;let i=this.getCurrentProperty(r,"radcal-pattern");new Q(this.app,"pattern",s=>{this.updateFrontmatter(r,"radcal-pattern",s)},i).open()}}),this.addCommand({id:"set-opacity",name:"Set Opacity",checkCallback:n=>{let r=this.app.workspace.getActiveFile();if(!r||r.extension!=="md")return!1;if(n)return!0;let i=this.getCurrentProperty(r,"radcal-opacity");new Q(this.app,"opacity",s=>{this.updateFrontmatter(r,"radcal-opacity",s)},i).open()}}),this.registerEvent(this.app.workspace.on("file-menu",(n,r)=>{!(r instanceof O.TFile)||r.extension!=="md"||(n.addSeparator(),n.addItem(i=>{i.setTitle("Radcal: Set Color").setIcon("palette").onClick(()=>{let s=this.getCurrentProperty(r,"radcal-color");new Q(this.app,"color",o=>{this.updateFrontmatter(r,"radcal-color",o)},s).open()})}),n.addItem(i=>{i.setTitle("Radcal: Set Pattern").setIcon("shapes").onClick(()=>{let s=this.getCurrentProperty(r,"radcal-pattern");new Q(this.app,"pattern",o=>{this.updateFrontmatter(r,"radcal-pattern",o)},s).open()})}),n.addItem(i=>{i.setTitle("Radcal: Set Opacity").setIcon("blend").onClick(()=>{let s=this.getCurrentProperty(r,"radcal-opacity");new Q(this.app,"opacity",o=>{this.updateFrontmatter(r,"radcal-opacity",o)},s).open()})}))})),this.syncOnStart(),this.startAutoSync()}async onunload(){var t,e;(t=this.calendarSync)==null||t.stopAutoSync(),this.calendarSync=null,(e=this.service)==null||e.destroy(),this.service=null}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},zt,t)}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:t}=this.app,e=null,n=t.getLeavesOfType(Et);n.length>0?e=n[0]:(e=t.getLeaf("tab"),e&&await e.setViewState({type:Et,active:!0})),e&&t.revealLeaf(e)}getActiveFileDate(){let t=this.app.workspace.getActiveFile();if(!t)return null;let e=t.basename.match(/(\d{4})-(\d{2})-(\d{2})/);return e?x(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10)):null}async activateLocalCalendarView(){var n;let{workspace:t}=this.app,e=(n=t.getLeavesOfType(Pt)[0])!=null?n:null;e||(e=t.getRightLeaf(!1),e&&await e.setViewState({type:Pt,active:!0})),e&&t.revealLeaf(e)}async syncAllCalendars(){var n;if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(r=>r.enabled&&r.url);if(t.length===0){new O.Notice("No calendar sources configured");return}new O.Notice(`Syncing ${t.length} calendar(s)...`);let e=await this.calendarSync.syncAllCalendars(t);this.showSyncResults(e);for(let r of e)if(r.success){let i=this.settings.calendarSources.find(s=>s.id===r.calendarId);i&&(i.lastSync=Date.now())}await this.saveSettings(),await((n=this.service)==null?void 0:n.initialize())}async syncOnStart(){if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(e=>e.enabled&&e.url&&e.syncOnStart);t.length!==0&&setTimeout(async()=>{var i;let e=await this.calendarSync.syncAllCalendars(t);for(let s of e)if(s.success){let o=this.settings.calendarSources.find(l=>l.id===s.calendarId);o&&(o.lastSync=Date.now())}await this.saveSettings();let n=e.filter(s=>s.success).length,r=e.reduce((s,o)=>s+o.eventsCreated+o.eventsUpdated,0);r>0&&new O.Notice(`Calendar sync: ${r} events updated from ${n} calendar(s)`),await((i=this.service)==null?void 0:i.initialize())},2e3)}startAutoSync(){if(!this.calendarSync)return;let t=this.settings.calendarSources.filter(e=>e.enabled&&e.url&&e.syncIntervalMinutes>0);t.length!==0&&this.calendarSync.startAutoSync(t,async e=>{var r;if(e.success){let i=this.settings.calendarSources.find(s=>s.id===e.calendarId);i&&(i.lastSync=Date.now(),await this.saveSettings())}let n=e.eventsCreated+e.eventsUpdated;n>0&&new O.Notice(`${e.calendarName}: ${n} events synced`),await((r=this.service)==null?void 0:r.initialize())})}showSyncResults(t){let e=t.filter(o=>o.success).length,n=t.reduce((o,l)=>o+l.eventsCreated,0),r=t.reduce((o,l)=>o+l.eventsUpdated,0),i=t.reduce((o,l)=>o+l.errors.length,0),s=`Sync complete: ${e}/${t.length} calendars`;n>0&&(s+=`, ${n} created`),r>0&&(s+=`, ${r} updated`),i>0&&(s+=`, ${i} errors`),new O.Notice(s);for(let o of t)o.errors.length>0&&console.warn(`Calendar sync errors (${o.calendarName}):`,o.errors)}getCurrentProperty(t,e){let n=this.app.metadataCache.getFileCache(t),r=n==null?void 0:n.frontmatter;if(!r)return;let i=r[e];if(typeof i=="string"||typeof i=="number")return i}async updateFrontmatter(t,e,n){try{await this.app.fileManager.processFrontMatter(t,r=>{r[e]=n}),new O.Notice(`Set ${e} to ${n}`)}catch(r){console.error("Failed to update frontmatter:",r),new O.Notice(`Failed to update ${e}`)}}registerBasesViewIfAvailable(){if(typeof this.registerBasesView!="function"){console.log("Radial Calendar: Bases API not available (requires Obsidian 1.10+)");return}try{this.registerBasesView("radial-calendar",{name:"Radial Calendar",icon:"circle",factory:$n,options:()=>[{type:"text",key:"dateProperty",displayName:"Date property",placeholder:"e.g. date, birthday, due",default:"date"},{type:"dropdown",key:"color",displayName:"Color",default:"blue",options:{blue:"Blue",green:"Green",red:"Red",purple:"Purple",orange:"Orange",teal:"Teal",pink:"Pink",yellow:"Yellow"}}]})&&console.log("Radial Calendar: Bases view registered successfully")}catch(t){console.warn("Radial Calendar: Failed to register Bases view:",t)}}};
