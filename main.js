/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Y=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var K=(o,t)=>{for(var e in t)Y(o,e,{get:t[e],enumerable:!0})},Z=(o,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of X(t))!q.call(o,r)&&r!==e&&Y(o,r,{get:()=>t[r],enumerable:!(n=J(t,r))||n.enumerable});return o};var Q=o=>Z(Y({},"__esModule",{value:!0}),o);var it={};K(it,{default:()=>$});module.exports=Q(it);var O=require("obsidian");var A=class{constructor(t){this.app=t}getAllMarkdownFiles(){return this.app.vault.getMarkdownFiles().map(e=>this.toFileInfo(e))}getMarkdownFilesInFolder(t){return this.getAllMarkdownFiles().filter(e=>e.folderPath?e.folderPath===t||e.folderPath.startsWith(t+"/"):!1)}getFileByPath(t){let e=this.app.vault.getAbstractFileByPath(t);return e instanceof this.getTFileClass()?e:null}async readFile(t){let e=this.getFileByPath(t);if(!e)return null;try{return await this.app.vault.read(e)}catch(n){return null}}async createOrOpenDailyNote(t,e=""){let n=this.getFileByPath(t);if(!n){let r=t.substring(0,t.lastIndexOf("/"));r&&await this.ensureFolderExists(r),n=await this.app.vault.create(t,e)}return n}async ensureFolderExists(t){this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t)}fileExists(t){return this.getFileByPath(t)!==null}getRoot(){return this.app.vault.getRoot()}toFileInfo(t){var e,n;return Object.freeze({path:t.path,basename:t.basename,name:t.name,extension:t.extension,folderPath:(n=(e=t.parent)==null?void 0:e.path)!=null?n:null})}getTFileClass(){let t=this.app.vault.getMarkdownFiles();return t.length>0?t[0].constructor:class{}}};var P=class{constructor(t){this.app=t}getMetadata(t){let e=this.app.metadataCache.getFileCache(t);return this.extractMetadata(e)}getMetadataByPath(t){let e=this.app.vault.getAbstractFileByPath(t);return!e||!this.isMarkdownFile(e)?null:this.getMetadata(e)}getProperty(t,e){var r;return(r=this.getMetadata(t).frontmatter)==null?void 0:r[e]}getStringProperty(t,e){let n=this.getProperty(t,e);return typeof n=="string"?n:n instanceof Date?this.formatDate(n):typeof n=="number"?String(n):null}getDateProperty(t,e){let n=this.getProperty(t,e);if(!n)return null;if(typeof n=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;let r=n.match(/^(\d{4}-\d{2}-\d{2})/);return r?r[1]:null}return n instanceof Date&&!isNaN(n.getTime())?this.formatDate(n):this.isLocalDateLike(n)?this.formatLocalDate(n):null}getTags(t){return this.getMetadata(t).tags}hasTag(t,e){let n=e.startsWith("#")?e:`#${e}`;return this.getTags(t).some(a=>a.tag.toLowerCase()===n.toLowerCase())}onMetadataChange(t){let e=n=>t(n);return this.app.metadataCache.on("changed",e),()=>this.app.metadataCache.off("changed",e)}extractMetadata(t){var r;let e=(r=t==null?void 0:t.frontmatter)!=null?r:null,n=[];if(e!=null&&e.tags){let a=Array.isArray(e.tags)?e.tags:[e.tags];for(let i of a)if(typeof i=="string"){let s=i.startsWith("#")?i:`#${i}`;n.push({tag:s,name:s.substring(1)})}}if(t!=null&&t.tags)for(let a of t.tags)n.find(s=>s.tag.toLowerCase()===a.tag.toLowerCase())||n.push({tag:a.tag,name:a.tag.substring(1)});return Object.freeze({frontmatter:e,tags:Object.freeze(n)})}formatDate(t){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}formatLocalDate(t){let e=t.year,n=String(t.month).padStart(2,"0"),r=String(t.day).padStart(2,"0");return`${e}-${n}-${r}`}isLocalDateLike(t){return typeof t=="object"&&t!==null&&"year"in t&&"month"in t&&"day"in t&&typeof t.year=="number"&&typeof t.month=="number"&&typeof t.day=="number"}isMarkdownFile(t){return typeof t=="object"&&t!==null&&"extension"in t&&t.extension==="md"}};function M(o,t,e){let n={year:o,month:t,day:e};if(!tt(n))throw new Error(`Invalid date: ${o}-${t}-${e}`);return Object.freeze(n)}function C(o){let t=o.month.toString().padStart(2,"0"),e=o.day.toString().padStart(2,"0");return`${o.year}-${t}-${e}`}function g(o,t){return o.year!==t.year?o.year-t.year:o.month!==t.month?o.month-t.month:o.day-t.day}function j(o,t){return o.year===t.year&&o.month===t.month&&o.day===t.day}function tt(o){let{year:t,month:e,day:n}=o;if(!Number.isInteger(t)||t<1||!Number.isInteger(e)||e<1||e>12||!Number.isInteger(n)||n<1)return!1;let r=D(t,e);return n<=r}function D(o,t){let e=[31,28,31,30,31,30,31,31,30,31,30,31];return t===2&&et(o)?29:e[t-1]}function et(o){return o%4===0&&o%100!==0||o%400===0}function S(o){let t=o.year,e=o.month,n=o.day;e<3&&(e+=12,t-=1);let r=n,a=e,i=t%100,s=Math.floor(t/100),l=(r+Math.floor(13*(a+1)/5)+i+Math.floor(i/4)+Math.floor(s/4)-2*s)%7;return l=(l%7+7)%7,(l+6)%7}function b(){let o=new Date;return Object.freeze({year:o.getFullYear(),month:o.getMonth()+1,day:o.getDate()})}var T=class{constructor(t={}){var e,n;this.entriesByPath=new Map,this.entriesByDate=new Map,this.multiDayEntriesByDate=new Map,this.stats={hits:0,misses:0,lastRebuild:0},this.config={maxEntries:(e=t.maxEntries)!=null?e:1e4,debug:(n=t.debug)!=null?n:!1}}addEntry(t){this.removeEntry(t.filePath),this.entriesByPath.set(t.filePath,t);let e=C(t.startDate);this.addToDateIndex(e,t,this.entriesByDate),t.isMultiDay&&t.endDate&&this.indexMultiDayEntry(t),this.log(`Added entry: ${t.filePath}`)}removeEntry(t){let e=this.entriesByPath.get(t);if(!e)return;this.entriesByPath.delete(t);let n=C(e.startDate);this.removeFromDateIndex(n,e.id,this.entriesByDate),e.isMultiDay&&e.endDate&&this.removeMultiDayEntry(e),this.log(`Removed entry: ${t}`)}getEntriesForDate(t){var i,s;let e=C(t),n=(i=this.entriesByDate.get(e))!=null?i:[],r=(s=this.multiDayEntriesByDate.get(e))!=null?s:[];n.length>0||r.length>0?this.stats.hits++:this.stats.misses++;let a=new Map;for(let l of n)a.set(l.id,l);for(let l of r)a.set(l.id,l);return Array.from(a.values())}getEntriesInRange(t,e){var r;let n=new Map;for(let a of this.entriesByPath.values()){let i=(r=a.endDate)!=null?r:a.startDate;g(a.startDate,e)<=0&&g(i,t)>=0&&n.set(a.id,a)}return Array.from(n.values())}getMultiDayEntries(){return Array.from(this.entriesByPath.values()).filter(t=>t.isMultiDay)}getEntryByPath(t){return this.entriesByPath.get(t)}hasEntry(t){return this.entriesByPath.has(t)}getAllEntries(){return Array.from(this.entriesByPath.values())}clear(){this.entriesByPath.clear(),this.entriesByDate.clear(),this.multiDayEntriesByDate.clear(),this.stats={hits:0,misses:0,lastRebuild:Date.now()},this.log("Cache cleared")}rebuild(t){this.clear(),this.stats.lastRebuild=Date.now();for(let e of t)this.addEntry(e);this.log(`Cache rebuilt with ${t.length} entries`)}getStats(){return Object.freeze({entryCount:this.entriesByPath.size,dateCount:this.entriesByDate.size+this.multiDayEntriesByDate.size,hits:this.stats.hits,misses:this.stats.misses,lastRebuild:this.stats.lastRebuild})}indexMultiDayEntry(t){if(!t.endDate)return;let e=t.startDate,n=t.endDate;for(;g(e,n)<0;)if(e=this.addOneDay(e),g(e,n)<=0){let r=C(e);this.addToDateIndex(r,t,this.multiDayEntriesByDate)}}removeMultiDayEntry(t){if(!t.endDate)return;let e=t.startDate,n=t.endDate;for(;g(e,n)<0;)if(e=this.addOneDay(e),g(e,n)<=0){let r=C(e);this.removeFromDateIndex(r,t.id,this.multiDayEntriesByDate)}}addToDateIndex(t,e,n){let r=n.get(t);r?r.push(e):n.set(t,[e])}removeFromDateIndex(t,e,n){let r=n.get(t);if(!r)return;let a=r.filter(i=>i.id!==e);a.length===0?n.delete(t):n.set(t,a)}addOneDay(t){let e=t.day+1,n=t.month,r=t.year,a=this.getDaysInMonth(r,n);return e>a&&(e=1,n+=1,n>12&&(n=1,r+=1)),{year:r,month:n,day:e}}getDaysInMonth(t,e){let n=[31,28,31,30,31,30,31,31,30,31,30,31];return e===2?t%4===0&&t%100!==0||t%400===0?29:28:n[e-1]}log(t){this.config.debug&&console.log(`[EntryCache] ${t}`)}};var I=class I{parseDate(t){if(t==null)return null;if(typeof t=="string")return this.parseDateString(t);if(t instanceof Date)return isNaN(t.getTime())?null:{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()};if(typeof t=="object"&&t!==null){let e=t;if(typeof e.year=="number"&&typeof e.month=="number"&&typeof e.day=="number"&&this.isValidDate(e.year,e.month,e.day))return{year:e.year,month:e.month,day:e.day}}return null}parseDateString(t){let n=t.trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!n)return null;let r=parseInt(n[1],10),a=parseInt(n[2],10),i=parseInt(n[3],10);return this.isValidDate(r,a,i)?{year:r,month:a,day:i}:null}isValidDate(t,e,n){if(t<1900||t>2100||e<1||e>12||n<1||n>31)return!1;let r=this.getDaysInMonth(t,e);return!(n>r)}getDaysInMonth(t,e){let n=[31,28,31,30,31,30,31,31,30,31,30,31];return e===2&&this.isLeapYear(t)?29:n[e-1]}isLeapYear(t){return t%4===0&&t%100!==0||t%400===0}extractFromFilename(t){let e={start:null,end:null};if(!t||typeof t!="string")return e;let n=t.match(I.DATE_PATTERN);return!n||n.length===0||(e.start=this.parseDate(n[0]),n.length>=2&&(e.end=this.parseDate(n[1]))),e}extractFromProperties(t,e){if(!t||typeof t!="object"||!Array.isArray(e))return null;for(let n of e){if(typeof n!="string"||!n)continue;let r=t[n];if(r==null)continue;let a=this.parseDate(r);if(a!==null)return a}return null}extractDates(t,e,n){let r={start:null,end:null},a=this.extractFromFilename(t);for(let i of n.priorities)i==="filename"?(r.start===null&&a.start!==null&&(r.start=a.start),r.end===null&&a.end!==null&&(r.end=a.end)):i==="properties"&&(r.start===null&&(r.start=this.extractFromProperties(e,n.startSources)),r.end===null&&(r.end=this.extractFromProperties(e,n.endSources)));return r}};I.DATE_PATTERN=/(\d{4}-\d{2}-\d{2})/g;var w=I,ht=new w;var nt=["January","February","March","April","May","June","July","August","September","October","November","December"],k=class{getDaysInMonth(t,e){return D(t,e)}getFirstDayOfWeek(t,e){let n=M(t,e,1);return S(n)}isToday(t){let e=b();return j(t,e)}generateGrid(t){let e=[];for(let n=1;n<=12;n++)e.push(this.generateMonth(t,n));return{year:t,months:e}}generateMonth(t,e){let n=this.getDaysInMonth(t,e),r=this.getFirstDayOfWeek(t,e),a=[];for(let i=0;i<r;i++)a.push({date:M(t,e,1),isToday:!1,isEmpty:!0});for(let i=1;i<=n;i++){let s=M(t,e,i);a.push({date:s,isToday:this.isToday(s),isEmpty:!1})}return{month:e,name:nt[e-1],startDayOfWeek:r,daysInMonth:n,days:a}}};var rt=24,x=class{calculateMonthSegments(t,e,n){let r=[];if(g(t,e)>0)return r;let a=t.year,i=t.month,s=0;for(;s<rt;){let l=a===t.year&&i===t.month,c=a===e.year&&i===e.month,d=l?t.day:1,y=c?e.day:D(a,i);if(r.push({year:a,month:i,startDay:d,endDay:y,entryId:n}),c)break;i++,i>12&&(i=1,a++),s++}return r}calculateBarPositions(t,e){let n=new Map;if(t.length===0)return n;let r=[...t].sort((i,s)=>i.startDay!==s.startDay?i.startDay-s.startDay:s.endDay-s.startDay-(i.endDay-i.startDay)),a=[];for(let i=0;i<=31;i++)a.push(new Set);for(let i of r){let s=(e.startDayOfWeek+i.startDay-1)%7,l=(e.startDayOfWeek+i.endDay-1)%7,c=i.endDay-i.startDay+1,d=0,y=!1;for(;!y;){let u=!0;for(let h=i.startDay;h<=i.endDay;h++)if(a[h].has(d)){u=!1;break}if(u){y=!0;for(let h=i.startDay;h<=i.endDay;h++)a[h].add(d)}else d++;if(d>100)break}n.set(i.entryId,{rowIndex:d,startColumn:s,endColumn:l,span:c})}return n}},bt=new x;function G(o){let t=o.endDate!==null&&(o.startDate.year!==o.endDate.year||o.startDate.month!==o.endDate.month||o.startDate.day!==o.endDate.day);return Object.freeze({id:o.id,filePath:o.filePath,fileName:o.fileName,displayName:o.displayName,startDate:o.startDate,endDate:o.endDate,isMultiDay:t,metadata:Object.freeze({tags:Object.freeze([...o.metadata.tags]),folder:o.metadata.folder,properties:Object.freeze({...o.metadata.properties})})})}var R=class{constructor(t,e){this.unregisterMetadataListener=null;this.eventListeners=null;this.vaultRepository=new A(t),this.metadataRepository=new P(t),this.entryCache=new T({debug:!1}),this.dateEngine=new w,this.calendarEngine=new k,this.multiDayEngine=new x,this.settings=e,this.currentYear=b().year}async initialize(){await this.rebuildCache(),this.setupMetadataListener()}destroy(){this.unregisterMetadataListener&&(this.unregisterMetadataListener(),this.unregisterMetadataListener=null),this.eventListeners=null}setEventListeners(t){this.eventListeners=t}async updateSettings(t){let e=this.settings.dateProperties.join(",")!==t.dateProperties.join(",")||this.settings.endDateProperties.join(",")!==t.endDateProperties.join(",")||this.settings.datePriority!==t.datePriority;this.settings=t,e&&await this.rebuildCache()}getCurrentYear(){return this.currentYear}setCurrentYear(t){var e;this.currentYear!==t&&(this.currentYear=t,(e=this.eventListeners)==null||e.onYearChanged(t))}nextYear(){this.setCurrentYear(this.currentYear+1)}previousYear(){this.setCurrentYear(this.currentYear-1)}goToToday(){this.setCurrentYear(b().year)}generateCalendarGrid(){return this.calendarEngine.generateGrid(this.currentYear)}getEntriesForDate(t){return this.entryCache.getEntriesForDate(t)}getMultiDayEntries(){return this.entryCache.getMultiDayEntries().filter(t=>{var a;let e={year:this.currentYear,month:1,day:1},n={year:this.currentYear,month:12,day:31},r=(a=t.endDate)!=null?a:t.startDate;return t.startDate.year===this.currentYear||t.startDate.year<this.currentYear&&r.year>=this.currentYear})}calculateBarPositions(t,e){return new Map}async openDailyNote(t){let e=this.settings.dailyNoteFormat,n=this.settings.dailyNoteFolder,r=this.formatDailyNoteFilename(t,e),a=n?`${n}/${r}.md`:`${r}.md`,i=await this.vaultRepository.createOrOpenDailyNote(a);console.log(`Opening daily note: ${i.path}`)}getCacheStats(){let t=this.entryCache.getStats();return{entryCount:t.entryCount,dateCount:t.dateCount}}async rebuildCache(){var r;let t=this.vaultRepository.getAllMarkdownFiles(),e=[],n=this.getDateExtractionConfig();for(let a of t){let i=this.createEntryFromFile(a,n);i&&e.push(i)}this.entryCache.rebuild(e),(r=this.eventListeners)==null||r.onEntriesUpdated()}createEntryFromFile(t,e){var l,c,d;let n=this.metadataRepository.getMetadataByPath(t.path),r=(l=n==null?void 0:n.frontmatter)!=null?l:null,{start:a,end:i}=this.dateEngine.extractDates(t.name,r,e);if(!a)return null;let s={};if(r)for(let[y,u]of Object.entries(r))(typeof u=="string"||typeof u=="number"||typeof u=="boolean")&&(s[y]=u);return G({id:t.path,filePath:t.path,fileName:t.name,displayName:t.basename,startDate:a,endDate:i,metadata:{tags:(c=n==null?void 0:n.tags.map(y=>y.name))!=null?c:[],folder:(d=t.folderPath)!=null?d:"",properties:s}})}getDateExtractionConfig(){return{startSources:this.settings.dateProperties,endSources:this.settings.endDateProperties,priorities:this.settings.datePriority==="property"?["properties","filename"]:["filename","properties"]}}formatDailyNoteFilename(t,e){return e.replace("YYYY",String(t.year)).replace("MM",String(t.month).padStart(2,"0")).replace("DD",String(t.day).padStart(2,"0"))}setupMetadataListener(){this.unregisterMetadataListener=this.metadataRepository.onMetadataChange(t=>{this.handleFileChange(t.path)})}handleFileChange(t){var n;let e=this.vaultRepository.getAllMarkdownFiles().find(r=>r.path===t);if(!e)this.entryCache.removeEntry(t);else{let r=this.getDateExtractionConfig(),a=this.createEntryFromFile(e,r);a?this.entryCache.addEntry(a):this.entryCache.removeEntry(t)}(n=this.eventListeners)==null||n.onEntriesUpdated()}};var N=require("obsidian");var F="radial-calendar-plugin",at=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_=["January","February","March","April","May","June","July","August","September","October","November","December"],V=800,p=V/2,f=380,v=120,z=100,Yt=(f-v)/31,B=class extends N.ItemView{constructor(e){super(e);this.config=null;this.containerEl_=null;this.svgEl=null;this.tooltipEl=null}getViewType(){return F}getDisplayText(){return"Radial Calendar"}getIcon(){return"circle"}initialize(e){this.config=e,this.config.service.setEventListeners({onEntriesUpdated:()=>this.render(),onYearChanged:()=>this.render()})}async onOpen(){this.containerEl_=this.contentEl,this.containerEl_.addClass("radial-calendar-plugin"),this.render()}async onClose(){var e;(e=this.containerEl_)==null||e.empty(),this.containerEl_=null,this.svgEl=null,this.tooltipEl=null}render(){if(!this.containerEl_||!this.config)return;this.containerEl_.empty();let n=this.config.service.getCurrentYear(),r=this.containerEl_.createDiv({cls:"rc-container"});this.renderHeader(r,n);let a=r.createDiv({cls:"rc-wrapper"});this.renderRadialCalendar(a,n),this.tooltipEl=r.createDiv({cls:"rc-tooltip"}),this.tooltipEl.style.display="none"}renderHeader(e,n){if(!this.config)return;let r=e.createDiv({cls:"rc-header"});r.createEl("button",{text:"\u2190",cls:"rc-nav-btn",attr:{"aria-label":"Previous year"}}).addEventListener("click",()=>{var l;(l=this.config)==null||l.service.previousYear()}),r.createEl("span",{text:String(n),cls:"rc-year-title"}),r.createEl("button",{text:"\u2192",cls:"rc-nav-btn",attr:{"aria-label":"Next year"}}).addEventListener("click",()=>{var l;(l=this.config)==null||l.service.nextYear()}),r.createEl("button",{text:"Today",cls:"rc-nav-btn rc-today-btn",attr:{"aria-label":"Go to today"}}).addEventListener("click",()=>{var l;(l=this.config)==null||l.service.goToToday()})}renderRadialCalendar(e,n){if(!this.config)return;let r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox",`0 0 ${V} ${V}`),r.setAttribute("class","rc-svg"),this.svgEl=r,this.renderBackgroundCircle(r);for(let a=1;a<=12;a++)this.renderMonthSegment(r,n,a);this.renderCenter(r,n),this.renderMonthLabels(r),this.renderTodayMarker(r,n),e.appendChild(r)}renderBackgroundCircle(e){let n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",String(p)),n.setAttribute("cy",String(p)),n.setAttribute("r",String(f)),n.setAttribute("class","rc-background"),e.appendChild(n)}renderCenter(e,n){let r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",String(p)),r.setAttribute("cy",String(p)),r.setAttribute("r",String(v-10)),r.setAttribute("class","rc-center"),e.appendChild(r)}renderMonthLabels(e){for(let n=0;n<12;n++){let r=this.monthToAngle(n+1)+Math.PI/12,a=p+z*Math.cos(r-Math.PI/2),i=p+z*Math.sin(r-Math.PI/2),s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",String(a)),s.setAttribute("y",String(i)),s.setAttribute("class","rc-month-label"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central"),s.textContent=at[n],e.appendChild(s)}}renderMonthSegment(e,n,r){if(!this.config)return;let a=D(n,r),i=this.monthToAngle(r),l=Math.PI/6/a,c=b(),d=c.year===n&&c.month===r;for(let y=1;y<=a;y++){let u=M(n,r,y),h=S(u),m=d&&c.day===y,E=h===0||h===6,L=i+(y-1)*l,H=L+l-.002,U=this.config.service.getEntriesForDate(u);this.renderDayArc(e,u,L,H,m,E,U)}this.renderMonthSeparator(e,i)}renderDayArc(e,n,r,a,i,s,l){if(!this.config)return;let c=v,d=f,y=this.createArcPath(c,d,r,a),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",y);let h=["rc-day-arc"];i&&h.push("rc-day-arc--today"),s&&h.push("rc-day-arc--weekend"),l.length>0&&h.push("rc-day-arc--has-notes"),l.length>3&&h.push("rc-day-arc--many-notes"),u.setAttribute("class",h.join(" ")),u.setAttribute("data-date",`${n.year}-${String(n.month).padStart(2,"0")}-${String(n.day).padStart(2,"0")}`),u.addEventListener("click",async m=>{var E;m.preventDefault(),await((E=this.config)==null?void 0:E.service.openDailyNote(n))}),u.addEventListener("mouseenter",m=>{this.showTooltip(m,n,l)}),u.addEventListener("mouseleave",()=>{this.hideTooltip()}),u.addEventListener("contextmenu",m=>{m.preventDefault(),l.length>0&&this.showDayContextMenu(m,n,l)}),e.appendChild(u),l.length>0&&this.renderNoteIndicators(e,r,a,l)}renderNoteIndicators(e,n,r,a){let i=f-15,s=f-5,l=Math.min(a.length,3),c=(r-n)/l;for(let d=0;d<l;d++){let y=n+d*c+.001,u=y+c-.002,h=this.createArcPath(i,s,y,u),m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",h),m.setAttribute("class","rc-note-indicator"),e.appendChild(m)}}renderMonthSeparator(e,n){let r=p+v*Math.cos(n-Math.PI/2),a=p+v*Math.sin(n-Math.PI/2),i=p+f*Math.cos(n-Math.PI/2),s=p+f*Math.sin(n-Math.PI/2),l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",String(r)),l.setAttribute("y1",String(a)),l.setAttribute("x2",String(i)),l.setAttribute("y2",String(s)),l.setAttribute("class","rc-month-separator"),e.appendChild(l)}renderTodayMarker(e,n){let r=b();if(r.year!==n)return;let a=D(n,r.month),i=this.monthToAngle(r.month),l=Math.PI/6/a,c=i+(r.day-.5)*l,d=p+(v-10)*Math.cos(c-Math.PI/2),y=p+(v-10)*Math.sin(c-Math.PI/2),u=p+(f+5)*Math.cos(c-Math.PI/2),h=p+(f+5)*Math.sin(c-Math.PI/2),m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",String(d)),m.setAttribute("y1",String(y)),m.setAttribute("x2",String(u)),m.setAttribute("y2",String(h)),m.setAttribute("class","rc-today-marker"),e.appendChild(m)}createArcPath(e,n,r,a){let i=r-Math.PI/2,s=a-Math.PI/2,l=p+e*Math.cos(i),c=p+e*Math.sin(i),d=p+e*Math.cos(s),y=p+e*Math.sin(s),u=p+n*Math.cos(i),h=p+n*Math.sin(i),m=p+n*Math.cos(s),E=p+n*Math.sin(s),L=a-r>Math.PI?1:0;return`
      M ${l} ${c}
      L ${u} ${h}
      A ${n} ${n} 0 ${L} 1 ${m} ${E}
      L ${d} ${y}
      A ${e} ${e} 0 ${L} 0 ${l} ${c}
      Z
    `}monthToAngle(e){return(e-1)*Math.PI/6}showTooltip(e,n,r){var c;if(!this.tooltipEl)return;let s=`<div class="rc-tooltip-date">${`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][S(n)]}, ${_[n.month-1]} ${n.day}, ${n.year}`}</div>`;if(r.length>0){s+='<div class="rc-tooltip-notes">';for(let d of r.slice(0,5))s+=`<div class="rc-tooltip-note">${d.displayName}</div>`;r.length>5&&(s+=`<div class="rc-tooltip-more">+${r.length-5} more</div>`),s+="</div>"}this.tooltipEl.innerHTML=s,this.tooltipEl.style.display="block";let l=(c=this.containerEl_)==null?void 0:c.getBoundingClientRect();if(l){let d=e.clientX-l.left+10,y=e.clientY-l.top+10;this.tooltipEl.style.left=`${d}px`,this.tooltipEl.style.top=`${y}px`}}hideTooltip(){this.tooltipEl&&(this.tooltipEl.style.display="none")}showDayContextMenu(e,n,r){if(!this.config)return;let a=new N.Menu;a.addItem(i=>{i.setTitle(`Open ${_[n.month-1]} ${n.day}`).setIcon("calendar").onClick(async()=>{var s;await((s=this.config)==null?void 0:s.service.openDailyNote(n))})}),a.addSeparator();for(let i of r.slice(0,10))a.addItem(s=>{s.setTitle(i.displayName).setIcon("file").onClick(()=>{var l;(l=this.config)==null||l.openFile(i.filePath)})});r.length>10&&a.addItem(i=>{i.setTitle(`+${r.length-10} more...`).setDisabled(!0)}),a.showAtMouseEvent(e)}};var W={dateProperties:["date","created","due"],endDateProperties:["endDate","end","until"],datePriority:"filename",dailyNoteFormat:"YYYY-MM-DD",dailyNoteFolder:""},$=class extends O.Plugin{constructor(){super(...arguments);this.service=null;this.settings=W}async onload(){await this.loadSettings(),this.service=new R(this.app,this.settings),await this.service.initialize(),this.registerView(F,e=>{let n=new B(e);return n.initialize({service:this.service,openFile:async r=>{let a=this.app.vault.getAbstractFileByPath(r);a instanceof O.TFile&&await this.app.workspace.getLeaf().openFile(a)}}),n}),this.addRibbonIcon("circle","Open Radial Calendar",()=>{this.activateView()}),this.addCommand({id:"open-radial-calendar",name:"Open Radial Calendar",callback:()=>{this.activateView()}})}async onunload(){var e;(e=this.service)==null||e.destroy(),this.service=null}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},W,e)}async activateView(){let{workspace:e}=this.app,n=null,r=e.getLeavesOfType(F);r.length>0?n=r[0]:(n=e.getLeaf("tab"),n&&await n.setViewState({type:F,active:!0})),n&&e.revealLeaf(n)}};
